import{Q as M,r as V,w as R,I as D,j as l,k as i,l as t,D as m,s as E,ac as N,X as p,x as d,q as u,ad as T,W as J,e as $,o as P,ae as j,i as B,z as b,F as w,C as S,t as K,m as O,T as Q,S as W,af as X,K as A,U as G,V as Y}from"./index.c94220ca.js";const Z={name:"replyComment",props:["params"],setup(s,{emit:c}){const a=V({msg:"",maxLen:140}),e=()=>{c("replyMsg",a.msg)};return R(()=>a.msg,()=>{a.msg=a.maxLen>=a.msg?a.msg:a.msg.substring(0,a.maxLen)}),{...D(a),subReplyComment:e}}},ee={class:"reply-comment"},te={class:"comment_textarea"},se={class:"pre"},oe={class:"comment_box_footer"},ne={class:"comment_limit"},ae={class:"num"};function ce(s,c,a,e,x,f){const y=T;return l(),i("div",ee,[t("h3",null,"\u6211\u56DE\u590D@"+m(a.params.user.nickname)+":",1),t("div",te,[t("div",se,m(s.msg),1),E(t("textarea",{class:"J_inpBox inp-paragraph",name:"leave_msg",id:"leave_msg",placeholder:"\u671F\u5F85\u4F60\u7684\u795E\u8BC4\u8BBA\u2026\u2026","onUpdate:modelValue":c[0]||(c[0]=g=>s.msg=g)},null,512),[[N,s.msg]])]),t("div",oe,[t("span",ne,[t("em",ae,m(s.msg.length),1),p("/"+m(s.maxLen),1)]),d(y,{type:"primary",color:"#ff641e",onClick:e.subReplyComment},{default:u(()=>[p("\u8BC4\u8BBA")]),_:1},8,["onClick"])])])}var me=M(Z,[["render",ce],["__scopeId","data-v-31569ab6"]]);const re={name:"Comments",components:{ReplyComment:me},props:{sId:{type:[Number,String],default:0},type:{type:Number,default:0}},setup(s){const{proxy:c}=A(),a=J(),e=V({msg:"",maxLen:140,curId:s.sId,limit:20,offset:0,before:0,hotComments:[],comments:[],total:0,currentPage:0,isEmpty:!1,replyCommentId:0,replyIndex:-1}),x=$(()=>a.getters.userInfo),f=$(()=>a.getters.isLogin),y=$(()=>function(o,r){return o.commentId===e.replyCommentId&&e.replyIndex===r}),g=()=>{switch(s.type){case 0:v("commentSong");break;case 1:v("commentMv");break;case 3:v("albumComment");break;case 5:v("commentVideo");break}},v=async o=>{const{data:r}=await c.$http[o]({id:e.curId,limit:e.limit,offset:e.offset,before:e.before,timestamp:new Date().valueOf()});C(r)},C=o=>{if(o.code!==200)return c.$msg.error("\u6570\u636E\u8BF7\u6C42\u5931\u8D25");e.total=o.total,e.hotComments=o.hotComments||[],e.hotComments.map(r=>(r.isHot=!0,r)),e.comments=[...e.hotComments,...o.comments],e.isEmpty=e.before===0&&!e.comments.length},I=async(o,r,q)=>{const F={t:o,type:s.type,id:e.curId,content:r,commentId:q},{data:z}=await c.$http.comment(F);if(z.code!==200)return c.$msg.error("\u6570\u636E\u8BF7\u6C42\u5931\u8D25");e.msg="",g(),o===0?c.$msg.success("\u5220\u9664\u8BC4\u8BBA\u6210\u529F\uFF01"):o===1?c.$msg.success("\u8BC4\u8BBA\u6210\u529F\uFF01"):o===2&&(c.$msg.success("\u56DE\u590D\u8BC4\u8BBA\u6210\u529F\uFF01"),e.replyCommentId=0,e.replyIndex=-1)},L=async()=>{if(!f.value){a.commit("setLoginDialog",!0);return}I(1,e.msg)},n=o=>{c.$msgBox.confirm("\u786E\u5B9A\u5220\u9664\u8BC4\u8BBA\uFF1F","\u63D0\u793A",{confirmButtonText:"\u786E\u5B9A",cancelButtonText:"\u53D6\u6D88",center:!0}).then(()=>{I(0,"",o.commentId)}).catch(()=>{})},k=(o,r)=>{if(!f.value){a.commit("setLoginDialog",!0);return}e.replyCommentId=e.replyCommentId===o.commentId&&e.replyIndex===r?0:o.commentId,e.replyIndex=r},_=o=>{if(!f.value){a.commit("setLoginDialog",!0);return}I(2,o,e.replyCommentId)},H=async o=>{if(!f.value){a.commit("setLoginDialog",!0);return}const{data:r}=await c.$http.commentLike({id:e.curId,cid:o.commentId,t:Number(!o.liked),type:s.type});if(r.code!==200)return c.$msg.error("\u6570\u636E\u8BF7\u6C42\u5931\u8D25");g()},U=o=>{e.offset=(o-1)*e.limit};return P(()=>{g()}),R(()=>s.sId,(o,r)=>{e.curId=o,e.offset=0,g()}),R(()=>e.msg,()=>{e.msg=e.maxLen>=e.msg?e.msg:e.msg.substring(0,e.maxLen)}),{...D(e),userInfo:x,isLogin:f,subComment:L,delComment:n,replyMsg:_,replyComment:k,likeComment:H,isShowReply:y,currentChange:U}}},h=s=>(G("data-v-55399cb6"),s=s(),Y(),s),le={class:"comments"},ie={class:"comment_hd"},de={key:0,class:"userInfo"},_e=h(()=>t("div",{slot:"placeholder",class:"image-slot"},[t("i",{class:"iconfont icon-placeholder"})],-1)),ue={class:"comment_textarea"},pe={class:"pre"},ge={class:"comment_box_footer"},he={class:"comment_limit"},fe={class:"num"},ye={class:"comment_area"},ve=h(()=>t("div",{slot:"placeholder",class:"image-slot"},[t("i",{class:"iconfont icon-placeholder"})],-1)),Ce={class:"comment_info"},Ie={class:"comment_content"},ke={class:"comment_footer"},be={class:"comment_time"},xe={class:"comment_oper"},Le=["onClick"],$e=h(()=>t("i",{class:"iconfont icon-del"},null,-1)),we=[$e],Re=["onClick"],Be=h(()=>t("i",{class:"iconfont icon-praise"},null,-1)),Se=["onClick"],Me=h(()=>t("i",{class:"iconfont icon-comment"},null,-1)),Ve=[Me],De={key:0,class:"isHot"},Ee=h(()=>t("i",{class:"iconfont icon-choicest"},null,-1)),Ne=[Ee],Te={class:"pagination"},He={key:1,class:"comments_status"},Ue={key:0,class:"loading"},qe={key:1,class:"empty"},Fe=h(()=>t("p",null,[t("i",{class:"iconfont icon-empty-main"})],-1)),ze=h(()=>t("p",null,"\u6682\u65E0\u7559\u8A00",-1)),Je=[Fe,ze];function Pe(s,c,a,e,x,f){const y=W,g=T,v=j,C=B("router-link"),I=B("reply-comment"),L=X;return l(),i("div",le,[t("div",ie,[t("h2",null,[p("\u8BC4\u8BBA"),t("em",null,"\u5171"+m(s.total)+"\u6761\u8BC4\u8BBA",1)]),e.userInfo?(l(),i("div",de,[t("span",null,m(e.userInfo.nickname),1),d(y,{src:e.userInfo.avatarUrl,class:"avatar"},{default:u(()=>[_e]),_:1},8,["src"])])):b("",!0)]),d(v,{class:"comment_box"},{default:u(()=>[t("div",ue,[t("div",pe,m(s.msg),1),E(t("textarea",{class:"J_inpBox inp-paragraph",name:"leave_msg",id:"leave_msg",placeholder:"\u671F\u5F85\u4F60\u7684\u795E\u8BC4\u8BBA\u2026\u2026","onUpdate:modelValue":c[0]||(c[0]=n=>s.msg=n)},null,512),[[N,s.msg]])]),t("div",ge,[d(g,{type:"primary",color:"#ff641e",onClick:e.subComment},{default:u(()=>[p("\u8BC4\u8BBA")]),_:1},8,["onClick"]),t("span",he,[t("em",fe,m(s.msg.length),1),p("/"+m(s.maxLen),1)])])]),_:1}),t("div",ye,[s.comments.length?(l(),i(w,{key:0},[(l(!0),i(w,null,S(s.comments,(n,k)=>(l(),i("div",{class:"comment_item",key:n.commentId+k+""},[d(C,{to:{path:"/user",query:{id:n.user.userId}},class:"comment_avatar"},{default:u(()=>[d(y,{src:n.user.avatarUrl+"?param=120y120"},{default:u(()=>[ve]),_:2},1032,["src"])]),_:2},1032,["to"]),t("div",Ce,[d(C,{to:{path:"/user",query:{id:n.user.userId}}},{default:u(()=>[p(m(n.user.nickname),1)]),_:2},1032,["to"]),t("div",Ie,m(n.content),1),(l(!0),i(w,null,S(n.beReplied,_=>(l(),i("div",{class:"comment_reply",key:_.beRepliedCommentId},[d(C,{to:{path:"/user",query:{id:_.user.userId}}},{default:u(()=>[p(m(_.user.nickname),1)]),_:2},1032,["to"]),p(": "+m(_.content),1)]))),128)),t("div",ke,[t("div",be,m(s.$utils.formatMsgTime(n.time)),1),t("div",xe,[e.userInfo&&e.userInfo.userId===n.user.userId?(l(),i("em",{key:0,class:"comment_del",onClick:_=>e.delComment(n)},we,8,Le)):b("",!0),t("span",{class:K([n.liked?"active":""]),onClick:_=>e.likeComment(n)},[Be,p("("+m(n.likedCount)+")",1)],10,Re),t("span",{class:"replyComment",onClick:_=>e.replyComment(n,k)},Ve,8,Se)])]),n.isHot?(l(),i("div",De,Ne)):b("",!0),d(Q,{name:"fade",mode:"out-in"},{default:u(()=>[e.isShowReply(n,k)?(l(),O(I,{key:0,params:n,onReplyMsg:e.replyMsg},null,8,["params","onReplyMsg"])):b("",!0)]),_:2},1024)])]))),128)),t("div",Te,[d(L,{onCurrentChange:e.currentChange,layout:"prev, pager, next",total:s.total},null,8,["onCurrentChange","total"])])],64)):(l(),i("div",He,[s.isEmpty?(l(),i("div",qe,Je)):(l(),i("div",Ue,"\u8BC4\u8BBA\u52A0\u8F7D\u4E2D..."))]))])])}var Ke=M(re,[["render",Pe],["__scopeId","data-v-55399cb6"]]);export{Ke as C};
