import{e as Mt,k as z,t as xt,B as Pt,ak as K,X as dt,d as Ht,s as ft,y as gt,l as j,x as Z,D as tt,al as se,c as kt,z as ot,r as $t,w as fe,o as oe,J as ge,q as Dt,T as re,F as Kt,C as Vt,j as X,U as _t,V as Rt,n as ve,v as Le,am as Ae,Z as De,m as ie,an as Xt,K as pe,Q as ke,a2 as _e,W as Re,aa as Ie,I as Ce,i as Jt,S as we}from"./index.c94220ca.js";import{C as Oe}from"./Comments.dd0102b8.js";var xe=Object.defineProperty,Pe=Object.defineProperties,Fe=Object.getOwnPropertyDescriptors,le=Object.getOwnPropertySymbols,Me=Object.prototype.hasOwnProperty,Ne=Object.prototype.propertyIsEnumerable,ue=(N,C,f)=>C in N?xe(N,C,{enumerable:!0,configurable:!0,writable:!0,value:f}):N[C]=f,ne=(N,C)=>{for(var f in C||(C={}))Me.call(C,f)&&ue(N,f,C[f]);if(le)for(var f of le(C))Ne.call(C,f)&&ue(N,f,C[f]);return N},ae=(N,C)=>Pe(N,Fe(C));function de(N,C,f,R){var E,A=!1,_=0;function I(){E&&clearTimeout(E)}function D(){for(var s=arguments.length,S=new Array(s),m=0;m<s;m++)S[m]=arguments[m];var h=this,T=Date.now()-_;function y(){_=Date.now(),f.apply(h,S)}function d(){E=void 0}A||(R&&!E&&y(),I(),R===void 0&&T>N?y():C!==!0&&(E=setTimeout(R?d:y,R===void 0?N-T:N)))}return typeof C!="boolean"&&(R=f,f=C,C=void 0),D.cancel=function(){I(),A=!0},D}function ce(N,C,f){return f===void 0?de(N,C,!1):de(N,f,C!==!1)}function Be(N){return N&&N.__esModule&&Object.prototype.hasOwnProperty.call(N,"default")?N.default:N}var me={exports:{}};typeof window!="undefined"&&(me.exports=function(N){var C={};function f(R){if(C[R])return C[R].exports;var E=C[R]={i:R,l:!1,exports:{}};return N[R].call(E.exports,E,E.exports,f),E.l=!0,E.exports}return f.m=N,f.c=C,f.d=function(R,E,A){f.o(R,E)||Object.defineProperty(R,E,{enumerable:!0,get:A})},f.r=function(R){typeof Symbol!="undefined"&&Symbol.toStringTag&&Object.defineProperty(R,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(R,"__esModule",{value:!0})},f.t=function(R,E){if(1&E&&(R=f(R)),8&E||4&E&&typeof R=="object"&&R&&R.__esModule)return R;var A=Object.create(null);if(f.r(A),Object.defineProperty(A,"default",{enumerable:!0,value:R}),2&E&&typeof R!="string")for(var _ in R)f.d(A,_,function(I){return R[I]}.bind(null,_));return A},f.n=function(R){var E=R&&R.__esModule?function(){return R.default}:function(){return R};return f.d(E,"a",E),E},f.o=function(R,E){return Object.prototype.hasOwnProperty.call(R,E)},f.p="/dist/",f(f.s="./src/hls.ts")}({"./node_modules/eventemitter3/index.js":function(N,C,f){var R=Object.prototype.hasOwnProperty,E="~";function A(){}function _(S,m,h){this.fn=S,this.context=m,this.once=h||!1}function I(S,m,h,T,y){if(typeof h!="function")throw new TypeError("The listener must be a function");var d=new _(h,T||S,y),t=E?E+m:m;return S._events[t]?S._events[t].fn?S._events[t]=[S._events[t],d]:S._events[t].push(d):(S._events[t]=d,S._eventsCount++),S}function D(S,m){--S._eventsCount==0?S._events=new A:delete S._events[m]}function s(){this._events=new A,this._eventsCount=0}Object.create&&(A.prototype=Object.create(null),new A().__proto__||(E=!1)),s.prototype.eventNames=function(){var S,m,h=[];if(this._eventsCount===0)return h;for(m in S=this._events)R.call(S,m)&&h.push(E?m.slice(1):m);return Object.getOwnPropertySymbols?h.concat(Object.getOwnPropertySymbols(S)):h},s.prototype.listeners=function(S){var m=E?E+S:S,h=this._events[m];if(!h)return[];if(h.fn)return[h.fn];for(var T=0,y=h.length,d=new Array(y);T<y;T++)d[T]=h[T].fn;return d},s.prototype.listenerCount=function(S){var m=E?E+S:S,h=this._events[m];return h?h.fn?1:h.length:0},s.prototype.emit=function(S,m,h,T,y,d){var t=E?E+S:S;if(!this._events[t])return!1;var a,e,o=this._events[t],u=arguments.length;if(o.fn){switch(o.once&&this.removeListener(S,o.fn,void 0,!0),u){case 1:return o.fn.call(o.context),!0;case 2:return o.fn.call(o.context,m),!0;case 3:return o.fn.call(o.context,m,h),!0;case 4:return o.fn.call(o.context,m,h,T),!0;case 5:return o.fn.call(o.context,m,h,T,y),!0;case 6:return o.fn.call(o.context,m,h,T,y,d),!0}for(e=1,a=new Array(u-1);e<u;e++)a[e-1]=arguments[e];o.fn.apply(o.context,a)}else{var n,l=o.length;for(e=0;e<l;e++)switch(o[e].once&&this.removeListener(S,o[e].fn,void 0,!0),u){case 1:o[e].fn.call(o[e].context);break;case 2:o[e].fn.call(o[e].context,m);break;case 3:o[e].fn.call(o[e].context,m,h);break;case 4:o[e].fn.call(o[e].context,m,h,T);break;default:if(!a)for(n=1,a=new Array(u-1);n<u;n++)a[n-1]=arguments[n];o[e].fn.apply(o[e].context,a)}}return!0},s.prototype.on=function(S,m,h){return I(this,S,m,h,!1)},s.prototype.once=function(S,m,h){return I(this,S,m,h,!0)},s.prototype.removeListener=function(S,m,h,T){var y=E?E+S:S;if(!this._events[y])return this;if(!m)return D(this,y),this;var d=this._events[y];if(d.fn)d.fn!==m||T&&!d.once||h&&d.context!==h||D(this,y);else{for(var t=0,a=[],e=d.length;t<e;t++)(d[t].fn!==m||T&&!d[t].once||h&&d[t].context!==h)&&a.push(d[t]);a.length?this._events[y]=a.length===1?a[0]:a:D(this,y)}return this},s.prototype.removeAllListeners=function(S){var m;return S?(m=E?E+S:S,this._events[m]&&D(this,m)):(this._events=new A,this._eventsCount=0),this},s.prototype.off=s.prototype.removeListener,s.prototype.addListener=s.prototype.on,s.prefixed=E,s.EventEmitter=s,N.exports=s},"./node_modules/url-toolkit/src/url-toolkit.js":function(N,C,f){var R,E,A,_,I;R=/^((?:[a-zA-Z0-9+\-.]+:)?)(\/\/[^\/?#]*)?((?:[^\/?#]*\/)*[^;?#]*)?(;[^?#]*)?(\?[^#]*)?(#[^]*)?$/,E=/^([^\/?#]*)([^]*)$/,A=/(?:\/|^)\.(?=\/)/g,_=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,I={buildAbsoluteURL:function(D,s,S){if(S=S||{},D=D.trim(),!(s=s.trim())){if(!S.alwaysNormalize)return D;var m=I.parseURL(D);if(!m)throw new Error("Error trying to parse base URL.");return m.path=I.normalizePath(m.path),I.buildURLFromParts(m)}var h=I.parseURL(s);if(!h)throw new Error("Error trying to parse relative URL.");if(h.scheme)return S.alwaysNormalize?(h.path=I.normalizePath(h.path),I.buildURLFromParts(h)):s;var T=I.parseURL(D);if(!T)throw new Error("Error trying to parse base URL.");if(!T.netLoc&&T.path&&T.path[0]!=="/"){var y=E.exec(T.path);T.netLoc=y[1],T.path=y[2]}T.netLoc&&!T.path&&(T.path="/");var d={scheme:T.scheme,netLoc:h.netLoc,path:null,params:h.params,query:h.query,fragment:h.fragment};if(!h.netLoc&&(d.netLoc=T.netLoc,h.path[0]!=="/"))if(h.path){var t=T.path,a=t.substring(0,t.lastIndexOf("/")+1)+h.path;d.path=I.normalizePath(a)}else d.path=T.path,h.params||(d.params=T.params,h.query||(d.query=T.query));return d.path===null&&(d.path=S.alwaysNormalize?I.normalizePath(h.path):h.path),I.buildURLFromParts(d)},parseURL:function(D){var s=R.exec(D);return s?{scheme:s[1]||"",netLoc:s[2]||"",path:s[3]||"",params:s[4]||"",query:s[5]||"",fragment:s[6]||""}:null},normalizePath:function(D){for(D=D.split("").reverse().join("").replace(A,"");D.length!==(D=D.replace(_,"")).length;);return D.split("").reverse().join("")},buildURLFromParts:function(D){return D.scheme+D.netLoc+D.path+D.params+D.query+D.fragment}},N.exports=I},"./node_modules/webworkify-webpack/index.js":function(N,C,f){function R(s){var S={};function m(T){if(S[T])return S[T].exports;var y=S[T]={i:T,l:!1,exports:{}};return s[T].call(y.exports,y,y.exports,m),y.l=!0,y.exports}m.m=s,m.c=S,m.i=function(T){return T},m.d=function(T,y,d){m.o(T,y)||Object.defineProperty(T,y,{configurable:!1,enumerable:!0,get:d})},m.r=function(T){Object.defineProperty(T,"__esModule",{value:!0})},m.n=function(T){var y=T&&T.__esModule?function(){return T.default}:function(){return T};return m.d(y,"a",y),y},m.o=function(T,y){return Object.prototype.hasOwnProperty.call(T,y)},m.p="/",m.oe=function(T){throw console.error(T),T};var h=m(m.s=ENTRY_MODULE);return h.default||h}var E="[\\.|\\-|\\+|\\w|/|@]+",A="\\(\\s*(/\\*.*?\\*/)?\\s*.*?([\\.|\\-|\\+|\\w|/|@]+).*?\\)";function _(s){return(s+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function I(s,S,m){var h={};h[m]=[];var T=S.toString(),y=T.match(/^function\s?\w*\(\w+,\s*\w+,\s*(\w+)\)/);if(!y)return h;for(var d,t=y[1],a=new RegExp("(\\\\n|\\W)"+_(t)+A,"g");d=a.exec(T);)d[3]!=="dll-reference"&&h[m].push(d[3]);for(a=new RegExp("\\("+_(t)+'\\("(dll-reference\\s('+E+'))"\\)\\)'+A,"g");d=a.exec(T);)s[d[2]]||(h[m].push(d[1]),s[d[2]]=f(d[1]).m),h[d[2]]=h[d[2]]||[],h[d[2]].push(d[4]);for(var e,o=Object.keys(h),u=0;u<o.length;u++)for(var n=0;n<h[o[u]].length;n++)e=h[o[u]][n],isNaN(1*e)||(h[o[u]][n]=1*h[o[u]][n]);return h}function D(s){return Object.keys(s).reduce(function(S,m){return S||s[m].length>0},!1)}N.exports=function(s,S){S=S||{};var m={main:f.m},h=S.all?{main:Object.keys(m.main)}:function(a,e){for(var o={main:[e]},u={main:[]},n={main:{}};D(o);)for(var l=Object.keys(o),p=0;p<l.length;p++){var g=l[p],v=o[g].pop();if(n[g]=n[g]||{},!n[g][v]&&a[g][v]){n[g][v]=!0,u[g]=u[g]||[],u[g].push(v);for(var r=I(a,a[g][v],g),i=Object.keys(r),c=0;c<i.length;c++)o[i[c]]=o[i[c]]||[],o[i[c]]=o[i[c]].concat(r[i[c]])}}return u}(m,s),T="";Object.keys(h).filter(function(a){return a!=="main"}).forEach(function(a){for(var e=0;h[a][e];)e++;h[a].push(e),m[a][e]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",T=T+"var "+a+" = ("+R.toString().replace("ENTRY_MODULE",JSON.stringify(e))+")({"+h[a].map(function(o){return JSON.stringify(o)+": "+m[a][o].toString()}).join(",")+`});
`}),T=T+"new (("+R.toString().replace("ENTRY_MODULE",JSON.stringify(s))+")({"+h.main.map(function(a){return JSON.stringify(a)+": "+m.main[a].toString()}).join(",")+"}))(self);";var y=new window.Blob([T],{type:"text/javascript"});if(S.bare)return y;var d=(window.URL||window.webkitURL||window.mozURL||window.msURL).createObjectURL(y),t=new window.Worker(d);return t.objectURL=d,t}},"./src/config.ts":function(N,C,f){f.r(C),f.d(C,"hlsDefaultConfig",function(){return l}),f.d(C,"mergeConfig",function(){return p}),f.d(C,"enableStreamingMode",function(){return g});var R=f("./src/controller/abr-controller.ts"),E=f("./src/controller/audio-stream-controller.ts"),A=f("./src/controller/audio-track-controller.ts"),_=f("./src/controller/subtitle-stream-controller.ts"),I=f("./src/controller/subtitle-track-controller.ts"),D=f("./src/controller/buffer-controller.ts"),s=f("./src/controller/timeline-controller.ts"),S=f("./src/controller/cap-level-controller.ts"),m=f("./src/controller/fps-controller.ts"),h=f("./src/controller/eme-controller.ts"),T=f("./src/utils/xhr-loader.ts"),y=f("./src/utils/fetch-loader.ts"),d=f("./src/utils/cues.ts"),t=f("./src/utils/mediakeys-helper.ts"),a=f("./src/utils/logger.ts");function e(){return(e=Object.assign||function(v){for(var r=1;r<arguments.length;r++){var i=arguments[r];for(var c in i)Object.prototype.hasOwnProperty.call(i,c)&&(v[c]=i[c])}return v}).apply(this,arguments)}function o(v,r){var i=Object.keys(v);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(v);r&&(c=c.filter(function(b){return Object.getOwnPropertyDescriptor(v,b).enumerable})),i.push.apply(i,c)}return i}function u(v){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?o(Object(i),!0).forEach(function(c){n(v,c,i[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(v,Object.getOwnPropertyDescriptors(i)):o(Object(i)).forEach(function(c){Object.defineProperty(v,c,Object.getOwnPropertyDescriptor(i,c))})}return v}function n(v,r,i){return r in v?Object.defineProperty(v,r,{value:i,enumerable:!0,configurable:!0,writable:!0}):v[r]=i,v}var l=u(u({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,maxBufferSize:6e7,maxBufferHole:.1,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,enableSoftwareAES:!0,manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,startLevel:void 0,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:T.default,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:R.default,bufferController:D.default,capLevelController:S.default,fpsController:m.default,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystemOptions:{},requestMediaKeySystemAccessFunc:t.requestMediaKeySystemAccess,testBandwidth:!0,progressive:!1,lowLatencyMode:!0},{cueHandler:d.default,enableCEA708Captions:!0,enableWebVTT:!0,enableIMSC1:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}),{},{subtitleStreamController:_.SubtitleStreamController,subtitleTrackController:I.default,timelineController:s.TimelineController,audioStreamController:E.default,audioTrackController:A.default,emeController:h.default});function p(v,r){if((r.liveSyncDurationCount||r.liveMaxLatencyDurationCount)&&(r.liveSyncDuration||r.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(r.liveMaxLatencyDurationCount!==void 0&&(r.liveSyncDurationCount===void 0||r.liveMaxLatencyDurationCount<=r.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(r.liveMaxLatencyDuration!==void 0&&(r.liveSyncDuration===void 0||r.liveMaxLatencyDuration<=r.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');return e({},v,r)}function g(v){var r=v.loader;r!==y.default&&r!==T.default?(a.logger.log("[config]: Custom loader detected, cannot enable progressive streaming"),v.progressive=!1):Object(y.fetchSupported)()&&(v.loader=y.default,v.progressive=!0,v.enableSoftwareAES=!0,a.logger.log("[config]: Progressive streaming enabled, using FetchLoader"))}},"./src/controller/abr-controller.ts":function(N,C,f){f.r(C);var R=f("./src/polyfills/number.ts"),E=f("./src/utils/ewma-bandwidth-estimator.ts"),A=f("./src/events.ts"),_=f("./src/utils/buffer-helper.ts"),I=f("./src/errors.ts"),D=f("./src/types/loader.ts"),s=f("./src/utils/logger.ts");function S(h,T){for(var y=0;y<T.length;y++){var d=T[y];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(h,d.key,d)}}var m=function(){function h(t){this.hls=void 0,this.lastLoadedFragLevel=0,this._nextAutoLevel=-1,this.timer=void 0,this.onCheck=this._abandonRulesCheck.bind(this),this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.bwEstimator=void 0,this.hls=t;var a=t.config;this.bwEstimator=new E.default(a.abrEwmaSlowVoD,a.abrEwmaFastVoD,a.abrEwmaDefaultEstimate),this.registerListeners()}var T,y,d=h.prototype;return d.registerListeners=function(){var t=this.hls;t.on(A.Events.FRAG_LOADING,this.onFragLoading,this),t.on(A.Events.FRAG_LOADED,this.onFragLoaded,this),t.on(A.Events.FRAG_BUFFERED,this.onFragBuffered,this),t.on(A.Events.LEVEL_LOADED,this.onLevelLoaded,this),t.on(A.Events.ERROR,this.onError,this)},d.unregisterListeners=function(){var t=this.hls;t.off(A.Events.FRAG_LOADING,this.onFragLoading,this),t.off(A.Events.FRAG_LOADED,this.onFragLoaded,this),t.off(A.Events.FRAG_BUFFERED,this.onFragBuffered,this),t.off(A.Events.LEVEL_LOADED,this.onLevelLoaded,this),t.off(A.Events.ERROR,this.onError,this)},d.destroy=function(){this.unregisterListeners(),this.clearTimer(),this.hls=this.onCheck=null,this.fragCurrent=this.partCurrent=null},d.onFragLoading=function(t,a){var e,o=a.frag;o.type===D.PlaylistLevelType.MAIN&&(this.timer||(this.fragCurrent=o,this.partCurrent=(e=a.part)!=null?e:null,this.timer=self.setInterval(this.onCheck,100)))},d.onLevelLoaded=function(t,a){var e=this.hls.config;a.details.live?this.bwEstimator.update(e.abrEwmaSlowLive,e.abrEwmaFastLive):this.bwEstimator.update(e.abrEwmaSlowVoD,e.abrEwmaFastVoD)},d._abandonRulesCheck=function(){var t=this.fragCurrent,a=this.partCurrent,e=this.hls,o=e.autoLevelEnabled,u=e.config,n=e.media;if(t&&n){var l=a?a.stats:t.stats,p=a?a.duration:t.duration;if(l.aborted)return s.logger.warn("frag loader destroy or aborted, disarm abandonRules"),this.clearTimer(),void(this._nextAutoLevel=-1);if(o&&!n.paused&&n.playbackRate&&n.readyState){var g=performance.now()-l.loading.start,v=Math.abs(n.playbackRate);if(!(g<=500*p/v)){var r=e.levels,i=e.minAutoLevel,c=r[t.level],b=l.total||Math.max(l.loaded,Math.round(p*c.maxBitrate/8)),L=Math.max(1,l.bwEstimate?l.bwEstimate/8:1e3*l.loaded/g),k=(b-l.loaded)/L,O=n.currentTime,w=(_.BufferHelper.bufferInfo(n,O,u.maxBufferHole).end-O)/v;if(!(w>=2*p/v||k<=w)){var x,P=Number.POSITIVE_INFINITY;for(x=t.level-1;x>i&&!((P=p*r[x].maxBitrate/(6.4*L))<w);x--);if(!(P>=k)){var F=this.bwEstimator.getEstimate();s.logger.warn("Fragment "+t.sn+(a?" part "+a.index:"")+" of level "+t.level+" is loading too slowly and will cause an underbuffer; aborting and switching to level "+x+`
      Current BW estimate: `+(Object(R.isFiniteNumber)(F)?(F/1024).toFixed(3):"Unknown")+` Kb/s
      Estimated load time for current fragment: `+k.toFixed(3)+` s
      Estimated load time for the next fragment: `+P.toFixed(3)+` s
      Time to underbuffer: `+w.toFixed(3)+" s"),e.nextLoadLevel=x,this.bwEstimator.sample(g,l.loaded),this.clearTimer(),t.loader&&(this.fragCurrent=this.partCurrent=null,t.loader.abort()),e.trigger(A.Events.FRAG_LOAD_EMERGENCY_ABORTED,{frag:t,part:a,stats:l})}}}}}},d.onFragLoaded=function(t,a){var e=a.frag,o=a.part;if(e.type===D.PlaylistLevelType.MAIN&&Object(R.isFiniteNumber)(e.sn)){var u=o?o.stats:e.stats,n=o?o.duration:e.duration;if(this.clearTimer(),this.lastLoadedFragLevel=e.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate){var l=this.hls.levels[e.level],p=(l.loaded?l.loaded.bytes:0)+u.loaded,g=(l.loaded?l.loaded.duration:0)+n;l.loaded={bytes:p,duration:g},l.realBitrate=Math.round(8*p/g)}if(e.bitrateTest){var v={stats:u,frag:e,part:o,id:e.type};this.onFragBuffered(A.Events.FRAG_BUFFERED,v),e.bitrateTest=!1}}},d.onFragBuffered=function(t,a){var e=a.frag,o=a.part,u=o?o.stats:e.stats;if(!u.aborted&&e.type===D.PlaylistLevelType.MAIN&&e.sn!=="initSegment"){var n=u.parsing.end-u.loading.start;this.bwEstimator.sample(n,u.loaded),u.bwEstimate=this.bwEstimator.getEstimate(),e.bitrateTest?this.bitrateTestDelay=n/1e3:this.bitrateTestDelay=0}},d.onError=function(t,a){switch(a.details){case I.ErrorDetails.FRAG_LOAD_ERROR:case I.ErrorDetails.FRAG_LOAD_TIMEOUT:this.clearTimer()}},d.clearTimer=function(){self.clearInterval(this.timer),this.timer=void 0},d.getNextABRAutoLevel=function(){var t=this.fragCurrent,a=this.partCurrent,e=this.hls,o=e.maxAutoLevel,u=e.config,n=e.minAutoLevel,l=e.media,p=a?a.duration:t?t.duration:0,g=l?l.currentTime:0,v=l&&l.playbackRate!==0?Math.abs(l.playbackRate):1,r=this.bwEstimator?this.bwEstimator.getEstimate():u.abrEwmaDefaultEstimate,i=(_.BufferHelper.bufferInfo(l,g,u.maxBufferHole).end-g)/v,c=this.findBestLevel(r,n,o,i,u.abrBandWidthFactor,u.abrBandWidthUpFactor);if(c>=0)return c;s.logger.trace((i?"rebuffering expected":"buffer is empty")+", finding optimal quality level");var b=p?Math.min(p,u.maxStarvationDelay):u.maxStarvationDelay,L=u.abrBandWidthFactor,k=u.abrBandWidthUpFactor;if(!i){var O=this.bitrateTestDelay;O&&(b=(p?Math.min(p,u.maxLoadingDelay):u.maxLoadingDelay)-O,s.logger.trace("bitrate test took "+Math.round(1e3*O)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*b)+" ms"),L=k=1)}return c=this.findBestLevel(r,n,o,i+b,L,k),Math.max(c,0)},d.findBestLevel=function(t,a,e,o,u,n){for(var l,p=this.fragCurrent,g=this.partCurrent,v=this.lastLoadedFragLevel,r=this.hls.levels,i=r[v],c=!(i==null||(l=i.details)===null||l===void 0||!l.live),b=i==null?void 0:i.codecSet,L=g?g.duration:p?p.duration:0,k=e;k>=a;k--){var O=r[k];if(O&&(!b||O.codecSet===b)){var w=O.details,x=(g?w==null?void 0:w.partTarget:w==null?void 0:w.averagetargetduration)||L,P=void 0;P=k<=v?u*t:n*t;var F=r[k].maxBitrate,M=F*x/P;if(s.logger.trace("level/adjustedbw/bitrate/avgDuration/maxFetchDuration/fetchDuration: "+k+"/"+Math.round(P)+"/"+F+"/"+x+"/"+o+"/"+M),P>F&&(!M||c&&!this.bitrateTestDelay||M<o))return k}}return-1},T=h,(y=[{key:"nextAutoLevel",get:function(){var t=this._nextAutoLevel,a=this.bwEstimator;if(!(t===-1||a&&a.canEstimate()))return t;var e=this.getNextABRAutoLevel();return t!==-1&&(e=Math.min(t,e)),e},set:function(t){this._nextAutoLevel=t}}])&&S(T.prototype,y),h}();C.default=m},"./src/controller/audio-stream-controller.ts":function(N,C,f){f.r(C);var R=f("./src/polyfills/number.ts"),E=f("./src/controller/base-stream-controller.ts"),A=f("./src/events.ts"),_=f("./src/utils/buffer-helper.ts"),I=f("./src/controller/fragment-tracker.ts"),D=f("./src/types/level.ts"),s=f("./src/types/loader.ts"),S=f("./src/loader/fragment.ts"),m=f("./src/demux/chunk-cache.ts"),h=f("./src/demux/transmuxer-interface.ts"),T=f("./src/types/transmuxer.ts"),y=f("./src/controller/fragment-finders.ts"),d=f("./src/utils/discontinuities.ts"),t=f("./src/errors.ts"),a=f("./src/utils/logger.ts");function e(){return(e=Object.assign||function(n){for(var l=1;l<arguments.length;l++){var p=arguments[l];for(var g in p)Object.prototype.hasOwnProperty.call(p,g)&&(n[g]=p[g])}return n}).apply(this,arguments)}function o(n,l){return(o=Object.setPrototypeOf||function(p,g){return p.__proto__=g,p})(n,l)}var u=function(n){var l,p;function g(r,i){var c;return(c=n.call(this,r,i,"[audio-stream-controller]")||this).videoBuffer=null,c.videoTrackCC=-1,c.waitingVideoCC=-1,c.audioSwitch=!1,c.trackId=-1,c.waitingData=null,c.mainDetails=null,c.bufferFlushed=!1,c._registerListeners(),c}p=n,(l=g).prototype=Object.create(p.prototype),l.prototype.constructor=l,o(l,p);var v=g.prototype;return v.onHandlerDestroying=function(){this._unregisterListeners(),this.mainDetails=null},v._registerListeners=function(){var r=this.hls;r.on(A.Events.MEDIA_ATTACHED,this.onMediaAttached,this),r.on(A.Events.MEDIA_DETACHING,this.onMediaDetaching,this),r.on(A.Events.MANIFEST_LOADING,this.onManifestLoading,this),r.on(A.Events.LEVEL_LOADED,this.onLevelLoaded,this),r.on(A.Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),r.on(A.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),r.on(A.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),r.on(A.Events.ERROR,this.onError,this),r.on(A.Events.BUFFER_RESET,this.onBufferReset,this),r.on(A.Events.BUFFER_CREATED,this.onBufferCreated,this),r.on(A.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),r.on(A.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),r.on(A.Events.FRAG_BUFFERED,this.onFragBuffered,this)},v._unregisterListeners=function(){var r=this.hls;r.off(A.Events.MEDIA_ATTACHED,this.onMediaAttached,this),r.off(A.Events.MEDIA_DETACHING,this.onMediaDetaching,this),r.off(A.Events.MANIFEST_LOADING,this.onManifestLoading,this),r.off(A.Events.LEVEL_LOADED,this.onLevelLoaded,this),r.off(A.Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),r.off(A.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),r.off(A.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),r.off(A.Events.ERROR,this.onError,this),r.off(A.Events.BUFFER_RESET,this.onBufferReset,this),r.off(A.Events.BUFFER_CREATED,this.onBufferCreated,this),r.off(A.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),r.off(A.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),r.off(A.Events.FRAG_BUFFERED,this.onFragBuffered,this)},v.onInitPtsFound=function(r,i){var c=i.frag,b=i.id,L=i.initPTS;if(b==="main"){var k=c.cc;this.initPTS[c.cc]=L,this.log("InitPTS for cc: "+k+" found from main: "+L),this.videoTrackCC=k,this.state===E.State.WAITING_INIT_PTS&&this.tick()}},v.startLoad=function(r){if(!this.levels)return this.startPosition=r,void(this.state=E.State.STOPPED);var i=this.lastCurrentTime;this.stopLoad(),this.setInterval(100),this.fragLoadError=0,i>0&&r===-1?(this.log("Override startPosition with lastCurrentTime @"+i.toFixed(3)),this.state=E.State.IDLE):(this.loadedmetadata=!1,this.state=E.State.WAITING_TRACK),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=r,this.tick()},v.doTick=function(){switch(this.state){case E.State.IDLE:this.doTickIdle();break;case E.State.WAITING_TRACK:var r,i=this.levels,c=this.trackId,b=i==null||(r=i[c])===null||r===void 0?void 0:r.details;if(b){if(this.waitForCdnTuneIn(b))break;this.state=E.State.WAITING_INIT_PTS}break;case E.State.FRAG_LOADING_WAITING_RETRY:var L,k=performance.now(),O=this.retryDate;(!O||k>=O||(L=this.media)!==null&&L!==void 0&&L.seeking)&&(this.log("RetryDate reached, switch back to IDLE state"),this.state=E.State.IDLE);break;case E.State.WAITING_INIT_PTS:var w=this.waitingData;if(w){var x=w.frag,P=w.part,F=w.cache,M=w.complete;if(this.initPTS[x.cc]!==void 0){this.waitingData=null,this.waitingVideoCC=-1,this.state=E.State.FRAG_LOADING;var B={frag:x,part:P,payload:F.flush(),networkDetails:null};this._handleFragmentLoadProgress(B),M&&n.prototype._handleFragmentLoadComplete.call(this,B)}else if(this.videoTrackCC!==this.waitingVideoCC)a.logger.log("Waiting fragment cc ("+x.cc+") cancelled because video is at cc "+this.videoTrackCC),this.clearWaitingFragment();else{var U=this.getLoadPosition(),G=_.BufferHelper.bufferInfo(this.mediaBuffer,U,this.config.maxBufferHole);Object(y.fragmentWithinToleranceTest)(G.end,this.config.maxFragLookUpTolerance,x)<0&&(a.logger.log("Waiting fragment cc ("+x.cc+") @ "+x.start+" cancelled because another fragment at "+G.end+" is needed"),this.clearWaitingFragment())}}else this.state=E.State.IDLE}this.onTickEnd()},v.clearWaitingFragment=function(){var r=this.waitingData;r&&(this.fragmentTracker.removeFragment(r.frag),this.waitingData=null,this.waitingVideoCC=-1,this.state=E.State.IDLE)},v.onTickEnd=function(){var r=this.media;if(r&&r.readyState){var i=(this.mediaBuffer?this.mediaBuffer:r).buffered;!this.loadedmetadata&&i.length&&(this.loadedmetadata=!0),this.lastCurrentTime=r.currentTime}},v.doTickIdle=function(){var r,i,c=this.hls,b=this.levels,L=this.media,k=this.trackId,O=c.config;if(b&&b[k]&&(L||!this.startFragRequested&&O.startFragPrefetch)){var w=b[k].details;if(!w||w.live&&this.levelLastLoaded!==k||this.waitForCdnTuneIn(w))this.state=E.State.WAITING_TRACK;else{this.bufferFlushed&&(this.bufferFlushed=!1,this.afterBufferFlushed(this.mediaBuffer?this.mediaBuffer:this.media,S.ElementaryStreamTypes.AUDIO,s.PlaylistLevelType.AUDIO));var x=this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:this.media,s.PlaylistLevelType.AUDIO);if(x!==null){var P=x.len,F=this.getMaxBufferLength(),M=this.audioSwitch;if(!(P>=F)||M){if(!M&&this._streamEnded(x,w))return c.trigger(A.Events.BUFFER_EOS,{type:"audio"}),void(this.state=E.State.ENDED);var B=w.fragments[0].start,U=x.end;if(M){var G=this.getLoadPosition();U=G,w.PTSKnown&&G<B&&(x.end>B||x.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),L.currentTime=B+.05)}var V=this.getNextFragment(U,w);V?((r=V.decryptdata)===null||r===void 0?void 0:r.keyFormat)!=="identity"||(i=V.decryptdata)!==null&&i!==void 0&&i.key?this.loadFragment(V,w,U):this.loadKey(V,w):this.bufferFlushed=!0}}}}},v.getMaxBufferLength=function(){var r=n.prototype.getMaxBufferLength.call(this),i=this.getFwdBufferInfo(this.videoBuffer?this.videoBuffer:this.media,s.PlaylistLevelType.MAIN);return i===null?r:Math.max(r,i.len)},v.onMediaDetaching=function(){this.videoBuffer=null,n.prototype.onMediaDetaching.call(this)},v.onAudioTracksUpdated=function(r,i){var c=i.audioTracks;this.resetTransmuxer(),this.levels=c.map(function(b){return new D.Level(b)})},v.onAudioTrackSwitching=function(r,i){var c=!!i.url;this.trackId=i.id;var b=this.fragCurrent;b!=null&&b.loader&&b.loader.abort(),this.fragCurrent=null,this.clearWaitingFragment(),c?this.setInterval(100):this.resetTransmuxer(),c?(this.audioSwitch=!0,this.state=E.State.IDLE):this.state=E.State.STOPPED,this.tick()},v.onManifestLoading=function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments(),this.startPosition=this.lastCurrentTime=0,this.bufferFlushed=!1},v.onLevelLoaded=function(r,i){this.mainDetails=i.details},v.onAudioTrackLoaded=function(r,i){var c,b=this.levels,L=i.details,k=i.id;if(b){this.log("Track "+k+" loaded ["+L.startSN+","+L.endSN+"],duration:"+L.totalduration);var O=b[k],w=0;if(L.live||(c=O.details)!==null&&c!==void 0&&c.live){var x=this.mainDetails;if(L.fragments[0]||(L.deltaUpdateFailed=!0),L.deltaUpdateFailed||!x)return;!O.details&&L.hasProgramDateTime&&x.hasProgramDateTime?(Object(d.alignPDT)(L,x),w=L.fragments[0].start):w=this.alignPlaylists(L,O.details)}O.details=L,this.levelLastLoaded=k,this.startFragRequested||!this.mainDetails&&L.live||this.setStartPosition(O.details,w),this.state!==E.State.WAITING_TRACK||this.waitForCdnTuneIn(L)||(this.state=E.State.IDLE),this.tick()}else this.warn("Audio tracks were reset while loading level "+k)},v._handleFragmentLoadProgress=function(r){var i,c=r.frag,b=r.part,L=r.payload,k=this.config,O=this.trackId,w=this.levels;if(w){var x=w[O];console.assert(x,"Audio track is defined on fragment load progress");var P=x.details;console.assert(P,"Audio track details are defined on fragment load progress");var F=k.defaultAudioCodec||x.audioCodec||"mp4a.40.2",M=this.transmuxer;M||(M=this.transmuxer=new h.default(this.hls,s.PlaylistLevelType.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));var B=this.initPTS[c.cc],U=(i=c.initSegment)===null||i===void 0?void 0:i.data;if(B!==void 0){var G=b?b.index:-1,V=G!==-1,H=new T.ChunkMetadata(c.level,c.sn,c.stats.chunkCount,L.byteLength,G,V);M.push(L,U,F,"",c,b,P.totalduration,!1,H,B)}else a.logger.log("Unknown video PTS for cc "+c.cc+", waiting for video PTS before demuxing audio frag "+c.sn+" of ["+P.startSN+" ,"+P.endSN+"],track "+O),(this.waitingData=this.waitingData||{frag:c,part:b,cache:new m.default,complete:!1}).cache.push(new Uint8Array(L)),this.waitingVideoCC=this.videoTrackCC,this.state=E.State.WAITING_INIT_PTS}else this.warn("Audio tracks were reset while fragment load was in progress. Fragment "+c.sn+" of level "+c.level+" will not be buffered")},v._handleFragmentLoadComplete=function(r){this.waitingData?this.waitingData.complete=!0:n.prototype._handleFragmentLoadComplete.call(this,r)},v.onBufferReset=function(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1},v.onBufferCreated=function(r,i){var c=i.tracks.audio;c&&(this.mediaBuffer=c.buffer),i.tracks.video&&(this.videoBuffer=i.tracks.video.buffer)},v.onFragBuffered=function(r,i){var c=i.frag,b=i.part;c.type===s.PlaylistLevelType.AUDIO&&(this.fragContextChanged(c)?this.warn("Fragment "+c.sn+(b?" p: "+b.index:"")+" of level "+c.level+" finished buffering, but was aborted. state: "+this.state+", audioSwitch: "+this.audioSwitch):(c.sn!=="initSegment"&&(this.fragPrevious=c,this.audioSwitch&&(this.audioSwitch=!1,this.hls.trigger(A.Events.AUDIO_TRACK_SWITCHED,{id:this.trackId}))),this.fragBufferedComplete(c,b)))},v.onError=function(r,i){switch(i.details){case t.ErrorDetails.FRAG_LOAD_ERROR:case t.ErrorDetails.FRAG_LOAD_TIMEOUT:case t.ErrorDetails.KEY_LOAD_ERROR:case t.ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(s.PlaylistLevelType.AUDIO,i);break;case t.ErrorDetails.AUDIO_TRACK_LOAD_ERROR:case t.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:this.state!==E.State.ERROR&&this.state!==E.State.STOPPED&&(this.state=i.fatal?E.State.ERROR:E.State.IDLE,this.warn(i.details+" while loading frag, switching to "+this.state+" state"));break;case t.ErrorDetails.BUFFER_FULL_ERROR:if(i.parent==="audio"&&(this.state===E.State.PARSING||this.state===E.State.PARSED)){var c=!0,b=this.getFwdBufferInfo(this.mediaBuffer,s.PlaylistLevelType.AUDIO);b&&b.len>.5&&(c=!this.reduceMaxBufferLength(b.len)),c&&(this.warn("Buffer full error also media.currentTime is not buffered, flush audio buffer"),this.fragCurrent=null,n.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")),this.resetLoadingState()}}},v.onBufferFlushed=function(r,i){i.type===S.ElementaryStreamTypes.AUDIO&&(this.bufferFlushed=!0)},v._handleTransmuxComplete=function(r){var i,c="audio",b=this.hls,L=r.remuxResult,k=r.chunkMeta,O=this.getCurrentContext(k);if(!O)return this.warn("The loading context changed while buffering fragment "+k.sn+" of level "+k.level+". This chunk will not be buffered."),void this.resetLiveStartWhenNotLoaded(k.level);var w=O.frag,x=O.part,P=L.audio,F=L.text,M=L.id3,B=L.initSegment;if(!this.fragContextChanged(w)){if(this.state=E.State.PARSING,this.audioSwitch&&P&&this.completeAudioSwitch(),B!=null&&B.tracks&&(this._bufferInitSegment(B.tracks,w,k),b.trigger(A.Events.FRAG_PARSING_INIT_SEGMENT,{frag:w,id:c,tracks:B.tracks})),P){var U=P.startPTS,G=P.endPTS,V=P.startDTS,H=P.endDTS;x&&(x.elementaryStreams[S.ElementaryStreamTypes.AUDIO]={startPTS:U,endPTS:G,startDTS:V,endDTS:H}),w.setElementaryStreamInfo(S.ElementaryStreamTypes.AUDIO,U,G,V,H),this.bufferFragmentData(P,w,x,k)}if(M!=null&&(i=M.samples)!==null&&i!==void 0&&i.length){var Y=e({frag:w,id:c},M);b.trigger(A.Events.FRAG_PARSING_METADATA,Y)}if(F){var W=e({frag:w,id:c},F);b.trigger(A.Events.FRAG_PARSING_USERDATA,W)}}},v._bufferInitSegment=function(r,i,c){if(this.state===E.State.PARSING){r.video&&delete r.video;var b=r.audio;if(b){b.levelCodec=b.codec,b.id="audio",this.log("Init audio buffer, container:"+b.container+", codecs[parsed]=["+b.codec+"]"),this.hls.trigger(A.Events.BUFFER_CODECS,r);var L=b.initSegment;if(L!=null&&L.byteLength){var k={type:"audio",frag:i,part:null,chunkMeta:c,parent:i.type,data:L};this.hls.trigger(A.Events.BUFFER_APPENDING,k)}this.tick()}}},v.loadFragment=function(r,i,c){var b=this.fragmentTracker.getState(r);this.fragCurrent=r,(this.audioSwitch||b===I.FragmentState.NOT_LOADED||b===I.FragmentState.PARTIAL)&&(r.sn==="initSegment"?this._loadInitSegment(r):i.live&&!Object(R.isFiniteNumber)(this.initPTS[r.cc])?(this.log("Waiting for video PTS in continuity counter "+r.cc+" of live stream before loading audio fragment "+r.sn+" of level "+this.trackId),this.state=E.State.WAITING_INIT_PTS):(this.startFragRequested=!0,n.prototype.loadFragment.call(this,r,i,c)))},v.completeAudioSwitch=function(){var r=this.hls,i=this.media,c=this.trackId;i&&(this.log("Switching audio track : flushing all audio"),n.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")),this.audioSwitch=!1,r.trigger(A.Events.AUDIO_TRACK_SWITCHED,{id:c})},g}(E.default);C.default=u},"./src/controller/audio-track-controller.ts":function(N,C,f){f.r(C);var R=f("./src/events.ts"),E=f("./src/errors.ts"),A=f("./src/controller/base-playlist-controller.ts"),_=f("./src/types/loader.ts");function I(S,m){for(var h=0;h<m.length;h++){var T=m[h];T.enumerable=T.enumerable||!1,T.configurable=!0,"value"in T&&(T.writable=!0),Object.defineProperty(S,T.key,T)}}function D(S,m){return(D=Object.setPrototypeOf||function(h,T){return h.__proto__=T,h})(S,m)}var s=function(S){var m,h;function T(a){var e;return(e=S.call(this,a,"[audio-track-controller]")||this).tracks=[],e.groupId=null,e.tracksInGroup=[],e.trackId=-1,e.trackName="",e.selectDefaultTrack=!0,e.registerListeners(),e}h=S,(m=T).prototype=Object.create(h.prototype),m.prototype.constructor=m,D(m,h);var y,d,t=T.prototype;return t.registerListeners=function(){var a=this.hls;a.on(R.Events.MANIFEST_LOADING,this.onManifestLoading,this),a.on(R.Events.MANIFEST_PARSED,this.onManifestParsed,this),a.on(R.Events.LEVEL_LOADING,this.onLevelLoading,this),a.on(R.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),a.on(R.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),a.on(R.Events.ERROR,this.onError,this)},t.unregisterListeners=function(){var a=this.hls;a.off(R.Events.MANIFEST_LOADING,this.onManifestLoading,this),a.off(R.Events.MANIFEST_PARSED,this.onManifestParsed,this),a.off(R.Events.LEVEL_LOADING,this.onLevelLoading,this),a.off(R.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),a.off(R.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),a.off(R.Events.ERROR,this.onError,this)},t.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,S.prototype.destroy.call(this)},t.onManifestLoading=function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.trackName="",this.selectDefaultTrack=!0},t.onManifestParsed=function(a,e){this.tracks=e.audioTracks||[]},t.onAudioTrackLoaded=function(a,e){var o=e.id,u=e.details,n=this.tracksInGroup[o];if(n){var l=n.details;n.details=e.details,this.log("audioTrack "+o+" loaded ["+u.startSN+"-"+u.endSN+"]"),o===this.trackId&&(this.retryCount=0,this.playlistLoaded(o,e,l))}else this.warn("Invalid audio track id "+o)},t.onLevelLoading=function(a,e){this.switchLevel(e.level)},t.onLevelSwitching=function(a,e){this.switchLevel(e.level)},t.switchLevel=function(a){var e=this.hls.levels[a];if(e!=null&&e.audioGroupIds){var o=e.audioGroupIds[e.urlId];if(this.groupId!==o){this.groupId=o;var u=this.tracks.filter(function(l){return!o||l.groupId===o});this.selectDefaultTrack&&!u.some(function(l){return l.default})&&(this.selectDefaultTrack=!1),this.tracksInGroup=u;var n={audioTracks:u};this.log("Updating audio tracks, "+u.length+' track(s) found in "'+o+'" group-id'),this.hls.trigger(R.Events.AUDIO_TRACKS_UPDATED,n),this.selectInitialTrack()}}},t.onError=function(a,e){S.prototype.onError.call(this,a,e),!e.fatal&&e.context&&e.context.type===_.PlaylistContextType.AUDIO_TRACK&&e.context.id===this.trackId&&e.context.groupId===this.groupId&&this.retryLoadingOrFail(e)},t.setAudioTrack=function(a){var e=this.tracksInGroup;if(a<0||a>=e.length)this.warn("Invalid id passed to audio-track controller");else{this.clearTimer();var o=e[this.trackId];this.log("Now switching to audio-track index "+a);var u=e[a],n=u.id,l=u.groupId,p=l===void 0?"":l,g=u.name,v=u.type,r=u.url;if(this.trackId=a,this.trackName=g,this.selectDefaultTrack=!1,this.hls.trigger(R.Events.AUDIO_TRACK_SWITCHING,{id:n,groupId:p,name:g,type:v,url:r}),!u.details||u.details.live){var i=this.switchParams(u.url,o==null?void 0:o.details);this.loadPlaylist(i)}}},t.selectInitialTrack=function(){var a=this.tracksInGroup;console.assert(a.length,"Initial audio track should be selected when tracks are known");var e=this.trackName,o=this.findTrackId(e)||this.findTrackId();o!==-1?this.setAudioTrack(o):(this.warn("No track found for running audio group-ID: "+this.groupId),this.hls.trigger(R.Events.ERROR,{type:E.ErrorTypes.MEDIA_ERROR,details:E.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,fatal:!0}))},t.findTrackId=function(a){for(var e=this.tracksInGroup,o=0;o<e.length;o++){var u=e[o];if((!this.selectDefaultTrack||u.default)&&(!a||a===u.name))return u.id}return-1},t.loadPlaylist=function(a){var e=this.tracksInGroup[this.trackId];if(this.shouldLoadTrack(e)){var o=e.id,u=e.groupId,n=e.url;if(a)try{n=a.addDirectives(n)}catch(l){this.warn("Could not construct new URL with HLS Delivery Directives: "+l)}this.log("loading audio-track playlist for id: "+o),this.clearTimer(),this.hls.trigger(R.Events.AUDIO_TRACK_LOADING,{url:n,id:o,groupId:u,deliveryDirectives:a||null})}},y=T,(d=[{key:"audioTracks",get:function(){return this.tracksInGroup}},{key:"audioTrack",get:function(){return this.trackId},set:function(a){this.selectDefaultTrack=!1,this.setAudioTrack(a)}}])&&I(y.prototype,d),T}(A.default);C.default=s},"./src/controller/base-playlist-controller.ts":function(N,C,f){f.r(C),f.d(C,"default",function(){return D});var R=f("./src/polyfills/number.ts"),E=f("./src/types/level.ts"),A=f("./src/controller/level-helper.ts"),_=f("./src/utils/logger.ts"),I=f("./src/errors.ts"),D=function(){function s(m,h){this.hls=void 0,this.timer=-1,this.canLoad=!1,this.retryCount=0,this.log=void 0,this.warn=void 0,this.log=_.logger.log.bind(_.logger,h+":"),this.warn=_.logger.warn.bind(_.logger,h+":"),this.hls=m}var S=s.prototype;return S.destroy=function(){this.clearTimer(),this.hls=this.log=this.warn=null},S.onError=function(m,h){h.fatal&&h.type===I.ErrorTypes.NETWORK_ERROR&&this.clearTimer()},S.clearTimer=function(){clearTimeout(this.timer),this.timer=-1},S.startLoad=function(){this.canLoad=!0,this.retryCount=0,this.loadPlaylist()},S.stopLoad=function(){this.canLoad=!1,this.clearTimer()},S.switchParams=function(m,h){var T=h==null?void 0:h.renditionReports;if(T)for(var y=0;y<T.length;y++){var d=T[y],t=""+d.URI;if(t===m.substr(-t.length)){var a=parseInt(d["LAST-MSN"]),e=parseInt(d["LAST-PART"]);if(h&&this.hls.config.lowLatencyMode){var o=Math.min(h.age-h.partTarget,h.targetduration);e!==void 0&&o>h.partTarget&&(e+=1)}if(Object(R.isFiniteNumber)(a))return new E.HlsUrlParameters(a,Object(R.isFiniteNumber)(e)?e:void 0,E.HlsSkip.No)}}},S.loadPlaylist=function(m){},S.shouldLoadTrack=function(m){return this.canLoad&&m&&!!m.url&&(!m.details||m.details.live)},S.playlistLoaded=function(m,h,T){var y=this,d=h.details,t=h.stats,a=t.loading.end?Math.max(0,self.performance.now()-t.loading.end):0;if(d.advancedDateTime=Date.now()-a,d.live||T!=null&&T.live){if(d.reloaded(T),T&&this.log("live playlist "+m+" "+(d.advanced?"REFRESHED "+d.lastPartSn+"-"+d.lastPartIndex:"MISSED")),T&&d.fragments.length>0&&Object(A.mergeDetails)(T,d),!this.canLoad||!d.live)return;var e,o=void 0,u=void 0;if(d.canBlockReload&&d.endSN&&d.advanced){var n=this.hls.config.lowLatencyMode,l=d.lastPartSn,p=d.endSN,g=d.lastPartIndex,v=l===p;g!==-1?(o=v?p+1:l,u=v?n?0:g:g+1):o=p+1;var r=d.age,i=r+d.ageHeader,c=Math.min(i-d.partTarget,1.5*d.targetduration);if(c>0){if(T&&c>T.tuneInGoal)this.warn("CDN Tune-in goal increased from: "+T.tuneInGoal+" to: "+c+" with playlist age: "+d.age),c=0;else{var b=Math.floor(c/d.targetduration);o+=b,u!==void 0&&(u+=Math.round(c%d.targetduration/d.partTarget)),this.log("CDN Tune-in age: "+d.ageHeader+"s last advanced "+r.toFixed(2)+"s goal: "+c+" skip sn "+b+" to part "+u)}d.tuneInGoal=c}if(e=this.getDeliveryDirectives(d,h.deliveryDirectives,o,u),n||!v)return void this.loadPlaylist(e)}else e=this.getDeliveryDirectives(d,h.deliveryDirectives,o,u);var L=Object(A.computeReloadInterval)(d,t);o!==void 0&&d.canBlockReload&&(L-=d.partTarget||1),this.log("reload live playlist "+m+" in "+Math.round(L)+" ms"),this.timer=self.setTimeout(function(){return y.loadPlaylist(e)},L)}else this.clearTimer()},S.getDeliveryDirectives=function(m,h,T,y){var d=Object(E.getSkipValue)(m,T);return h!=null&&h.skip&&m.deltaUpdateFailed&&(T=h.msn,y=h.part,d=E.HlsSkip.No),new E.HlsUrlParameters(T,y,d)},S.retryLoadingOrFail=function(m){var h,T=this,y=this.hls.config,d=this.retryCount<y.levelLoadingMaxRetry;if(d)if(this.retryCount++,m.details.indexOf("LoadTimeOut")>-1&&(h=m.context)!==null&&h!==void 0&&h.deliveryDirectives)this.warn("retry playlist loading #"+this.retryCount+' after "'+m.details+'"'),this.loadPlaylist();else{var t=Math.min(Math.pow(2,this.retryCount)*y.levelLoadingRetryDelay,y.levelLoadingMaxRetryTimeout);this.timer=self.setTimeout(function(){return T.loadPlaylist()},t),this.warn("retry playlist loading #"+this.retryCount+" in "+t+' ms after "'+m.details+'"')}else this.warn('cannot recover from error "'+m.details+'"'),this.clearTimer(),m.fatal=!0;return d},s}()},"./src/controller/base-stream-controller.ts":function(N,C,f){f.r(C),f.d(C,"State",function(){return n}),f.d(C,"default",function(){return l});var R=f("./src/polyfills/number.ts"),E=f("./src/task-loop.ts"),A=f("./src/controller/fragment-tracker.ts"),_=f("./src/utils/buffer-helper.ts"),I=f("./src/utils/logger.ts"),D=f("./src/events.ts"),s=f("./src/errors.ts"),S=f("./src/types/transmuxer.ts"),m=f("./src/utils/mp4-tools.ts"),h=f("./src/utils/discontinuities.ts"),T=f("./src/controller/fragment-finders.ts"),y=f("./src/controller/level-helper.ts"),d=f("./src/loader/fragment-loader.ts"),t=f("./src/crypt/decrypter.ts"),a=f("./src/utils/time-ranges.ts"),e=f("./src/types/loader.ts");function o(p,g){for(var v=0;v<g.length;v++){var r=g[v];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(p,r.key,r)}}function u(p,g){return(u=Object.setPrototypeOf||function(v,r){return v.__proto__=r,v})(p,g)}var n={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",BACKTRACKING:"BACKTRACKING",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"},l=function(p){var g,v;function r(L,k,O){var w;return(w=p.call(this)||this).hls=void 0,w.fragPrevious=null,w.fragCurrent=null,w.fragmentTracker=void 0,w.transmuxer=null,w._state=n.STOPPED,w.media=void 0,w.mediaBuffer=void 0,w.config=void 0,w.bitrateTest=!1,w.lastCurrentTime=0,w.nextLoadPosition=0,w.startPosition=0,w.loadedmetadata=!1,w.fragLoadError=0,w.retryDate=0,w.levels=null,w.fragmentLoader=void 0,w.levelLastLoaded=null,w.startFragRequested=!1,w.decrypter=void 0,w.initPTS=[],w.onvseeking=null,w.onvended=null,w.logPrefix="",w.log=void 0,w.warn=void 0,w.logPrefix=O,w.log=I.logger.log.bind(I.logger,O+":"),w.warn=I.logger.warn.bind(I.logger,O+":"),w.hls=L,w.fragmentLoader=new d.default(L.config),w.fragmentTracker=k,w.config=L.config,w.decrypter=new t.default(L,L.config),L.on(D.Events.KEY_LOADED,w.onKeyLoaded,function(x){if(x===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return x}(w)),w}v=p,(g=r).prototype=Object.create(v.prototype),g.prototype.constructor=g,u(g,v);var i,c,b=r.prototype;return b.doTick=function(){this.onTickEnd()},b.onTickEnd=function(){},b.startLoad=function(L){},b.stopLoad=function(){this.fragmentLoader.abort();var L=this.fragCurrent;L&&this.fragmentTracker.removeFragment(L),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=n.STOPPED},b._streamEnded=function(L,k){var O=this.fragCurrent,w=this.fragmentTracker;if(!k.live&&O&&O.sn===k.endSN&&!L.nextStart){var x=w.getState(O);return x===A.FragmentState.PARTIAL||x===A.FragmentState.OK}return!1},b.onMediaAttached=function(L,k){var O=this.media=this.mediaBuffer=k.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),O.addEventListener("seeking",this.onvseeking),O.addEventListener("ended",this.onvended);var w=this.config;this.levels&&w.autoStartLoad&&this.state===n.STOPPED&&this.startLoad(w.startPosition)},b.onMediaDetaching=function(){var L=this.media;L!=null&&L.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),L&&(L.removeEventListener("seeking",this.onvseeking),L.removeEventListener("ended",this.onvended),this.onvseeking=this.onvended=null),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()},b.onMediaSeeking=function(){var L=this.config,k=this.fragCurrent,O=this.media,w=this.mediaBuffer,x=this.state,P=O?O.currentTime:0,F=_.BufferHelper.bufferInfo(w||O,P,L.maxBufferHole);if(this.log("media seeking to "+(Object(R.isFiniteNumber)(P)?P.toFixed(3):P)+", state: "+x),x===n.ENDED)this.resetLoadingState();else if(k&&!F.len){var M=L.maxFragLookUpTolerance,B=k.start-M,U=P>k.start+k.duration+M;(P<B||U)&&(U&&k.loader&&(this.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),k.loader.abort()),this.resetLoadingState())}O&&(this.lastCurrentTime=P),this.loadedmetadata||F.len||(this.nextLoadPosition=this.startPosition=P),this.tickImmediate()},b.onMediaEnded=function(){this.startPosition=this.lastCurrentTime=0},b.onKeyLoaded=function(L,k){if(this.state===n.KEY_LOADING&&k.frag===this.fragCurrent&&this.levels){this.state=n.IDLE;var O=this.levels[k.frag.level].details;O&&this.loadFragment(k.frag,O,k.frag.start)}},b.onHandlerDestroying=function(){this.stopLoad(),p.prototype.onHandlerDestroying.call(this)},b.onHandlerDestroyed=function(){this.state=n.STOPPED,this.hls.off(D.Events.KEY_LOADED,this.onKeyLoaded,this),this.fragmentLoader&&this.fragmentLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.fragmentLoader=this.fragmentTracker=null,p.prototype.onHandlerDestroyed.call(this)},b.loadKey=function(L,k){this.log("Loading key for "+L.sn+" of ["+k.startSN+"-"+k.endSN+"], "+(this.logPrefix==="[stream-controller]"?"level":"track")+" "+L.level),this.state=n.KEY_LOADING,this.fragCurrent=L,this.hls.trigger(D.Events.KEY_LOADING,{frag:L})},b.loadFragment=function(L,k,O){this._loadFragForPlayback(L,k,O)},b._loadFragForPlayback=function(L,k,O){var w=this;this._doFragLoad(L,k,O,function(x){if(w.fragContextChanged(L))return w.warn("Fragment "+L.sn+(x.part?" p: "+x.part.index:"")+" of level "+L.level+" was dropped during download."),void w.fragmentTracker.removeFragment(L);L.stats.chunkCount++,w._handleFragmentLoadProgress(x)}).then(function(x){if(x){w.fragLoadError=0;var P=w.state;if(!w.fragContextChanged(L))return"payload"in x&&(w.log("Loaded fragment "+L.sn+" of level "+L.level),w.hls.trigger(D.Events.FRAG_LOADED,x),w.state===n.BACKTRACKING)?(w.fragmentTracker.backtrack(L,x),void w.resetFragmentLoading(L)):void w._handleFragmentLoadComplete(x);(P===n.FRAG_LOADING||P===n.BACKTRACKING||!w.fragCurrent&&P===n.PARSING)&&(w.fragmentTracker.removeFragment(L),w.state=n.IDLE)}}).catch(function(x){w.warn(x),w.resetFragmentLoading(L)})},b.flushMainBuffer=function(L,k,O){if(O===void 0&&(O=null),L-k){var w={startOffset:L,endOffset:k,type:O};this.fragLoadError=0,this.hls.trigger(D.Events.BUFFER_FLUSHING,w)}},b._loadInitSegment=function(L){var k=this;this._doFragLoad(L).then(function(O){if(!O||k.fragContextChanged(L)||!k.levels)throw new Error("init load aborted");return O}).then(function(O){var w=k.hls,x=O.payload,P=L.decryptdata;if(x&&x.byteLength>0&&P&&P.key&&P.iv&&P.method==="AES-128"){var F=self.performance.now();return k.decrypter.webCryptoDecrypt(new Uint8Array(x),P.key.buffer,P.iv.buffer).then(function(M){var B=self.performance.now();return w.trigger(D.Events.FRAG_DECRYPTED,{frag:L,payload:M,stats:{tstart:F,tdecrypt:B}}),O.payload=M,O})}return O}).then(function(O){var w=k.fragCurrent,x=k.hls,P=k.levels;if(!P)throw new Error("init load aborted, missing levels");var F=P[L.level].details;console.assert(F,"Level details are defined when init segment is loaded");var M=L.stats;k.state=n.IDLE,k.fragLoadError=0,L.data=new Uint8Array(O.payload),M.parsing.start=M.buffering.start=self.performance.now(),M.parsing.end=M.buffering.end=self.performance.now(),O.frag===w&&x.trigger(D.Events.FRAG_BUFFERED,{stats:M,frag:w,part:null,id:L.type}),k.tick()}).catch(function(O){k.warn(O),k.resetFragmentLoading(L)})},b.fragContextChanged=function(L){var k=this.fragCurrent;return!L||!k||L.level!==k.level||L.sn!==k.sn||L.urlId!==k.urlId},b.fragBufferedComplete=function(L,k){var O=this.mediaBuffer?this.mediaBuffer:this.media;this.log("Buffered "+L.type+" sn: "+L.sn+(k?" part: "+k.index:"")+" of "+(this.logPrefix==="[stream-controller]"?"level":"track")+" "+L.level+" "+a.default.toString(_.BufferHelper.getBuffered(O))),this.state=n.IDLE,this.tick()},b._handleFragmentLoadComplete=function(L){var k=this.transmuxer;if(k){var O=L.frag,w=L.part,x=L.partsLoaded,P=!x||x.length===0||x.some(function(M){return!M}),F=new S.ChunkMetadata(O.level,O.sn,O.stats.chunkCount+1,0,w?w.index:-1,!P);k.flush(F)}},b._handleFragmentLoadProgress=function(L){},b._doFragLoad=function(L,k,O,w){var x=this;if(O===void 0&&(O=null),!this.levels)throw new Error("frag load aborted, missing levels");if(O=Math.max(L.start,O||0),this.config.lowLatencyMode&&k){var P=k.partList;if(P&&w){O>L.end&&k.fragmentHint&&(L=k.fragmentHint);var F=this.getNextPart(P,L,O);if(F>-1){var M=P[F];return this.log("Loading part sn: "+L.sn+" p: "+M.index+" cc: "+L.cc+" of playlist ["+k.startSN+"-"+k.endSN+"] parts [0-"+F+"-"+(P.length-1)+"] "+(this.logPrefix==="[stream-controller]"?"level":"track")+": "+L.level+", target: "+parseFloat(O.toFixed(3))),this.nextLoadPosition=M.start+M.duration,this.state=n.FRAG_LOADING,this.hls.trigger(D.Events.FRAG_LOADING,{frag:L,part:P[F],targetBufferTime:O}),this.doFragPartsLoad(L,P,F,w).catch(function(B){return x.handleFragLoadError(B)})}if(!L.url||this.loadedEndOfParts(P,O))return Promise.resolve(null)}}return this.log("Loading fragment "+L.sn+" cc: "+L.cc+" "+(k?"of ["+k.startSN+"-"+k.endSN+"] ":"")+(this.logPrefix==="[stream-controller]"?"level":"track")+": "+L.level+", target: "+parseFloat(O.toFixed(3))),Object(R.isFiniteNumber)(L.sn)&&!this.bitrateTest&&(this.nextLoadPosition=L.start+L.duration),this.state=n.FRAG_LOADING,this.hls.trigger(D.Events.FRAG_LOADING,{frag:L,targetBufferTime:O}),this.fragmentLoader.load(L,w).catch(function(B){return x.handleFragLoadError(B)})},b.doFragPartsLoad=function(L,k,O,w){var x=this;return new Promise(function(P,F){var M=[];(function B(U){var G=k[U];x.fragmentLoader.loadPart(L,G,w).then(function(V){M[G.index]=V;var H=V.part;x.hls.trigger(D.Events.FRAG_LOADED,V);var Y=k[U+1];if(!Y||Y.fragment!==L)return P({frag:L,part:H,partsLoaded:M});B(U+1)}).catch(F)})(O)})},b.handleFragLoadError=function(L){var k=L.data;return k&&k.details===s.ErrorDetails.INTERNAL_ABORTED?this.handleFragLoadAborted(k.frag,k.part):this.hls.trigger(D.Events.ERROR,k),null},b._handleTransmuxerFlush=function(L){var k=this.getCurrentContext(L);if(k&&this.state===n.PARSING){var O=k.frag,w=k.part,x=k.level,P=self.performance.now();O.stats.parsing.end=P,w&&(w.stats.parsing.end=P),this.updateLevelTiming(O,w,x,L.partial)}else this.fragCurrent||(this.state=n.IDLE)},b.getCurrentContext=function(L){var k=this.levels,O=L.level,w=L.sn,x=L.part;if(!k||!k[O])return this.warn("Levels object was unset while buffering fragment "+w+" of level "+O+". The current chunk will not be buffered."),null;var P=k[O],F=x>-1?Object(y.getPartWith)(P,w,x):null,M=F?F.fragment:Object(y.getFragmentWithSN)(P,w,this.fragCurrent);return M?{frag:M,part:F,level:P}:null},b.bufferFragmentData=function(L,k,O,w){if(L&&this.state===n.PARSING){var x=L.data1,P=L.data2,F=x;if(x&&P&&(F=Object(m.appendUint8Array)(x,P)),F&&F.length){var M={type:L.type,frag:k,part:O,chunkMeta:w,parent:k.type,data:F};this.hls.trigger(D.Events.BUFFER_APPENDING,M),L.dropped&&L.independent&&!O&&this.flushBufferGap(k)}}},b.flushBufferGap=function(L){var k=this.media;if(k)if(_.BufferHelper.isBuffered(k,k.currentTime)){var O=k.currentTime,w=_.BufferHelper.bufferInfo(k,O,0),x=L.duration,P=Math.min(2*this.config.maxFragLookUpTolerance,.25*x),F=Math.max(Math.min(L.start-P,w.end-P),O+P);L.start-F>P&&this.flushMainBuffer(F,L.start)}else this.flushMainBuffer(0,L.start)},b.getFwdBufferInfo=function(L,k){var O=this.config,w=this.getLoadPosition();if(!Object(R.isFiniteNumber)(w))return null;var x=_.BufferHelper.bufferInfo(L,w,O.maxBufferHole);if(x.len===0&&x.nextStart!==void 0){var P=this.fragmentTracker.getBufferedFrag(w,k);if(P&&x.nextStart<P.end)return _.BufferHelper.bufferInfo(L,w,Math.max(x.nextStart,O.maxBufferHole))}return x},b.getMaxBufferLength=function(L){var k,O=this.config;return k=L?Math.max(8*O.maxBufferSize/L,O.maxBufferLength):O.maxBufferLength,Math.min(k,O.maxMaxBufferLength)},b.reduceMaxBufferLength=function(L){var k=this.config,O=L||k.maxBufferLength;return k.maxMaxBufferLength>=O&&(k.maxMaxBufferLength/=2,this.warn("Reduce max buffer length to "+k.maxMaxBufferLength+"s"),!0)},b.getNextFragment=function(L,k){var O,w,x=k.fragments,P=x.length;if(!P)return null;var F,M=this.config,B=x[0].start;if(k.live){var U=M.initialLiveManifestSize;if(P<U)return this.warn("Not enough fragments to start playback (have: "+P+", need: "+U+")"),null;k.PTSKnown||this.startFragRequested||this.startPosition!==-1||(F=this.getInitialLiveFragment(k,x),this.startPosition=F?this.hls.liveSyncPosition||F.start:L)}else L<=B&&(F=x[0]);if(!F){var G=M.lowLatencyMode?k.partEnd:k.fragmentEnd;F=this.getFragmentAtPosition(L,G,k)}return(O=F)===null||O===void 0||!O.initSegment||(w=F)!==null&&w!==void 0&&w.initSegment.data||this.bitrateTest||(F=F.initSegment),F},b.getNextPart=function(L,k,O){for(var w=-1,x=!1,P=!0,F=0,M=L.length;F<M;F++){var B=L[F];if(P=P&&!B.independent,w>-1&&O<B.start)break;var U=B.loaded;!U&&(x||B.independent||P)&&B.fragment===k&&(w=F),x=U}return w},b.loadedEndOfParts=function(L,k){var O=L[L.length-1];return O&&k>O.start&&O.loaded},b.getInitialLiveFragment=function(L,k){var O=this.fragPrevious,w=null;if(O){if(L.hasProgramDateTime&&(this.log("Live playlist, switching playlist, load frag with same PDT: "+O.programDateTime),w=Object(T.findFragmentByPDT)(k,O.endProgramDateTime,this.config.maxFragLookUpTolerance)),!w){var x=O.sn+1;if(x>=L.startSN&&x<=L.endSN){var P=k[x-L.startSN];O.cc===P.cc&&(w=P,this.log("Live playlist, switching playlist, load frag with next SN: "+w.sn))}w||(w=Object(T.findFragWithCC)(k,O.cc))&&this.log("Live playlist, switching playlist, load frag with same CC: "+w.sn)}}else{var F=this.hls.liveSyncPosition;F!==null&&(w=this.getFragmentAtPosition(F,this.bitrateTest?L.fragmentEnd:L.edge,L))}return w},b.getFragmentAtPosition=function(L,k,O){var w,x=this.config,P=this.fragPrevious,F=O.fragments,M=O.endSN,B=O.fragmentHint,U=x.maxFragLookUpTolerance,G=!!(x.lowLatencyMode&&O.partList&&B);if(G&&B&&!this.bitrateTest&&(F=F.concat(B),M=B.sn),L<k){var V=L>k-U?0:U;w=Object(T.findFragmentByPTS)(P,F,L,V)}else w=F[F.length-1];if(w){var H=w.sn-O.startSN,Y=P&&w.level===P.level,W=F[H+1];if(this.fragmentTracker.getState(w)===A.FragmentState.BACKTRACKED){w=null;for(var q=H;F[q]&&this.fragmentTracker.getState(F[q])===A.FragmentState.BACKTRACKED;)w=P?F[q--]:F[--q];w||(w=W)}else P&&w.sn===P.sn&&!G&&Y&&(w.sn<M&&this.fragmentTracker.getState(W)!==A.FragmentState.OK?(this.log("SN "+w.sn+" just loaded, load next one: "+W.sn),w=W):w=null)}return w},b.synchronizeToLiveEdge=function(L){var k=this.config,O=this.media;if(O){var w=this.hls.liveSyncPosition,x=O.currentTime,P=L.fragments[0].start,F=L.edge,M=x>=P-k.maxFragLookUpTolerance&&x<=F;if(w!==null&&O.duration>w&&(x<w||!M)){var B=k.liveMaxLatencyDuration!==void 0?k.liveMaxLatencyDuration:k.liveMaxLatencyDurationCount*L.targetduration;(!M&&O.readyState<4||x<F-B)&&(this.loadedmetadata||(this.nextLoadPosition=w),O.readyState&&(this.warn("Playback: "+x.toFixed(3)+" is located too far from the end of live sliding playlist: "+F+", reset currentTime to : "+w.toFixed(3)),O.currentTime=w))}}},b.alignPlaylists=function(L,k){var O=this.levels,w=this.levelLastLoaded,x=this.fragPrevious,P=w!==null?O[w]:null,F=L.fragments.length;if(!F)return this.warn("No fragments in live playlist"),0;var M=L.fragments[0].start,B=!k,U=L.alignedSliding&&Object(R.isFiniteNumber)(M);if(B||!U&&!M){Object(h.alignStream)(x,P,L);var G=L.fragments[0].start;return this.log("Live playlist sliding: "+G.toFixed(2)+" start-sn: "+(k?k.startSN:"na")+"->"+L.startSN+" prev-sn: "+(x?x.sn:"na")+" fragments: "+F),G}return M},b.waitForCdnTuneIn=function(L){return L.live&&L.canBlockReload&&L.tuneInGoal>Math.max(L.partHoldBack,3*L.partTarget)},b.setStartPosition=function(L,k){var O=this.startPosition;if(O<k&&(O=-1),O===-1||this.lastCurrentTime===-1){var w=L.startTimeOffset;Object(R.isFiniteNumber)(w)?(O=k+w,w<0&&(O+=L.totalduration),O=Math.min(Math.max(k,O),k+L.totalduration),this.log("Start time offset "+w+" found in playlist, adjust startPosition to "+O),this.startPosition=O):L.live?O=this.hls.liveSyncPosition||k:this.startPosition=O=0,this.lastCurrentTime=O}this.nextLoadPosition=O},b.getLoadPosition=function(){var L=this.media,k=0;return this.loadedmetadata&&L?k=L.currentTime:this.nextLoadPosition&&(k=this.nextLoadPosition),k},b.handleFragLoadAborted=function(L,k){this.transmuxer&&L.sn!=="initSegment"&&L.stats.aborted&&(this.warn("Fragment "+L.sn+(k?" part"+k.index:"")+" of level "+L.level+" was aborted"),this.resetFragmentLoading(L))},b.resetFragmentLoading=function(L){this.fragCurrent&&this.fragContextChanged(L)||(this.state=n.IDLE)},b.onFragmentOrKeyLoadError=function(L,k){if(!k.fatal){var O=k.frag;if(O&&O.type===L){var w=this.fragCurrent;console.assert(w&&O.sn===w.sn&&O.level===w.level&&O.urlId===w.urlId,"Frag load error must match current frag to retry");var x=this.config;if(this.fragLoadError+1<=x.fragLoadingMaxRetry){if(this.resetLiveStartWhenNotLoaded(O.level))return;var P=Math.min(Math.pow(2,this.fragLoadError)*x.fragLoadingRetryDelay,x.fragLoadingMaxRetryTimeout);this.warn("Fragment "+O.sn+" of "+L+" "+O.level+" failed to load, retrying in "+P+"ms"),this.retryDate=self.performance.now()+P,this.fragLoadError++,this.state=n.FRAG_LOADING_WAITING_RETRY}else k.levelRetry?(L===e.PlaylistLevelType.AUDIO&&(this.fragCurrent=null),this.fragLoadError=0,this.state=n.IDLE):(I.logger.error(k.details+" reaches max retry, redispatch as fatal ..."),k.fatal=!0,this.hls.stopLoad(),this.state=n.ERROR)}}},b.afterBufferFlushed=function(L,k,O){if(L){var w=_.BufferHelper.getBuffered(L);this.fragmentTracker.detectEvictedFragments(k,w,O),this.state===n.ENDED&&this.resetLoadingState()}},b.resetLoadingState=function(){this.fragCurrent=null,this.fragPrevious=null,this.state=n.IDLE},b.resetLiveStartWhenNotLoaded=function(L){if(!this.loadedmetadata){this.startFragRequested=!1;var k=this.levels?this.levels[L].details:null;if(k!=null&&k.live)return this.startPosition=-1,this.setStartPosition(k,0),this.resetLoadingState(),!0;this.nextLoadPosition=this.startPosition}return!1},b.updateLevelTiming=function(L,k,O,w){var x=this,P=O.details;console.assert(!!P,"level.details must be defined"),Object.keys(L.elementaryStreams).reduce(function(F,M){var B=L.elementaryStreams[M];if(B){var U=B.endPTS-B.startPTS;if(U<=0)return x.warn("Could not parse fragment "+L.sn+" "+M+" duration reliably ("+U+") resetting transmuxer to fallback to playlist timing"),x.resetTransmuxer(),F||!1;var G=w?0:Object(y.updateFragPTSDTS)(P,L,B.startPTS,B.endPTS,B.startDTS,B.endDTS);return x.hls.trigger(D.Events.LEVEL_PTS_UPDATED,{details:P,level:O,drift:G,type:M,frag:L,start:B.startPTS,end:B.endPTS}),!0}return F},!1)?(this.state=n.PARSED,this.hls.trigger(D.Events.FRAG_PARSED,{frag:L,part:k})):this.resetLoadingState()},b.resetTransmuxer=function(){this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null)},i=r,(c=[{key:"state",get:function(){return this._state},set:function(L){var k=this._state;k!==L&&(this._state=L,this.log(k+"->"+L))}}])&&o(i.prototype,c),r}(E.default)},"./src/controller/buffer-controller.ts":function(N,C,f){f.r(C),f.d(C,"default",function(){return T});var R=f("./src/polyfills/number.ts"),E=f("./src/events.ts"),A=f("./src/utils/logger.ts"),_=f("./src/errors.ts"),I=f("./src/utils/buffer-helper.ts"),D=f("./src/utils/mediasource-helper.ts"),s=f("./src/loader/fragment.ts"),S=f("./src/controller/buffer-operation-queue.ts"),m=Object(D.getMediaSource)(),h=/([ha]vc.)(?:\.[^.,]+)+/,T=function(){function y(t){var a=this;this.details=null,this._objectUrl=null,this.operationQueue=void 0,this.listeners=void 0,this.hls=void 0,this.bufferCodecEventsExpected=0,this._bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.appendError=0,this.tracks={},this.pendingTracks={},this.sourceBuffer=void 0,this._onMediaSourceOpen=function(){var e=a.hls,o=a.media,u=a.mediaSource;A.logger.log("[buffer-controller]: Media source opened"),o&&(a.updateMediaElementDuration(),e.trigger(E.Events.MEDIA_ATTACHED,{media:o})),u&&u.removeEventListener("sourceopen",a._onMediaSourceOpen),a.checkPendingTracks()},this._onMediaSourceClose=function(){A.logger.log("[buffer-controller]: Media source closed")},this._onMediaSourceEnded=function(){A.logger.log("[buffer-controller]: Media source ended")},this.hls=t,this._initSourceBuffer(),this.registerListeners()}var d=y.prototype;return d.hasSourceTypes=function(){return this.getSourceBufferTypes().length>0||Object.keys(this.pendingTracks).length>0},d.destroy=function(){this.unregisterListeners(),this.details=null},d.registerListeners=function(){var t=this.hls;t.on(E.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),t.on(E.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(E.Events.MANIFEST_PARSED,this.onManifestParsed,this),t.on(E.Events.BUFFER_RESET,this.onBufferReset,this),t.on(E.Events.BUFFER_APPENDING,this.onBufferAppending,this),t.on(E.Events.BUFFER_CODECS,this.onBufferCodecs,this),t.on(E.Events.BUFFER_EOS,this.onBufferEos,this),t.on(E.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),t.on(E.Events.LEVEL_UPDATED,this.onLevelUpdated,this),t.on(E.Events.FRAG_PARSED,this.onFragParsed,this),t.on(E.Events.FRAG_CHANGED,this.onFragChanged,this)},d.unregisterListeners=function(){var t=this.hls;t.off(E.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),t.off(E.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(E.Events.MANIFEST_PARSED,this.onManifestParsed,this),t.off(E.Events.BUFFER_RESET,this.onBufferReset,this),t.off(E.Events.BUFFER_APPENDING,this.onBufferAppending,this),t.off(E.Events.BUFFER_CODECS,this.onBufferCodecs,this),t.off(E.Events.BUFFER_EOS,this.onBufferEos,this),t.off(E.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),t.off(E.Events.LEVEL_UPDATED,this.onLevelUpdated,this),t.off(E.Events.FRAG_PARSED,this.onFragParsed,this),t.off(E.Events.FRAG_CHANGED,this.onFragChanged,this)},d._initSourceBuffer=function(){this.sourceBuffer={},this.operationQueue=new S.default(this.sourceBuffer),this.listeners={audio:[],video:[],audiovideo:[]}},d.onManifestParsed=function(t,a){var e=2;(a.audio&&!a.video||!a.altAudio)&&(e=1),this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=e,this.details=null,A.logger.log(this.bufferCodecEventsExpected+" bufferCodec event(s) expected")},d.onMediaAttaching=function(t,a){var e=this.media=a.media;if(e&&m){var o=this.mediaSource=new m;o.addEventListener("sourceopen",this._onMediaSourceOpen),o.addEventListener("sourceended",this._onMediaSourceEnded),o.addEventListener("sourceclose",this._onMediaSourceClose),e.src=self.URL.createObjectURL(o),this._objectUrl=e.src}},d.onMediaDetaching=function(){var t=this.media,a=this.mediaSource,e=this._objectUrl;if(a){if(A.logger.log("[buffer-controller]: media source detaching"),a.readyState==="open")try{a.endOfStream()}catch(o){A.logger.warn("[buffer-controller]: onMediaDetaching: "+o.message+" while calling endOfStream")}this.onBufferReset(),a.removeEventListener("sourceopen",this._onMediaSourceOpen),a.removeEventListener("sourceended",this._onMediaSourceEnded),a.removeEventListener("sourceclose",this._onMediaSourceClose),t&&(e&&self.URL.revokeObjectURL(e),t.src===e?(t.removeAttribute("src"),t.load()):A.logger.warn("[buffer-controller]: media.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.bufferCodecEventsExpected=this._bufferCodecEventsTotal,this.pendingTracks={},this.tracks={}}this.hls.trigger(E.Events.MEDIA_DETACHED,void 0)},d.onBufferReset=function(){var t=this;this.getSourceBufferTypes().forEach(function(a){var e=t.sourceBuffer[a];try{e&&(t.removeBufferListeners(a),t.mediaSource&&t.mediaSource.removeSourceBuffer(e),t.sourceBuffer[a]=void 0)}catch(o){A.logger.warn("[buffer-controller]: Failed to reset the "+a+" buffer",o)}}),this._initSourceBuffer()},d.onBufferCodecs=function(t,a){var e=this,o=this.getSourceBufferTypes().length;Object.keys(a).forEach(function(u){if(o){var n=e.tracks[u];if(n&&typeof n.buffer.changeType=="function"){var l=a[u],p=l.codec,g=l.levelCodec,v=l.container;if((n.levelCodec||n.codec).replace(h,"$1")!==(g||p).replace(h,"$1")){var r=v+";codecs="+(g||p);e.appendChangeType(u,r)}}}else e.pendingTracks[u]=a[u]}),o||(this.bufferCodecEventsExpected=Math.max(this.bufferCodecEventsExpected-1,0),this.mediaSource&&this.mediaSource.readyState==="open"&&this.checkPendingTracks())},d.appendChangeType=function(t,a){var e=this,o=this.operationQueue,u={execute:function(){var n=e.sourceBuffer[t];n&&(A.logger.log("[buffer-controller]: changing "+t+" sourceBuffer type to "+a),n.changeType(a)),o.shiftAndExecuteNext(t)},onStart:function(){},onComplete:function(){},onError:function(n){A.logger.warn("[buffer-controller]: Failed to change "+t+" SourceBuffer type",n)}};o.append(u,t)},d.onBufferAppending=function(t,a){var e=this,o=this.hls,u=this.operationQueue,n=this.tracks,l=a.data,p=a.type,g=a.frag,v=a.part,r=a.chunkMeta,i=r.buffering[p],c=self.performance.now();i.start=c;var b=g.stats.buffering,L=v?v.stats.buffering:null;b.start===0&&(b.start=c),L&&L.start===0&&(L.start=c);var k=n.audio,O=p==="audio"&&r.id===1&&(k==null?void 0:k.container)==="audio/mpeg",w={execute:function(){if(i.executeStart=self.performance.now(),O){var x=e.sourceBuffer[p];if(x){var P=g.start-x.timestampOffset;Math.abs(P)>=.1&&(A.logger.log("[buffer-controller]: Updating audio SourceBuffer timestampOffset to "+g.start+" (delta: "+P+") sn: "+g.sn+")"),x.timestampOffset=g.start)}}e.appendExecutor(l,p)},onStart:function(){},onComplete:function(){var x=self.performance.now();i.executeEnd=i.end=x,b.first===0&&(b.first=x),L&&L.first===0&&(L.first=x);var P=e.sourceBuffer,F={};for(var M in P)F[M]=I.BufferHelper.getBuffered(P[M]);e.appendError=0,e.hls.trigger(E.Events.BUFFER_APPENDED,{type:p,frag:g,part:v,chunkMeta:r,parent:g.type,timeRanges:F})},onError:function(x){A.logger.error("[buffer-controller]: Error encountered while trying to append to the "+p+" SourceBuffer",x);var P={type:_.ErrorTypes.MEDIA_ERROR,parent:g.type,details:_.ErrorDetails.BUFFER_APPEND_ERROR,err:x,fatal:!1};x.code===DOMException.QUOTA_EXCEEDED_ERR?P.details=_.ErrorDetails.BUFFER_FULL_ERROR:(e.appendError++,P.details=_.ErrorDetails.BUFFER_APPEND_ERROR,e.appendError>o.config.appendErrorMaxRetry&&(A.logger.error("[buffer-controller]: Failed "+o.config.appendErrorMaxRetry+" times to append segment in sourceBuffer"),P.fatal=!0)),o.trigger(E.Events.ERROR,P)}};u.append(w,p)},d.onBufferFlushing=function(t,a){var e=this,o=this.operationQueue,u=function(n){return{execute:e.removeExecutor.bind(e,n,a.startOffset,a.endOffset),onStart:function(){},onComplete:function(){e.hls.trigger(E.Events.BUFFER_FLUSHED,{type:n})},onError:function(l){A.logger.warn("[buffer-controller]: Failed to remove from "+n+" SourceBuffer",l)}}};a.type?o.append(u(a.type),a.type):this.getSourceBufferTypes().forEach(function(n){o.append(u(n),n)})},d.onFragParsed=function(t,a){var e=this,o=a.frag,u=a.part,n=[],l=u?u.elementaryStreams:o.elementaryStreams;l[s.ElementaryStreamTypes.AUDIOVIDEO]?n.push("audiovideo"):(l[s.ElementaryStreamTypes.AUDIO]&&n.push("audio"),l[s.ElementaryStreamTypes.VIDEO]&&n.push("video")),n.length===0&&A.logger.warn("Fragments must have at least one ElementaryStreamType set. type: "+o.type+" level: "+o.level+" sn: "+o.sn),this.blockBuffers(function(){var p=self.performance.now();o.stats.buffering.end=p,u&&(u.stats.buffering.end=p);var g=u?u.stats:o.stats;e.hls.trigger(E.Events.FRAG_BUFFERED,{frag:o,part:u,stats:g,id:o.type})},n)},d.onFragChanged=function(t,a){this.flushBackBuffer()},d.onBufferEos=function(t,a){var e=this;this.getSourceBufferTypes().reduce(function(o,u){var n=e.sourceBuffer[u];return a.type&&a.type!==u||n&&!n.ended&&(n.ended=!0,A.logger.log("[buffer-controller]: "+u+" sourceBuffer now EOS")),o&&!(n&&!n.ended)},!0)&&this.blockBuffers(function(){var o=e.mediaSource;o&&o.readyState==="open"&&o.endOfStream()})},d.onLevelUpdated=function(t,a){var e=a.details;e.fragments.length&&(this.details=e,this.getSourceBufferTypes().length?this.blockBuffers(this.updateMediaElementDuration.bind(this)):this.updateMediaElementDuration())},d.flushBackBuffer=function(){var t=this.hls,a=this.details,e=this.media,o=this.sourceBuffer;if(e&&a!==null){var u=this.getSourceBufferTypes();if(u.length){var n=a.live&&t.config.liveBackBufferLength!==null?t.config.liveBackBufferLength:t.config.backBufferLength;if(Object(R.isFiniteNumber)(n)&&!(n<0)){var l=e.currentTime,p=a.levelTargetDuration,g=Math.max(n,p),v=Math.floor(l/p)*p-g;u.forEach(function(r){var i=o[r];if(i){var c=I.BufferHelper.getBuffered(i);c.length>0&&v>c.start(0)&&(t.trigger(E.Events.BACK_BUFFER_REACHED,{bufferEnd:v}),a.live&&t.trigger(E.Events.LIVE_BACK_BUFFER_REACHED,{bufferEnd:v}),t.trigger(E.Events.BUFFER_FLUSHING,{startOffset:0,endOffset:v,type:r}))}})}}}},d.updateMediaElementDuration=function(){if(this.details&&this.media&&this.mediaSource&&this.mediaSource.readyState==="open"){var t=this.details,a=this.hls,e=this.media,o=this.mediaSource,u=t.fragments[0].start+t.totalduration,n=e.duration,l=Object(R.isFiniteNumber)(o.duration)?o.duration:0;t.live&&a.config.liveDurationInfinity?(A.logger.log("[buffer-controller]: Media Source duration is set to Infinity"),o.duration=1/0,this.updateSeekableRange(t)):(u>l&&u>n||!Object(R.isFiniteNumber)(n))&&(A.logger.log("[buffer-controller]: Updating Media Source duration to "+u.toFixed(3)),o.duration=u)}},d.updateSeekableRange=function(t){var a=this.mediaSource,e=t.fragments;if(e.length&&t.live&&a!=null&&a.setLiveSeekableRange){var o=Math.max(0,e[0].start),u=Math.max(o,o+t.totalduration);a.setLiveSeekableRange(o,u)}},d.checkPendingTracks=function(){var t=this.bufferCodecEventsExpected,a=this.operationQueue,e=this.pendingTracks,o=Object.keys(e).length;if(o&&!t||o===2){this.createSourceBuffers(e),this.pendingTracks={};var u=this.getSourceBufferTypes();if(u.length===0)return void this.hls.trigger(E.Events.ERROR,{type:_.ErrorTypes.MEDIA_ERROR,details:_.ErrorDetails.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,reason:"could not create source buffer for media codec(s)"});u.forEach(function(n){a.executeNext(n)})}},d.createSourceBuffers=function(t){var a=this.sourceBuffer,e=this.mediaSource;if(!e)throw Error("createSourceBuffers called when mediaSource was null");var o=0;for(var u in t)if(!a[u]){var n=t[u];if(!n)throw Error("source buffer exists for track "+u+", however track does not");var l=n.levelCodec||n.codec,p=n.container+";codecs="+l;A.logger.log("[buffer-controller]: creating sourceBuffer("+p+")");try{var g=a[u]=e.addSourceBuffer(p),v=u;this.addBufferListener(v,"updatestart",this._onSBUpdateStart),this.addBufferListener(v,"updateend",this._onSBUpdateEnd),this.addBufferListener(v,"error",this._onSBUpdateError),this.tracks[u]={buffer:g,codec:l,container:n.container,levelCodec:n.levelCodec,id:n.id},o++}catch(r){A.logger.error("[buffer-controller]: error while trying to add sourceBuffer: "+r.message),this.hls.trigger(E.Events.ERROR,{type:_.ErrorTypes.MEDIA_ERROR,details:_.ErrorDetails.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:r,mimeType:p})}}o&&this.hls.trigger(E.Events.BUFFER_CREATED,{tracks:this.tracks})},d._onSBUpdateStart=function(t){this.operationQueue.current(t).onStart()},d._onSBUpdateEnd=function(t){var a=this.operationQueue;a.current(t).onComplete(),a.shiftAndExecuteNext(t)},d._onSBUpdateError=function(t,a){A.logger.error("[buffer-controller]: "+t+" SourceBuffer error",a),this.hls.trigger(E.Events.ERROR,{type:_.ErrorTypes.MEDIA_ERROR,details:_.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:!1});var e=this.operationQueue.current(t);e&&e.onError(a)},d.removeExecutor=function(t,a,e){var o=this.media,u=this.mediaSource,n=this.operationQueue,l=this.sourceBuffer[t];if(!o||!u||!l)return A.logger.warn("[buffer-controller]: Attempting to remove from the "+t+" SourceBuffer, but it does not exist"),void n.shiftAndExecuteNext(t);var p=Object(R.isFiniteNumber)(o.duration)?o.duration:1/0,g=Object(R.isFiniteNumber)(u.duration)?u.duration:1/0,v=Math.max(0,a),r=Math.min(e,p,g);r>v?(A.logger.log("[buffer-controller]: Removing ["+v+","+r+"] from the "+t+" SourceBuffer"),console.assert(!l.updating,t+" sourceBuffer must not be updating"),l.remove(v,r)):n.shiftAndExecuteNext(t)},d.appendExecutor=function(t,a){var e=this.operationQueue,o=this.sourceBuffer[a];if(!o)return A.logger.warn("[buffer-controller]: Attempting to append to the "+a+" SourceBuffer, but it does not exist"),void e.shiftAndExecuteNext(a);o.ended=!1,console.assert(!o.updating,a+" sourceBuffer must not be updating"),o.appendBuffer(t)},d.blockBuffers=function(t,a){var e=this;if(a===void 0&&(a=this.getSourceBufferTypes()),!a.length)return A.logger.log("[buffer-controller]: Blocking operation requested, but no SourceBuffers exist"),void Promise.resolve(t);var o=this.operationQueue,u=a.map(function(n){return o.appendBlocker(n)});Promise.all(u).then(function(){t(),a.forEach(function(n){var l=e.sourceBuffer[n];l&&l.updating||o.shiftAndExecuteNext(n)})})},d.getSourceBufferTypes=function(){return Object.keys(this.sourceBuffer)},d.addBufferListener=function(t,a,e){var o=this.sourceBuffer[t];if(o){var u=e.bind(this,t);this.listeners[t].push({event:a,listener:u}),o.addEventListener(a,u)}},d.removeBufferListeners=function(t){var a=this.sourceBuffer[t];a&&this.listeners[t].forEach(function(e){a.removeEventListener(e.event,e.listener)})},y}()},"./src/controller/buffer-operation-queue.ts":function(N,C,f){f.r(C),f.d(C,"default",function(){return E});var R=f("./src/utils/logger.ts"),E=function(){function A(I){this.buffers=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.buffers=I}var _=A.prototype;return _.append=function(I,D){var s=this.queues[D];s.push(I),s.length===1&&this.buffers[D]&&this.executeNext(D)},_.insertAbort=function(I,D){this.queues[D].unshift(I),this.executeNext(D)},_.appendBlocker=function(I){var D,s=new Promise(function(m){D=m}),S={execute:D,onStart:function(){},onComplete:function(){},onError:function(){}};return this.append(S,I),s},_.executeNext=function(I){var D=this.buffers,s=this.queues,S=D[I],m=s[I];if(m.length){var h=m[0];try{h.execute()}catch(T){R.logger.warn("[buffer-operation-queue]: Unhandled exception executing the current operation"),h.onError(T),S&&S.updating||(m.shift(),this.executeNext(I))}}},_.shiftAndExecuteNext=function(I){this.queues[I].shift(),this.executeNext(I)},_.current=function(I){return this.queues[I][0]},A}()},"./src/controller/cap-level-controller.ts":function(N,C,f){f.r(C);var R=f("./src/events.ts");function E(_,I){for(var D=0;D<I.length;D++){var s=I[D];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(_,s.key,s)}}var A=function(){function _(m){this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.hls=void 0,this.streamController=void 0,this.clientRect=void 0,this.hls=m,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}var I,D,s,S=_.prototype;return S.setStreamController=function(m){this.streamController=m},S.destroy=function(){this.unregisterListener(),this.hls.config.capLevelToPlayerSize&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null},S.registerListeners=function(){var m=this.hls;m.on(R.Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),m.on(R.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),m.on(R.Events.MANIFEST_PARSED,this.onManifestParsed,this),m.on(R.Events.BUFFER_CODECS,this.onBufferCodecs,this),m.on(R.Events.MEDIA_DETACHING,this.onMediaDetaching,this)},S.unregisterListener=function(){var m=this.hls;m.off(R.Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),m.off(R.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),m.off(R.Events.MANIFEST_PARSED,this.onManifestParsed,this),m.off(R.Events.BUFFER_CODECS,this.onBufferCodecs,this),m.off(R.Events.MEDIA_DETACHING,this.onMediaDetaching,this)},S.onFpsDropLevelCapping=function(m,h){_.isLevelAllowed(h.droppedLevel,this.restrictedLevels)&&this.restrictedLevels.push(h.droppedLevel)},S.onMediaAttaching=function(m,h){this.media=h.media instanceof HTMLVideoElement?h.media:null},S.onManifestParsed=function(m,h){var T=this.hls;this.restrictedLevels=[],this.firstLevel=h.firstLevel,T.config.capLevelToPlayerSize&&h.video&&this.startCapping()},S.onBufferCodecs=function(m,h){this.hls.config.capLevelToPlayerSize&&h.video&&this.startCapping()},S.onMediaDetaching=function(){this.stopCapping()},S.detectPlayerSize=function(){if(this.media&&this.mediaHeight>0&&this.mediaWidth>0){var m=this.hls.levels;if(m.length){var h=this.hls;h.autoLevelCapping=this.getMaxLevel(m.length-1),h.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=h.autoLevelCapping}}},S.getMaxLevel=function(m){var h=this,T=this.hls.levels;if(!T.length)return-1;var y=T.filter(function(d,t){return _.isLevelAllowed(t,h.restrictedLevels)&&t<=m});return this.clientRect=null,_.getMaxLevelByMediaSize(y,this.mediaWidth,this.mediaHeight)},S.startCapping=function(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.hls.firstLevel=this.getMaxLevel(this.firstLevel),self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())},S.stopCapping=function(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)},S.getDimensions=function(){if(this.clientRect)return this.clientRect;var m=this.media,h={width:0,height:0};if(m){var T=m.getBoundingClientRect();h.width=T.width,h.height=T.height,h.width||h.height||(h.width=T.right-T.left||m.width||0,h.height=T.bottom-T.top||m.height||0)}return this.clientRect=h,h},_.isLevelAllowed=function(m,h){return h===void 0&&(h=[]),h.indexOf(m)===-1},_.getMaxLevelByMediaSize=function(m,h,T){if(!m||!m.length)return-1;for(var y,d,t=m.length-1,a=0;a<m.length;a+=1){var e=m[a];if((e.width>=h||e.height>=T)&&(y=e,!(d=m[a+1])||y.width!==d.width||y.height!==d.height)){t=a;break}}return t},I=_,s=[{key:"contentScaleFactor",get:function(){var m=1;try{m=self.devicePixelRatio}catch{}return m}}],(D=[{key:"mediaWidth",get:function(){return this.getDimensions().width*_.contentScaleFactor}},{key:"mediaHeight",get:function(){return this.getDimensions().height*_.contentScaleFactor}}])&&E(I.prototype,D),s&&E(I,s),_}();C.default=A},"./src/controller/eme-controller.ts":function(N,C,f){f.r(C);var R=f("./src/events.ts"),E=f("./src/errors.ts"),A=f("./src/utils/logger.ts"),_=f("./src/utils/mediakeys-helper.ts");function I(s,S){for(var m=0;m<S.length;m++){var h=S[m];h.enumerable=h.enumerable||!1,h.configurable=!0,"value"in h&&(h.writable=!0),Object.defineProperty(s,h.key,h)}}var D=function(){function s(T){this.hls=void 0,this._widevineLicenseUrl=void 0,this._licenseXhrSetup=void 0,this._licenseResponseCallback=void 0,this._emeEnabled=void 0,this._requestMediaKeySystemAccess=void 0,this._drmSystemOptions=void 0,this._config=void 0,this._mediaKeysList=[],this._media=null,this._hasSetMediaKeys=!1,this._requestLicenseFailureCount=0,this.mediaKeysPromise=null,this._onMediaEncrypted=this.onMediaEncrypted.bind(this),this.hls=T,this._config=T.config,this._widevineLicenseUrl=this._config.widevineLicenseUrl,this._licenseXhrSetup=this._config.licenseXhrSetup,this._licenseResponseCallback=this._config.licenseResponseCallback,this._emeEnabled=this._config.emeEnabled,this._requestMediaKeySystemAccess=this._config.requestMediaKeySystemAccessFunc,this._drmSystemOptions=this._config.drmSystemOptions,this._registerListeners()}var S,m,h=s.prototype;return h.destroy=function(){this._unregisterListeners(),this.hls=this._onMediaEncrypted=null,this._requestMediaKeySystemAccess=null},h._registerListeners=function(){this.hls.on(R.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(R.Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(R.Events.MANIFEST_PARSED,this.onManifestParsed,this)},h._unregisterListeners=function(){this.hls.off(R.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(R.Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(R.Events.MANIFEST_PARSED,this.onManifestParsed,this)},h.getLicenseServerUrl=function(T){switch(T){case _.KeySystems.WIDEVINE:if(!this._widevineLicenseUrl)break;return this._widevineLicenseUrl}throw new Error('no license server URL configured for key-system "'+T+'"')},h._attemptKeySystemAccess=function(T,y,d){var t=this,a=function(o,u,n,l){switch(o){case _.KeySystems.WIDEVINE:return function(p,g,v){var r={audioCapabilities:[],videoCapabilities:[]};return p.forEach(function(i){r.audioCapabilities.push({contentType:'audio/mp4; codecs="'+i+'"',robustness:v.audioRobustness||""})}),g.forEach(function(i){r.videoCapabilities.push({contentType:'video/mp4; codecs="'+i+'"',robustness:v.videoRobustness||""})}),[r]}(u,n,l);default:throw new Error("Unknown key-system: "+o)}}(T,y,d,this._drmSystemOptions);A.logger.log("Requesting encrypted media key-system access");var e=this.requestMediaKeySystemAccess(T,a);this.mediaKeysPromise=e.then(function(o){return t._onMediaKeySystemAccessObtained(T,o)}),e.catch(function(o){A.logger.error('Failed to obtain key-system "'+T+'" access:',o)})},h._onMediaKeySystemAccessObtained=function(T,y){var d=this;A.logger.log('Access for key-system "'+T+'" obtained');var t={mediaKeysSessionInitialized:!1,mediaKeySystemAccess:y,mediaKeySystemDomain:T};this._mediaKeysList.push(t);var a=Promise.resolve().then(function(){return y.createMediaKeys()}).then(function(e){return t.mediaKeys=e,A.logger.log('Media-keys created for key-system "'+T+'"'),d._onMediaKeysCreated(),e});return a.catch(function(e){A.logger.error("Failed to create media-keys:",e)}),a},h._onMediaKeysCreated=function(){var T=this;this._mediaKeysList.forEach(function(y){y.mediaKeysSession||(y.mediaKeysSession=y.mediaKeys.createSession(),T._onNewMediaKeySession(y.mediaKeysSession))})},h._onNewMediaKeySession=function(T){var y=this;A.logger.log("New key-system session "+T.sessionId),T.addEventListener("message",function(d){y._onKeySessionMessage(T,d.message)},!1)},h._onKeySessionMessage=function(T,y){A.logger.log("Got EME message event, creating license request"),this._requestLicense(y,function(d){A.logger.log("Received license data (length: "+(d&&d.byteLength)+"), updating key-session"),T.update(d)})},h.onMediaEncrypted=function(T){var y=this;if(A.logger.log('Media is encrypted using "'+T.initDataType+'" init data type'),!this.mediaKeysPromise)return A.logger.error("Fatal: Media is encrypted but no CDM access or no keys have been requested"),void this.hls.trigger(R.Events.ERROR,{type:E.ErrorTypes.KEY_SYSTEM_ERROR,details:E.ErrorDetails.KEY_SYSTEM_NO_KEYS,fatal:!0});var d=function(t){y._media&&(y._attemptSetMediaKeys(t),y._generateRequestWithPreferredKeySession(T.initDataType,T.initData))};this.mediaKeysPromise.then(d).catch(d)},h._attemptSetMediaKeys=function(T){if(!this._media)throw new Error("Attempted to set mediaKeys without first attaching a media element");if(!this._hasSetMediaKeys){var y=this._mediaKeysList[0];if(!y||!y.mediaKeys)return A.logger.error("Fatal: Media is encrypted but no CDM access or no keys have been obtained yet"),void this.hls.trigger(R.Events.ERROR,{type:E.ErrorTypes.KEY_SYSTEM_ERROR,details:E.ErrorDetails.KEY_SYSTEM_NO_KEYS,fatal:!0});A.logger.log("Setting keys for encrypted media"),this._media.setMediaKeys(y.mediaKeys),this._hasSetMediaKeys=!0}},h._generateRequestWithPreferredKeySession=function(T,y){var d=this,t=this._mediaKeysList[0];if(!t)return A.logger.error("Fatal: Media is encrypted but not any key-system access has been obtained yet"),void this.hls.trigger(R.Events.ERROR,{type:E.ErrorTypes.KEY_SYSTEM_ERROR,details:E.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0});if(t.mediaKeysSessionInitialized)A.logger.warn("Key-Session already initialized but requested again");else{var a=t.mediaKeysSession;if(!a)return A.logger.error("Fatal: Media is encrypted but no key-session existing"),void this.hls.trigger(R.Events.ERROR,{type:E.ErrorTypes.KEY_SYSTEM_ERROR,details:E.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!0});if(!y)return A.logger.warn("Fatal: initData required for generating a key session is null"),void this.hls.trigger(R.Events.ERROR,{type:E.ErrorTypes.KEY_SYSTEM_ERROR,details:E.ErrorDetails.KEY_SYSTEM_NO_INIT_DATA,fatal:!0});A.logger.log('Generating key-session request for "'+T+'" init data type'),t.mediaKeysSessionInitialized=!0,a.generateRequest(T,y).then(function(){A.logger.debug("Key-session generation succeeded")}).catch(function(e){A.logger.error("Error generating key-session request:",e),d.hls.trigger(R.Events.ERROR,{type:E.ErrorTypes.KEY_SYSTEM_ERROR,details:E.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!1})})}},h._createLicenseXhr=function(T,y,d){var t=new XMLHttpRequest;t.responseType="arraybuffer",t.onreadystatechange=this._onLicenseRequestReadyStageChange.bind(this,t,T,y,d);var a=this._licenseXhrSetup;if(a)try{a.call(this.hls,t,T),a=void 0}catch(e){A.logger.error(e)}try{t.readyState||t.open("POST",T,!0),a&&a.call(this.hls,t,T)}catch(e){throw new Error("issue setting up KeySystem license XHR "+e)}return t},h._onLicenseRequestReadyStageChange=function(T,y,d,t){switch(T.readyState){case 4:if(T.status===200){this._requestLicenseFailureCount=0,A.logger.log("License request succeeded");var a=T.response,e=this._licenseResponseCallback;if(e)try{a=e.call(this.hls,T,y)}catch(u){A.logger.error(u)}t(a)}else{if(A.logger.error("License Request XHR failed ("+y+"). Status: "+T.status+" ("+T.statusText+")"),this._requestLicenseFailureCount++,this._requestLicenseFailureCount>3)return void this.hls.trigger(R.Events.ERROR,{type:E.ErrorTypes.KEY_SYSTEM_ERROR,details:E.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0});var o=3-this._requestLicenseFailureCount+1;A.logger.warn("Retrying license request, "+o+" attempts left"),this._requestLicense(d,t)}}},h._generateLicenseRequestChallenge=function(T,y){switch(T.mediaKeySystemDomain){case _.KeySystems.WIDEVINE:return y}throw new Error("unsupported key-system: "+T.mediaKeySystemDomain)},h._requestLicense=function(T,y){A.logger.log("Requesting content license for key-system");var d=this._mediaKeysList[0];if(!d)return A.logger.error("Fatal error: Media is encrypted but no key-system access has been obtained yet"),void this.hls.trigger(R.Events.ERROR,{type:E.ErrorTypes.KEY_SYSTEM_ERROR,details:E.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0});try{var t=this.getLicenseServerUrl(d.mediaKeySystemDomain),a=this._createLicenseXhr(t,T,y);A.logger.log("Sending license request to URL: "+t);var e=this._generateLicenseRequestChallenge(d,T);a.send(e)}catch(o){A.logger.error("Failure requesting DRM license: "+o),this.hls.trigger(R.Events.ERROR,{type:E.ErrorTypes.KEY_SYSTEM_ERROR,details:E.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0})}},h.onMediaAttached=function(T,y){if(this._emeEnabled){var d=y.media;this._media=d,d.addEventListener("encrypted",this._onMediaEncrypted)}},h.onMediaDetached=function(){var T=this._media,y=this._mediaKeysList;T&&(T.removeEventListener("encrypted",this._onMediaEncrypted),this._media=null,this._mediaKeysList=[],Promise.all(y.map(function(d){if(d.mediaKeysSession)return d.mediaKeysSession.close().catch(function(){})})).then(function(){return T.setMediaKeys(null)}).catch(function(){}))},h.onManifestParsed=function(T,y){if(this._emeEnabled){var d=y.levels.map(function(a){return a.audioCodec}).filter(function(a){return!!a}),t=y.levels.map(function(a){return a.videoCodec}).filter(function(a){return!!a});this._attemptKeySystemAccess(_.KeySystems.WIDEVINE,d,t)}},S=s,(m=[{key:"requestMediaKeySystemAccess",get:function(){if(!this._requestMediaKeySystemAccess)throw new Error("No requestMediaKeySystemAccess function configured");return this._requestMediaKeySystemAccess}}])&&I(S.prototype,m),s}();C.default=D},"./src/controller/fps-controller.ts":function(N,C,f){f.r(C);var R=f("./src/events.ts"),E=f("./src/utils/logger.ts"),A=function(){function _(D){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=D,this.registerListeners()}var I=_.prototype;return I.setStreamController=function(D){this.streamController=D},I.registerListeners=function(){this.hls.on(R.Events.MEDIA_ATTACHING,this.onMediaAttaching,this)},I.unregisterListeners=function(){this.hls.off(R.Events.MEDIA_ATTACHING,this.onMediaAttaching)},I.destroy=function(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null},I.onMediaAttaching=function(D,s){var S=this.hls.config;if(S.capLevelOnFPSDrop){var m=s.media instanceof self.HTMLVideoElement?s.media:null;this.media=m,m&&typeof m.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),S.fpsDroppedMonitoringPeriod)}},I.checkFPS=function(D,s,S){var m=performance.now();if(s){if(this.lastTime){var h=m-this.lastTime,T=S-this.lastDroppedFrames,y=s-this.lastDecodedFrames,d=1e3*T/h,t=this.hls;if(t.trigger(R.Events.FPS_DROP,{currentDropped:T,currentDecoded:y,totalDroppedFrames:S}),d>0&&T>t.config.fpsDroppedMonitoringThreshold*y){var a=t.currentLevel;E.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+a),a>0&&(t.autoLevelCapping===-1||t.autoLevelCapping>=a)&&(a-=1,t.trigger(R.Events.FPS_DROP_LEVEL_CAPPING,{level:a,droppedLevel:t.currentLevel}),t.autoLevelCapping=a,this.streamController.nextLevelSwitch())}}this.lastTime=m,this.lastDroppedFrames=S,this.lastDecodedFrames=s}},I.checkFPSInterval=function(){var D=this.media;if(D)if(this.isVideoPlaybackQualityAvailable){var s=D.getVideoPlaybackQuality();this.checkFPS(D,s.totalVideoFrames,s.droppedVideoFrames)}else this.checkFPS(D,D.webkitDecodedFrameCount,D.webkitDroppedFrameCount)},_}();C.default=A},"./src/controller/fragment-finders.ts":function(N,C,f){f.r(C),f.d(C,"findFragmentByPDT",function(){return A}),f.d(C,"findFragmentByPTS",function(){return _}),f.d(C,"fragmentWithinToleranceTest",function(){return I}),f.d(C,"pdtWithinToleranceTest",function(){return D}),f.d(C,"findFragWithCC",function(){return s});var R=f("./src/polyfills/number.ts"),E=f("./src/utils/binary-search.ts");function A(S,m,h){if(m===null||!Array.isArray(S)||!S.length||!Object(R.isFiniteNumber)(m)||m<(S[0].programDateTime||0)||m>=(S[S.length-1].endProgramDateTime||0))return null;h=h||0;for(var T=0;T<S.length;++T){var y=S[T];if(D(m,h,y))return y}return null}function _(S,m,h,T){h===void 0&&(h=0),T===void 0&&(T=0);var y=null;if(S?y=m[S.sn-m[0].sn+1]||null:h===0&&m[0].start===0&&(y=m[0]),y&&I(h,T,y)===0)return y;var d=E.default.search(m,I.bind(null,h,T));return d||y}function I(S,m,h){S===void 0&&(S=0),m===void 0&&(m=0);var T=Math.min(m,h.duration+(h.deltaPTS?h.deltaPTS:0));return h.start+h.duration-T<=S?1:h.start-T>S&&h.start?-1:0}function D(S,m,h){var T=1e3*Math.min(m,h.duration+(h.deltaPTS?h.deltaPTS:0));return(h.endProgramDateTime||0)-T>S}function s(S,m){return E.default.search(S,function(h){return h.cc<m?1:h.cc>m?-1:0})}},"./src/controller/fragment-tracker.ts":function(N,C,f){f.r(C),f.d(C,"FragmentState",function(){return R}),f.d(C,"FragmentTracker",function(){return I});var R,E,A=f("./src/events.ts"),_=f("./src/types/loader.ts");(E=R||(R={})).NOT_LOADED="NOT_LOADED",E.BACKTRACKED="BACKTRACKED",E.APPENDING="APPENDING",E.PARTIAL="PARTIAL",E.OK="OK";var I=function(){function S(h){this.activeFragment=null,this.activeParts=null,this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hls=h,this._registerListeners()}var m=S.prototype;return m._registerListeners=function(){var h=this.hls;h.on(A.Events.BUFFER_APPENDED,this.onBufferAppended,this),h.on(A.Events.FRAG_BUFFERED,this.onFragBuffered,this),h.on(A.Events.FRAG_LOADED,this.onFragLoaded,this)},m._unregisterListeners=function(){var h=this.hls;h.off(A.Events.BUFFER_APPENDED,this.onBufferAppended,this),h.off(A.Events.FRAG_BUFFERED,this.onFragBuffered,this),h.off(A.Events.FRAG_LOADED,this.onFragLoaded,this)},m.destroy=function(){this._unregisterListeners(),this.fragments=this.timeRanges=null},m.getAppendedFrag=function(h,T){if(T===_.PlaylistLevelType.MAIN){var y=this.activeFragment,d=this.activeParts;if(!y)return null;if(d)for(var t=d.length;t--;){var a=d[t],e=a?a.end:y.appendedPTS;if(a.start<=h&&e!==void 0&&h<=e)return t>9&&(this.activeParts=d.slice(t-9)),a}else if(y.start<=h&&y.appendedPTS!==void 0&&h<=y.appendedPTS)return y}return this.getBufferedFrag(h,T)},m.getBufferedFrag=function(h,T){for(var y=this.fragments,d=Object.keys(y),t=d.length;t--;){var a=y[d[t]];if((a==null?void 0:a.body.type)===T&&a.buffered){var e=a.body;if(e.start<=h&&h<=e.end)return e}}return null},m.detectEvictedFragments=function(h,T,y){var d=this;Object.keys(this.fragments).forEach(function(t){var a=d.fragments[t];if(a)if(a.buffered){var e=a.range[h];e&&e.time.some(function(o){var u=!d.isTimeBuffered(o.startPTS,o.endPTS,T);return u&&d.removeFragment(a.body),u})}else a.body.type===y&&d.removeFragment(a.body)})},m.detectPartialFragments=function(h){var T=this,y=this.timeRanges,d=h.frag,t=h.part;if(y&&d.sn!=="initSegment"){var a=s(d),e=this.fragments[a];e&&(Object.keys(y).forEach(function(o){var u=d.elementaryStreams[o];if(u){var n=y[o],l=t!==null||u.partial===!0;e.range[o]=T.getBufferedTimes(d,t,l,n)}}),e.backtrack=e.loaded=null,Object.keys(e.range).length?e.buffered=!0:this.removeFragment(e.body))}},m.fragBuffered=function(h){var T=s(h),y=this.fragments[T];y&&(y.backtrack=y.loaded=null,y.buffered=!0)},m.getBufferedTimes=function(h,T,y,d){for(var t={time:[],partial:y},a=T?T.start:h.start,e=T?T.end:h.end,o=h.minEndPTS||e,u=h.maxStartPTS||a,n=0;n<d.length;n++){var l=d.start(n)-this.bufferPadding,p=d.end(n)+this.bufferPadding;if(u>=l&&o<=p){t.time.push({startPTS:Math.max(a,d.start(n)),endPTS:Math.min(e,d.end(n))});break}if(a<p&&e>l)t.partial=!0,t.time.push({startPTS:Math.max(a,d.start(n)),endPTS:Math.min(e,d.end(n))});else if(e<=l)break}return t},m.getPartialFragment=function(h){var T,y,d,t=null,a=0,e=this.bufferPadding,o=this.fragments;return Object.keys(o).forEach(function(u){var n=o[u];n&&D(n)&&(y=n.body.start-e,d=n.body.end+e,h>=y&&h<=d&&(T=Math.min(h-y,d-h),a<=T&&(t=n.body,a=T)))}),t},m.getState=function(h){var T=s(h),y=this.fragments[T];return y?y.buffered?D(y)?R.PARTIAL:R.OK:y.backtrack?R.BACKTRACKED:R.APPENDING:R.NOT_LOADED},m.backtrack=function(h,T){var y=s(h),d=this.fragments[y];if(!d||d.backtrack)return null;var t=d.backtrack=T||d.loaded;return d.loaded=null,t},m.getBacktrackData=function(h){var T=s(h),y=this.fragments[T];if(y){var d,t=y.backtrack;if(t!=null&&(d=t.payload)!==null&&d!==void 0&&d.byteLength)return t;this.removeFragment(h)}return null},m.isTimeBuffered=function(h,T,y){for(var d,t,a=0;a<y.length;a++){if(d=y.start(a)-this.bufferPadding,t=y.end(a)+this.bufferPadding,h>=d&&T<=t)return!0;if(T<=d)return!1}return!1},m.onFragLoaded=function(h,T){var y=T.frag,d=T.part;if(y.sn!=="initSegment"&&!y.bitrateTest&&!d){var t=s(y);this.fragments[t]={body:y,loaded:T,backtrack:null,buffered:!1,range:Object.create(null)}}},m.onBufferAppended=function(h,T){var y=this,d=T.frag,t=T.part,a=T.timeRanges;if(d.type===_.PlaylistLevelType.MAIN)if(this.activeFragment=d,t){var e=this.activeParts;e||(this.activeParts=e=[]),e.push(t)}else this.activeParts=null;this.timeRanges=a,Object.keys(a).forEach(function(o){var u=a[o];if(y.detectEvictedFragments(o,u),!t)for(var n=0;n<u.length;n++)d.appendedPTS=Math.max(u.end(n),d.appendedPTS||0)})},m.onFragBuffered=function(h,T){this.detectPartialFragments(T)},m.hasFragment=function(h){var T=s(h);return!!this.fragments[T]},m.removeFragmentsInRange=function(h,T,y){var d=this;Object.keys(this.fragments).forEach(function(t){var a=d.fragments[t];if(a&&a.buffered){var e=a.body;e.type===y&&e.start<T&&e.end>h&&d.removeFragment(e)}})},m.removeFragment=function(h){var T=s(h);h.stats.loaded=0,h.clearElementaryStreamInfo(),delete this.fragments[T]},m.removeAllFragments=function(){this.fragments=Object.create(null),this.activeFragment=null,this.activeParts=null},S}();function D(S){var m,h;return S.buffered&&(((m=S.range.video)===null||m===void 0?void 0:m.partial)||((h=S.range.audio)===null||h===void 0?void 0:h.partial))}function s(S){return S.type+"_"+S.level+"_"+S.urlId+"_"+S.sn}},"./src/controller/gap-controller.ts":function(N,C,f){f.r(C),f.d(C,"STALL_MINIMUM_DURATION_MS",function(){return I}),f.d(C,"MAX_START_GAP_JUMP",function(){return D}),f.d(C,"SKIP_BUFFER_HOLE_STEP_SECONDS",function(){return s}),f.d(C,"SKIP_BUFFER_RANGE_START",function(){return S}),f.d(C,"default",function(){return m});var R=f("./src/utils/buffer-helper.ts"),E=f("./src/errors.ts"),A=f("./src/events.ts"),_=f("./src/utils/logger.ts"),I=250,D=2,s=.1,S=.05,m=function(){function h(y,d,t,a){this.config=void 0,this.media=void 0,this.fragmentTracker=void 0,this.hls=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.config=y,this.media=d,this.fragmentTracker=t,this.hls=a}var T=h.prototype;return T.destroy=function(){this.hls=this.fragmentTracker=this.media=null},T.poll=function(y){var d=this.config,t=this.media,a=this.stalled,e=t.currentTime,o=t.seeking,u=this.seeking&&!o,n=!this.seeking&&o;if(this.seeking=o,e===y){if((n||u)&&(this.stalled=null),!t.paused&&!t.ended&&t.playbackRate!==0&&R.BufferHelper.getBuffered(t).length){var l=R.BufferHelper.bufferInfo(t,e,0),p=l.len>0,g=l.nextStart||0;if(p||g){if(o){var v=l.len>D,r=!g||g-e>D&&!this.fragmentTracker.getPartialFragment(e);if(v||r)return;this.moved=!1}if(!this.moved&&this.stalled!==null){var i,c=Math.max(g,l.start||0)-e,b=this.hls.levels?this.hls.levels[this.hls.currentLevel]:null,L=!(b==null||(i=b.details)===null||i===void 0)&&i.live?2*b.details.targetduration:D;if(c>0&&c<=L)return void this._trySkipBufferHole(null)}var k=self.performance.now();if(a!==null){var O=k-a;!o&&O>=I&&this._reportStall(l.len);var w=R.BufferHelper.bufferInfo(t,e,d.maxBufferHole);this._tryFixBufferStall(w,O)}else this.stalled=k}}}else if(this.moved=!0,a!==null){if(this.stallReported){var x=self.performance.now()-a;_.logger.warn("playback not stuck anymore @"+e+", after "+Math.round(x)+"ms"),this.stallReported=!1}this.stalled=null,this.nudgeRetry=0}},T._tryFixBufferStall=function(y,d){var t=this.config,a=this.fragmentTracker,e=this.media.currentTime,o=a.getPartialFragment(e);o&&this._trySkipBufferHole(o)||y.len>t.maxBufferHole&&d>1e3*t.highBufferWatchdogPeriod&&(_.logger.warn("Trying to nudge playhead over buffer-hole"),this.stalled=null,this._tryNudgeBuffer())},T._reportStall=function(y){var d=this.hls,t=this.media;this.stallReported||(this.stallReported=!0,_.logger.warn("Playback stalling at @"+t.currentTime+" due to low buffer (buffer="+y+")"),d.trigger(A.Events.ERROR,{type:E.ErrorTypes.MEDIA_ERROR,details:E.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!1,buffer:y}))},T._trySkipBufferHole=function(y){for(var d=this.config,t=this.hls,a=this.media,e=a.currentTime,o=0,u=R.BufferHelper.getBuffered(a),n=0;n<u.length;n++){var l=u.start(n);if(e+d.maxBufferHole>=o&&e<l){var p=Math.max(l+S,a.currentTime+s);return _.logger.warn("skipping hole, adjusting currentTime from "+e+" to "+p),this.moved=!0,this.stalled=null,a.currentTime=p,y&&t.trigger(A.Events.ERROR,{type:E.ErrorTypes.MEDIA_ERROR,details:E.ErrorDetails.BUFFER_SEEK_OVER_HOLE,fatal:!1,reason:"fragment loaded with buffer holes, seeking from "+e+" to "+p,frag:y}),p}o=u.end(n)}return 0},T._tryNudgeBuffer=function(){var y=this.config,d=this.hls,t=this.media,a=t.currentTime,e=(this.nudgeRetry||0)+1;if(this.nudgeRetry=e,e<y.nudgeMaxRetry){var o=a+e*y.nudgeOffset;_.logger.warn("Nudging 'currentTime' from "+a+" to "+o),t.currentTime=o,d.trigger(A.Events.ERROR,{type:E.ErrorTypes.MEDIA_ERROR,details:E.ErrorDetails.BUFFER_NUDGE_ON_STALL,fatal:!1})}else _.logger.error("Playhead still not moving while enough data buffered @"+a+" after "+y.nudgeMaxRetry+" nudges"),d.trigger(A.Events.ERROR,{type:E.ErrorTypes.MEDIA_ERROR,details:E.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!0})},h}()},"./src/controller/id3-track-controller.ts":function(N,C,f){f.r(C);var R=f("./src/events.ts"),E=f("./src/utils/texttrack-utils.ts"),A=f("./src/demux/id3.ts"),_=function(){function I(s){this.hls=void 0,this.id3Track=null,this.media=null,this.hls=s,this._registerListeners()}var D=I.prototype;return D.destroy=function(){this._unregisterListeners()},D._registerListeners=function(){var s=this.hls;s.on(R.Events.MEDIA_ATTACHED,this.onMediaAttached,this),s.on(R.Events.MEDIA_DETACHING,this.onMediaDetaching,this),s.on(R.Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),s.on(R.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},D._unregisterListeners=function(){var s=this.hls;s.off(R.Events.MEDIA_ATTACHED,this.onMediaAttached,this),s.off(R.Events.MEDIA_DETACHING,this.onMediaDetaching,this),s.off(R.Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),s.off(R.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},D.onMediaAttached=function(s,S){this.media=S.media},D.onMediaDetaching=function(){this.id3Track&&(Object(E.clearCurrentCues)(this.id3Track),this.id3Track=null,this.media=null)},D.getID3Track=function(s){if(this.media){for(var S=0;S<s.length;S++){var m=s[S];if(m.kind==="metadata"&&m.label==="id3")return Object(E.sendAddTrackEvent)(m,this.media),m}return this.media.addTextTrack("metadata","id3")}},D.onFragParsingMetadata=function(s,S){if(this.media){var m=S.frag,h=S.samples;this.id3Track||(this.id3Track=this.getID3Track(this.media.textTracks),this.id3Track.mode="hidden");for(var T=self.WebKitDataCue||self.VTTCue||self.TextTrackCue,y=0;y<h.length;y++){var d=A.getID3Frames(h[y].data);if(d){var t=h[y].pts,a=y<h.length-1?h[y+1].pts:m.end;a-t<=0&&(a=t+.25);for(var e=0;e<d.length;e++){var o=d[e];if(!A.isTimeStampFrame(o)){var u=new T(t,a,"");u.value=o,this.id3Track.addCue(u)}}}}}},D.onBufferFlushing=function(s,S){var m=S.startOffset,h=S.endOffset,T=S.type;if(!T||T==="audio"){var y=this.id3Track;y&&Object(E.removeCuesInRange)(y,m,h)}},I}();C.default=_},"./src/controller/latency-controller.ts":function(N,C,f){f.r(C),f.d(C,"default",function(){return I});var R=f("./src/errors.ts"),E=f("./src/events.ts"),A=f("./src/utils/logger.ts");function _(D,s){for(var S=0;S<s.length;S++){var m=s[S];m.enumerable=m.enumerable||!1,m.configurable=!0,"value"in m&&(m.writable=!0),Object.defineProperty(D,m.key,m)}}var I=function(){function D(h){var T=this;this.hls=void 0,this.config=void 0,this.media=null,this.levelDetails=null,this.currentTime=0,this.stallCount=0,this._latency=null,this.timeupdateHandler=function(){return T.timeupdate()},this.hls=h,this.config=h.config,this.registerListeners()}var s,S,m=D.prototype;return m.destroy=function(){this.unregisterListeners(),this.onMediaDetaching(),this.levelDetails=null,this.hls=this.timeupdateHandler=null},m.registerListeners=function(){this.hls.on(E.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(E.Events.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.on(E.Events.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(E.Events.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.on(E.Events.ERROR,this.onError,this)},m.unregisterListeners=function(){this.hls.off(E.Events.MEDIA_ATTACHED,this.onMediaAttached),this.hls.off(E.Events.MEDIA_DETACHING,this.onMediaDetaching),this.hls.off(E.Events.MANIFEST_LOADING,this.onManifestLoading),this.hls.off(E.Events.LEVEL_UPDATED,this.onLevelUpdated),this.hls.off(E.Events.ERROR,this.onError)},m.onMediaAttached=function(h,T){this.media=T.media,this.media.addEventListener("timeupdate",this.timeupdateHandler)},m.onMediaDetaching=function(){this.media&&(this.media.removeEventListener("timeupdate",this.timeupdateHandler),this.media=null)},m.onManifestLoading=function(){this.levelDetails=null,this._latency=null,this.stallCount=0},m.onLevelUpdated=function(h,T){var y=T.details;this.levelDetails=y,y.advanced&&this.timeupdate(),!y.live&&this.media&&this.media.removeEventListener("timeupdate",this.timeupdateHandler)},m.onError=function(h,T){T.details===R.ErrorDetails.BUFFER_STALLED_ERROR&&(this.stallCount++,A.logger.warn("[playback-rate-controller]: Stall detected, adjusting target latency"))},m.timeupdate=function(){var h=this.media,T=this.levelDetails;if(h&&T){this.currentTime=h.currentTime;var y=this.computeLatency();if(y!==null){this._latency=y;var d=this.config,t=d.lowLatencyMode,a=d.maxLiveSyncPlaybackRate;if(t&&a!==1){var e=this.targetLatency;if(e!==null){var o=y-e,u=o<Math.min(this.maxLatency,e+T.targetduration);if(T.live&&u&&o>.05&&this.forwardBufferLength>1){var n=Math.min(2,Math.max(1,a)),l=Math.round(2/(1+Math.exp(-.75*o-this.edgeStalled))*20)/20;h.playbackRate=Math.min(n,Math.max(1,l))}else h.playbackRate!==1&&h.playbackRate!==0&&(h.playbackRate=1)}}}}},m.estimateLiveEdge=function(){var h=this.levelDetails;return h===null?null:h.edge+h.age},m.computeLatency=function(){var h=this.estimateLiveEdge();return h===null?null:h-this.currentTime},s=D,(S=[{key:"latency",get:function(){return this._latency||0}},{key:"maxLatency",get:function(){var h=this.config,T=this.levelDetails;return h.liveMaxLatencyDuration!==void 0?h.liveMaxLatencyDuration:T?h.liveMaxLatencyDurationCount*T.targetduration:0}},{key:"targetLatency",get:function(){var h=this.levelDetails;if(h===null)return null;var T=h.holdBack,y=h.partHoldBack,d=h.targetduration,t=this.config,a=t.liveSyncDuration,e=t.liveSyncDurationCount,o=t.lowLatencyMode,u=this.hls.userConfig,n=o&&y||T;(u.liveSyncDuration||u.liveSyncDurationCount||n===0)&&(n=a!==void 0?a:e*d);var l=d;return n+Math.min(1*this.stallCount,l)}},{key:"liveSyncPosition",get:function(){var h=this.estimateLiveEdge(),T=this.targetLatency,y=this.levelDetails;if(h===null||T===null||y===null)return null;var d=y.edge,t=h-T-this.edgeStalled,a=d-y.totalduration,e=d-(this.config.lowLatencyMode&&y.partTarget||y.targetduration);return Math.min(Math.max(a,t),e)}},{key:"drift",get:function(){var h=this.levelDetails;return h===null?1:h.drift}},{key:"edgeStalled",get:function(){var h=this.levelDetails;if(h===null)return 0;var T=3*(this.config.lowLatencyMode&&h.partTarget||h.targetduration);return Math.max(h.age-T,0)}},{key:"forwardBufferLength",get:function(){var h=this.media,T=this.levelDetails;if(!h||!T)return 0;var y=h.buffered.length;return y?h.buffered.end(y-1):T.edge-this.currentTime}}])&&_(s.prototype,S),D}()},"./src/controller/level-controller.ts":function(N,C,f){f.r(C),f.d(C,"default",function(){return y});var R=f("./src/types/level.ts"),E=f("./src/events.ts"),A=f("./src/errors.ts"),_=f("./src/utils/codecs.ts"),I=f("./src/controller/level-helper.ts"),D=f("./src/controller/base-playlist-controller.ts"),s=f("./src/types/loader.ts");function S(){return(S=Object.assign||function(d){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var e in a)Object.prototype.hasOwnProperty.call(a,e)&&(d[e]=a[e])}return d}).apply(this,arguments)}function m(d,t){for(var a=0;a<t.length;a++){var e=t[a];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(d,e.key,e)}}function h(d,t){return(h=Object.setPrototypeOf||function(a,e){return a.__proto__=e,a})(d,t)}var T=/chrome|firefox/.test(navigator.userAgent.toLowerCase()),y=function(d){var t,a;function e(l){var p;return(p=d.call(this,l,"[level-controller]")||this)._levels=[],p._firstLevel=-1,p._startLevel=void 0,p.currentLevelIndex=-1,p.manualLevelIndex=-1,p.onParsedComplete=void 0,p._registerListeners(),p}a=d,(t=e).prototype=Object.create(a.prototype),t.prototype.constructor=t,h(t,a);var o,u,n=e.prototype;return n._registerListeners=function(){var l=this.hls;l.on(E.Events.MANIFEST_LOADED,this.onManifestLoaded,this),l.on(E.Events.LEVEL_LOADED,this.onLevelLoaded,this),l.on(E.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),l.on(E.Events.FRAG_LOADED,this.onFragLoaded,this),l.on(E.Events.ERROR,this.onError,this)},n._unregisterListeners=function(){var l=this.hls;l.off(E.Events.MANIFEST_LOADED,this.onManifestLoaded,this),l.off(E.Events.LEVEL_LOADED,this.onLevelLoaded,this),l.off(E.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),l.off(E.Events.FRAG_LOADED,this.onFragLoaded,this),l.off(E.Events.ERROR,this.onError,this)},n.destroy=function(){this._unregisterListeners(),this.manualLevelIndex=-1,this._levels.length=0,d.prototype.destroy.call(this)},n.startLoad=function(){this._levels.forEach(function(l){l.loadError=0}),d.prototype.startLoad.call(this)},n.onManifestLoaded=function(l,p){var g,v,r=[],i=[],c=[],b={},L=!1,k=!1,O=!1;if(p.levels.forEach(function(F){var M=F.attrs;L=L||!(!F.width||!F.height),k=k||!!F.videoCodec,O=O||!!F.audioCodec,T&&F.audioCodec&&F.audioCodec.indexOf("mp4a.40.34")!==-1&&(F.audioCodec=void 0);var B=F.bitrate+"-"+F.attrs.RESOLUTION+"-"+F.attrs.CODECS;(v=b[B])?v.url.push(F.url):(v=new R.Level(F),b[B]=v,r.push(v)),M&&(M.AUDIO&&Object(I.addGroupId)(v,"audio",M.AUDIO),M.SUBTITLES&&Object(I.addGroupId)(v,"text",M.SUBTITLES))}),(L||k)&&O&&(r=r.filter(function(F){var M=F.videoCodec,B=F.width,U=F.height;return!!M||!(!B||!U)})),r=r.filter(function(F){var M=F.audioCodec,B=F.videoCodec;return(!M||Object(_.isCodecSupportedInMp4)(M,"audio"))&&(!B||Object(_.isCodecSupportedInMp4)(B,"video"))}),p.audioTracks&&(i=p.audioTracks.filter(function(F){return!F.audioCodec||Object(_.isCodecSupportedInMp4)(F.audioCodec,"audio")}),Object(I.assignTrackIdsByGroup)(i)),p.subtitles&&(c=p.subtitles,Object(I.assignTrackIdsByGroup)(c)),r.length>0){g=r[0].bitrate,r.sort(function(F,M){return F.bitrate-M.bitrate}),this._levels=r;for(var w=0;w<r.length;w++)if(r[w].bitrate===g){this._firstLevel=w,this.log("manifest loaded, "+r.length+" level(s) found, first bitrate: "+g);break}var x=O&&!k,P={levels:r,audioTracks:i,subtitleTracks:c,firstLevel:this._firstLevel,stats:p.stats,audio:O,video:k,altAudio:!x&&i.some(function(F){return!!F.url})};this.hls.trigger(E.Events.MANIFEST_PARSED,P),(this.hls.config.autoStartLoad||this.hls.forceStartLoad)&&this.hls.startLoad(this.hls.config.startPosition)}else this.hls.trigger(E.Events.ERROR,{type:A.ErrorTypes.MEDIA_ERROR,details:A.ErrorDetails.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:p.url,reason:"no level with compatible codecs found in manifest"})},n.onError=function(l,p){if(d.prototype.onError.call(this,l,p),!p.fatal){var g=p.context,v=this._levels[this.currentLevelIndex];if(g&&(g.type===s.PlaylistContextType.AUDIO_TRACK&&v.audioGroupIds&&g.groupId===v.audioGroupIds[v.urlId]||g.type===s.PlaylistContextType.SUBTITLE_TRACK&&v.textGroupIds&&g.groupId===v.textGroupIds[v.urlId]))this.redundantFailover(this.currentLevelIndex);else{var r,i=!1,c=!0;switch(p.details){case A.ErrorDetails.FRAG_LOAD_ERROR:case A.ErrorDetails.FRAG_LOAD_TIMEOUT:case A.ErrorDetails.KEY_LOAD_ERROR:case A.ErrorDetails.KEY_LOAD_TIMEOUT:if(p.frag){var b=this._levels[p.frag.level];b?(b.fragmentError++,b.fragmentError>this.hls.config.fragLoadingMaxRetry&&(r=p.frag.level)):r=p.frag.level}break;case A.ErrorDetails.LEVEL_LOAD_ERROR:case A.ErrorDetails.LEVEL_LOAD_TIMEOUT:g&&(g.deliveryDirectives&&(c=!1),r=g.level),i=!0;break;case A.ErrorDetails.REMUX_ALLOC_ERROR:r=p.level,i=!0}r!==void 0&&this.recoverLevel(p,r,i,c)}}},n.recoverLevel=function(l,p,g,v){var r=l.details,i=this._levels[p];if(i.loadError++,g){if(!this.retryLoadingOrFail(l))return void(this.currentLevelIndex=-1);l.levelRetry=!0}if(v){var c=i.url.length;if(c>1&&i.loadError<c)l.levelRetry=!0,this.redundantFailover(p);else if(this.manualLevelIndex===-1){var b=p===0?this._levels.length-1:p-1;this.currentLevelIndex!==b&&this._levels[b].loadError===0&&(this.warn(r+": switch to "+b),l.levelRetry=!0,this.hls.nextAutoLevel=b)}}},n.redundantFailover=function(l){var p=this._levels[l],g=p.url.length;if(g>1){var v=(p.urlId+1)%g;this.warn("Switching to redundant URL-id "+v),this._levels.forEach(function(r){r.urlId=v}),this.level=l}},n.onFragLoaded=function(l,p){var g=p.frag;if(g!==void 0&&g.type===s.PlaylistLevelType.MAIN){var v=this._levels[g.level];v!==void 0&&(v.fragmentError=0,v.loadError=0)}},n.onLevelLoaded=function(l,p){var g,v,r=p.level,i=p.details,c=this._levels[r];if(!c)return this.warn("Invalid level index "+r),void((v=p.deliveryDirectives)!==null&&v!==void 0&&v.skip&&(i.deltaUpdateFailed=!0));r===this.currentLevelIndex?(c.fragmentError===0&&(c.loadError=0,this.retryCount=0),this.playlistLoaded(r,p,c.details)):(g=p.deliveryDirectives)!==null&&g!==void 0&&g.skip&&(i.deltaUpdateFailed=!0)},n.onAudioTrackSwitched=function(l,p){var g=this.hls.levels[this.currentLevelIndex];if(g&&g.audioGroupIds){for(var v=-1,r=this.hls.audioTracks[p.id].groupId,i=0;i<g.audioGroupIds.length;i++)if(g.audioGroupIds[i]===r){v=i;break}v!==g.urlId&&(g.urlId=v,this.startLoad())}},n.loadPlaylist=function(l){var p=this.currentLevelIndex,g=this._levels[p];if(this.canLoad&&g&&g.url.length>0){var v=g.urlId,r=g.url[v];if(l)try{r=l.addDirectives(r)}catch(i){this.warn("Could not construct new URL with HLS Delivery Directives: "+i)}this.log("Attempt loading level index "+p+(l?" at sn "+l.msn+" part "+l.part:"")+" with URL-id "+v+" "+r),this.clearTimer(),this.hls.trigger(E.Events.LEVEL_LOADING,{url:r,level:p,id:v,deliveryDirectives:l||null})}},n.removeLevel=function(l,p){var g=function(r,i){return i!==p},v=this._levels.filter(function(r,i){return i!==l||r.url.length>1&&p!==void 0&&(r.url=r.url.filter(g),r.audioGroupIds&&(r.audioGroupIds=r.audioGroupIds.filter(g)),r.textGroupIds&&(r.textGroupIds=r.textGroupIds.filter(g)),r.urlId=0,!0)}).map(function(r,i){var c=r.details;return c!=null&&c.fragments&&c.fragments.forEach(function(b){b.level=i}),r});this._levels=v,this.hls.trigger(E.Events.LEVELS_UPDATED,{levels:v})},o=e,(u=[{key:"levels",get:function(){return this._levels.length===0?null:this._levels}},{key:"level",get:function(){return this.currentLevelIndex},set:function(l){var p,g=this._levels;if(g.length!==0&&(this.currentLevelIndex!==l||(p=g[l])===null||p===void 0||!p.details)){if(l<0||l>=g.length){var v=l<0;if(this.hls.trigger(E.Events.ERROR,{type:A.ErrorTypes.OTHER_ERROR,details:A.ErrorDetails.LEVEL_SWITCH_ERROR,level:l,fatal:v,reason:"invalid level idx"}),v)return;l=Math.min(l,g.length-1)}this.clearTimer();var r=this.currentLevelIndex,i=g[r],c=g[l];this.log("switching to level "+l+" from "+r),this.currentLevelIndex=l;var b=S({},c,{level:l,maxBitrate:c.maxBitrate,uri:c.uri,urlId:c.urlId});delete b._urlId,this.hls.trigger(E.Events.LEVEL_SWITCHING,b);var L=c.details;if(!L||L.live){var k=this.switchParams(c.uri,i==null?void 0:i.details);this.loadPlaylist(k)}}}},{key:"manualLevel",get:function(){return this.manualLevelIndex},set:function(l){this.manualLevelIndex=l,this._startLevel===void 0&&(this._startLevel=l),l!==-1&&(this.level=l)}},{key:"firstLevel",get:function(){return this._firstLevel},set:function(l){this._firstLevel=l}},{key:"startLevel",get:function(){if(this._startLevel===void 0){var l=this.hls.config.startLevel;return l!==void 0?l:this._firstLevel}return this._startLevel},set:function(l){this._startLevel=l}},{key:"nextLoadLevel",get:function(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel},set:function(l){this.level=l,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=l)}}])&&m(o.prototype,u),e}(D.default)},"./src/controller/level-helper.ts":function(N,C,f){f.r(C),f.d(C,"addGroupId",function(){return A}),f.d(C,"assignTrackIdsByGroup",function(){return _}),f.d(C,"updatePTS",function(){return I}),f.d(C,"updateFragPTSDTS",function(){return s}),f.d(C,"mergeDetails",function(){return S}),f.d(C,"mapPartIntersection",function(){return m}),f.d(C,"mapFragmentIntersection",function(){return h}),f.d(C,"adjustSliding",function(){return T}),f.d(C,"addSliding",function(){return y}),f.d(C,"computeReloadInterval",function(){return d}),f.d(C,"getFragmentWithSN",function(){return t}),f.d(C,"getPartWith",function(){return a});var R=f("./src/polyfills/number.ts"),E=f("./src/utils/logger.ts");function A(e,o,u){switch(o){case"audio":e.audioGroupIds||(e.audioGroupIds=[]),e.audioGroupIds.push(u);break;case"text":e.textGroupIds||(e.textGroupIds=[]),e.textGroupIds.push(u)}}function _(e){var o={};e.forEach(function(u){var n=u.groupId||"";u.id=o[n]=o[n]||0,o[n]++})}function I(e,o,u){D(e[o],e[u])}function D(e,o){var u=o.startPTS;if(Object(R.isFiniteNumber)(u)){var n,l=0;o.sn>e.sn?(l=u-e.start,n=e):(l=e.start-u,n=o),n.duration!==l&&(n.duration=l)}else o.sn>e.sn?e.cc===o.cc&&e.minEndPTS?o.start=e.start+(e.minEndPTS-e.start):o.start=e.start+e.duration:o.start=Math.max(e.start-o.duration,0)}function s(e,o,u,n,l,p){n-u<=0&&(E.logger.warn("Fragment should have a positive duration",o),n=u+o.duration,p=l+o.duration);var g=u,v=n,r=o.startPTS,i=o.endPTS;if(Object(R.isFiniteNumber)(r)){var c=Math.abs(r-u);Object(R.isFiniteNumber)(o.deltaPTS)?o.deltaPTS=Math.max(c,o.deltaPTS):o.deltaPTS=c,g=Math.max(u,r),u=Math.min(u,r),l=Math.min(l,o.startDTS),v=Math.min(n,i),n=Math.max(n,i),p=Math.max(p,o.endDTS)}o.duration=n-u;var b=u-o.start;o.appendedPTS=n,o.start=o.startPTS=u,o.maxStartPTS=g,o.startDTS=l,o.endPTS=n,o.minEndPTS=v,o.endDTS=p;var L,k=o.sn;if(!e||k<e.startSN||k>e.endSN)return 0;var O=k-e.startSN,w=e.fragments;for(w[O]=o,L=O;L>0;L--)D(w[L],w[L-1]);for(L=O;L<w.length-1;L++)D(w[L],w[L+1]);return e.fragmentHint&&D(w[w.length-1],e.fragmentHint),e.PTSKnown=e.alignedSliding=!0,b}function S(e,o){for(var u=null,n=e.fragments,l=n.length-1;l>=0;l--){var p=n[l].initSegment;if(p){u=p;break}}e.fragmentHint&&delete e.fragmentHint.endPTS;var g,v=0;if(h(e,o,function(k,O){var w;k.relurl&&(v=k.cc-O.cc),Object(R.isFiniteNumber)(k.startPTS)&&Object(R.isFiniteNumber)(k.endPTS)&&(O.start=O.startPTS=k.startPTS,O.startDTS=k.startDTS,O.appendedPTS=k.appendedPTS,O.maxStartPTS=k.maxStartPTS,O.endPTS=k.endPTS,O.endDTS=k.endDTS,O.minEndPTS=k.minEndPTS,O.duration=k.endPTS-k.startPTS,O.duration&&(g=O),o.PTSKnown=o.alignedSliding=!0),O.elementaryStreams=k.elementaryStreams,O.loader=k.loader,O.stats=k.stats,O.urlId=k.urlId,k.initSegment?(O.initSegment=k.initSegment,u=k.initSegment):O.initSegment&&O.initSegment.relurl!=((w=u)===null||w===void 0?void 0:w.relurl)||(O.initSegment=u)}),o.skippedSegments&&(o.deltaUpdateFailed=o.fragments.some(function(k){return!k}),o.deltaUpdateFailed)){E.logger.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(var r=o.skippedSegments;r--;)o.fragments.shift();o.startSN=o.fragments[0].sn,o.startCC=o.fragments[0].cc}var i=o.fragments;if(v){E.logger.warn("discontinuity sliding from playlist, take drift into account");for(var c=0;c<i.length;c++)i[c].cc+=v}o.skippedSegments&&(o.startCC=o.fragments[0].cc),m(e.partList,o.partList,function(k,O){O.elementaryStreams=k.elementaryStreams,O.stats=k.stats}),g?s(o,g,g.startPTS,g.endPTS,g.startDTS,g.endDTS):T(e,o),i.length&&(o.totalduration=o.edge-i[0].start),o.driftStartTime=e.driftStartTime,o.driftStart=e.driftStart;var b=o.advancedDateTime;if(o.advanced&&b){var L=o.edge;o.driftStart||(o.driftStartTime=b,o.driftStart=L),o.driftEndTime=b,o.driftEnd=L}else o.driftEndTime=e.driftEndTime,o.driftEnd=e.driftEnd,o.advancedDateTime=e.advancedDateTime}function m(e,o,u){if(e&&o)for(var n=0,l=0,p=e.length;l<=p;l++){var g=e[l],v=o[l+n];g&&v&&g.index===v.index&&g.fragment.sn===v.fragment.sn?u(g,v):n--}}function h(e,o,u){for(var n=o.skippedSegments,l=Math.max(e.startSN,o.startSN)-o.startSN,p=(e.fragmentHint?1:0)+(n?o.endSN:Math.min(e.endSN,o.endSN))-o.startSN,g=o.startSN-e.startSN,v=o.fragmentHint?o.fragments.concat(o.fragmentHint):o.fragments,r=e.fragmentHint?e.fragments.concat(e.fragmentHint):e.fragments,i=l;i<=p;i++){var c=r[g+i],b=v[i];n&&!b&&i<n&&(b=o.fragments[i]=c),c&&b&&u(c,b)}}function T(e,o){var u=o.startSN+o.skippedSegments-e.startSN,n=e.fragments;u<0||u>=n.length||y(o,n[u].start)}function y(e,o){if(o){for(var u=e.fragments,n=e.skippedSegments;n<u.length;n++)u[n].start+=o;e.fragmentHint&&(e.fragmentHint.start+=o)}}function d(e,o){var u,n=1e3*e.levelTargetDuration,l=n/2,p=e.age,g=p>0&&p<3*n,v=o.loading.end-o.loading.start,r=e.availabilityDelay;if(e.updated===!1)if(g){var i=333*e.misses;u=Math.max(Math.min(l,2*v),i),e.availabilityDelay=(e.availabilityDelay||0)+u}else u=l;else g?(r=Math.min(r||n/2,p),e.availabilityDelay=r,u=r+n-p):u=n-v;return Math.round(u)}function t(e,o,u){if(!e||!e.details)return null;var n=e.details,l=n.fragments[o-n.startSN];return l||((l=n.fragmentHint)&&l.sn===o?l:o<n.startSN&&u&&u.sn===o?u:null)}function a(e,o,u){if(!e||!e.details)return null;var n=e.details.partList;if(n)for(var l=n.length;l--;){var p=n[l];if(p.index===u&&p.fragment.sn===o)return p}return null}},"./src/controller/stream-controller.ts":function(N,C,f){f.r(C),f.d(C,"default",function(){return e});var R=f("./src/polyfills/number.ts"),E=f("./src/controller/base-stream-controller.ts"),A=f("./src/is-supported.ts"),_=f("./src/events.ts"),I=f("./src/utils/buffer-helper.ts"),D=f("./src/controller/fragment-tracker.ts"),s=f("./src/types/loader.ts"),S=f("./src/loader/fragment.ts"),m=f("./src/demux/transmuxer-interface.ts"),h=f("./src/types/transmuxer.ts"),T=f("./src/controller/gap-controller.ts"),y=f("./src/errors.ts"),d=f("./src/utils/logger.ts");function t(o,u){for(var n=0;n<u.length;n++){var l=u[n];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(o,l.key,l)}}function a(o,u){return(a=Object.setPrototypeOf||function(n,l){return n.__proto__=l,n})(o,u)}var e=function(o){var u,n;function l(r,i){var c;return(c=o.call(this,r,i,"[stream-controller]")||this).audioCodecSwap=!1,c.gapController=null,c.level=-1,c._forceStartLoad=!1,c.altAudio=!1,c.audioOnly=!1,c.fragPlaying=null,c.onvplaying=null,c.onvseeked=null,c.fragLastKbps=0,c.stalled=!1,c.couldBacktrack=!1,c.audioCodecSwitch=!1,c.videoBuffer=null,c._registerListeners(),c}n=o,(u=l).prototype=Object.create(n.prototype),u.prototype.constructor=u,a(u,n);var p,g,v=l.prototype;return v._registerListeners=function(){var r=this.hls;r.on(_.Events.MEDIA_ATTACHED,this.onMediaAttached,this),r.on(_.Events.MEDIA_DETACHING,this.onMediaDetaching,this),r.on(_.Events.MANIFEST_LOADING,this.onManifestLoading,this),r.on(_.Events.MANIFEST_PARSED,this.onManifestParsed,this),r.on(_.Events.LEVEL_LOADING,this.onLevelLoading,this),r.on(_.Events.LEVEL_LOADED,this.onLevelLoaded,this),r.on(_.Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),r.on(_.Events.ERROR,this.onError,this),r.on(_.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),r.on(_.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),r.on(_.Events.BUFFER_CREATED,this.onBufferCreated,this),r.on(_.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),r.on(_.Events.LEVELS_UPDATED,this.onLevelsUpdated,this),r.on(_.Events.FRAG_BUFFERED,this.onFragBuffered,this)},v._unregisterListeners=function(){var r=this.hls;r.off(_.Events.MEDIA_ATTACHED,this.onMediaAttached,this),r.off(_.Events.MEDIA_DETACHING,this.onMediaDetaching,this),r.off(_.Events.MANIFEST_LOADING,this.onManifestLoading,this),r.off(_.Events.MANIFEST_PARSED,this.onManifestParsed,this),r.off(_.Events.LEVEL_LOADED,this.onLevelLoaded,this),r.off(_.Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),r.off(_.Events.ERROR,this.onError,this),r.off(_.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),r.off(_.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),r.off(_.Events.BUFFER_CREATED,this.onBufferCreated,this),r.off(_.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),r.off(_.Events.LEVELS_UPDATED,this.onLevelsUpdated,this),r.off(_.Events.FRAG_BUFFERED,this.onFragBuffered,this)},v.onHandlerDestroying=function(){this._unregisterListeners(),this.onMediaDetaching()},v.startLoad=function(r){if(this.levels){var i=this.lastCurrentTime,c=this.hls;if(this.stopLoad(),this.setInterval(100),this.level=-1,this.fragLoadError=0,!this.startFragRequested){var b=c.startLevel;b===-1&&(c.config.testBandwidth?(b=0,this.bitrateTest=!0):b=c.nextAutoLevel),this.level=c.nextLoadLevel=b,this.loadedmetadata=!1}i>0&&r===-1&&(this.log("Override startPosition with lastCurrentTime @"+i.toFixed(3)),r=i),this.state=E.State.IDLE,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=r,this.tick()}else this._forceStartLoad=!0,this.state=E.State.STOPPED},v.stopLoad=function(){this._forceStartLoad=!1,o.prototype.stopLoad.call(this)},v.doTick=function(){switch(this.state){case E.State.IDLE:this.doTickIdle();break;case E.State.WAITING_LEVEL:var r,i=this.levels,c=this.level,b=i==null||(r=i[c])===null||r===void 0?void 0:r.details;if(b&&(!b.live||this.levelLastLoaded===this.level)){if(this.waitForCdnTuneIn(b))break;this.state=E.State.IDLE;break}break;case E.State.FRAG_LOADING_WAITING_RETRY:var L,k=self.performance.now(),O=this.retryDate;(!O||k>=O||(L=this.media)!==null&&L!==void 0&&L.seeking)&&(this.log("retryDate reached, switch back to IDLE state"),this.state=E.State.IDLE)}this.onTickEnd()},v.onTickEnd=function(){o.prototype.onTickEnd.call(this),this.checkBuffer(),this.checkFragmentChanged()},v.doTickIdle=function(){var r,i,c=this.hls,b=this.levelLastLoaded,L=this.levels,k=this.media,O=c.config,w=c.nextLoadLevel;if(b!==null&&(k||!this.startFragRequested&&O.startFragPrefetch)&&(!this.altAudio||!this.audioOnly)&&L&&L[w]){var x=L[w];this.level=c.nextLoadLevel=w;var P=x.details;if(!P||this.state===E.State.WAITING_LEVEL||P.live&&this.levelLastLoaded!==w)this.state=E.State.WAITING_LEVEL;else{var F=this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:k,s.PlaylistLevelType.MAIN);if(F!==null&&!(F.len>=this.getMaxBufferLength(x.maxBitrate))){if(this._streamEnded(F,P)){var M={};return this.altAudio&&(M.type="video"),this.hls.trigger(_.Events.BUFFER_EOS,M),void(this.state=E.State.ENDED)}var B=F.end,U=this.getNextFragment(B,P);if(this.couldBacktrack&&!this.fragPrevious&&U&&U.sn!=="initSegment"){var G=U.sn-P.startSN;G>1&&(U=P.fragments[G-1],this.fragmentTracker.removeFragment(U))}if(U&&this.fragmentTracker.getState(U)===D.FragmentState.OK&&this.nextLoadPosition>B){var V=this.audioOnly&&!this.altAudio?S.ElementaryStreamTypes.AUDIO:S.ElementaryStreamTypes.VIDEO;this.afterBufferFlushed(k,V,s.PlaylistLevelType.MAIN),U=this.getNextFragment(this.nextLoadPosition,P)}U&&(!U.initSegment||U.initSegment.data||this.bitrateTest||(U=U.initSegment),((r=U.decryptdata)===null||r===void 0?void 0:r.keyFormat)!=="identity"||(i=U.decryptdata)!==null&&i!==void 0&&i.key?this.loadFragment(U,P,B):this.loadKey(U,P))}}}},v.loadFragment=function(r,i,c){var b,L=this.fragmentTracker.getState(r);if(this.fragCurrent=r,L===D.FragmentState.BACKTRACKED){var k=this.fragmentTracker.getBacktrackData(r);if(k)return this._handleFragmentLoadProgress(k),void this._handleFragmentLoadComplete(k);L=D.FragmentState.NOT_LOADED}L===D.FragmentState.NOT_LOADED||L===D.FragmentState.PARTIAL?r.sn==="initSegment"?this._loadInitSegment(r):this.bitrateTest?(r.bitrateTest=!0,this.log("Fragment "+r.sn+" of level "+r.level+" is being downloaded to test bitrate and will not be buffered"),this._loadBitrateTestFrag(r)):(this.startFragRequested=!0,o.prototype.loadFragment.call(this,r,i,c)):L===D.FragmentState.APPENDING?this.reduceMaxBufferLength(r.duration)&&this.fragmentTracker.removeFragment(r):((b=this.media)===null||b===void 0?void 0:b.buffered.length)===0&&this.fragmentTracker.removeAllFragments()},v.getAppendedFrag=function(r){var i=this.fragmentTracker.getAppendedFrag(r,s.PlaylistLevelType.MAIN);return i&&"fragment"in i?i.fragment:i},v.getBufferedFrag=function(r){return this.fragmentTracker.getBufferedFrag(r,s.PlaylistLevelType.MAIN)},v.followingBufferedFrag=function(r){return r?this.getBufferedFrag(r.end+.5):null},v.immediateLevelSwitch=function(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)},v.nextLevelSwitch=function(){var r=this.levels,i=this.media;if(i!=null&&i.readyState){var c,b=this.getAppendedFrag(i.currentTime);if(b&&b.start>1&&this.flushMainBuffer(0,b.start-1),!i.paused&&r){var L=r[this.hls.nextLoadLevel],k=this.fragLastKbps;c=k&&this.fragCurrent?this.fragCurrent.duration*L.maxBitrate/(1e3*k)+1:0}else c=0;var O=this.getBufferedFrag(i.currentTime+c);if(O){var w=this.followingBufferedFrag(O);if(w){this.abortCurrentFrag();var x=w.maxStartPTS?w.maxStartPTS:w.start,P=w.duration,F=Math.max(O.end,x+Math.min(Math.max(P-this.config.maxFragLookUpTolerance,.5*P),.75*P));this.flushMainBuffer(F,Number.POSITIVE_INFINITY)}}}},v.abortCurrentFrag=function(){var r=this.fragCurrent;this.fragCurrent=null,r!=null&&r.loader&&r.loader.abort(),this.state===E.State.KEY_LOADING&&(this.state=E.State.IDLE),this.nextLoadPosition=this.getLoadPosition()},v.flushMainBuffer=function(r,i){o.prototype.flushMainBuffer.call(this,r,i,this.altAudio?"video":null)},v.onMediaAttached=function(r,i){o.prototype.onMediaAttached.call(this,r,i);var c=i.media;this.onvplaying=this.onMediaPlaying.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),c.addEventListener("playing",this.onvplaying),c.addEventListener("seeked",this.onvseeked),this.gapController=new T.default(this.config,c,this.fragmentTracker,this.hls)},v.onMediaDetaching=function(){var r=this.media;r&&(r.removeEventListener("playing",this.onvplaying),r.removeEventListener("seeked",this.onvseeked),this.onvplaying=this.onvseeked=null,this.videoBuffer=null),this.fragPlaying=null,this.gapController&&(this.gapController.destroy(),this.gapController=null),o.prototype.onMediaDetaching.call(this)},v.onMediaPlaying=function(){this.tick()},v.onMediaSeeked=function(){var r=this.media,i=r?r.currentTime:null;Object(R.isFiniteNumber)(i)&&this.log("Media seeked to "+i.toFixed(3)),this.tick()},v.onManifestLoading=function(){this.log("Trigger BUFFER_RESET"),this.hls.trigger(_.Events.BUFFER_RESET,void 0),this.fragmentTracker.removeAllFragments(),this.couldBacktrack=this.stalled=!1,this.startPosition=this.lastCurrentTime=0,this.fragPlaying=null},v.onManifestParsed=function(r,i){var c,b=!1,L=!1;i.levels.forEach(function(k){(c=k.audioCodec)&&(c.indexOf("mp4a.40.2")!==-1&&(b=!0),c.indexOf("mp4a.40.5")!==-1&&(L=!0))}),this.audioCodecSwitch=b&&L&&!Object(A.changeTypeSupported)(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=i.levels,this.startFragRequested=!1},v.onLevelLoading=function(r,i){var c=this.levels;if(c&&this.state===E.State.IDLE){var b=c[i.level];(!b.details||b.details.live&&this.levelLastLoaded!==i.level||this.waitForCdnTuneIn(b.details))&&(this.state=E.State.WAITING_LEVEL)}},v.onLevelLoaded=function(r,i){var c,b=this.levels,L=i.level,k=i.details,O=k.totalduration;if(b){this.log("Level "+L+" loaded ["+k.startSN+","+k.endSN+"], cc ["+k.startCC+", "+k.endCC+"] duration:"+O);var w=this.fragCurrent;!w||this.state!==E.State.FRAG_LOADING&&this.state!==E.State.FRAG_LOADING_WAITING_RETRY||w.level!==i.level&&w.loader&&(this.state=E.State.IDLE,w.loader.abort());var x=b[L],P=0;if(k.live||(c=x.details)!==null&&c!==void 0&&c.live){if(k.fragments[0]||(k.deltaUpdateFailed=!0),k.deltaUpdateFailed)return;P=this.alignPlaylists(k,x.details)}if(x.details=k,this.levelLastLoaded=L,this.hls.trigger(_.Events.LEVEL_UPDATED,{details:k,level:L}),this.state===E.State.WAITING_LEVEL){if(this.waitForCdnTuneIn(k))return;this.state=E.State.IDLE}this.startFragRequested?k.live&&this.synchronizeToLiveEdge(k):this.setStartPosition(k,P),this.tick()}else this.warn("Levels were reset while loading level "+L)},v._handleFragmentLoadProgress=function(r){var i,c=r.frag,b=r.part,L=r.payload,k=this.levels;if(k){var O=k[c.level],w=O.details;if(w){var x=O.videoCodec,P=w.PTSKnown||!w.live,F=(i=c.initSegment)===null||i===void 0?void 0:i.data,M=this._getAudioCodec(O),B=this.transmuxer=this.transmuxer||new m.default(this.hls,s.PlaylistLevelType.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),U=b?b.index:-1,G=U!==-1,V=new h.ChunkMetadata(c.level,c.sn,c.stats.chunkCount,L.byteLength,U,G),H=this.initPTS[c.cc];B.push(L,F,M,x,c,b,w.totalduration,P,V,H)}else this.warn("Dropping fragment "+c.sn+" of level "+c.level+" after level details were reset")}else this.warn("Levels were reset while fragment load was in progress. Fragment "+c.sn+" of level "+c.level+" will not be buffered")},v.onAudioTrackSwitching=function(r,i){var c=this.altAudio,b=!!i.url,L=i.id;if(!b){if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;var k=this.fragCurrent;k!=null&&k.loader&&(this.log("Switching to main audio track, cancel main fragment load"),k.loader.abort()),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();var O=this.hls;c&&O.trigger(_.Events.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),O.trigger(_.Events.AUDIO_TRACK_SWITCHED,{id:L})}},v.onAudioTrackSwitched=function(r,i){var c=i.id,b=!!this.hls.audioTracks[c].url;if(b){var L=this.videoBuffer;L&&this.mediaBuffer!==L&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=L)}this.altAudio=b,this.tick()},v.onBufferCreated=function(r,i){var c,b,L=i.tracks,k=!1;for(var O in L){var w=L[O];if(w.id==="main"){if(b=O,c=w,O==="video"){var x=L[O];x&&(this.videoBuffer=x.buffer)}}else k=!0}k&&c?(this.log("Alternate track found, use "+b+".buffered to schedule main fragment loading"),this.mediaBuffer=c.buffer):this.mediaBuffer=this.media},v.onFragBuffered=function(r,i){var c=i.frag,b=i.part;if(!c||c.type===s.PlaylistLevelType.MAIN){if(this.fragContextChanged(c))return this.warn("Fragment "+c.sn+(b?" p: "+b.index:"")+" of level "+c.level+" finished buffering, but was aborted. state: "+this.state),void(this.state===E.State.PARSED&&(this.state=E.State.IDLE));var L=b?b.stats:c.stats;this.fragLastKbps=Math.round(8*L.total/(L.buffering.end-L.loading.first)),c.sn!=="initSegment"&&(this.fragPrevious=c),this.fragBufferedComplete(c,b)}},v.onError=function(r,i){switch(i.details){case y.ErrorDetails.FRAG_LOAD_ERROR:case y.ErrorDetails.FRAG_LOAD_TIMEOUT:case y.ErrorDetails.KEY_LOAD_ERROR:case y.ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(s.PlaylistLevelType.MAIN,i);break;case y.ErrorDetails.LEVEL_LOAD_ERROR:case y.ErrorDetails.LEVEL_LOAD_TIMEOUT:this.state!==E.State.ERROR&&(i.fatal?(this.warn(""+i.details),this.state=E.State.ERROR):i.levelRetry||this.state!==E.State.WAITING_LEVEL||(this.state=E.State.IDLE));break;case y.ErrorDetails.BUFFER_FULL_ERROR:if(i.parent==="main"&&(this.state===E.State.PARSING||this.state===E.State.PARSED)){var c=!0,b=this.getFwdBufferInfo(this.media,s.PlaylistLevelType.MAIN);b&&b.len>.5&&(c=!this.reduceMaxBufferLength(b.len)),c&&(this.warn("buffer full error also media.currentTime is not buffered, flush main"),this.immediateLevelSwitch()),this.resetLoadingState()}}},v.checkBuffer=function(){var r=this.media,i=this.gapController;if(r&&i&&r.readyState){var c=I.BufferHelper.getBuffered(r);!this.loadedmetadata&&c.length?(this.loadedmetadata=!0,this.seekToStartPos()):i.poll(this.lastCurrentTime),this.lastCurrentTime=r.currentTime}},v.onFragLoadEmergencyAborted=function(){this.state=E.State.IDLE,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tickImmediate()},v.onBufferFlushed=function(r,i){var c=i.type;if(c!==S.ElementaryStreamTypes.AUDIO||this.audioOnly&&!this.altAudio){var b=(c===S.ElementaryStreamTypes.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;this.afterBufferFlushed(b,c,s.PlaylistLevelType.MAIN)}},v.onLevelsUpdated=function(r,i){this.levels=i.levels},v.swapAudioCodec=function(){this.audioCodecSwap=!this.audioCodecSwap},v.seekToStartPos=function(){var r=this.media,i=r.currentTime,c=this.startPosition;if(c>=0&&i<c){if(r.seeking)return void d.logger.log("could not seek to "+c+", already seeking at "+i);var b=I.BufferHelper.getBuffered(r),L=(b.length?b.start(0):0)-c;L>0&&L<this.config.maxBufferHole&&(d.logger.log("adjusting start position by "+L+" to match buffer start"),c+=L,this.startPosition=c),this.log("seek to target start position "+c+" from current time "+i),r.currentTime=c}},v._getAudioCodec=function(r){var i=this.config.defaultAudioCodec||r.audioCodec;return this.audioCodecSwap&&i&&(this.log("Swapping audio codec"),i=i.indexOf("mp4a.40.5")!==-1?"mp4a.40.2":"mp4a.40.5"),i},v._loadBitrateTestFrag=function(r){var i=this;this._doFragLoad(r).then(function(c){var b=i.hls;if(c&&!b.nextLoadLevel&&!i.fragContextChanged(r)){i.fragLoadError=0,i.state=E.State.IDLE,i.startFragRequested=!1,i.bitrateTest=!1;var L=r.stats;L.parsing.start=L.parsing.end=L.buffering.start=L.buffering.end=self.performance.now(),b.trigger(_.Events.FRAG_LOADED,c)}})},v._handleTransmuxComplete=function(r){var i,c="main",b=this.hls,L=r.remuxResult,k=r.chunkMeta,O=this.getCurrentContext(k);if(!O)return this.warn("The loading context changed while buffering fragment "+k.sn+" of level "+k.level+". This chunk will not be buffered."),void this.resetLiveStartWhenNotLoaded(k.level);var w=O.frag,x=O.part,P=O.level,F=L.video,M=L.text,B=L.id3,U=L.initSegment,G=this.altAudio?void 0:L.audio;if(!this.fragContextChanged(w)){if(this.state=E.State.PARSING,U){U.tracks&&(this._bufferInitSegment(P,U.tracks,w,k),b.trigger(_.Events.FRAG_PARSING_INIT_SEGMENT,{frag:w,id:c,tracks:U.tracks}));var V=U.initPTS,H=U.timescale;Object(R.isFiniteNumber)(V)&&(this.initPTS[w.cc]=V,b.trigger(_.Events.INIT_PTS_FOUND,{frag:w,id:c,initPTS:V,timescale:H}))}if(F&&L.independent!==!1){if(P.details){var Y=F.startPTS,W=F.endPTS,q=F.startDTS,J=F.endDTS;if(x)x.elementaryStreams[F.type]={startPTS:Y,endPTS:W,startDTS:q,endDTS:J};else if(F.firstKeyFrame&&F.independent&&(this.couldBacktrack=!0),F.dropped&&F.independent){if(this.getLoadPosition()+this.config.maxBufferHole<Y)return void this.backtrack(w);w.setElementaryStreamInfo(F.type,w.start,W,w.start,J,!0)}w.setElementaryStreamInfo(F.type,Y,W,q,J),this.bufferFragmentData(F,w,x,k)}}else if(L.independent===!1)return void this.backtrack(w);if(G){var rt=G.startPTS,it=G.endPTS,Q=G.startDTS,st=G.endDTS;x&&(x.elementaryStreams[S.ElementaryStreamTypes.AUDIO]={startPTS:rt,endPTS:it,startDTS:Q,endDTS:st}),w.setElementaryStreamInfo(S.ElementaryStreamTypes.AUDIO,rt,it,Q,st),this.bufferFragmentData(G,w,x,k)}if(B!=null&&(i=B.samples)!==null&&i!==void 0&&i.length){var $={frag:w,id:c,samples:B.samples};b.trigger(_.Events.FRAG_PARSING_METADATA,$)}if(M){var et={frag:w,id:c,samples:M.samples};b.trigger(_.Events.FRAG_PARSING_USERDATA,et)}}},v._bufferInitSegment=function(r,i,c,b){var L=this;if(this.state===E.State.PARSING){this.audioOnly=!!i.audio&&!i.video,this.altAudio&&!this.audioOnly&&delete i.audio;var k=i.audio,O=i.video,w=i.audiovideo;if(k){var x=r.audioCodec,P=navigator.userAgent.toLowerCase();this.audioCodecSwitch&&(x&&(x=x.indexOf("mp4a.40.5")!==-1?"mp4a.40.2":"mp4a.40.5"),k.metadata.channelCount!==1&&P.indexOf("firefox")===-1&&(x="mp4a.40.5")),P.indexOf("android")!==-1&&k.container!=="audio/mpeg"&&(x="mp4a.40.2",this.log("Android: force audio codec to "+x)),r.audioCodec&&r.audioCodec!==x&&this.log('Swapping manifest audio codec "'+r.audioCodec+'" for "'+x+'"'),k.levelCodec=x,k.id="main",this.log("Init audio buffer, container:"+k.container+", codecs[selected/level/parsed]=["+(x||"")+"/"+(r.audioCodec||"")+"/"+k.codec+"]")}O&&(O.levelCodec=r.videoCodec,O.id="main",this.log("Init video buffer, container:"+O.container+", codecs[level/parsed]=["+(r.videoCodec||"")+"/"+O.codec+"]")),w&&this.log("Init audiovideo buffer, container:"+w.container+", codecs[level/parsed]=["+(r.attrs.CODECS||"")+"/"+w.codec+"]"),this.hls.trigger(_.Events.BUFFER_CODECS,i),Object.keys(i).forEach(function(F){var M=i[F].initSegment;M!=null&&M.byteLength&&L.hls.trigger(_.Events.BUFFER_APPENDING,{type:F,data:M,frag:c,part:null,chunkMeta:b,parent:c.type})}),this.tick()}},v.backtrack=function(r){this.couldBacktrack=!0,this.resetTransmuxer(),this.flushBufferGap(r);var i=this.fragmentTracker.backtrack(r);this.fragPrevious=null,this.nextLoadPosition=r.start,i?this.resetFragmentLoading(r):this.state=E.State.BACKTRACKING},v.checkFragmentChanged=function(){var r=this.media,i=null;if(r&&r.readyState>1&&r.seeking===!1){var c=r.currentTime;if(I.BufferHelper.isBuffered(r,c)?i=this.getAppendedFrag(c):I.BufferHelper.isBuffered(r,c+.1)&&(i=this.getAppendedFrag(c+.1)),i){var b=this.fragPlaying,L=i.level;b&&i.sn===b.sn&&b.level===L&&i.urlId===b.urlId||(this.hls.trigger(_.Events.FRAG_CHANGED,{frag:i}),b&&b.level===L||this.hls.trigger(_.Events.LEVEL_SWITCHED,{level:L}),this.fragPlaying=i)}}},p=l,(g=[{key:"nextLevel",get:function(){var r=this.nextBufferedFrag;return r?r.level:-1}},{key:"currentLevel",get:function(){var r=this.media;if(r){var i=this.getAppendedFrag(r.currentTime);if(i)return i.level}return-1}},{key:"nextBufferedFrag",get:function(){var r=this.media;if(r){var i=this.getAppendedFrag(r.currentTime);return this.followingBufferedFrag(i)}return null}},{key:"forceStartLoad",get:function(){return this._forceStartLoad}}])&&t(p.prototype,g),l}(E.default)},"./src/controller/subtitle-stream-controller.ts":function(N,C,f){f.r(C),f.d(C,"SubtitleStreamController",function(){return d});var R=f("./src/events.ts"),E=f("./src/utils/logger.ts"),A=f("./src/utils/buffer-helper.ts"),_=f("./src/controller/fragment-finders.ts"),I=f("./src/utils/discontinuities.ts"),D=f("./src/controller/level-helper.ts"),s=f("./src/controller/fragment-tracker.ts"),S=f("./src/controller/base-stream-controller.ts"),m=f("./src/types/loader.ts"),h=f("./src/types/level.ts");function T(t,a){for(var e=0;e<a.length;e++){var o=a[e];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function y(t,a){return(y=Object.setPrototypeOf||function(e,o){return e.__proto__=o,e})(t,a)}var d=function(t){var a,e;function o(p,g){var v;return(v=t.call(this,p,g,"[subtitle-stream-controller]")||this).levels=[],v.currentTrackId=-1,v.tracksBuffered=[],v.mainDetails=null,v._registerListeners(),v}e=t,(a=o).prototype=Object.create(e.prototype),a.prototype.constructor=a,y(a,e);var u,n,l=o.prototype;return l.onHandlerDestroying=function(){this._unregisterListeners(),this.mainDetails=null},l._registerListeners=function(){var p=this.hls;p.on(R.Events.MEDIA_ATTACHED,this.onMediaAttached,this),p.on(R.Events.MEDIA_DETACHING,this.onMediaDetaching,this),p.on(R.Events.MANIFEST_LOADING,this.onManifestLoading,this),p.on(R.Events.LEVEL_LOADED,this.onLevelLoaded,this),p.on(R.Events.ERROR,this.onError,this),p.on(R.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),p.on(R.Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),p.on(R.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),p.on(R.Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),p.on(R.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},l._unregisterListeners=function(){var p=this.hls;p.off(R.Events.MEDIA_ATTACHED,this.onMediaAttached,this),p.off(R.Events.MEDIA_DETACHING,this.onMediaDetaching,this),p.off(R.Events.MANIFEST_LOADING,this.onManifestLoading,this),p.off(R.Events.LEVEL_LOADED,this.onLevelLoaded,this),p.off(R.Events.ERROR,this.onError,this),p.off(R.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),p.off(R.Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),p.off(R.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),p.off(R.Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),p.off(R.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},l.startLoad=function(){this.stopLoad(),this.state=S.State.IDLE,this.setInterval(500),this.tick()},l.onManifestLoading=function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments()},l.onLevelLoaded=function(p,g){this.mainDetails=g.details},l.onSubtitleFragProcessed=function(p,g){var v=g.frag,r=g.success;if(this.fragPrevious=v,this.state=S.State.IDLE,r){var i=this.tracksBuffered[this.currentTrackId];if(i){for(var c,b=v.start,L=0;L<i.length;L++)if(b>=i[L].start&&b<=i[L].end){c=i[L];break}var k=v.start+v.duration;c?c.end=k:(c={start:b,end:k},i.push(c)),this.fragmentTracker.fragBuffered(v)}}},l.onBufferFlushing=function(p,g){var v=g.startOffset,r=g.endOffset;if(v===0&&r!==Number.POSITIVE_INFINITY){var i=this.currentTrackId,c=this.levels;if(!c.length||!c[i]||!c[i].details)return;var b=r-c[i].details.targetduration;if(b<=0)return;g.endOffsetSubtitles=Math.max(0,b),this.tracksBuffered.forEach(function(L){for(var k=0;k<L.length;)if(L[k].end<=b)L.shift();else{if(!(L[k].start<b))break;L[k].start=b,k++}}),this.fragmentTracker.removeFragmentsInRange(v,b,m.PlaylistLevelType.SUBTITLE)}},l.onError=function(p,g){var v,r=g.frag;r&&r.type===m.PlaylistLevelType.SUBTITLE&&((v=this.fragCurrent)!==null&&v!==void 0&&v.loader&&this.fragCurrent.loader.abort(),this.state=S.State.IDLE)},l.onSubtitleTracksUpdated=function(p,g){var v=this,r=g.subtitleTracks;this.tracksBuffered=[],this.levels=r.map(function(i){return new h.Level(i)}),this.fragmentTracker.removeAllFragments(),this.fragPrevious=null,this.levels.forEach(function(i){v.tracksBuffered[i.id]=[]}),this.mediaBuffer=null},l.onSubtitleTrackSwitch=function(p,g){if(this.currentTrackId=g.id,this.levels.length&&this.currentTrackId!==-1){var v=this.levels[this.currentTrackId];v!=null&&v.details?(this.mediaBuffer=this.mediaBufferTimeRanges,this.setInterval(500)):this.mediaBuffer=null}else this.clearInterval()},l.onSubtitleTrackLoaded=function(p,g){var v,r=g.details,i=g.id,c=this.currentTrackId,b=this.levels;if(b.length){var L=b[c];if(!(i>=b.length||i!==c)&&L){if(this.mediaBuffer=this.mediaBufferTimeRanges,r.live||(v=L.details)!==null&&v!==void 0&&v.live){var k=this.mainDetails;if(r.deltaUpdateFailed||!k)return;var O=k.fragments[0];L.details?this.alignPlaylists(r,L.details)===0&&O&&Object(D.addSliding)(r,O.start):r.hasProgramDateTime&&k.hasProgramDateTime?Object(I.alignPDT)(r,k):O&&Object(D.addSliding)(r,O.start)}L.details=r,this.levelLastLoaded=i,this.tick(),r.live&&!this.fragCurrent&&this.media&&this.state===S.State.IDLE&&(Object(_.findFragmentByPTS)(null,r.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),L.details=void 0))}}},l._handleFragmentLoadComplete=function(p){var g=p.frag,v=p.payload,r=g.decryptdata,i=this.hls;if(!this.fragContextChanged(g)&&v&&v.byteLength>0&&r&&r.key&&r.iv&&r.method==="AES-128"){var c=performance.now();this.decrypter.webCryptoDecrypt(new Uint8Array(v),r.key.buffer,r.iv.buffer).then(function(b){var L=performance.now();i.trigger(R.Events.FRAG_DECRYPTED,{frag:g,payload:b,stats:{tstart:c,tdecrypt:L}})})}},l.doTick=function(){if(this.media){if(this.state===S.State.IDLE){var p,g=this.currentTrackId,v=this.levels;if(!v.length||!v[g]||!v[g].details)return;var r=v[g].details,i=r.targetduration,c=this.config,b=this.media,L=A.BufferHelper.bufferedInfo(this.mediaBufferTimeRanges,b.currentTime-i,c.maxBufferHole),k=L.end;if(L.len>this.getMaxBufferLength()+i)return;console.assert(r,"Subtitle track details are defined on idle subtitle stream controller tick");var O,w=r.fragments,x=w.length,P=r.edge,F=this.fragPrevious;if(k<P){var M=c.maxFragLookUpTolerance;F&&r.hasProgramDateTime&&(O=Object(_.findFragmentByPDT)(w,F.endProgramDateTime,M)),O||!(O=Object(_.findFragmentByPTS)(F,w,k,M))&&F&&F.start<w[0].start&&(O=w[0])}else O=w[x-1];(p=O)!==null&&p!==void 0&&p.encrypted?(E.logger.log("Loading key for "+O.sn),this.state=S.State.KEY_LOADING,this.hls.trigger(R.Events.KEY_LOADING,{frag:O})):O&&this.fragmentTracker.getState(O)===s.FragmentState.NOT_LOADED&&this.loadFragment(O,r,k)}}else this.state=S.State.IDLE},l.loadFragment=function(p,g,v){this.fragCurrent=p,t.prototype.loadFragment.call(this,p,g,v)},u=o,(n=[{key:"mediaBufferTimeRanges",get:function(){return this.tracksBuffered[this.currentTrackId]||[]}}])&&T(u.prototype,n),o}(S.default)},"./src/controller/subtitle-track-controller.ts":function(N,C,f){f.r(C);var R=f("./src/events.ts"),E=f("./src/utils/texttrack-utils.ts"),A=f("./src/controller/base-playlist-controller.ts"),_=f("./src/types/loader.ts");function I(m,h){for(var T=0;T<h.length;T++){var y=h[T];y.enumerable=y.enumerable||!1,y.configurable=!0,"value"in y&&(y.writable=!0),Object.defineProperty(m,y.key,y)}}function D(m,h){return(D=Object.setPrototypeOf||function(T,y){return T.__proto__=y,T})(m,h)}var s=function(m){var h,T;function y(e){var o;return(o=m.call(this,e,"[subtitle-track-controller]")||this).media=null,o.tracks=[],o.groupId=null,o.tracksInGroup=[],o.trackId=-1,o.selectDefaultTrack=!0,o.queuedDefaultTrack=-1,o.trackChangeListener=function(){return o.onTextTracksChanged()},o.asyncPollTrackChange=function(){return o.pollTrackChange(0)},o.useTextTrackPolling=!1,o.subtitlePollingInterval=-1,o.subtitleDisplay=!0,o.registerListeners(),o}T=m,(h=y).prototype=Object.create(T.prototype),h.prototype.constructor=h,D(h,T);var d,t,a=y.prototype;return a.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.trackChangeListener=this.asyncPollTrackChange=null,m.prototype.destroy.call(this)},a.registerListeners=function(){var e=this.hls;e.on(R.Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(R.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(R.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.on(R.Events.MANIFEST_PARSED,this.onManifestParsed,this),e.on(R.Events.LEVEL_LOADING,this.onLevelLoading,this),e.on(R.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(R.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(R.Events.ERROR,this.onError,this)},a.unregisterListeners=function(){var e=this.hls;e.off(R.Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(R.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(R.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.off(R.Events.MANIFEST_PARSED,this.onManifestParsed,this),e.off(R.Events.LEVEL_LOADING,this.onLevelLoading,this),e.off(R.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(R.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(R.Events.ERROR,this.onError,this)},a.onMediaAttached=function(e,o){this.media=o.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))},a.pollTrackChange=function(e){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.trackChangeListener,e)},a.onMediaDetaching=function(){this.media&&(self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||this.media.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId),S(this.media.textTracks).forEach(function(e){Object(E.clearCurrentCues)(e)}),this.subtitleTrack=-1,this.media=null)},a.onManifestLoading=function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.selectDefaultTrack=!0},a.onManifestParsed=function(e,o){this.tracks=o.subtitleTracks},a.onSubtitleTrackLoaded=function(e,o){var u=o.id,n=o.details,l=this.trackId,p=this.tracksInGroup[l];if(p){var g=p.details;p.details=o.details,this.log("subtitle track "+u+" loaded ["+n.startSN+"-"+n.endSN+"]"),u===this.trackId&&(this.retryCount=0,this.playlistLoaded(u,o,g))}else this.warn("Invalid subtitle track id "+u)},a.onLevelLoading=function(e,o){this.switchLevel(o.level)},a.onLevelSwitching=function(e,o){this.switchLevel(o.level)},a.switchLevel=function(e){var o=this.hls.levels[e];if(o!=null&&o.textGroupIds){var u=o.textGroupIds[o.urlId];if(this.groupId!==u){var n=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0,l=this.tracks.filter(function(v){return!u||v.groupId===u});this.tracksInGroup=l;var p=this.findTrackId(n==null?void 0:n.name)||this.findTrackId();this.groupId=u;var g={subtitleTracks:l};this.log("Updating subtitle tracks, "+l.length+' track(s) found in "'+u+'" group-id'),this.hls.trigger(R.Events.SUBTITLE_TRACKS_UPDATED,g),p!==-1&&this.setSubtitleTrack(p,n)}}},a.findTrackId=function(e){for(var o=this.tracksInGroup,u=0;u<o.length;u++){var n=o[u];if((!this.selectDefaultTrack||n.default)&&(!e||e===n.name))return n.id}return-1},a.onError=function(e,o){m.prototype.onError.call(this,e,o),!o.fatal&&o.context&&o.context.type===_.PlaylistContextType.SUBTITLE_TRACK&&o.context.id===this.trackId&&o.context.groupId===this.groupId&&this.retryLoadingOrFail(o)},a.loadPlaylist=function(e){var o=this.tracksInGroup[this.trackId];if(this.shouldLoadTrack(o)){var u=o.id,n=o.groupId,l=o.url;if(e)try{l=e.addDirectives(l)}catch(p){this.warn("Could not construct new URL with HLS Delivery Directives: "+p)}this.log("Loading subtitle playlist for id "+u),this.hls.trigger(R.Events.SUBTITLE_TRACK_LOADING,{url:l,id:u,groupId:n,deliveryDirectives:e||null})}},a.toggleTrackModes=function(e){var o=this,u=this.media,n=this.subtitleDisplay,l=this.trackId;if(u){var p=S(u.textTracks),g=p.filter(function(i){return i.groupId===o.groupId});if(e===-1)[].slice.call(p).forEach(function(i){i.mode="disabled"});else{var v=g[l];v&&(v.mode="disabled")}var r=g[e];r&&(r.mode=n?"showing":"hidden")}},a.setSubtitleTrack=function(e,o){var u,n=this.tracksInGroup;if(this.media){if(this.trackId!==e&&this.toggleTrackModes(e),!(this.trackId===e&&(e===-1||(u=n[e])!==null&&u!==void 0&&u.details)||e<-1||e>=n.length)){this.clearTimer();var l=n[e];if(this.log("Switching to subtitle track "+e),this.trackId=e,l){var p=l.id,g=l.groupId,v=g===void 0?"":g,r=l.name,i=l.type,c=l.url;this.hls.trigger(R.Events.SUBTITLE_TRACK_SWITCH,{id:p,groupId:v,name:r,type:i,url:c});var b=this.switchParams(l.url,o==null?void 0:o.details);this.loadPlaylist(b)}else this.hls.trigger(R.Events.SUBTITLE_TRACK_SWITCH,{id:e})}}else this.queuedDefaultTrack=e},a.onTextTracksChanged=function(){if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),this.media&&this.hls.config.renderTextTracksNatively){for(var e=-1,o=S(this.media.textTracks),u=0;u<o.length;u++)if(o[u].mode==="hidden")e=u;else if(o[u].mode==="showing"){e=u;break}this.subtitleTrack!==e&&(this.subtitleTrack=e)}},d=y,(t=[{key:"subtitleTracks",get:function(){return this.tracksInGroup}},{key:"subtitleTrack",get:function(){return this.trackId},set:function(e){this.selectDefaultTrack=!1;var o=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0;this.setSubtitleTrack(e,o)}}])&&I(d.prototype,t),y}(A.default);function S(m){for(var h=[],T=0;T<m.length;T++){var y=m[T];y.kind==="subtitles"&&y.label&&h.push(m[T])}return h}C.default=s},"./src/controller/timeline-controller.ts":function(N,C,f){f.r(C),f.d(C,"TimelineController",function(){return h});var R=f("./src/polyfills/number.ts"),E=f("./src/events.ts"),A=f("./src/utils/cea-608-parser.ts"),_=f("./src/utils/output-filter.ts"),I=f("./src/utils/webvtt-parser.ts"),D=f("./src/utils/texttrack-utils.ts"),s=f("./src/utils/imsc1-ttml-parser.ts"),S=f("./src/types/loader.ts"),m=f("./src/utils/logger.ts"),h=function(){function y(t){if(this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.timescale=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastSn=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!1}},this.captionsProperties=void 0,this.hls=t,this.config=t.config,this.Cues=t.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},this.config.enableCEA708Captions){var a=new _.default(this,"textTrack1"),e=new _.default(this,"textTrack2"),o=new _.default(this,"textTrack3"),u=new _.default(this,"textTrack4");this.cea608Parser1=new A.default(1,a,e),this.cea608Parser2=new A.default(3,o,u)}t.on(E.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),t.on(E.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(E.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.on(E.Events.MANIFEST_LOADED,this.onManifestLoaded,this),t.on(E.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),t.on(E.Events.FRAG_LOADING,this.onFragLoading,this),t.on(E.Events.FRAG_LOADED,this.onFragLoaded,this),t.on(E.Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),t.on(E.Events.FRAG_DECRYPTED,this.onFragDecrypted,this),t.on(E.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),t.on(E.Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),t.on(E.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)}var d=y.prototype;return d.destroy=function(){var t=this.hls;t.off(E.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),t.off(E.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(E.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.off(E.Events.MANIFEST_LOADED,this.onManifestLoaded,this),t.off(E.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),t.off(E.Events.FRAG_LOADING,this.onFragLoading,this),t.off(E.Events.FRAG_LOADED,this.onFragLoaded,this),t.off(E.Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),t.off(E.Events.FRAG_DECRYPTED,this.onFragDecrypted,this),t.off(E.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),t.off(E.Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),t.off(E.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.cea608Parser1=this.cea608Parser2=null},d.addCues=function(t,a,e,o,u){for(var n,l,p,g,v=!1,r=u.length;r--;){var i=u[r],c=(n=i[0],l=i[1],p=a,g=e,Math.min(l,g)-Math.max(n,p));if(c>=0&&(i[0]=Math.min(i[0],a),i[1]=Math.max(i[1],e),v=!0,c/(e-a)>.5))return}if(v||u.push([a,e]),this.config.renderTextTracksNatively){var b=this.captionsTracks[t];this.Cues.newCue(b,a,e,o)}else{var L=this.Cues.newCue(null,a,e,o);this.hls.trigger(E.Events.CUES_PARSED,{type:"captions",cues:L,track:t})}},d.onInitPtsFound=function(t,a){var e=this,o=a.frag,u=a.id,n=a.initPTS,l=a.timescale,p=this.unparsedVttFrags;u==="main"&&(this.initPTS[o.cc]=n,this.timescale[o.cc]=l),p.length&&(this.unparsedVttFrags=[],p.forEach(function(g){e.onFragLoaded(E.Events.FRAG_LOADED,g)}))},d.getExistingTrack=function(t){var a=this.media;if(a)for(var e=0;e<a.textTracks.length;e++){var o=a.textTracks[e];if(o[t])return o}return null},d.createCaptionsTrack=function(t){this.config.renderTextTracksNatively?this.createNativeTrack(t):this.createNonNativeTrack(t)},d.createNativeTrack=function(t){if(!this.captionsTracks[t]){var a=this.captionsProperties,e=this.captionsTracks,o=this.media,u=a[t],n=u.label,l=u.languageCode,p=this.getExistingTrack(t);if(p)e[t]=p,Object(D.clearCurrentCues)(e[t]),Object(D.sendAddTrackEvent)(e[t],o);else{var g=this.createTextTrack("captions",n,l);g&&(g[t]=!0,e[t]=g)}}},d.createNonNativeTrack=function(t){if(!this.nonNativeCaptionsTracks[t]){var a=this.captionsProperties[t];if(a){var e={_id:t,label:a.label,kind:"captions",default:!!a.media&&!!a.media.default,closedCaptions:a.media};this.nonNativeCaptionsTracks[t]=e,this.hls.trigger(E.Events.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[e]})}}},d.createTextTrack=function(t,a,e){var o=this.media;if(o)return o.addTextTrack(t,a,e)},d.onMediaAttaching=function(t,a){this.media=a.media,this._cleanTracks()},d.onMediaDetaching=function(){var t=this.captionsTracks;Object.keys(t).forEach(function(a){Object(D.clearCurrentCues)(t[a]),delete t[a]}),this.nonNativeCaptionsTracks={}},d.onManifestLoading=function(){this.lastSn=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!1}},this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=this.unparsedVttFrags||[],this.initPTS=[],this.timescale=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())},d._cleanTracks=function(){var t=this.media;if(t){var a=t.textTracks;if(a)for(var e=0;e<a.length;e++)Object(D.clearCurrentCues)(a[e])}},d.onSubtitleTracksUpdated=function(t,a){var e=this;this.textTracks=[];var o=a.subtitleTracks||[],u=o.some(function(g){return g.textCodec===s.IMSC1_CODEC});if(this.config.enableWebVTT||u&&this.config.enableIMSC1){var n=this.tracks&&o&&this.tracks.length===o.length;if(this.tracks=o||[],this.config.renderTextTracksNatively){var l=this.media?this.media.textTracks:[];this.tracks.forEach(function(g,v){var r;if(v<l.length){for(var i=null,c=0;c<l.length;c++)if(T(l[c],g)){i=l[c];break}i&&(r=i)}r?Object(D.clearCurrentCues)(r):(r=e.createTextTrack("subtitles",g.name,g.lang))&&(r.mode="disabled"),r&&(r.groupId=g.groupId,e.textTracks.push(r))})}else if(!n&&this.tracks&&this.tracks.length){var p=this.tracks.map(function(g){return{label:g.name,kind:g.type.toLowerCase(),default:g.default,subtitleTrack:g}});this.hls.trigger(E.Events.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:p})}}},d.onManifestLoaded=function(t,a){var e=this;this.config.enableCEA708Captions&&a.captions&&a.captions.forEach(function(o){var u=/(?:CC|SERVICE)([1-4])/.exec(o.instreamId);if(u){var n="textTrack"+u[1],l=e.captionsProperties[n];l&&(l.label=o.name,o.lang&&(l.languageCode=o.lang),l.media=o)}})},d.onFragLoading=function(t,a){var e=this.cea608Parser1,o=this.cea608Parser2,u=this.lastSn;if(this.enabled&&e&&o&&a.frag.type===S.PlaylistLevelType.MAIN){var n=a.frag.sn;n!==u+1&&(e.reset(),o.reset()),this.lastSn=n}},d.onFragLoaded=function(t,a){var e=a.frag,o=a.payload,u=this.initPTS,n=this.unparsedVttFrags;if(e.type===S.PlaylistLevelType.SUBTITLE)if(o.byteLength){if(!Object(R.isFiniteNumber)(u[e.cc]))return n.push(a),void(u.length&&this.hls.trigger(E.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:new Error("Missing initial subtitle PTS")}));var l=e.decryptdata;if(l==null||l.key==null||l.method!=="AES-128"){var p=this.tracks[e.level],g=this.vttCCs;g[e.cc]||(g[e.cc]={start:e.start,prevCC:this.prevCC,new:!0},this.prevCC=e.cc),p&&p.textCodec===s.IMSC1_CODEC?this._parseIMSC1(e,o):this._parseVTTs(e,o,g)}}else this.hls.trigger(E.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:new Error("Empty subtitle payload")})},d._parseIMSC1=function(t,a){var e=this,o=this.hls;Object(s.parseIMSC1)(a,this.initPTS[t.cc],this.timescale[t.cc],function(u){e._appendCues(u,t.level),o.trigger(E.Events.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:t})},function(u){m.logger.log("Failed to parse IMSC1: "+u),o.trigger(E.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:t,error:u})})},d._parseVTTs=function(t,a,e){var o=this,u=this.hls;Object(I.parseWebVTT)(a,this.initPTS[t.cc],this.timescale[t.cc],e,t.cc,t.start,function(n){o._appendCues(n,t.level),u.trigger(E.Events.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:t})},function(n){o._fallbackToIMSC1(t,a),m.logger.log("Failed to parse VTT cue: "+n),u.trigger(E.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:t,error:n})})},d._fallbackToIMSC1=function(t,a){var e=this,o=this.tracks[t.level];o.textCodec||Object(s.parseIMSC1)(a,this.initPTS[t.cc],this.timescale[t.cc],function(){o.textCodec=s.IMSC1_CODEC,e._parseIMSC1(t,a)},function(){o.textCodec="wvtt"})},d._appendCues=function(t,a){var e=this.hls;if(this.config.renderTextTracksNatively){var o=this.textTracks[a];if(o.mode==="disabled")return;t.forEach(function(n){return Object(D.addCueToTrack)(o,n)})}else{var u=this.tracks[a].default?"default":"subtitles"+a;e.trigger(E.Events.CUES_PARSED,{type:"subtitles",cues:t,track:u})}},d.onFragDecrypted=function(t,a){var e=a.frag;if(e.type===S.PlaylistLevelType.SUBTITLE){if(!Object(R.isFiniteNumber)(this.initPTS[e.cc]))return void this.unparsedVttFrags.push(a);this.onFragLoaded(E.Events.FRAG_LOADED,a)}},d.onSubtitleTracksCleared=function(){this.tracks=[],this.captionsTracks={}},d.onFragParsingUserdata=function(t,a){var e=this.cea608Parser1,o=this.cea608Parser2;if(this.enabled&&e&&o)for(var u=0;u<a.samples.length;u++){var n=a.samples[u].bytes;if(n){var l=this.extractCea608Data(n);e.addData(a.samples[u].pts,l[0]),o.addData(a.samples[u].pts,l[1])}}},d.onBufferFlushing=function(t,a){var e=a.startOffset,o=a.endOffset,u=a.endOffsetSubtitles,n=a.type,l=this.media;if(l&&!(l.currentTime<o)){if(!n||n==="video"){var p=this.captionsTracks;Object.keys(p).forEach(function(v){return Object(D.removeCuesInRange)(p[v],e,o)})}if(this.config.renderTextTracksNatively&&e===0&&u!==void 0){var g=this.textTracks;Object.keys(g).forEach(function(v){return Object(D.removeCuesInRange)(g[v],e,u)})}}},d.extractCea608Data=function(t){for(var a=31&t[0],e=2,o=[[],[]],u=0;u<a;u++){var n=t[e++],l=127&t[e++],p=127&t[e++],g=3&n;l===0&&p===0||(4&n)!=0&&(g!==0&&g!==1||(o[g].push(l),o[g].push(p)))}return o},y}();function T(y,d){return y&&y.label===d.name&&!(y.textTrack1||y.textTrack2)}},"./src/crypt/aes-crypto.ts":function(N,C,f){f.r(C),f.d(C,"default",function(){return R});var R=function(){function E(A,_){this.subtle=void 0,this.aesIV=void 0,this.subtle=A,this.aesIV=_}return E.prototype.decrypt=function(A,_){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},_,A)},E}()},"./src/crypt/aes-decryptor.ts":function(N,C,f){f.r(C),f.d(C,"removePadding",function(){return E}),f.d(C,"default",function(){return A});var R=f("./src/utils/typed-array.ts");function E(_){var I=_.byteLength,D=I&&new DataView(_.buffer).getUint8(I-1);return D?Object(R.sliceUint8)(_,0,I-D):_}var A=function(){function _(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}var I=_.prototype;return I.uint8ArrayToUint32Array_=function(D){for(var s=new DataView(D),S=new Uint32Array(4),m=0;m<4;m++)S[m]=s.getUint32(4*m);return S},I.initTable=function(){var D=this.sBox,s=this.invSBox,S=this.subMix,m=S[0],h=S[1],T=S[2],y=S[3],d=this.invSubMix,t=d[0],a=d[1],e=d[2],o=d[3],u=new Uint32Array(256),n=0,l=0,p=0;for(p=0;p<256;p++)u[p]=p<128?p<<1:p<<1^283;for(p=0;p<256;p++){var g=l^l<<1^l<<2^l<<3^l<<4;g=g>>>8^255&g^99,D[n]=g,s[g]=n;var v=u[n],r=u[v],i=u[r],c=257*u[g]^16843008*g;m[n]=c<<24|c>>>8,h[n]=c<<16|c>>>16,T[n]=c<<8|c>>>24,y[n]=c,c=16843009*i^65537*r^257*v^16843008*n,t[g]=c<<24|c>>>8,a[g]=c<<16|c>>>16,e[g]=c<<8|c>>>24,o[g]=c,n?(n=v^u[u[u[i^v]]],l^=u[u[l]]):n=l=1}},I.expandKey=function(D){for(var s=this.uint8ArrayToUint32Array_(D),S=!0,m=0;m<s.length&&S;)S=s[m]===this.key[m],m++;if(!S){this.key=s;var h=this.keySize=s.length;if(h!==4&&h!==6&&h!==8)throw new Error("Invalid aes key size="+h);var T,y,d,t,a=this.ksRows=4*(h+6+1),e=this.keySchedule=new Uint32Array(a),o=this.invKeySchedule=new Uint32Array(a),u=this.sBox,n=this.rcon,l=this.invSubMix,p=l[0],g=l[1],v=l[2],r=l[3];for(T=0;T<a;T++)T<h?d=e[T]=s[T]:(t=d,T%h==0?(t=u[(t=t<<8|t>>>24)>>>24]<<24|u[t>>>16&255]<<16|u[t>>>8&255]<<8|u[255&t],t^=n[T/h|0]<<24):h>6&&T%h==4&&(t=u[t>>>24]<<24|u[t>>>16&255]<<16|u[t>>>8&255]<<8|u[255&t]),e[T]=d=(e[T-h]^t)>>>0);for(y=0;y<a;y++)T=a-y,t=3&y?e[T]:e[T-4],o[y]=y<4||T<=4?t:p[u[t>>>24]]^g[u[t>>>16&255]]^v[u[t>>>8&255]]^r[u[255&t]],o[y]=o[y]>>>0}},I.networkToHostOrderSwap=function(D){return D<<24|(65280&D)<<8|(16711680&D)>>8|D>>>24},I.decrypt=function(D,s,S){for(var m,h,T,y,d,t,a,e,o,u,n,l,p,g,v=this.keySize+6,r=this.invKeySchedule,i=this.invSBox,c=this.invSubMix,b=c[0],L=c[1],k=c[2],O=c[3],w=this.uint8ArrayToUint32Array_(S),x=w[0],P=w[1],F=w[2],M=w[3],B=new Int32Array(D),U=new Int32Array(B.length),G=this.networkToHostOrderSwap;s<B.length;){for(o=G(B[s]),u=G(B[s+1]),n=G(B[s+2]),l=G(B[s+3]),d=o^r[0],t=l^r[1],a=n^r[2],e=u^r[3],p=4,g=1;g<v;g++)m=b[d>>>24]^L[t>>16&255]^k[a>>8&255]^O[255&e]^r[p],h=b[t>>>24]^L[a>>16&255]^k[e>>8&255]^O[255&d]^r[p+1],T=b[a>>>24]^L[e>>16&255]^k[d>>8&255]^O[255&t]^r[p+2],y=b[e>>>24]^L[d>>16&255]^k[t>>8&255]^O[255&a]^r[p+3],d=m,t=h,a=T,e=y,p+=4;m=i[d>>>24]<<24^i[t>>16&255]<<16^i[a>>8&255]<<8^i[255&e]^r[p],h=i[t>>>24]<<24^i[a>>16&255]<<16^i[e>>8&255]<<8^i[255&d]^r[p+1],T=i[a>>>24]<<24^i[e>>16&255]<<16^i[d>>8&255]<<8^i[255&t]^r[p+2],y=i[e>>>24]<<24^i[d>>16&255]<<16^i[t>>8&255]<<8^i[255&a]^r[p+3],U[s]=G(m^x),U[s+1]=G(y^P),U[s+2]=G(T^F),U[s+3]=G(h^M),x=o,P=u,F=n,M=l,s+=4}return U.buffer},_}()},"./src/crypt/decrypter.ts":function(N,C,f){f.r(C),f.d(C,"default",function(){return s});var R=f("./src/crypt/aes-crypto.ts"),E=f("./src/crypt/fast-aes-key.ts"),A=f("./src/crypt/aes-decryptor.ts"),_=f("./src/utils/logger.ts"),I=f("./src/utils/mp4-tools.ts"),D=f("./src/utils/typed-array.ts"),s=function(){function S(h,T,y){var d=(y===void 0?{}:y).removePKCS7Padding,t=d===void 0||d;if(this.logEnabled=!0,this.observer=void 0,this.config=void 0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.observer=h,this.config=T,this.removePKCS7Padding=t,t)try{var a=self.crypto;a&&(this.subtle=a.subtle||a.webkitSubtle)}catch{}this.subtle===null&&(this.config.enableSoftwareAES=!0)}var m=S.prototype;return m.destroy=function(){this.observer=null},m.isSync=function(){return this.config.enableSoftwareAES},m.flush=function(){var h=this.currentResult;if(h){var T=new Uint8Array(h);return this.reset(),this.removePKCS7Padding?Object(A.removePadding)(T):T}this.reset()},m.reset=function(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)},m.decrypt=function(h,T,y,d){if(this.config.enableSoftwareAES){this.softwareDecrypt(new Uint8Array(h),T,y);var t=this.flush();t&&d(t.buffer)}else this.webCryptoDecrypt(new Uint8Array(h),T,y).then(d)},m.softwareDecrypt=function(h,T,y){var d=this.currentIV,t=this.currentResult,a=this.remainderData;this.logOnce("JS AES decrypt"),a&&(h=Object(I.appendUint8Array)(a,h),this.remainderData=null);var e=this.getValidChunk(h);if(!e.length)return null;d&&(y=d);var o=this.softwareDecrypter;o||(o=this.softwareDecrypter=new A.default),o.expandKey(T);var u=t;return this.currentResult=o.decrypt(e.buffer,0,y),this.currentIV=Object(D.sliceUint8)(e,-16).buffer,u||null},m.webCryptoDecrypt=function(h,T,y){var d=this,t=this.subtle;return this.key===T&&this.fastAesKey||(this.key=T,this.fastAesKey=new E.default(t,T)),this.fastAesKey.expandKey().then(function(a){return t?new R.default(t,y).decrypt(h.buffer,a):Promise.reject(new Error("web crypto not initialized"))}).catch(function(a){return d.onWebCryptoError(a,h,T,y)})},m.onWebCryptoError=function(h,T,y,d){return _.logger.warn("[decrypter.ts]: WebCrypto Error, disable WebCrypto API:",h),this.config.enableSoftwareAES=!0,this.logEnabled=!0,this.softwareDecrypt(T,y,d)},m.getValidChunk=function(h){var T=h,y=h.length-h.length%16;return y!==h.length&&(T=Object(D.sliceUint8)(h,0,y),this.remainderData=Object(D.sliceUint8)(h,y)),T},m.logOnce=function(h){this.logEnabled&&(_.logger.log("[decrypter.ts]: "+h),this.logEnabled=!1)},S}()},"./src/crypt/fast-aes-key.ts":function(N,C,f){f.r(C),f.d(C,"default",function(){return R});var R=function(){function E(A,_){this.subtle=void 0,this.key=void 0,this.subtle=A,this.key=_}return E.prototype.expandKey=function(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])},E}()},"./src/demux/aacdemuxer.ts":function(N,C,f){f.r(C);var R=f("./src/demux/base-audio-demuxer.ts"),E=f("./src/demux/adts.ts"),A=f("./src/utils/logger.ts"),_=f("./src/demux/id3.ts");function I(s,S){return(I=Object.setPrototypeOf||function(m,h){return m.__proto__=h,m})(s,S)}var D=function(s){var S,m;function h(y,d){var t;return(t=s.call(this)||this).observer=void 0,t.config=void 0,t.observer=y,t.config=d,t}m=s,(S=h).prototype=Object.create(m.prototype),S.prototype.constructor=S,I(S,m);var T=h.prototype;return T.resetInitSegment=function(y,d,t){s.prototype.resetInitSegment.call(this,y,d,t),this._audioTrack={container:"audio/adts",type:"audio",id:0,pid:-1,sequenceNumber:0,isAAC:!0,samples:[],manifestCodec:y,duration:t,inputTimeScale:9e4,dropped:0}},h.probe=function(y){if(!y)return!1;for(var d=(_.getID3Data(y,0)||[]).length,t=y.length;d<t;d++)if(E.probe(y,d))return A.logger.log("ADTS sync word found !"),!0;return!1},T.canParse=function(y,d){return E.canParse(y,d)},T.appendFrame=function(y,d,t){E.initTrackConfig(y,this.observer,d,t,y.manifestCodec);var a=E.appendFrame(y,d,t,this.initPTS,this.frameIndex);if(a&&a.missing===0)return a},h}(R.default);D.minProbeByteLength=9,C.default=D},"./src/demux/adts.ts":function(N,C,f){f.r(C),f.d(C,"getAudioConfig",function(){return _}),f.d(C,"isHeaderPattern",function(){return I}),f.d(C,"getHeaderLength",function(){return D}),f.d(C,"getFullFrameLength",function(){return s}),f.d(C,"canGetFrameLength",function(){return S}),f.d(C,"isHeader",function(){return m}),f.d(C,"canParse",function(){return h}),f.d(C,"probe",function(){return T}),f.d(C,"initTrackConfig",function(){return y}),f.d(C,"getFrameDuration",function(){return d}),f.d(C,"parseFrameHeader",function(){return t}),f.d(C,"appendFrame",function(){return a});var R=f("./src/utils/logger.ts"),E=f("./src/errors.ts"),A=f("./src/events.ts");function _(e,o,u,n){var l,p,g,v,r=navigator.userAgent.toLowerCase(),i=n,c=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];l=1+((192&o[u+2])>>>6);var b=(60&o[u+2])>>>2;if(!(b>c.length-1))return g=(1&o[u+2])<<2,g|=(192&o[u+3])>>>6,R.logger.log("manifest codec:"+n+", ADTS type:"+l+", samplingIndex:"+b),/firefox/i.test(r)?b>=6?(l=5,v=new Array(4),p=b-3):(l=2,v=new Array(2),p=b):r.indexOf("android")!==-1?(l=2,v=new Array(2),p=b):(l=5,v=new Array(4),n&&(n.indexOf("mp4a.40.29")!==-1||n.indexOf("mp4a.40.5")!==-1)||!n&&b>=6?p=b-3:((n&&n.indexOf("mp4a.40.2")!==-1&&(b>=6&&g===1||/vivaldi/i.test(r))||!n&&g===1)&&(l=2,v=new Array(2)),p=b)),v[0]=l<<3,v[0]|=(14&b)>>1,v[1]|=(1&b)<<7,v[1]|=g<<3,l===5&&(v[1]|=(14&p)>>1,v[2]=(1&p)<<7,v[2]|=8,v[3]=0),{config:v,samplerate:c[b],channelCount:g,codec:"mp4a.40."+l,manifestCodec:i};e.trigger(A.Events.ERROR,{type:E.ErrorTypes.MEDIA_ERROR,details:E.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:"+b})}function I(e,o){return e[o]===255&&(246&e[o+1])==240}function D(e,o){return 1&e[o+1]?7:9}function s(e,o){return(3&e[o+3])<<11|e[o+4]<<3|(224&e[o+5])>>>5}function S(e,o){return o+5<e.length}function m(e,o){return o+1<e.length&&I(e,o)}function h(e,o){return S(e,o)&&I(e,o)&&s(e,o)<=e.length-o}function T(e,o){if(m(e,o)){var u=D(e,o);if(o+u>=e.length)return!1;var n=s(e,o);if(n<=u)return!1;var l=o+n;return l===e.length||m(e,l)}return!1}function y(e,o,u,n,l){if(!e.samplerate){var p=_(o,u,n,l);if(!p)return;e.config=p.config,e.samplerate=p.samplerate,e.channelCount=p.channelCount,e.codec=p.codec,e.manifestCodec=p.manifestCodec,R.logger.log("parsed codec:"+e.codec+", rate:"+p.samplerate+", channels:"+p.channelCount)}}function d(e){return 9216e4/e}function t(e,o,u,n,l){var p=D(e,o),g=s(e,o);if((g-=p)>0)return{headerLength:p,frameLength:g,stamp:u+n*l}}function a(e,o,u,n,l){var p=t(o,u,n,l,d(e.samplerate));if(p){var g,v=p.frameLength,r=p.headerLength,i=p.stamp,c=r+v,b=Math.max(0,u+c-o.length);b?(g=new Uint8Array(c-r)).set(o.subarray(u+r,o.length),0):g=o.subarray(u+r,u+c);var L={unit:g,pts:i};return b||e.samples.push(L),{sample:L,length:c,missing:b}}}},"./src/demux/base-audio-demuxer.ts":function(N,C,f){f.r(C),f.d(C,"initPTSFn",function(){return s});var R=f("./src/polyfills/number.ts"),E=f("./src/demux/id3.ts"),A=f("./src/demux/dummy-demuxed-track.ts"),_=f("./src/utils/mp4-tools.ts"),I=f("./src/utils/typed-array.ts"),D=function(){function S(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.initPTS=null}var m=S.prototype;return m.resetInitSegment=function(h,T,y){this._id3Track={type:"id3",id:0,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}},m.resetTimeStamp=function(){},m.resetContiguity=function(){},m.canParse=function(h,T){return!1},m.appendFrame=function(h,T,y){},m.demux=function(h,T){this.cachedData&&(h=Object(_.appendUint8Array)(this.cachedData,h),this.cachedData=null);var y,d,t=E.getID3Data(h,0),a=t?t.length:0,e=this._audioTrack,o=this._id3Track,u=t?E.getTimeStamp(t):void 0,n=h.length;for(this.frameIndex!==0&&this.initPTS!==null||(this.initPTS=s(u,T)),t&&t.length>0&&o.samples.push({pts:this.initPTS,dts:this.initPTS,data:t}),d=this.initPTS;a<n;){if(this.canParse(h,a)){var l=this.appendFrame(e,h,a);l?(this.frameIndex++,d=l.sample.pts,y=a+=l.length):a=n}else E.canParse(h,a)?(t=E.getID3Data(h,a),o.samples.push({pts:d,dts:d,data:t}),y=a+=t.length):a++;if(a===n&&y!==n){var p=Object(I.sliceUint8)(h,y);this.cachedData?this.cachedData=Object(_.appendUint8Array)(this.cachedData,p):this.cachedData=p}}return{audioTrack:e,avcTrack:Object(A.dummyTrack)(),id3Track:o,textTrack:Object(A.dummyTrack)()}},m.demuxSampleAes=function(h,T,y){return Promise.reject(new Error("["+this+"] This demuxer does not support Sample-AES decryption"))},m.flush=function(h){var T=this.cachedData;return T&&(this.cachedData=null,this.demux(T,0)),this.frameIndex=0,{audioTrack:this._audioTrack,avcTrack:Object(A.dummyTrack)(),id3Track:this._id3Track,textTrack:Object(A.dummyTrack)()}},m.destroy=function(){},S}(),s=function(S,m){return Object(R.isFiniteNumber)(S)?90*S:9e4*m};C.default=D},"./src/demux/chunk-cache.ts":function(N,C,f){f.r(C),f.d(C,"default",function(){return R});var R=function(){function E(){this.chunks=[],this.dataLength=0}var A=E.prototype;return A.push=function(_){this.chunks.push(_),this.dataLength+=_.length},A.flush=function(){var _,I=this.chunks,D=this.dataLength;return I.length?(_=I.length===1?I[0]:function(s,S){for(var m=new Uint8Array(S),h=0,T=0;T<s.length;T++){var y=s[T];m.set(y,h),h+=y.length}return m}(I,D),this.reset(),_):new Uint8Array(0)},A.reset=function(){this.chunks.length=0,this.dataLength=0},E}()},"./src/demux/dummy-demuxed-track.ts":function(N,C,f){function R(){return{type:"",id:-1,pid:-1,inputTimeScale:9e4,sequenceNumber:-1,samples:[],dropped:0}}f.r(C),f.d(C,"dummyTrack",function(){return R})},"./src/demux/exp-golomb.ts":function(N,C,f){f.r(C);var R=f("./src/utils/logger.ts"),E=function(){function A(I){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=I,this.bytesAvailable=I.byteLength,this.word=0,this.bitsAvailable=0}var _=A.prototype;return _.loadWord=function(){var I=this.data,D=this.bytesAvailable,s=I.byteLength-D,S=new Uint8Array(4),m=Math.min(4,D);if(m===0)throw new Error("no bytes available");S.set(I.subarray(s,s+m)),this.word=new DataView(S.buffer).getUint32(0),this.bitsAvailable=8*m,this.bytesAvailable-=m},_.skipBits=function(I){var D;this.bitsAvailable>I?(this.word<<=I,this.bitsAvailable-=I):(I-=this.bitsAvailable,I-=(D=I>>3)>>3,this.bytesAvailable-=D,this.loadWord(),this.word<<=I,this.bitsAvailable-=I)},_.readBits=function(I){var D=Math.min(this.bitsAvailable,I),s=this.word>>>32-D;return I>32&&R.logger.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=D,this.bitsAvailable>0?this.word<<=D:this.bytesAvailable>0&&this.loadWord(),(D=I-D)>0&&this.bitsAvailable?s<<D|this.readBits(D):s},_.skipLZ=function(){var I;for(I=0;I<this.bitsAvailable;++I)if((this.word&2147483648>>>I)!=0)return this.word<<=I,this.bitsAvailable-=I,I;return this.loadWord(),I+this.skipLZ()},_.skipUEG=function(){this.skipBits(1+this.skipLZ())},_.skipEG=function(){this.skipBits(1+this.skipLZ())},_.readUEG=function(){var I=this.skipLZ();return this.readBits(I+1)-1},_.readEG=function(){var I=this.readUEG();return 1&I?1+I>>>1:-1*(I>>>1)},_.readBoolean=function(){return this.readBits(1)===1},_.readUByte=function(){return this.readBits(8)},_.readUShort=function(){return this.readBits(16)},_.readUInt=function(){return this.readBits(32)},_.skipScalingList=function(I){for(var D=8,s=8,S=0;S<I;S++)s!==0&&(s=(D+this.readEG()+256)%256),D=s===0?D:s},_.readSPS=function(){var I,D,s,S=0,m=0,h=0,T=0,y=this.readUByte.bind(this),d=this.readBits.bind(this),t=this.readUEG.bind(this),a=this.readBoolean.bind(this),e=this.skipBits.bind(this),o=this.skipEG.bind(this),u=this.skipUEG.bind(this),n=this.skipScalingList.bind(this);y();var l=y();if(d(5),e(3),y(),u(),l===100||l===110||l===122||l===244||l===44||l===83||l===86||l===118||l===128){var p=t();if(p===3&&e(1),u(),u(),e(1),a())for(D=p!==3?8:12,s=0;s<D;s++)a()&&n(s<6?16:64)}u();var g=t();if(g===0)t();else if(g===1)for(e(1),o(),o(),I=t(),s=0;s<I;s++)o();u(),e(1);var v=t(),r=t(),i=d(1);i===0&&e(1),e(1),a()&&(S=t(),m=t(),h=t(),T=t());var c=[1,1];if(a()&&a())switch(y()){case 1:c=[1,1];break;case 2:c=[12,11];break;case 3:c=[10,11];break;case 4:c=[16,11];break;case 5:c=[40,33];break;case 6:c=[24,11];break;case 7:c=[20,11];break;case 8:c=[32,11];break;case 9:c=[80,33];break;case 10:c=[18,11];break;case 11:c=[15,11];break;case 12:c=[64,33];break;case 13:c=[160,99];break;case 14:c=[4,3];break;case 15:c=[3,2];break;case 16:c=[2,1];break;case 255:c=[y()<<8|y(),y()<<8|y()]}return{width:Math.ceil(16*(v+1)-2*S-2*m),height:(2-i)*(r+1)*16-(i?2:4)*(h+T),pixelRatio:c}},_.readSliceType=function(){return this.readUByte(),this.readUEG(),this.readUEG()},A}();C.default=E},"./src/demux/id3.ts":function(N,C,f){f.r(C),f.d(C,"isHeader",function(){return E}),f.d(C,"isFooter",function(){return A}),f.d(C,"getID3Data",function(){return _}),f.d(C,"canParse",function(){return D}),f.d(C,"getTimeStamp",function(){return s}),f.d(C,"isTimeStampFrame",function(){return S}),f.d(C,"getID3Frames",function(){return h}),f.d(C,"decodeFrame",function(){return T}),f.d(C,"utf8ArrayToStr",function(){return e}),f.d(C,"testables",function(){return o});var R,E=function(u,n){return n+10<=u.length&&u[n]===73&&u[n+1]===68&&u[n+2]===51&&u[n+3]<255&&u[n+4]<255&&u[n+6]<128&&u[n+7]<128&&u[n+8]<128&&u[n+9]<128},A=function(u,n){return n+10<=u.length&&u[n]===51&&u[n+1]===68&&u[n+2]===73&&u[n+3]<255&&u[n+4]<255&&u[n+6]<128&&u[n+7]<128&&u[n+8]<128&&u[n+9]<128},_=function(u,n){for(var l=n,p=0;E(u,n);)p+=10,p+=I(u,n+6),A(u,n+10)&&(p+=10),n+=p;if(p>0)return u.subarray(l,l+p)},I=function(u,n){var l=0;return l=(127&u[n])<<21,l|=(127&u[n+1])<<14,l|=(127&u[n+2])<<7,l|=127&u[n+3]},D=function(u,n){return E(u,n)&&I(u,n+6)+10<=u.length-n},s=function(u){for(var n=h(u),l=0;l<n.length;l++){var p=n[l];if(S(p))return a(p)}},S=function(u){return u&&u.key==="PRIV"&&u.info==="com.apple.streaming.transportStreamTimestamp"},m=function(u){var n=String.fromCharCode(u[0],u[1],u[2],u[3]),l=I(u,4);return{type:n,size:l,data:u.subarray(10,10+l)}},h=function(u){for(var n=0,l=[];E(u,n);){for(var p=I(u,n+6),g=(n+=10)+p;n+8<g;){var v=m(u.subarray(n)),r=T(v);r&&l.push(r),n+=v.size+10}A(u,n)&&(n+=10)}return l},T=function(u){return u.type==="PRIV"?y(u):u.type[0]==="W"?t(u):d(u)},y=function(u){if(!(u.size<2)){var n=e(u.data,!0),l=new Uint8Array(u.data.subarray(n.length+1));return{key:u.type,info:n,data:l.buffer}}},d=function(u){if(!(u.size<2)){if(u.type==="TXXX"){var n=1,l=e(u.data.subarray(n),!0);n+=l.length+1;var p=e(u.data.subarray(n));return{key:u.type,info:l,data:p}}var g=e(u.data.subarray(1));return{key:u.type,data:g}}},t=function(u){if(u.type==="WXXX"){if(u.size<2)return;var n=1,l=e(u.data.subarray(n),!0);n+=l.length+1;var p=e(u.data.subarray(n));return{key:u.type,info:l,data:p}}var g=e(u.data);return{key:u.type,data:g}},a=function(u){if(u.data.byteLength===8){var n=new Uint8Array(u.data),l=1&n[3],p=(n[4]<<23)+(n[5]<<15)+(n[6]<<7)+n[7];return p/=45,l&&(p+=4772185884e-2),Math.round(p)}},e=function(u,n){n===void 0&&(n=!1);var l=(R||self.TextDecoder===void 0||(R=new self.TextDecoder("utf-8")),R);if(l){var p=l.decode(u);if(n){var g=p.indexOf("\0");return g!==-1?p.substring(0,g):p}return p.replace(/\0/g,"")}for(var v,r,i,c=u.length,b="",L=0;L<c;){if((v=u[L++])===0&&n)return b;if(v!==0&&v!==3)switch(v>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:b+=String.fromCharCode(v);break;case 12:case 13:r=u[L++],b+=String.fromCharCode((31&v)<<6|63&r);break;case 14:r=u[L++],i=u[L++],b+=String.fromCharCode((15&v)<<12|(63&r)<<6|(63&i)<<0)}}return b},o={decodeTextFrame:d}},"./src/demux/mp3demuxer.ts":function(N,C,f){f.r(C);var R=f("./src/demux/base-audio-demuxer.ts"),E=f("./src/demux/id3.ts"),A=f("./src/utils/logger.ts"),_=f("./src/demux/mpegaudio.ts");function I(s,S){return(I=Object.setPrototypeOf||function(m,h){return m.__proto__=h,m})(s,S)}var D=function(s){var S,m;function h(){return s.apply(this,arguments)||this}m=s,(S=h).prototype=Object.create(m.prototype),S.prototype.constructor=S,I(S,m);var T=h.prototype;return T.resetInitSegment=function(y,d,t){s.prototype.resetInitSegment.call(this,y,d,t),this._audioTrack={container:"audio/mpeg",type:"audio",id:0,pid:-1,sequenceNumber:0,isAAC:!1,samples:[],manifestCodec:y,duration:t,inputTimeScale:9e4,dropped:0}},h.probe=function(y){if(!y)return!1;for(var d=(E.getID3Data(y,0)||[]).length,t=y.length;d<t;d++)if(_.probe(y,d))return A.logger.log("MPEG Audio sync word found !"),!0;return!1},T.canParse=function(y,d){return _.canParse(y,d)},T.appendFrame=function(y,d,t){if(this.initPTS!==null)return _.appendFrame(y,d,t,this.initPTS,this.frameIndex)},h}(R.default);D.minProbeByteLength=4,C.default=D},"./src/demux/mp4demuxer.ts":function(N,C,f){f.r(C);var R=f("./src/utils/mp4-tools.ts"),E=f("./src/demux/dummy-demuxed-track.ts"),A=function(){function _(D,s){this.remainderData=null,this.config=void 0,this.config=s}var I=_.prototype;return I.resetTimeStamp=function(){},I.resetInitSegment=function(){},I.resetContiguity=function(){},_.probe=function(D){return Object(R.findBox)({data:D,start:0,end:Math.min(D.length,16384)},["moof"]).length>0},I.demux=function(D){var s=D,S=Object(E.dummyTrack)();if(this.config.progressive){this.remainderData&&(s=Object(R.appendUint8Array)(this.remainderData,D));var m=Object(R.segmentValidRange)(s);this.remainderData=m.remainder,S.samples=m.valid||new Uint8Array}else S.samples=s;return{audioTrack:Object(E.dummyTrack)(),avcTrack:S,id3Track:Object(E.dummyTrack)(),textTrack:Object(E.dummyTrack)()}},I.flush=function(){var D=Object(E.dummyTrack)();return D.samples=this.remainderData||new Uint8Array,this.remainderData=null,{audioTrack:Object(E.dummyTrack)(),avcTrack:D,id3Track:Object(E.dummyTrack)(),textTrack:Object(E.dummyTrack)()}},I.demuxSampleAes=function(D,s,S){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))},I.destroy=function(){},_}();A.minProbeByteLength=1024,C.default=A},"./src/demux/mpegaudio.ts":function(N,C,f){f.r(C),f.d(C,"appendFrame",function(){return D}),f.d(C,"parseHeader",function(){return s}),f.d(C,"isHeaderPattern",function(){return S}),f.d(C,"isHeader",function(){return m}),f.d(C,"canParse",function(){return h}),f.d(C,"probe",function(){return T});var R=null,E=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],A=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],_=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],I=[0,1,1,4];function D(y,d,t,a,e){if(!(t+24>d.length)){var o=s(d,t);if(o&&t+o.frameLength<=d.length){var u=a+e*(9e4*o.samplesPerFrame/o.sampleRate),n={unit:d.subarray(t,t+o.frameLength),pts:u,dts:u};return y.config=[],y.channelCount=o.channelCount,y.samplerate=o.sampleRate,y.samples.push(n),{sample:n,length:o.frameLength,missing:0}}}}function s(y,d){var t=y[d+1]>>3&3,a=y[d+1]>>1&3,e=y[d+2]>>4&15,o=y[d+2]>>2&3;if(t!==1&&e!==0&&e!==15&&o!==3){var u=y[d+2]>>1&1,n=y[d+3]>>6,l=1e3*E[14*(t===3?3-a:a===3?3:4)+e-1],p=A[3*(t===3?0:t===2?1:2)+o],g=n===3?1:2,v=_[t][a],r=I[a],i=8*v*r,c=Math.floor(v*l/p+u)*r;if(R===null){var b=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);R=b?parseInt(b[1]):0}return!!R&&R<=87&&a===2&&l>=224e3&&n===0&&(y[d+3]=128|y[d+3]),{sampleRate:p,channelCount:g,frameLength:c,samplesPerFrame:i}}}function S(y,d){return y[d]===255&&(224&y[d+1])==224&&(6&y[d+1])!=0}function m(y,d){return d+1<y.length&&S(y,d)}function h(y,d){return S(y,d)&&4<=y.length-d}function T(y,d){if(d+1<y.length&&S(y,d)){var t=s(y,d),a=4;t!=null&&t.frameLength&&(a=t.frameLength);var e=d+a;return e===y.length||m(y,e)}return!1}},"./src/demux/sample-aes.ts":function(N,C,f){f.r(C);var R=f("./src/crypt/decrypter.ts"),E=f("./src/demux/tsdemuxer.ts"),A=function(){function _(D,s,S){this.keyData=void 0,this.decrypter=void 0,this.keyData=S,this.decrypter=new R.default(D,s,{removePKCS7Padding:!1})}var I=_.prototype;return I.decryptBuffer=function(D,s){this.decrypter.decrypt(D,this.keyData.key.buffer,this.keyData.iv.buffer,s)},I.decryptAacSample=function(D,s,S,m){var h=D[s].unit,T=h.subarray(16,h.length-h.length%16),y=T.buffer.slice(T.byteOffset,T.byteOffset+T.length),d=this;this.decryptBuffer(y,function(t){var a=new Uint8Array(t);h.set(a,16),m||d.decryptAacSamples(D,s+1,S)})},I.decryptAacSamples=function(D,s,S){for(;;s++){if(s>=D.length)return void S();if(!(D[s].unit.length<32)){var m=this.decrypter.isSync();if(this.decryptAacSample(D,s,S,m),!m)return}}},I.getAvcEncryptedData=function(D){for(var s=16*Math.floor((D.length-48)/160)+16,S=new Int8Array(s),m=0,h=32;h<=D.length-16;h+=160,m+=16)S.set(D.subarray(h,h+16),m);return S},I.getAvcDecryptedUnit=function(D,s){for(var S=new Uint8Array(s),m=0,h=32;h<=D.length-16;h+=160,m+=16)D.set(S.subarray(m,m+16),h);return D},I.decryptAvcSample=function(D,s,S,m,h,T){var y=Object(E.discardEPB)(h.data),d=this.getAvcEncryptedData(y),t=this;this.decryptBuffer(d.buffer,function(a){h.data=t.getAvcDecryptedUnit(y,a),T||t.decryptAvcSamples(D,s,S+1,m)})},I.decryptAvcSamples=function(D,s,S,m){if(D instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;s++,S=0){if(s>=D.length)return void m();for(var h=D[s].units;!(S>=h.length);S++){var T=h[S];if(!(T.data.length<=48||T.type!==1&&T.type!==5)){var y=this.decrypter.isSync();if(this.decryptAvcSample(D,s,S,m,T,y),!y)return}}}},_}();C.default=A},"./src/demux/transmuxer-interface.ts":function(N,C,f){f.r(C),f.d(C,"default",function(){return m});var R=f("./node_modules/webworkify-webpack/index.js"),E=f("./src/events.ts"),A=f("./src/demux/transmuxer.ts"),_=f("./src/utils/logger.ts"),I=f("./src/errors.ts"),D=f("./src/utils/mediasource-helper.ts"),s=f("./node_modules/eventemitter3/index.js"),S=Object(D.getMediaSource)()||{isTypeSupported:function(){return!1}},m=function(){function h(y,d,t,a){var e=this;this.hls=void 0,this.id=void 0,this.observer=void 0,this.frag=null,this.part=null,this.worker=void 0,this.onwmsg=void 0,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0,this.hls=y,this.id=d,this.onTransmuxComplete=t,this.onFlush=a;var o=y.config,u=function(g,v){(v=v||{}).frag=e.frag,v.id=e.id,y.trigger(g,v)};this.observer=new s.EventEmitter,this.observer.on(E.Events.FRAG_DECRYPTED,u),this.observer.on(E.Events.ERROR,u);var n={mp4:S.isTypeSupported("video/mp4"),mpeg:S.isTypeSupported("audio/mpeg"),mp3:S.isTypeSupported('audio/mp4; codecs="mp3"')},l=navigator.vendor;if(o.enableWorker&&typeof Worker!="undefined"){var p;_.logger.log("demuxing in webworker");try{p=this.worker=R("./src/demux/transmuxer-worker.ts"),this.onwmsg=this.onWorkerMessage.bind(this),p.addEventListener("message",this.onwmsg),p.onerror=function(g){y.trigger(E.Events.ERROR,{type:I.ErrorTypes.OTHER_ERROR,details:I.ErrorDetails.INTERNAL_EXCEPTION,fatal:!0,event:"demuxerWorker",error:new Error(g.message+"  ("+g.filename+":"+g.lineno+")")})},p.postMessage({cmd:"init",typeSupported:n,vendor:l,id:d,config:JSON.stringify(o)})}catch(g){_.logger.warn("Error in worker:",g),_.logger.error("Error while initializing DemuxerWorker, fallback to inline"),p&&self.URL.revokeObjectURL(p.objectURL),this.transmuxer=new A.default(this.observer,n,o,l,d),this.worker=null}}else this.transmuxer=new A.default(this.observer,n,o,l,d)}var T=h.prototype;return T.destroy=function(){var y=this.worker;if(y)y.removeEventListener("message",this.onwmsg),y.terminate(),this.worker=null;else{var d=this.transmuxer;d&&(d.destroy(),this.transmuxer=null)}var t=this.observer;t&&t.removeAllListeners(),this.observer=null},T.push=function(y,d,t,a,e,o,u,n,l,p){var g=this;l.transmuxing.start=self.performance.now();var v=this.transmuxer,r=this.worker,i=o?o.start:e.start,c=e.decryptdata,b=this.frag,L=!(b&&e.cc===b.cc),k=!(b&&l.level===b.level),O=b?l.sn-b.sn:-1,w=this.part?l.part-this.part.index:1,x=!k&&(O===1||O===0&&w===1),P=self.performance.now();(k||O||e.stats.parsing.start===0)&&(e.stats.parsing.start=P),!o||!w&&x||(o.stats.parsing.start=P);var F=new A.TransmuxState(L,x,n,k,i);if(!x||L){_.logger.log("[transmuxer-interface, "+e.type+"]: Starting new transmux session for sn: "+l.sn+" p: "+l.part+" level: "+l.level+" id: "+l.id+`
        discontinuity: `+L+`
        trackSwitch: `+k+`
        contiguous: `+x+`
        accurateTimeOffset: `+n+`
        timeOffset: `+i);var M=new A.TransmuxConfig(t,a,d,u,p);this.configureTransmuxer(M)}if(this.frag=e,this.part=o,r)r.postMessage({cmd:"demux",data:y,decryptdata:c,chunkMeta:l,state:F},y instanceof ArrayBuffer?[y]:[]);else if(v){var B=v.push(y,c,l,F);Object(A.isPromise)(B)?B.then(function(U){g.handleTransmuxComplete(U)}):this.handleTransmuxComplete(B)}},T.flush=function(y){var d=this;y.transmuxing.start=self.performance.now();var t=this.transmuxer,a=this.worker;if(a)a.postMessage({cmd:"flush",chunkMeta:y});else if(t){var e=t.flush(y);Object(A.isPromise)(e)?e.then(function(o){d.handleFlushResult(o,y)}):this.handleFlushResult(e,y)}},T.handleFlushResult=function(y,d){var t=this;y.forEach(function(a){t.handleTransmuxComplete(a)}),this.onFlush(d)},T.onWorkerMessage=function(y){var d=y.data,t=this.hls;switch(d.event){case"init":self.URL.revokeObjectURL(this.worker.objectURL);break;case"transmuxComplete":this.handleTransmuxComplete(d.data);break;case"flush":this.onFlush(d.data);break;default:d.data=d.data||{},d.data.frag=this.frag,d.data.id=this.id,t.trigger(d.event,d.data)}},T.configureTransmuxer=function(y){var d=this.worker,t=this.transmuxer;d?d.postMessage({cmd:"configure",config:y}):t&&t.configure(y)},T.handleTransmuxComplete=function(y){y.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(y)},h}()},"./src/demux/transmuxer-worker.ts":function(N,C,f){f.r(C),f.d(C,"default",function(){return I});var R=f("./src/demux/transmuxer.ts"),E=f("./src/events.ts"),A=f("./src/utils/logger.ts"),_=f("./node_modules/eventemitter3/index.js");function I(m){var h=new _.EventEmitter,T=function(y,d){m.postMessage({event:y,data:d})};h.on(E.Events.FRAG_DECRYPTED,T),h.on(E.Events.ERROR,T),m.addEventListener("message",function(y){var d=y.data;switch(d.cmd){case"init":var t=JSON.parse(d.config);m.transmuxer=new R.default(h,d.typeSupported,t,d.vendor,d.id),Object(A.enableLogs)(t.debug),T("init",null);break;case"configure":m.transmuxer.configure(d.config);break;case"demux":var a=m.transmuxer.push(d.data,d.decryptdata,d.chunkMeta,d.state);Object(R.isPromise)(a)?a.then(function(u){D(m,u)}):D(m,a);break;case"flush":var e=d.chunkMeta,o=m.transmuxer.flush(e);Object(R.isPromise)(o)?o.then(function(u){S(m,u,e)}):S(m,o,e)}})}function D(m,h){if((T=h.remuxResult).audio||T.video||T.text||T.id3||T.initSegment){var T,y=[],d=h.remuxResult,t=d.audio,a=d.video;t&&s(y,t),a&&s(y,a),m.postMessage({event:"transmuxComplete",data:h},y)}}function s(m,h){h.data1&&m.push(h.data1.buffer),h.data2&&m.push(h.data2.buffer)}function S(m,h,T){h.forEach(function(y){D(m,y)}),m.postMessage({event:"flush",data:T})}},"./src/demux/transmuxer.ts":function(N,C,f){f.r(C),f.d(C,"default",function(){return e}),f.d(C,"isPromise",function(){return u}),f.d(C,"TransmuxConfig",function(){return n}),f.d(C,"TransmuxState",function(){return l});var R,E=f("./src/events.ts"),A=f("./src/errors.ts"),_=f("./src/crypt/decrypter.ts"),I=f("./src/demux/aacdemuxer.ts"),D=f("./src/demux/mp4demuxer.ts"),s=f("./src/demux/tsdemuxer.ts"),S=f("./src/demux/mp3demuxer.ts"),m=f("./src/remux/mp4-remuxer.ts"),h=f("./src/remux/passthrough-remuxer.ts"),T=f("./src/demux/chunk-cache.ts"),y=f("./src/utils/mp4-tools.ts"),d=f("./src/utils/logger.ts");try{R=self.performance.now.bind(self.performance)}catch{d.logger.debug("Unable to use Performance API on this environment"),R=self.Date.now}var t=[{demux:s.default,remux:m.default},{demux:D.default,remux:h.default},{demux:I.default,remux:m.default},{demux:S.default,remux:m.default}],a=1024;t.forEach(function(p){var g=p.demux;a=Math.max(a,g.minProbeByteLength)});var e=function(){function p(v,r,i,c,b){this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.vendor=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.cache=new T.default,this.observer=v,this.typeSupported=r,this.config=i,this.vendor=c,this.id=b}var g=p.prototype;return g.configure=function(v){this.transmuxConfig=v,this.decrypter&&this.decrypter.reset()},g.push=function(v,r,i,c){var b=this,L=i.transmuxing;L.executeStart=R();var k=new Uint8Array(v),O=this.cache,w=this.config,x=this.currentTransmuxState,P=this.transmuxConfig;c&&(this.currentTransmuxState=c);var F=function(at,nt){var ct=null;return at.byteLength>0&&nt!=null&&nt.key!=null&&nt.iv!==null&&nt.method!=null&&(ct=nt),ct}(k,r);if(F&&F.method==="AES-128"){var M=this.getDecrypter();if(!w.enableSoftwareAES)return this.decryptionPromise=M.webCryptoDecrypt(k,F.key.buffer,F.iv.buffer).then(function(at){var nt=b.push(at,null,i);return b.decryptionPromise=null,nt}),this.decryptionPromise;var B=M.softwareDecrypt(k,F.key.buffer,F.iv.buffer);if(!B)return L.executeEnd=R(),o(i);k=new Uint8Array(B)}var U=c||x,G=U.contiguous,V=U.discontinuity,H=U.trackSwitch,Y=U.accurateTimeOffset,W=U.timeOffset,q=P.audioCodec,J=P.videoCodec,rt=P.defaultInitPts,it=P.duration,Q=P.initSegmentData;if((V||H)&&this.resetInitSegment(Q,q,J,it),V&&this.resetInitialTimestamp(rt),G||this.resetContiguity(),this.needsProbing(k,V,H)){if(O.dataLength){var st=O.flush();k=Object(y.appendUint8Array)(st,k)}this.configureTransmuxer(k,P)}var $=this.transmux(k,F,W,Y,i),et=this.currentTransmuxState;return et.contiguous=!0,et.discontinuity=!1,et.trackSwitch=!1,L.executeEnd=R(),$},g.flush=function(v){var r=this,i=v.transmuxing;i.executeStart=R();var c=this.decrypter,b=this.cache,L=this.currentTransmuxState,k=this.decryptionPromise;if(k)return k.then(function(){return r.flush(v)});var O=[],w=L.timeOffset;if(c){var x=c.flush();x&&O.push(this.push(x,null,v))}var P=b.dataLength;b.reset();var F=this.demuxer,M=this.remuxer;if(!F||!M)return P>=a&&this.observer.emit(E.Events.ERROR,E.Events.ERROR,{type:A.ErrorTypes.MEDIA_ERROR,details:A.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"no demux matching with content found"}),i.executeEnd=R(),[o(v)];var B=F.flush(w);return u(B)?B.then(function(U){return r.flushRemux(O,U,v),O}):(this.flushRemux(O,B,v),O)},g.flushRemux=function(v,r,i){var c=r.audioTrack,b=r.avcTrack,L=r.id3Track,k=r.textTrack,O=this.currentTransmuxState,w=O.accurateTimeOffset,x=O.timeOffset;d.logger.log("[transmuxer.ts]: Flushed fragment "+i.sn+(i.part>-1?" p: "+i.part:"")+" of level "+i.level);var P=this.remuxer.remux(c,b,L,k,x,w,!0,this.id);v.push({remuxResult:P,chunkMeta:i}),i.transmuxing.executeEnd=R()},g.resetInitialTimestamp=function(v){var r=this.demuxer,i=this.remuxer;r&&i&&(r.resetTimeStamp(v),i.resetTimeStamp(v))},g.resetContiguity=function(){var v=this.demuxer,r=this.remuxer;v&&r&&(v.resetContiguity(),r.resetNextTimestamp())},g.resetInitSegment=function(v,r,i,c){var b=this.demuxer,L=this.remuxer;b&&L&&(b.resetInitSegment(r,i,c),L.resetInitSegment(v,r,i))},g.destroy=function(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)},g.transmux=function(v,r,i,c,b){return r&&r.method==="SAMPLE-AES"?this.transmuxSampleAes(v,r,i,c,b):this.transmuxUnencrypted(v,i,c,b)},g.transmuxUnencrypted=function(v,r,i,c){var b=this.demuxer.demux(v,r,!1,!this.config.progressive),L=b.audioTrack,k=b.avcTrack,O=b.id3Track,w=b.textTrack;return{remuxResult:this.remuxer.remux(L,k,O,w,r,i,!1,this.id),chunkMeta:c}},g.transmuxSampleAes=function(v,r,i,c,b){var L=this;return this.demuxer.demuxSampleAes(v,r,i).then(function(k){return{remuxResult:L.remuxer.remux(k.audioTrack,k.avcTrack,k.id3Track,k.textTrack,i,c,!1,L.id),chunkMeta:b}})},g.configureTransmuxer=function(v,r){for(var i,c=this.config,b=this.observer,L=this.typeSupported,k=this.vendor,O=r.audioCodec,w=r.defaultInitPts,x=r.duration,P=r.initSegmentData,F=r.videoCodec,M=0,B=t.length;M<B;M++)if(t[M].demux.probe(v)){i=t[M];break}i||(d.logger.warn("Failed to find demuxer by probing frag, treating as mp4 passthrough"),i={demux:D.default,remux:h.default});var U=this.demuxer,G=this.remuxer,V=i.remux,H=i.demux;G&&G instanceof V||(this.remuxer=new V(b,c,L,k)),U&&U instanceof H||(this.demuxer=new H(b,c,L),this.probe=H.probe),this.resetInitSegment(P,O,F,x),this.resetInitialTimestamp(w)},g.needsProbing=function(v,r,i){return!this.demuxer||!this.remuxer||r||i},g.getDecrypter=function(){var v=this.decrypter;return v||(v=this.decrypter=new _.default(this.observer,this.config)),v},p}(),o=function(p){return{remuxResult:{},chunkMeta:p}};function u(p){return"then"in p&&p.then instanceof Function}var n=function(p,g,v,r,i){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=p,this.videoCodec=g,this.initSegmentData=v,this.duration=r,this.defaultInitPts=i},l=function(p,g,v,r,i){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.discontinuity=p,this.contiguous=g,this.accurateTimeOffset=v,this.trackSwitch=r,this.timeOffset=i}},"./src/demux/tsdemuxer.ts":function(N,C,f){f.r(C),f.d(C,"discardEPB",function(){return u});var R=f("./src/demux/adts.ts"),E=f("./src/demux/mpegaudio.ts"),A=f("./src/demux/exp-golomb.ts"),_=f("./src/demux/id3.ts"),I=f("./src/demux/sample-aes.ts"),D=f("./src/events.ts"),s=f("./src/utils/mp4-tools.ts"),S=f("./src/utils/logger.ts"),m=f("./src/errors.ts"),h={video:1,audio:2,id3:3,text:4},T=function(){function n(p,g,v){this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._duration=0,this.aacLastPTS=null,this._initPTS=null,this._initDTS=null,this._pmtId=-1,this._avcTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.observer=p,this.config=g,this.typeSupported=v}n.probe=function(p){var g=n.syncOffset(p);return!(g<0||(g&&S.logger.warn("MPEG2-TS detected but first sync word found @ offset "+g+", junk ahead ?"),0))},n.syncOffset=function(p){for(var g=Math.min(1e3,p.length-564),v=0;v<g;){if(p[v]===71&&p[v+188]===71&&p[v+376]===71)return v;v++}return-1},n.createTrack=function(p,g){return{container:p==="video"||p==="audio"?"video/mp2t":void 0,type:p,id:h[p],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:p==="audio"?g:void 0}};var l=n.prototype;return l.resetInitSegment=function(p,g,v){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack=n.createTrack("video",v),this._audioTrack=n.createTrack("audio",v),this._id3Track=n.createTrack("id3",v),this._txtTrack=n.createTrack("text",v),this._audioTrack.isAAC=!0,this.aacOverFlow=null,this.aacLastPTS=null,this.avcSample=null,this.audioCodec=p,this.videoCodec=g,this._duration=v},l.resetTimeStamp=function(){},l.resetContiguity=function(){var p=this._audioTrack,g=this._avcTrack,v=this._id3Track;p&&(p.pesData=null),g&&(g.pesData=null),v&&(v.pesData=null),this.aacOverFlow=null,this.aacLastPTS=null},l.demux=function(p,g,v,r){var i;v===void 0&&(v=!1),r===void 0&&(r=!1),v||(this.sampleAes=null);var c=this._avcTrack,b=this._audioTrack,L=this._id3Track,k=c.pid,O=c.pesData,w=b.pid,x=L.pid,P=b.pesData,F=L.pesData,M=!1,B=this.pmtParsed,U=this._pmtId,G=p.length;if(this.remainderData&&(G=(p=Object(s.appendUint8Array)(this.remainderData,p)).length,this.remainderData=null),G<188&&!r)return this.remainderData=p,{audioTrack:b,avcTrack:c,id3Track:L,textTrack:this._txtTrack};var V=Math.max(0,n.syncOffset(p));(G-=(G+V)%188)<p.byteLength&&!r&&(this.remainderData=new Uint8Array(p.buffer,G,p.buffer.byteLength-G));for(var H=V;H<G;H+=188)if(p[H]===71){var Y=!!(64&p[H+1]),W=((31&p[H+1])<<8)+p[H+2],q=void 0;if((48&p[H+3])>>4>1){if((q=H+5+p[H+4])===H+188)continue}else q=H+4;switch(W){case k:Y&&(O&&(i=a(O))&&this.parseAVCPES(i,!1),O={data:[],size:0}),O&&(O.data.push(p.subarray(q,H+188)),O.size+=H+188-q);break;case w:Y&&(P&&(i=a(P))&&(b.isAAC?this.parseAACPES(i):this.parseMPEGPES(i)),P={data:[],size:0}),P&&(P.data.push(p.subarray(q,H+188)),P.size+=H+188-q);break;case x:Y&&(F&&(i=a(F))&&this.parseID3PES(i),F={data:[],size:0}),F&&(F.data.push(p.subarray(q,H+188)),F.size+=H+188-q);break;case 0:Y&&(q+=p[q]+1),U=this._pmtId=d(p,q);break;case U:Y&&(q+=p[q]+1);var J=t(p,q,this.typeSupported.mpeg===!0||this.typeSupported.mp3===!0,v);(k=J.avc)>0&&(c.pid=k),(w=J.audio)>0&&(b.pid=w,b.isAAC=J.isAAC),(x=J.id3)>0&&(L.pid=x),M&&!B&&(S.logger.log("reparse from beginning"),M=!1,H=V-188),B=this.pmtParsed=!0;break;case 17:case 8191:break;default:M=!0}}else this.observer.emit(D.Events.ERROR,D.Events.ERROR,{type:m.ErrorTypes.MEDIA_ERROR,details:m.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"TS packet did not start with 0x47"});c.pesData=O,b.pesData=P,L.pesData=F;var rt={audioTrack:b,avcTrack:c,id3Track:L,textTrack:this._txtTrack};return r&&this.extractRemainingSamples(rt),rt},l.flush=function(){var p,g=this.remainderData;return this.remainderData=null,p=g?this.demux(g,-1,!1,!0):{audioTrack:this._audioTrack,avcTrack:this._avcTrack,textTrack:this._txtTrack,id3Track:this._id3Track},this.extractRemainingSamples(p),this.sampleAes?this.decrypt(p,this.sampleAes):p},l.extractRemainingSamples=function(p){var g,v=p.audioTrack,r=p.avcTrack,i=p.id3Track,c=r.pesData,b=v.pesData,L=i.pesData;c&&(g=a(c))?(this.parseAVCPES(g,!0),r.pesData=null):r.pesData=c,b&&(g=a(b))?(v.isAAC?this.parseAACPES(g):this.parseMPEGPES(g),v.pesData=null):(b!=null&&b.size&&S.logger.log("last AAC PES packet truncated,might overlap between fragments"),v.pesData=b),L&&(g=a(L))?(this.parseID3PES(g),i.pesData=null):i.pesData=L},l.demuxSampleAes=function(p,g,v){var r=this.demux(p,v,!0,!this.config.progressive),i=this.sampleAes=new I.default(this.observer,this.config,g);return this.decrypt(r,i)},l.decrypt=function(p,g){return new Promise(function(v){var r=p.audioTrack,i=p.avcTrack;r.samples&&r.isAAC?g.decryptAacSamples(r.samples,0,function(){i.samples?g.decryptAvcSamples(i.samples,0,0,function(){v(p)}):v(p)}):i.samples&&g.decryptAvcSamples(i.samples,0,0,function(){v(p)})})},l.destroy=function(){this._initPTS=this._initDTS=null,this._duration=0},l.parseAVCPES=function(p,g){var v,r=this,i=this._avcTrack,c=this.parseAVCNALu(p.data),b=this.avcSample,L=!1;p.data=null,b&&c.length&&!i.audFound&&(e(b,i),b=this.avcSample=y(!1,p.pts,p.dts,"")),c.forEach(function(k){switch(k.type){case 1:v=!0,b||(b=r.avcSample=y(!0,p.pts,p.dts,"")),b.frame=!0;var O=k.data;if(L&&O.length>4){var w=new A.default(O).readSliceType();w!==2&&w!==4&&w!==7&&w!==9||(b.key=!0)}break;case 5:v=!0,b||(b=r.avcSample=y(!0,p.pts,p.dts,"")),b.key=!0,b.frame=!0;break;case 6:v=!0;var x=new A.default(u(k.data));x.readUByte();for(var P=0,F=0,M=!1,B=0;!M&&x.bytesAvailable>1;){P=0;do P+=B=x.readUByte();while(B===255);F=0;do F+=B=x.readUByte();while(B===255);if(P===4&&x.bytesAvailable!==0){if(M=!0,x.readUByte()===181&&x.readUShort()===49&&x.readUInt()===1195456820&&x.readUByte()===3){for(var U=x.readUByte(),G=31&U,V=[U,x.readUByte()],H=0;H<G;H++)V.push(x.readUByte()),V.push(x.readUByte()),V.push(x.readUByte());o(r._txtTrack.samples,{type:3,pts:p.pts,bytes:V})}}else if(P===5&&x.bytesAvailable!==0){if(M=!0,F>16){for(var Y=[],W=0;W<16;W++)Y.push(x.readUByte().toString(16)),W!==3&&W!==5&&W!==7&&W!==9||Y.push("-");for(var q=F-16,J=new Uint8Array(q),rt=0;rt<q;rt++)J[rt]=x.readUByte();o(r._txtTrack.samples,{pts:p.pts,payloadType:P,uuid:Y.join(""),userData:Object(_.utf8ArrayToStr)(J),userDataBytes:J})}}else if(F<x.bytesAvailable)for(var it=0;it<F;it++)x.readUByte()}break;case 7:if(v=!0,L=!0,!i.sps){var Q=new A.default(k.data).readSPS();i.width=Q.width,i.height=Q.height,i.pixelRatio=Q.pixelRatio,i.sps=[k.data],i.duration=r._duration;for(var st=k.data.subarray(1,4),$="avc1.",et=0;et<3;et++){var at=st[et].toString(16);at.length<2&&(at="0"+at),$+=at}i.codec=$}break;case 8:v=!0,i.pps||(i.pps=[k.data]);break;case 9:v=!1,i.audFound=!0,b&&e(b,i),b=r.avcSample=y(!1,p.pts,p.dts,"");break;case 12:v=!1;break;default:v=!1,b&&(b.debug+="unknown NAL "+k.type+" ")}b&&v&&b.units.push(k)}),g&&b&&(e(b,i),this.avcSample=null)},l.getLastNalUnit=function(){var p,g,v=this.avcSample;if(!v||v.units.length===0){var r=this._avcTrack.samples;v=r[r.length-1]}if((p=v)!==null&&p!==void 0&&p.units){var i=v.units;g=i[i.length-1]}return g},l.parseAVCNALu=function(p){var g,v,r=p.byteLength,i=this._avcTrack,c=i.naluState||0,b=c,L=[],k=0,O=-1,w=0;for(c===-1&&(O=0,w=31&p[0],c=0,k=1);k<r;)if(g=p[k++],c)if(c!==1)if(g)if(g===1){if(O>=0){var x={data:p.subarray(O,k-c-1),type:w};L.push(x)}else{var P=this.getLastNalUnit();if(P&&(b&&k<=4-b&&P.state&&(P.data=P.data.subarray(0,P.data.byteLength-b)),(v=k-c-1)>0)){var F=new Uint8Array(P.data.byteLength+v);F.set(P.data,0),F.set(p.subarray(0,v),P.data.byteLength),P.data=F}}k<r?(O=k,w=31&p[k],c=0):c=-1}else c=0;else c=3;else c=g?0:2;else c=g?0:1;if(O>=0&&c>=0){var M={data:p.subarray(O,r),type:w,state:c};L.push(M)}if(L.length===0){var B=this.getLastNalUnit();if(B){var U=new Uint8Array(B.data.byteLength+p.byteLength);U.set(B.data,0),U.set(p,B.data.byteLength),B.data=U}}return i.naluState=c,L},l.parseAACPES=function(p){var g,v,r,i,c,b=0,L=this._audioTrack,k=this.aacOverFlow,O=p.data;if(k){this.aacOverFlow=null;var w=k.sample.unit.byteLength,x=Math.min(k.missing,w),P=w-x;k.sample.unit.set(O.subarray(0,x),P),L.samples.push(k.sample),b=k.missing}for(g=b,v=O.length;g<v-1&&!R.isHeader(O,g);g++);if(g===b||(g<v-1?(r="AAC PES did not start with ADTS header,offset:"+g,i=!1):(r="no ADTS header found in AAC PES",i=!0),S.logger.warn("parsing error:"+r),this.observer.emit(D.Events.ERROR,D.Events.ERROR,{type:m.ErrorTypes.MEDIA_ERROR,details:m.ErrorDetails.FRAG_PARSING_ERROR,fatal:i,reason:r}),!i)){if(R.initTrackConfig(L,this.observer,O,g,this.audioCodec),p.pts!==void 0)c=p.pts;else{if(!k)return void S.logger.warn("[tsdemuxer]: AAC PES unknown PTS");var F=R.getFrameDuration(L.samplerate);c=k.sample.pts+F}for(var M=0;g<v;){if(R.isHeader(O,g)){if(g+5<v){var B=R.appendFrame(L,O,g,c,M);if(B){if(!B.missing){g+=B.length,M++;continue}this.aacOverFlow=B}}break}g++}}},l.parseMPEGPES=function(p){var g=p.data,v=g.length,r=0,i=0,c=p.pts;if(c!==void 0)for(;i<v;)if(E.isHeader(g,i)){var b=E.appendFrame(this._audioTrack,g,i,c,r);if(!b)break;i+=b.length,r++}else i++;else S.logger.warn("[tsdemuxer]: MPEG PES unknown PTS")},l.parseID3PES=function(p){p.pts!==void 0?this._id3Track.samples.push(p):S.logger.warn("[tsdemuxer]: ID3 PES unknown PTS")},n}();function y(n,l,p,g){return{key:n,frame:!1,pts:l,dts:p,units:[],debug:g,length:0}}function d(n,l){return(31&n[l+10])<<8|n[l+11]}function t(n,l,p,g){var v={audio:-1,avc:-1,id3:-1,isAAC:!0},r=l+3+((15&n[l+1])<<8|n[l+2])-4;for(l+=12+((15&n[l+10])<<8|n[l+11]);l<r;){var i=(31&n[l+1])<<8|n[l+2];switch(n[l]){case 207:if(!g){S.logger.log("ADTS AAC with AES-128-CBC frame encryption found in unencrypted stream");break}case 15:v.audio===-1&&(v.audio=i);break;case 21:v.id3===-1&&(v.id3=i);break;case 219:if(!g){S.logger.log("H.264 with AES-128-CBC slice encryption found in unencrypted stream");break}case 27:v.avc===-1&&(v.avc=i);break;case 3:case 4:p?v.audio===-1&&(v.audio=i,v.isAAC=!1):S.logger.log("MPEG audio found, not supported in this browser");break;case 36:S.logger.warn("Unsupported HEVC stream type found")}l+=5+((15&n[l+3])<<8|n[l+4])}return v}function a(n){var l,p,g,v,r,i=0,c=n.data;if(!n||n.size===0)return null;for(;c[0].length<19&&c.length>1;){var b=new Uint8Array(c[0].length+c[1].length);b.set(c[0]),b.set(c[1],c[0].length),c[0]=b,c.splice(1,1)}if(((l=c[0])[0]<<16)+(l[1]<<8)+l[2]===1){if((p=(l[4]<<8)+l[5])&&p>n.size-6)return null;var L=l[7];192&L&&(v=536870912*(14&l[9])+4194304*(255&l[10])+16384*(254&l[11])+128*(255&l[12])+(254&l[13])/2,64&L?v-(r=536870912*(14&l[14])+4194304*(255&l[15])+16384*(254&l[16])+128*(255&l[17])+(254&l[18])/2)>54e5&&(S.logger.warn(Math.round((v-r)/9e4)+"s delta between PTS and DTS, align them"),v=r):r=v);var k=(g=l[8])+9;if(n.size<=k)return null;n.size-=k;for(var O=new Uint8Array(n.size),w=0,x=c.length;w<x;w++){var P=(l=c[w]).byteLength;if(k){if(k>P){k-=P;continue}l=l.subarray(k),P-=k,k=0}O.set(l,i),i+=P}return p&&(p-=g+3),{data:O,pts:v,dts:r,len:p}}return null}function e(n,l){if(n.units.length&&n.frame){if(n.pts===void 0){var p=l.samples,g=p.length;if(!g)return void l.dropped++;var v=p[g-1];n.pts=v.pts,n.dts=v.dts}l.samples.push(n)}n.debug.length&&S.logger.log(n.pts+"/"+n.dts+":"+n.debug)}function o(n,l){var p=n.length;if(p>0){if(l.pts>=n[p-1].pts)n.push(l);else for(var g=p-1;g>=0;g--)if(l.pts<n[g].pts){n.splice(g,0,l);break}}else n.push(l)}function u(n){for(var l=n.byteLength,p=[],g=1;g<l-2;)n[g]===0&&n[g+1]===0&&n[g+2]===3?(p.push(g+2),g+=2):g++;if(p.length===0)return n;var v=l-p.length,r=new Uint8Array(v),i=0;for(g=0;g<v;i++,g++)i===p[0]&&(i++,p.shift()),r[g]=n[i];return r}T.minProbeByteLength=188,C.default=T},"./src/errors.ts":function(N,C,f){var R,E,A,_;f.r(C),f.d(C,"ErrorTypes",function(){return R}),f.d(C,"ErrorDetails",function(){return A}),(E=R||(R={})).NETWORK_ERROR="networkError",E.MEDIA_ERROR="mediaError",E.KEY_SYSTEM_ERROR="keySystemError",E.MUX_ERROR="muxError",E.OTHER_ERROR="otherError",(_=A||(A={})).KEY_SYSTEM_NO_KEYS="keySystemNoKeys",_.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",_.KEY_SYSTEM_NO_SESSION="keySystemNoSession",_.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",_.KEY_SYSTEM_NO_INIT_DATA="keySystemNoInitData",_.MANIFEST_LOAD_ERROR="manifestLoadError",_.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",_.MANIFEST_PARSING_ERROR="manifestParsingError",_.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",_.LEVEL_EMPTY_ERROR="levelEmptyError",_.LEVEL_LOAD_ERROR="levelLoadError",_.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",_.LEVEL_SWITCH_ERROR="levelSwitchError",_.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",_.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",_.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",_.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",_.FRAG_LOAD_ERROR="fragLoadError",_.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",_.FRAG_DECRYPT_ERROR="fragDecryptError",_.FRAG_PARSING_ERROR="fragParsingError",_.REMUX_ALLOC_ERROR="remuxAllocError",_.KEY_LOAD_ERROR="keyLoadError",_.KEY_LOAD_TIMEOUT="keyLoadTimeOut",_.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",_.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",_.BUFFER_APPEND_ERROR="bufferAppendError",_.BUFFER_APPENDING_ERROR="bufferAppendingError",_.BUFFER_STALLED_ERROR="bufferStalledError",_.BUFFER_FULL_ERROR="bufferFullError",_.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",_.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",_.INTERNAL_EXCEPTION="internalException",_.INTERNAL_ABORTED="aborted",_.UNKNOWN="unknown"},"./src/events.ts":function(N,C,f){var R,E;f.r(C),f.d(C,"Events",function(){return R}),(E=R||(R={})).MEDIA_ATTACHING="hlsMediaAttaching",E.MEDIA_ATTACHED="hlsMediaAttached",E.MEDIA_DETACHING="hlsMediaDetaching",E.MEDIA_DETACHED="hlsMediaDetached",E.BUFFER_RESET="hlsBufferReset",E.BUFFER_CODECS="hlsBufferCodecs",E.BUFFER_CREATED="hlsBufferCreated",E.BUFFER_APPENDING="hlsBufferAppending",E.BUFFER_APPENDED="hlsBufferAppended",E.BUFFER_EOS="hlsBufferEos",E.BUFFER_FLUSHING="hlsBufferFlushing",E.BUFFER_FLUSHED="hlsBufferFlushed",E.MANIFEST_LOADING="hlsManifestLoading",E.MANIFEST_LOADED="hlsManifestLoaded",E.MANIFEST_PARSED="hlsManifestParsed",E.LEVEL_SWITCHING="hlsLevelSwitching",E.LEVEL_SWITCHED="hlsLevelSwitched",E.LEVEL_LOADING="hlsLevelLoading",E.LEVEL_LOADED="hlsLevelLoaded",E.LEVEL_UPDATED="hlsLevelUpdated",E.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",E.LEVELS_UPDATED="hlsLevelsUpdated",E.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",E.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",E.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",E.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",E.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",E.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",E.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",E.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",E.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",E.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",E.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",E.CUES_PARSED="hlsCuesParsed",E.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",E.INIT_PTS_FOUND="hlsInitPtsFound",E.FRAG_LOADING="hlsFragLoading",E.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",E.FRAG_LOADED="hlsFragLoaded",E.FRAG_DECRYPTED="hlsFragDecrypted",E.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",E.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",E.FRAG_PARSING_METADATA="hlsFragParsingMetadata",E.FRAG_PARSED="hlsFragParsed",E.FRAG_BUFFERED="hlsFragBuffered",E.FRAG_CHANGED="hlsFragChanged",E.FPS_DROP="hlsFpsDrop",E.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",E.ERROR="hlsError",E.DESTROYING="hlsDestroying",E.KEY_LOADING="hlsKeyLoading",E.KEY_LOADED="hlsKeyLoaded",E.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",E.BACK_BUFFER_REACHED="hlsBackBufferReached"},"./src/hls.ts":function(N,C,f){f.r(C),f.d(C,"default",function(){return e});var R=f("./node_modules/url-toolkit/src/url-toolkit.js"),E=f("./src/loader/playlist-loader.ts"),A=f("./src/loader/key-loader.ts"),_=f("./src/controller/id3-track-controller.ts"),I=f("./src/controller/latency-controller.ts"),D=f("./src/controller/level-controller.ts"),s=f("./src/controller/fragment-tracker.ts"),S=f("./src/controller/stream-controller.ts"),m=f("./src/is-supported.ts"),h=f("./src/utils/logger.ts"),T=f("./src/config.ts"),y=f("./node_modules/eventemitter3/index.js"),d=f("./src/events.ts"),t=f("./src/errors.ts");function a(o,u){for(var n=0;n<u.length;n++){var l=u[n];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(o,l.key,l)}}var e=function(){function o(g){g===void 0&&(g={}),this.config=void 0,this.userConfig=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new y.EventEmitter,this._autoLevelCapping=void 0,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.emeController=void 0,this._media=null,this.url=null;var v=this.config=Object(T.mergeConfig)(o.DefaultConfig,g);this.userConfig=g,Object(h.enableLogs)(v.debug),this._autoLevelCapping=-1,v.progressive&&Object(T.enableStreamingMode)(v);var r=v.abrController,i=v.bufferController,c=v.capLevelController,b=v.fpsController,L=this.abrController=new r(this),k=this.bufferController=new i(this),O=this.capLevelController=new c(this),w=new b(this),x=new E.default(this),P=new A.default(this),F=new _.default(this),M=this.levelController=new D.default(this),B=new s.FragmentTracker(this),U=this.streamController=new S.default(this,B);O.setStreamController(U),w.setStreamController(U);var G=[M,U];this.networkControllers=G;var V=[x,P,L,k,O,w,F,B];this.audioTrackController=this.createController(v.audioTrackController,null,G),this.createController(v.audioStreamController,B,G),this.subtitleTrackController=this.createController(v.subtitleTrackController,null,G),this.createController(v.subtitleStreamController,B,G),this.createController(v.timelineController,null,V),this.emeController=this.createController(v.emeController,null,V),this.latencyController=this.createController(I.default,null,V),this.coreComponents=V}o.isSupported=function(){return Object(m.isSupported)()};var u,n,l,p=o.prototype;return p.createController=function(g,v,r){if(g){var i=v?new g(this,v):new g(this);return r&&r.push(i),i}return null},p.on=function(g,v,r){r===void 0&&(r=this),this._emitter.on(g,v,r)},p.once=function(g,v,r){r===void 0&&(r=this),this._emitter.once(g,v,r)},p.removeAllListeners=function(g){this._emitter.removeAllListeners(g)},p.off=function(g,v,r,i){r===void 0&&(r=this),this._emitter.off(g,v,r,i)},p.listeners=function(g){return this._emitter.listeners(g)},p.emit=function(g,v,r){return this._emitter.emit(g,v,r)},p.trigger=function(g,v){if(this.config.debug)return this.emit(g,g,v);try{return this.emit(g,g,v)}catch(r){h.logger.error("An internal error happened while handling event "+g+'. Error message: "'+r.message+'". Here is a stacktrace:',r),this.trigger(d.Events.ERROR,{type:t.ErrorTypes.OTHER_ERROR,details:t.ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:g,error:r})}return!1},p.listenerCount=function(g){return this._emitter.listenerCount(g)},p.destroy=function(){h.logger.log("destroy"),this.trigger(d.Events.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this.url=null,this.networkControllers.forEach(function(g){return g.destroy()}),this.networkControllers.length=0,this.coreComponents.forEach(function(g){return g.destroy()}),this.coreComponents.length=0},p.attachMedia=function(g){h.logger.log("attachMedia"),this._media=g,this.trigger(d.Events.MEDIA_ATTACHING,{media:g})},p.detachMedia=function(){h.logger.log("detachMedia"),this.trigger(d.Events.MEDIA_DETACHING,void 0),this._media=null},p.loadSource=function(g){this.stopLoad();var v=this.media,r=this.url,i=this.url=R.buildAbsoluteURL(self.location.href,g,{alwaysNormalize:!0});h.logger.log("loadSource:"+i),v&&r&&r!==i&&this.bufferController.hasSourceTypes()&&(this.detachMedia(),this.attachMedia(v)),this.trigger(d.Events.MANIFEST_LOADING,{url:g})},p.startLoad=function(g){g===void 0&&(g=-1),h.logger.log("startLoad("+g+")"),this.networkControllers.forEach(function(v){v.startLoad(g)})},p.stopLoad=function(){h.logger.log("stopLoad"),this.networkControllers.forEach(function(g){g.stopLoad()})},p.swapAudioCodec=function(){h.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()},p.recoverMediaError=function(){h.logger.log("recoverMediaError");var g=this._media;this.detachMedia(),g&&this.attachMedia(g)},p.removeLevel=function(g,v){v===void 0&&(v=0),this.levelController.removeLevel(g,v)},u=o,l=[{key:"version",get:function(){return"1.0.10"}},{key:"Events",get:function(){return d.Events}},{key:"ErrorTypes",get:function(){return t.ErrorTypes}},{key:"ErrorDetails",get:function(){return t.ErrorDetails}},{key:"DefaultConfig",get:function(){return o.defaultConfig?o.defaultConfig:T.hlsDefaultConfig},set:function(g){o.defaultConfig=g}}],(n=[{key:"levels",get:function(){var g=this.levelController.levels;return g||[]}},{key:"currentLevel",get:function(){return this.streamController.currentLevel},set:function(g){h.logger.log("set currentLevel:"+g),this.loadLevel=g,this.abrController.clearTimer(),this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function(){return this.streamController.nextLevel},set:function(g){h.logger.log("set nextLevel:"+g),this.levelController.manualLevel=g,this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function(){return this.levelController.level},set:function(g){h.logger.log("set loadLevel:"+g),this.levelController.manualLevel=g}},{key:"nextLoadLevel",get:function(){return this.levelController.nextLoadLevel},set:function(g){this.levelController.nextLoadLevel=g}},{key:"firstLevel",get:function(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},set:function(g){h.logger.log("set firstLevel:"+g),this.levelController.firstLevel=g}},{key:"startLevel",get:function(){return this.levelController.startLevel},set:function(g){h.logger.log("set startLevel:"+g),g!==-1&&(g=Math.max(g,this.minAutoLevel)),this.levelController.startLevel=g}},{key:"capLevelToPlayerSize",get:function(){return this.config.capLevelToPlayerSize},set:function(g){var v=!!g;v!==this.config.capLevelToPlayerSize&&(v?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=v)}},{key:"autoLevelCapping",get:function(){return this._autoLevelCapping},set:function(g){this._autoLevelCapping!==g&&(h.logger.log("set autoLevelCapping:"+g),this._autoLevelCapping=g)}},{key:"bandwidthEstimate",get:function(){var g=this.abrController.bwEstimator;return g?g.getEstimate():NaN}},{key:"autoLevelEnabled",get:function(){return this.levelController.manualLevel===-1}},{key:"manualLevel",get:function(){return this.levelController.manualLevel}},{key:"minAutoLevel",get:function(){var g=this.levels,v=this.config.minAutoBitrate;if(!g)return 0;for(var r=g.length,i=0;i<r;i++)if(g[i].maxBitrate>v)return i;return 0}},{key:"maxAutoLevel",get:function(){var g=this.levels,v=this.autoLevelCapping;return v===-1&&g&&g.length?g.length-1:v}},{key:"nextAutoLevel",get:function(){return Math.min(Math.max(this.abrController.nextAutoLevel,this.minAutoLevel),this.maxAutoLevel)},set:function(g){this.abrController.nextAutoLevel=Math.max(this.minAutoLevel,g)}},{key:"audioTracks",get:function(){var g=this.audioTrackController;return g?g.audioTracks:[]}},{key:"audioTrack",get:function(){var g=this.audioTrackController;return g?g.audioTrack:-1},set:function(g){var v=this.audioTrackController;v&&(v.audioTrack=g)}},{key:"subtitleTracks",get:function(){var g=this.subtitleTrackController;return g?g.subtitleTracks:[]}},{key:"subtitleTrack",get:function(){var g=this.subtitleTrackController;return g?g.subtitleTrack:-1},set:function(g){var v=this.subtitleTrackController;v&&(v.subtitleTrack=g)}},{key:"media",get:function(){return this._media}},{key:"subtitleDisplay",get:function(){var g=this.subtitleTrackController;return!!g&&g.subtitleDisplay},set:function(g){var v=this.subtitleTrackController;v&&(v.subtitleDisplay=g)}},{key:"lowLatencyMode",get:function(){return this.config.lowLatencyMode},set:function(g){this.config.lowLatencyMode=g}},{key:"liveSyncPosition",get:function(){return this.latencyController.liveSyncPosition}},{key:"latency",get:function(){return this.latencyController.latency}},{key:"maxLatency",get:function(){return this.latencyController.maxLatency}},{key:"targetLatency",get:function(){return this.latencyController.targetLatency}},{key:"drift",get:function(){return this.latencyController.drift}},{key:"forceStartLoad",get:function(){return this.streamController.forceStartLoad}}])&&a(u.prototype,n),l&&a(u,l),o}();e.defaultConfig=void 0},"./src/is-supported.ts":function(N,C,f){f.r(C),f.d(C,"isSupported",function(){return A}),f.d(C,"changeTypeSupported",function(){return _});var R=f("./src/utils/mediasource-helper.ts");function E(){return self.SourceBuffer||self.WebKitSourceBuffer}function A(){var I=Object(R.getMediaSource)();if(!I)return!1;var D=E(),s=I&&typeof I.isTypeSupported=="function"&&I.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),S=!D||D.prototype&&typeof D.prototype.appendBuffer=="function"&&typeof D.prototype.remove=="function";return!!s&&!!S}function _(){var I,D=E();return typeof(D==null||(I=D.prototype)===null||I===void 0?void 0:I.changeType)=="function"}},"./src/loader/fragment-loader.ts":function(N,C,f){f.r(C),f.d(C,"default",function(){return m}),f.d(C,"LoadError",function(){return T});var R=f("./src/polyfills/number.ts"),E=f("./src/errors.ts");function A(y){var d=typeof Map=="function"?new Map:void 0;return(A=function(t){if(t===null||(a=t,Function.toString.call(a).indexOf("[native code]")===-1))return t;var a;if(typeof t!="function")throw new TypeError("Super expression must either be null or a function");if(d!==void 0){if(d.has(t))return d.get(t);d.set(t,e)}function e(){return _(t,arguments,s(this).constructor)}return e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),D(e,t)})(y)}function _(y,d,t){return(_=I()?Reflect.construct:function(a,e,o){var u=[null];u.push.apply(u,e);var n=new(Function.bind.apply(a,u));return o&&D(n,o.prototype),n}).apply(null,arguments)}function I(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function D(y,d){return(D=Object.setPrototypeOf||function(t,a){return t.__proto__=a,t})(y,d)}function s(y){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(d){return d.__proto__||Object.getPrototypeOf(d)})(y)}var S=Math.pow(2,17),m=function(){function y(t){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=t}var d=y.prototype;return d.destroy=function(){this.loader&&(this.loader.destroy(),this.loader=null)},d.abort=function(){this.loader&&this.loader.abort()},d.load=function(t,a){var e=this,o=t.url;if(!o)return Promise.reject(new T({type:E.ErrorTypes.NETWORK_ERROR,details:E.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:t,networkDetails:null},"Fragment does not have a "+(o?"part list":"url")));this.abort();var u=this.config,n=u.fLoader,l=u.loader;return new Promise(function(p,g){e.loader&&e.loader.destroy();var v=e.loader=t.loader=n?new n(u):new l(u),r=h(t),i={timeout:u.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:u.fragLoadingMaxRetryTimeout,highWaterMark:S};t.stats=v.stats,v.load(r,i,{onSuccess:function(c,b,L,k){e.resetLoader(t,v),p({frag:t,part:null,payload:c.data,networkDetails:k})},onError:function(c,b,L){e.resetLoader(t,v),g(new T({type:E.ErrorTypes.NETWORK_ERROR,details:E.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:t,response:c,networkDetails:L}))},onAbort:function(c,b,L){e.resetLoader(t,v),g(new T({type:E.ErrorTypes.NETWORK_ERROR,details:E.ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:t,networkDetails:L}))},onTimeout:function(c,b,L){e.resetLoader(t,v),g(new T({type:E.ErrorTypes.NETWORK_ERROR,details:E.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:t,networkDetails:L}))},onProgress:function(c,b,L,k){a&&a({frag:t,part:null,payload:L,networkDetails:k})}})})},d.loadPart=function(t,a,e){var o=this;this.abort();var u=this.config,n=u.fLoader,l=u.loader;return new Promise(function(p,g){o.loader&&o.loader.destroy();var v=o.loader=t.loader=n?new n(u):new l(u),r=h(t,a),i={timeout:u.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:u.fragLoadingMaxRetryTimeout,highWaterMark:S};a.stats=v.stats,v.load(r,i,{onSuccess:function(c,b,L,k){o.resetLoader(t,v),o.updateStatsFromPart(t,a);var O={frag:t,part:a,payload:c.data,networkDetails:k};e(O),p(O)},onError:function(c,b,L){o.resetLoader(t,v),g(new T({type:E.ErrorTypes.NETWORK_ERROR,details:E.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:t,part:a,response:c,networkDetails:L}))},onAbort:function(c,b,L){t.stats.aborted=a.stats.aborted,o.resetLoader(t,v),g(new T({type:E.ErrorTypes.NETWORK_ERROR,details:E.ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:t,part:a,networkDetails:L}))},onTimeout:function(c,b,L){o.resetLoader(t,v),g(new T({type:E.ErrorTypes.NETWORK_ERROR,details:E.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:t,part:a,networkDetails:L}))}})})},d.updateStatsFromPart=function(t,a){var e=t.stats,o=a.stats,u=o.total;if(e.loaded+=o.loaded,u){var n=Math.round(t.duration/a.duration),l=Math.min(Math.round(e.loaded/u),n),p=(n-l)*Math.round(e.loaded/l);e.total=e.loaded+p}else e.total=Math.max(e.loaded,e.total);var g=e.loading,v=o.loading;g.start?g.first+=v.first-v.start:(g.start=v.start,g.first=v.first),g.end=v.end},d.resetLoader=function(t,a){t.loader=null,this.loader===a&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),a.destroy()},y}();function h(y,d){d===void 0&&(d=null);var t=d||y,a={frag:y,part:d,responseType:"arraybuffer",url:t.url,rangeStart:0,rangeEnd:0},e=t.byteRangeStartOffset,o=t.byteRangeEndOffset;return Object(R.isFiniteNumber)(e)&&Object(R.isFiniteNumber)(o)&&(a.rangeStart=e,a.rangeEnd=o),a}var T=function(y){var d,t;function a(e){for(var o,u=arguments.length,n=new Array(u>1?u-1:0),l=1;l<u;l++)n[l-1]=arguments[l];return(o=y.call.apply(y,[this].concat(n))||this).data=void 0,o.data=e,o}return t=y,(d=a).prototype=Object.create(t.prototype),d.prototype.constructor=d,D(d,t),a}(A(Error))},"./src/loader/fragment.ts":function(N,C,f){f.r(C),f.d(C,"ElementaryStreamTypes",function(){return R}),f.d(C,"BaseSegment",function(){return y}),f.d(C,"Fragment",function(){return d}),f.d(C,"Part",function(){return t});var R,E,A=f("./src/polyfills/number.ts"),_=f("./node_modules/url-toolkit/src/url-toolkit.js"),I=f("./src/utils/logger.ts"),D=f("./src/loader/level-key.ts"),s=f("./src/loader/load-stats.ts");function S(a,e){a.prototype=Object.create(e.prototype),a.prototype.constructor=a,m(a,e)}function m(a,e){return(m=Object.setPrototypeOf||function(o,u){return o.__proto__=u,o})(a,e)}function h(a,e){for(var o=0;o<e.length;o++){var u=e[o];u.enumerable=u.enumerable||!1,u.configurable=!0,"value"in u&&(u.writable=!0),Object.defineProperty(a,u.key,u)}}function T(a,e,o){return e&&h(a.prototype,e),o&&h(a,o),a}(E=R||(R={})).AUDIO="audio",E.VIDEO="video",E.AUDIOVIDEO="audiovideo";var y=function(){function a(e){var o;this._byteRange=null,this._url=null,this.baseurl=void 0,this.relurl=void 0,this.elementaryStreams=((o={})[R.AUDIO]=null,o[R.VIDEO]=null,o[R.AUDIOVIDEO]=null,o),this.baseurl=e}return a.prototype.setByteRange=function(e,o){var u=e.split("@",2),n=[];u.length===1?n[0]=o?o.byteRangeEndOffset:0:n[0]=parseInt(u[1]),n[1]=parseInt(u[0])+n[0],this._byteRange=n},T(a,[{key:"byteRange",get:function(){return this._byteRange?this._byteRange:[]}},{key:"byteRangeStartOffset",get:function(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function(){return this.byteRange[1]}},{key:"url",get:function(){return!this._url&&this.baseurl&&this.relurl&&(this._url=Object(_.buildAbsoluteURL)(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""},set:function(e){this._url=e}}]),a}(),d=function(a){function e(u,n){var l;return(l=a.call(this,n)||this)._decryptdata=null,l.rawProgramDateTime=null,l.programDateTime=null,l.tagList=[],l.duration=0,l.sn=0,l.levelkey=void 0,l.type=void 0,l.loader=null,l.level=-1,l.cc=0,l.startPTS=void 0,l.endPTS=void 0,l.appendedPTS=void 0,l.startDTS=void 0,l.endDTS=void 0,l.start=0,l.deltaPTS=void 0,l.maxStartPTS=void 0,l.minEndPTS=void 0,l.stats=new s.LoadStats,l.urlId=0,l.data=void 0,l.bitrateTest=!1,l.title=null,l.initSegment=null,l.type=u,l}S(e,a);var o=e.prototype;return o.createInitializationVector=function(u){for(var n=new Uint8Array(16),l=12;l<16;l++)n[l]=u>>8*(15-l)&255;return n},o.setDecryptDataFromLevelKey=function(u,n){var l=u;return(u==null?void 0:u.method)==="AES-128"&&u.uri&&!u.iv&&((l=D.LevelKey.fromURI(u.uri)).method=u.method,l.iv=this.createInitializationVector(n),l.keyFormat="identity"),l},o.setElementaryStreamInfo=function(u,n,l,p,g,v){v===void 0&&(v=!1);var r=this.elementaryStreams,i=r[u];i?(i.startPTS=Math.min(i.startPTS,n),i.endPTS=Math.max(i.endPTS,l),i.startDTS=Math.min(i.startDTS,p),i.endDTS=Math.max(i.endDTS,g)):r[u]={startPTS:n,endPTS:l,startDTS:p,endDTS:g,partial:v}},o.clearElementaryStreamInfo=function(){var u=this.elementaryStreams;u[R.AUDIO]=null,u[R.VIDEO]=null,u[R.AUDIOVIDEO]=null},T(e,[{key:"decryptdata",get:function(){if(!this.levelkey&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkey){var u=this.sn;typeof u!="number"&&(this.levelkey&&this.levelkey.method==="AES-128"&&!this.levelkey.iv&&I.logger.warn('missing IV for initialization segment with method="'+this.levelkey.method+'" - compliance issue'),u=0),this._decryptdata=this.setDecryptDataFromLevelKey(this.levelkey,u)}return this._decryptdata}},{key:"end",get:function(){return this.start+this.duration}},{key:"endProgramDateTime",get:function(){if(this.programDateTime===null||!Object(A.isFiniteNumber)(this.programDateTime))return null;var u=Object(A.isFiniteNumber)(this.duration)?this.duration:0;return this.programDateTime+1e3*u}},{key:"encrypted",get:function(){var u;return!((u=this.decryptdata)===null||u===void 0||!u.keyFormat||!this.decryptdata.uri)}}]),e}(y),t=function(a){function e(o,u,n,l,p){var g;(g=a.call(this,n)||this).fragOffset=0,g.duration=0,g.gap=!1,g.independent=!1,g.relurl=void 0,g.fragment=void 0,g.index=void 0,g.stats=new s.LoadStats,g.duration=o.decimalFloatingPoint("DURATION"),g.gap=o.bool("GAP"),g.independent=o.bool("INDEPENDENT"),g.relurl=o.enumeratedString("URI"),g.fragment=u,g.index=l;var v=o.enumeratedString("BYTERANGE");return v&&g.setByteRange(v,p),p&&(g.fragOffset=p.fragOffset+p.duration),g}return S(e,a),T(e,[{key:"start",get:function(){return this.fragment.start+this.fragOffset}},{key:"end",get:function(){return this.start+this.duration}},{key:"loaded",get:function(){var o=this.elementaryStreams;return!!(o.audio||o.video||o.audiovideo)}}]),e}(y)},"./src/loader/key-loader.ts":function(N,C,f){f.r(C),f.d(C,"default",function(){return _});var R=f("./src/events.ts"),E=f("./src/errors.ts"),A=f("./src/utils/logger.ts"),_=function(){function I(s){this.hls=void 0,this.loaders={},this.decryptkey=null,this.decrypturl=null,this.hls=s,this._registerListeners()}var D=I.prototype;return D._registerListeners=function(){this.hls.on(R.Events.KEY_LOADING,this.onKeyLoading,this)},D._unregisterListeners=function(){this.hls.off(R.Events.KEY_LOADING,this.onKeyLoading)},D.destroy=function(){for(var s in this._unregisterListeners(),this.loaders){var S=this.loaders[s];S&&S.destroy()}this.loaders={}},D.onKeyLoading=function(s,S){var m=S.frag,h=m.type,T=this.loaders[h];if(m.decryptdata){var y=m.decryptdata.uri;if(y!==this.decrypturl||this.decryptkey===null){var d=this.hls.config;if(T&&(A.logger.warn("abort previous key loader for type:"+h),T.abort()),!y)return void A.logger.warn("key uri is falsy");var t=d.loader,a=m.loader=this.loaders[h]=new t(d);this.decrypturl=y,this.decryptkey=null;var e={url:y,frag:m,responseType:"arraybuffer"},o={timeout:d.fragLoadingTimeOut,maxRetry:0,retryDelay:d.fragLoadingRetryDelay,maxRetryDelay:d.fragLoadingMaxRetryTimeout,highWaterMark:0},u={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};a.load(e,o,u)}else this.decryptkey&&(m.decryptdata.key=this.decryptkey,this.hls.trigger(R.Events.KEY_LOADED,{frag:m}))}else A.logger.warn("Missing decryption data on fragment in onKeyLoading")},D.loadsuccess=function(s,S,m){var h=m.frag;h.decryptdata?(this.decryptkey=h.decryptdata.key=new Uint8Array(s.data),h.loader=null,delete this.loaders[h.type],this.hls.trigger(R.Events.KEY_LOADED,{frag:h})):A.logger.error("after key load, decryptdata unset")},D.loaderror=function(s,S){var m=S.frag,h=m.loader;h&&h.abort(),delete this.loaders[m.type],this.hls.trigger(R.Events.ERROR,{type:E.ErrorTypes.NETWORK_ERROR,details:E.ErrorDetails.KEY_LOAD_ERROR,fatal:!1,frag:m,response:s})},D.loadtimeout=function(s,S){var m=S.frag,h=m.loader;h&&h.abort(),delete this.loaders[m.type],this.hls.trigger(R.Events.ERROR,{type:E.ErrorTypes.NETWORK_ERROR,details:E.ErrorDetails.KEY_LOAD_TIMEOUT,fatal:!1,frag:m})},I}()},"./src/loader/level-details.ts":function(N,C,f){f.r(C),f.d(C,"LevelDetails",function(){return A});var R=f("./src/polyfills/number.ts");function E(_,I){for(var D=0;D<I.length;D++){var s=I[D];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(_,s.key,s)}}var A=function(){function _(s){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.live=!0,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.availabilityDelay=void 0,this.misses=0,this.needSidxRanges=!1,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.fragments=[],this.url=s}var I,D;return _.prototype.reloaded=function(s){if(!s)return this.advanced=!0,void(this.updated=!0);var S=this.lastPartSn-s.lastPartSn,m=this.lastPartIndex-s.lastPartIndex;this.updated=this.endSN!==s.endSN||!!m||!!S,this.advanced=this.endSN>s.endSN||S>0||S===0&&m>0,this.updated||this.advanced?this.misses=Math.floor(.6*s.misses):this.misses=s.misses+1,this.availabilityDelay=s.availabilityDelay},I=_,(D=[{key:"hasProgramDateTime",get:function(){return!!this.fragments.length&&Object(R.isFiniteNumber)(this.fragments[this.fragments.length-1].programDateTime)}},{key:"levelTargetDuration",get:function(){return this.averagetargetduration||this.targetduration||10}},{key:"drift",get:function(){var s=this.driftEndTime-this.driftStartTime;return s>0?1e3*(this.driftEnd-this.driftStart)/s:1}},{key:"edge",get:function(){return this.partEnd||this.fragmentEnd}},{key:"partEnd",get:function(){var s;return(s=this.partList)!==null&&s!==void 0&&s.length?this.partList[this.partList.length-1].end:this.fragmentEnd}},{key:"fragmentEnd",get:function(){var s;return(s=this.fragments)!==null&&s!==void 0&&s.length?this.fragments[this.fragments.length-1].end:0}},{key:"age",get:function(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}},{key:"lastPartIndex",get:function(){var s;return(s=this.partList)!==null&&s!==void 0&&s.length?this.partList[this.partList.length-1].index:-1}},{key:"lastPartSn",get:function(){var s;return(s=this.partList)!==null&&s!==void 0&&s.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}}])&&E(I.prototype,D),_}()},"./src/loader/level-key.ts":function(N,C,f){f.r(C),f.d(C,"LevelKey",function(){return A});var R=f("./node_modules/url-toolkit/src/url-toolkit.js");function E(_,I){for(var D=0;D<I.length;D++){var s=I[D];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(_,s.key,s)}}var A=function(){function _(s,S){this._uri=null,this.method=null,this.keyFormat=null,this.keyFormatVersions=null,this.keyID=null,this.key=null,this.iv=null,this._uri=S?Object(R.buildAbsoluteURL)(s,S,{alwaysNormalize:!0}):s}var I,D;return _.fromURL=function(s,S){return new _(s,S)},_.fromURI=function(s){return new _(s)},I=_,(D=[{key:"uri",get:function(){return this._uri}}])&&E(I.prototype,D),_}()},"./src/loader/load-stats.ts":function(N,C,f){f.r(C),f.d(C,"LoadStats",function(){return R});var R=function(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}},"./src/loader/m3u8-parser.ts":function(N,C,f){f.r(C),f.d(C,"default",function(){return t});var R=f("./src/polyfills/number.ts"),E=f("./node_modules/url-toolkit/src/url-toolkit.js"),A=f("./src/loader/fragment.ts"),_=f("./src/loader/level-details.ts"),I=f("./src/loader/level-key.ts"),D=f("./src/utils/attr-list.ts"),s=f("./src/utils/logger.ts"),S=f("./src/utils/codecs.ts"),m=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-SESSION-DATA:([^\r\n]*)[\r\n]+/g,h=/#EXT-X-MEDIA:(.*)/g,T=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[\S ]*)/.source,/#EXT-X-BYTERANGE:*(.+)/.source,/#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/#.*/.source].join("|"),"g"),y=new RegExp([/#(EXTM3U)/.source,/#EXT-X-(PLAYLIST-TYPE):(.+)/.source,/#EXT-X-(MEDIA-SEQUENCE): *(\d+)/.source,/#EXT-X-(SKIP):(.+)/.source,/#EXT-X-(TARGETDURATION): *(\d+)/.source,/#EXT-X-(KEY):(.+)/.source,/#EXT-X-(START):(.+)/.source,/#EXT-X-(ENDLIST)/.source,/#EXT-X-(DISCONTINUITY-SEQ)UENCE: *(\d+)/.source,/#EXT-X-(DIS)CONTINUITY/.source,/#EXT-X-(VERSION):(\d+)/.source,/#EXT-X-(MAP):(.+)/.source,/#EXT-X-(SERVER-CONTROL):(.+)/.source,/#EXT-X-(PART-INF):(.+)/.source,/#EXT-X-(GAP)/.source,/#EXT-X-(BITRATE):\s*(\d+)/.source,/#EXT-X-(PART):(.+)/.source,/#EXT-X-(PRELOAD-HINT):(.+)/.source,/#EXT-X-(RENDITION-REPORT):(.+)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|")),d=/\.(mp4|m4s|m4v|m4a)$/i,t=function(){function u(){}return u.findGroup=function(n,l){for(var p=0;p<n.length;p++){var g=n[p];if(g.id===l)return g}},u.convertAVC1ToAVCOTI=function(n){var l=n.split(".");if(l.length>2){var p=l.shift()+".";return p+=parseInt(l.shift()).toString(16),p+=("000"+parseInt(l.shift()).toString(16)).substr(-4)}return n},u.resolve=function(n,l){return E.buildAbsoluteURL(l,n,{alwaysNormalize:!0})},u.parseMasterPlaylist=function(n,l){var p,g=[],v={},r=!1;for(m.lastIndex=0;(p=m.exec(n))!=null;)if(p[1]){var i=new D.AttrList(p[1]),c={attrs:i,bitrate:i.decimalInteger("AVERAGE-BANDWIDTH")||i.decimalInteger("BANDWIDTH"),name:i.NAME,url:u.resolve(p[2],l)},b=i.decimalResolution("RESOLUTION");b&&(c.width=b.width,c.height=b.height),a((i.CODECS||"").split(/[ ,]+/).filter(function(k){return k}),c),c.videoCodec&&c.videoCodec.indexOf("avc1")!==-1&&(c.videoCodec=u.convertAVC1ToAVCOTI(c.videoCodec)),g.push(c)}else if(p[3]){var L=new D.AttrList(p[3]);L["DATA-ID"]&&(r=!0,v[L["DATA-ID"]]=L)}return{levels:g,sessionData:r?v:null}},u.parseMasterPlaylistMedia=function(n,l,p,g){var v;g===void 0&&(g=[]);var r=[],i=0;for(h.lastIndex=0;(v=h.exec(n))!==null;){var c=new D.AttrList(v[1]);if(c.TYPE===p){var b={attrs:c,bitrate:0,id:i++,groupId:c["GROUP-ID"],instreamId:c["INSTREAM-ID"],name:c.NAME||c.LANGUAGE||"",type:p,default:c.bool("DEFAULT"),autoselect:c.bool("AUTOSELECT"),forced:c.bool("FORCED"),lang:c.LANGUAGE,url:c.URI?u.resolve(c.URI,l):""};if(g.length){var L=u.findGroup(g,b.groupId)||g[0];e(b,L,"audioCodec"),e(b,L,"textCodec")}r.push(b)}}return r},u.parseLevelPlaylist=function(n,l,p,g,v){var r,i,c,b=new _.LevelDetails(l),L=b.fragments,k=null,O=0,w=0,x=0,P=0,F=null,M=new A.Fragment(g,l),B=-1,U=!1;for(T.lastIndex=0,b.m3u8=n;(r=T.exec(n))!==null;){U&&(U=!1,(M=new A.Fragment(g,l)).start=x,M.sn=O,M.cc=P,M.level=p,k&&(M.initSegment=k,M.rawProgramDateTime=k.rawProgramDateTime));var G=r[1];if(G){M.duration=parseFloat(G);var V=(" "+r[2]).slice(1);M.title=V||null,M.tagList.push(V?["INF",G,V]:["INF",G])}else if(r[3])Object(R.isFiniteNumber)(M.duration)&&(M.start=x,c&&(M.levelkey=c),M.sn=O,M.level=p,M.cc=P,M.urlId=v,L.push(M),M.relurl=(" "+r[3]).slice(1),o(M,F),F=M,x+=M.duration,O++,w=0,U=!0);else if(r[4]){var H=(" "+r[4]).slice(1);F?M.setByteRange(H,F):M.setByteRange(H)}else if(r[5])M.rawProgramDateTime=(" "+r[5]).slice(1),M.tagList.push(["PROGRAM-DATE-TIME",M.rawProgramDateTime]),B===-1&&(B=L.length);else{if(!(r=r[0].match(y))){s.logger.warn("No matches on slow regex match for level playlist!");continue}for(i=1;i<r.length&&r[i]===void 0;i++);var Y=(" "+r[i]).slice(1),W=(" "+r[i+1]).slice(1),q=r[i+2]?(" "+r[i+2]).slice(1):"";switch(Y){case"PLAYLIST-TYPE":b.type=W.toUpperCase();break;case"MEDIA-SEQUENCE":O=b.startSN=parseInt(W);break;case"SKIP":var J=new D.AttrList(W),rt=J.decimalInteger("SKIPPED-SEGMENTS");if(Object(R.isFiniteNumber)(rt)){b.skippedSegments=rt;for(var it=rt;it--;)L.unshift(null);O+=rt}var Q=J.enumeratedString("RECENTLY-REMOVED-DATERANGES");Q&&(b.recentlyRemovedDateranges=Q.split("	"));break;case"TARGETDURATION":b.targetduration=parseFloat(W);break;case"VERSION":b.version=parseInt(W);break;case"EXTM3U":break;case"ENDLIST":b.live=!1;break;case"#":(W||q)&&M.tagList.push(q?[W,q]:[W]);break;case"DIS":P++;case"GAP":M.tagList.push([Y]);break;case"BITRATE":M.tagList.push([Y,W]);break;case"DISCONTINUITY-SEQ":P=parseInt(W);break;case"KEY":var st,$=new D.AttrList(W),et=$.enumeratedString("METHOD"),at=$.URI,nt=$.hexadecimalInteger("IV"),ct=$.enumeratedString("KEYFORMATVERSIONS"),vt=$.enumeratedString("KEYID"),pt=(st=$.enumeratedString("KEYFORMAT"))!=null?st:"identity";if(["com.apple.streamingkeydelivery","com.microsoft.playready","urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed","com.widevine"].indexOf(pt)>-1){s.logger.warn("Keyformat "+pt+" is not supported from the manifest");continue}if(pt!=="identity")continue;et&&(c=I.LevelKey.fromURL(l,at),at&&["AES-128","SAMPLE-AES","SAMPLE-AES-CENC"].indexOf(et)>=0&&(c.method=et,c.keyFormat=pt,vt&&(c.keyID=vt),ct&&(c.keyFormatVersions=ct),c.iv=nt));break;case"START":var yt=new D.AttrList(W).decimalFloatingPoint("TIME-OFFSET");Object(R.isFiniteNumber)(yt)&&(b.startTimeOffset=yt);break;case"MAP":var ut=new D.AttrList(W);M.relurl=ut.URI,ut.BYTERANGE&&M.setByteRange(ut.BYTERANGE),M.level=p,M.sn="initSegment",c&&(M.levelkey=c),M.initSegment=null,k=M,U=!0;break;case"SERVER-CONTROL":var lt=new D.AttrList(W);b.canBlockReload=lt.bool("CAN-BLOCK-RELOAD"),b.canSkipUntil=lt.optionalFloat("CAN-SKIP-UNTIL",0),b.canSkipDateRanges=b.canSkipUntil>0&&lt.bool("CAN-SKIP-DATERANGES"),b.partHoldBack=lt.optionalFloat("PART-HOLD-BACK",0),b.holdBack=lt.optionalFloat("HOLD-BACK",0);break;case"PART-INF":var Nt=new D.AttrList(W);b.partTarget=Nt.decimalFloatingPoint("PART-TARGET");break;case"PART":var Et=b.partList;Et||(Et=b.partList=[]);var Lt=w>0?Et[Et.length-1]:void 0,Bt=w++,It=new A.Part(new D.AttrList(W),M,l,Bt,Lt);Et.push(It),M.duration+=It.duration;break;case"PRELOAD-HINT":var St=new D.AttrList(W);b.preloadHint=St;break;case"RENDITION-REPORT":var Yt=new D.AttrList(W);b.renditionReports=b.renditionReports||[],b.renditionReports.push(Yt);break;default:s.logger.warn("line parsed but not handled: "+r)}}}F&&!F.relurl?(L.pop(),x-=F.duration,b.partList&&(b.fragmentHint=F)):b.partList&&(o(M,F),M.cc=P,b.fragmentHint=M);var Ut=L.length,bt=L[0],qt=L[Ut-1];if((x+=b.skippedSegments*b.targetduration)>0&&Ut&&qt){b.averagetargetduration=x/Ut;var Gt=qt.sn;b.endSN=Gt!=="initSegment"?Gt:0,bt&&(b.startCC=bt.cc,bt.initSegment||b.fragments.every(function(Ct){return Ct.relurl&&(At=Ct.relurl,d.test((wt=(Tt=E.parseURL(At))===null||Tt===void 0?void 0:Tt.path)!=null?wt:""));var At,wt,Tt})&&(s.logger.warn("MP4 fragments found but no init segment (probably no MAP, incomplete M3U8), trying to fetch SIDX"),(M=new A.Fragment(g,l)).relurl=qt.relurl,M.level=p,M.sn="initSegment",bt.initSegment=M,b.needSidxRanges=!0))}else b.endSN=0,b.startCC=0;return b.fragmentHint&&(x+=b.fragmentHint.duration),b.totalduration=x,b.endCC=P,B>0&&function(Ct,At){for(var wt=Ct[At],Tt=At;Tt--;){var Ot=Ct[Tt];if(!Ot)return;Ot.programDateTime=wt.programDateTime-1e3*Ot.duration,wt=Ot}}(L,B),b},u}();function a(u,n){["video","audio","text"].forEach(function(l){var p=u.filter(function(v){return Object(S.isCodecType)(v,l)});if(p.length){var g=p.filter(function(v){return v.lastIndexOf("avc1",0)===0||v.lastIndexOf("mp4a",0)===0});n[l+"Codec"]=g.length>0?g[0]:p[0],u=u.filter(function(v){return p.indexOf(v)===-1})}}),n.unknownCodecs=u}function e(u,n,l){var p=n[l];p&&(u[l]=p)}function o(u,n){u.rawProgramDateTime?u.programDateTime=Date.parse(u.rawProgramDateTime):n!=null&&n.programDateTime&&(u.programDateTime=n.endProgramDateTime),Object(R.isFiniteNumber)(u.programDateTime)||(u.programDateTime=null,u.rawProgramDateTime=null)}},"./src/loader/playlist-loader.ts":function(N,C,f){f.r(C);var R=f("./src/polyfills/number.ts"),E=f("./src/events.ts"),A=f("./src/errors.ts"),_=f("./src/utils/logger.ts"),I=f("./src/utils/mp4-tools.ts"),D=f("./src/loader/m3u8-parser.ts"),s=f("./src/types/loader.ts"),S=f("./src/utils/attr-list.ts");function m(T,y){var d=T.url;return d!==void 0&&d.indexOf("data:")!==0||(d=y.url),d}var h=function(){function T(d){this.hls=void 0,this.loaders=Object.create(null),this.hls=d,this.registerListeners()}var y=T.prototype;return y.registerListeners=function(){var d=this.hls;d.on(E.Events.MANIFEST_LOADING,this.onManifestLoading,this),d.on(E.Events.LEVEL_LOADING,this.onLevelLoading,this),d.on(E.Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),d.on(E.Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},y.unregisterListeners=function(){var d=this.hls;d.off(E.Events.MANIFEST_LOADING,this.onManifestLoading,this),d.off(E.Events.LEVEL_LOADING,this.onLevelLoading,this),d.off(E.Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),d.off(E.Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},y.createInternalLoader=function(d){var t=this.hls.config,a=t.pLoader,e=t.loader,o=new(a||e)(t);return d.loader=o,this.loaders[d.type]=o,o},y.getInternalLoader=function(d){return this.loaders[d.type]},y.resetInternalLoader=function(d){this.loaders[d]&&delete this.loaders[d]},y.destroyInternalLoaders=function(){for(var d in this.loaders){var t=this.loaders[d];t&&t.destroy(),this.resetInternalLoader(d)}},y.destroy=function(){this.unregisterListeners(),this.destroyInternalLoaders()},y.onManifestLoading=function(d,t){var a=t.url;this.load({id:null,groupId:null,level:0,responseType:"text",type:s.PlaylistContextType.MANIFEST,url:a,deliveryDirectives:null})},y.onLevelLoading=function(d,t){var a=t.id,e=t.level,o=t.url,u=t.deliveryDirectives;this.load({id:a,groupId:null,level:e,responseType:"text",type:s.PlaylistContextType.LEVEL,url:o,deliveryDirectives:u})},y.onAudioTrackLoading=function(d,t){var a=t.id,e=t.groupId,o=t.url,u=t.deliveryDirectives;this.load({id:a,groupId:e,level:null,responseType:"text",type:s.PlaylistContextType.AUDIO_TRACK,url:o,deliveryDirectives:u})},y.onSubtitleTrackLoading=function(d,t){var a=t.id,e=t.groupId,o=t.url,u=t.deliveryDirectives;this.load({id:a,groupId:e,level:null,responseType:"text",type:s.PlaylistContextType.SUBTITLE_TRACK,url:o,deliveryDirectives:u})},y.load=function(d){var t,a,e,o,u,n,l=this.hls.config,p=this.getInternalLoader(d);if(p){var g=p.context;if(g&&g.url===d.url)return void _.logger.trace("[playlist-loader]: playlist request ongoing");_.logger.log("[playlist-loader]: aborting previous loader for type: "+d.type),p.abort()}switch(d.type){case s.PlaylistContextType.MANIFEST:a=l.manifestLoadingMaxRetry,e=l.manifestLoadingTimeOut,o=l.manifestLoadingRetryDelay,u=l.manifestLoadingMaxRetryTimeout;break;case s.PlaylistContextType.LEVEL:case s.PlaylistContextType.AUDIO_TRACK:case s.PlaylistContextType.SUBTITLE_TRACK:a=0,e=l.levelLoadingTimeOut;break;default:a=l.levelLoadingMaxRetry,e=l.levelLoadingTimeOut,o=l.levelLoadingRetryDelay,u=l.levelLoadingMaxRetryTimeout}if(p=this.createInternalLoader(d),(t=d.deliveryDirectives)!==null&&t!==void 0&&t.part&&(d.type===s.PlaylistContextType.LEVEL&&d.level!==null?n=this.hls.levels[d.level].details:d.type===s.PlaylistContextType.AUDIO_TRACK&&d.id!==null?n=this.hls.audioTracks[d.id].details:d.type===s.PlaylistContextType.SUBTITLE_TRACK&&d.id!==null&&(n=this.hls.subtitleTracks[d.id].details),n)){var v=n.partTarget,r=n.targetduration;v&&r&&(e=Math.min(1e3*Math.max(3*v,.8*r),e))}var i={timeout:e,maxRetry:a,retryDelay:o,maxRetryDelay:u,highWaterMark:0},c={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};p.load(d,i,c)},y.loadsuccess=function(d,t,a,e){if(e===void 0&&(e=null),a.isSidxRequest)return this.handleSidxRequest(d,a),void this.handlePlaylistLoaded(d,t,a,e);this.resetInternalLoader(a.type);var o=d.data;o.indexOf("#EXTM3U")===0?(t.parsing.start=performance.now(),o.indexOf("#EXTINF:")>0||o.indexOf("#EXT-X-TARGETDURATION:")>0?this.handleTrackOrLevelPlaylist(d,t,a,e):this.handleMasterPlaylist(d,t,a,e)):this.handleManifestParsingError(d,a,"no EXTM3U delimiter",e)},y.loaderror=function(d,t,a){a===void 0&&(a=null),this.handleNetworkError(t,a,!1,d)},y.loadtimeout=function(d,t,a){a===void 0&&(a=null),this.handleNetworkError(t,a,!0)},y.handleMasterPlaylist=function(d,t,a,e){var o=this.hls,u=d.data,n=m(d,a),l=D.default.parseMasterPlaylist(u,n),p=l.levels,g=l.sessionData;if(p.length){var v=p.map(function(L){return{id:L.attrs.AUDIO,audioCodec:L.audioCodec}}),r=p.map(function(L){return{id:L.attrs.SUBTITLES,textCodec:L.textCodec}}),i=D.default.parseMasterPlaylistMedia(u,n,"AUDIO",v),c=D.default.parseMasterPlaylistMedia(u,n,"SUBTITLES",r),b=D.default.parseMasterPlaylistMedia(u,n,"CLOSED-CAPTIONS");i.length&&(i.some(function(L){return!L.url})||!p[0].audioCodec||p[0].attrs.AUDIO||(_.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),i.unshift({type:"main",name:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new S.AttrList({}),bitrate:0,url:""}))),o.trigger(E.Events.MANIFEST_LOADED,{levels:p,audioTracks:i,subtitles:c,captions:b,url:n,stats:t,networkDetails:e,sessionData:g})}else this.handleManifestParsingError(d,a,"no level found in manifest",e)},y.handleTrackOrLevelPlaylist=function(d,t,a,e){var o=this.hls,u=a.id,n=a.level,l=a.type,p=m(d,a),g=Object(R.isFiniteNumber)(u)?u:0,v=Object(R.isFiniteNumber)(n)?n:g,r=function(k){switch(k.type){case s.PlaylistContextType.AUDIO_TRACK:return s.PlaylistLevelType.AUDIO;case s.PlaylistContextType.SUBTITLE_TRACK:return s.PlaylistLevelType.SUBTITLE;default:return s.PlaylistLevelType.MAIN}}(a),i=D.default.parseLevelPlaylist(d.data,p,v,r,g);if(i.fragments.length){if(l===s.PlaylistContextType.MANIFEST){var c={attrs:new S.AttrList({}),bitrate:0,details:i,name:"",url:p};o.trigger(E.Events.MANIFEST_LOADED,{levels:[c],audioTracks:[],url:p,stats:t,networkDetails:e,sessionData:null})}if(t.parsing.end=performance.now(),i.needSidxRanges){var b,L=(b=i.fragments[0].initSegment)===null||b===void 0?void 0:b.url;this.load({url:L,isSidxRequest:!0,type:l,level:n,levelDetails:i,id:u,groupId:null,rangeStart:0,rangeEnd:2048,responseType:"arraybuffer",deliveryDirectives:null})}else a.levelDetails=i,this.handlePlaylistLoaded(d,t,a,e)}else o.trigger(E.Events.ERROR,{type:A.ErrorTypes.NETWORK_ERROR,details:A.ErrorDetails.LEVEL_EMPTY_ERROR,fatal:!1,url:p,reason:"no fragments found in level",level:typeof a.level=="number"?a.level:void 0})},y.handleSidxRequest=function(d,t){var a=Object(I.parseSegmentIndex)(new Uint8Array(d.data));if(a){var e=a.references,o=t.levelDetails;e.forEach(function(u,n){var l=u.info,p=o.fragments[n];p.byteRange.length===0&&p.setByteRange(String(1+l.end-l.start)+"@"+String(l.start)),p.initSegment&&p.initSegment.setByteRange(String(a.moovEndOffset)+"@0")})}},y.handleManifestParsingError=function(d,t,a,e){this.hls.trigger(E.Events.ERROR,{type:A.ErrorTypes.NETWORK_ERROR,details:A.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:t.type===s.PlaylistContextType.MANIFEST,url:d.url,reason:a,response:d,context:t,networkDetails:e})},y.handleNetworkError=function(d,t,a,e){a===void 0&&(a=!1),_.logger.warn("[playlist-loader]: A network "+(a?"timeout":"error")+" occurred while loading "+d.type+" level: "+d.level+" id: "+d.id+' group-id: "'+d.groupId+'"');var o=A.ErrorDetails.UNKNOWN,u=!1,n=this.getInternalLoader(d);switch(d.type){case s.PlaylistContextType.MANIFEST:o=a?A.ErrorDetails.MANIFEST_LOAD_TIMEOUT:A.ErrorDetails.MANIFEST_LOAD_ERROR,u=!0;break;case s.PlaylistContextType.LEVEL:o=a?A.ErrorDetails.LEVEL_LOAD_TIMEOUT:A.ErrorDetails.LEVEL_LOAD_ERROR,u=!1;break;case s.PlaylistContextType.AUDIO_TRACK:o=a?A.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:A.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,u=!1;break;case s.PlaylistContextType.SUBTITLE_TRACK:o=a?A.ErrorDetails.SUBTITLE_TRACK_LOAD_TIMEOUT:A.ErrorDetails.SUBTITLE_LOAD_ERROR,u=!1}n&&this.resetInternalLoader(d.type);var l={type:A.ErrorTypes.NETWORK_ERROR,details:o,fatal:u,url:d.url,loader:n,context:d,networkDetails:t};e&&(l.response=e),this.hls.trigger(E.Events.ERROR,l)},y.handlePlaylistLoaded=function(d,t,a,e){var o=a.type,u=a.level,n=a.id,l=a.groupId,p=a.loader,g=a.levelDetails,v=a.deliveryDirectives;if(g!=null&&g.targetduration){if(p)switch(g.live&&(p.getCacheAge&&(g.ageHeader=p.getCacheAge()||0),p.getCacheAge&&!isNaN(g.ageHeader)||(g.ageHeader=0)),o){case s.PlaylistContextType.MANIFEST:case s.PlaylistContextType.LEVEL:this.hls.trigger(E.Events.LEVEL_LOADED,{details:g,level:u||0,id:n||0,stats:t,networkDetails:e,deliveryDirectives:v});break;case s.PlaylistContextType.AUDIO_TRACK:this.hls.trigger(E.Events.AUDIO_TRACK_LOADED,{details:g,id:n||0,groupId:l||"",stats:t,networkDetails:e,deliveryDirectives:v});break;case s.PlaylistContextType.SUBTITLE_TRACK:this.hls.trigger(E.Events.SUBTITLE_TRACK_LOADED,{details:g,id:n||0,groupId:l||"",stats:t,networkDetails:e,deliveryDirectives:v})}}else this.handleManifestParsingError(d,a,"invalid target duration",e)},T}();C.default=h},"./src/polyfills/number.ts":function(N,C,f){f.r(C),f.d(C,"isFiniteNumber",function(){return R}),f.d(C,"MAX_SAFE_INTEGER",function(){return E});var R=Number.isFinite||function(A){return typeof A=="number"&&isFinite(A)},E=Number.MAX_SAFE_INTEGER||9007199254740991},"./src/remux/aac-helper.ts":function(N,C,f){f.r(C);var R=function(){function E(){}return E.getSilentFrame=function(A,_){switch(A){case"mp4a.40.2":if(_===1)return new Uint8Array([0,200,0,128,35,128]);if(_===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(_===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(_===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(_===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(_===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(_===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(_===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(_===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}},E}();C.default=R},"./src/remux/mp4-generator.ts":function(N,C,f){f.r(C);var R=Math.pow(2,32)-1,E=function(){function A(){}return A.init=function(){var _;for(_ in A.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]},A.types)A.types.hasOwnProperty(_)&&(A.types[_]=[_.charCodeAt(0),_.charCodeAt(1),_.charCodeAt(2),_.charCodeAt(3)]);var I=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),D=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);A.HDLR_TYPES={video:I,audio:D};var s=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),S=new Uint8Array([0,0,0,0,0,0,0,0]);A.STTS=A.STSC=A.STCO=S,A.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),A.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),A.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),A.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var m=new Uint8Array([105,115,111,109]),h=new Uint8Array([97,118,99,49]),T=new Uint8Array([0,0,0,1]);A.FTYP=A.box(A.types.ftyp,m,T,m,h),A.DINF=A.box(A.types.dinf,A.box(A.types.dref,s))},A.box=function(_){for(var I=8,D=arguments.length,s=new Array(D>1?D-1:0),S=1;S<D;S++)s[S-1]=arguments[S];for(var m=s.length,h=m;m--;)I+=s[m].byteLength;var T=new Uint8Array(I);for(T[0]=I>>24&255,T[1]=I>>16&255,T[2]=I>>8&255,T[3]=255&I,T.set(_,4),m=0,I=8;m<h;m++)T.set(s[m],I),I+=s[m].byteLength;return T},A.hdlr=function(_){return A.box(A.types.hdlr,A.HDLR_TYPES[_])},A.mdat=function(_){return A.box(A.types.mdat,_)},A.mdhd=function(_,I){I*=_;var D=Math.floor(I/(R+1)),s=Math.floor(I%(R+1));return A.box(A.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,_>>24&255,_>>16&255,_>>8&255,255&_,D>>24,D>>16&255,D>>8&255,255&D,s>>24,s>>16&255,s>>8&255,255&s,85,196,0,0]))},A.mdia=function(_){return A.box(A.types.mdia,A.mdhd(_.timescale,_.duration),A.hdlr(_.type),A.minf(_))},A.mfhd=function(_){return A.box(A.types.mfhd,new Uint8Array([0,0,0,0,_>>24,_>>16&255,_>>8&255,255&_]))},A.minf=function(_){return _.type==="audio"?A.box(A.types.minf,A.box(A.types.smhd,A.SMHD),A.DINF,A.stbl(_)):A.box(A.types.minf,A.box(A.types.vmhd,A.VMHD),A.DINF,A.stbl(_))},A.moof=function(_,I,D){return A.box(A.types.moof,A.mfhd(_),A.traf(D,I))},A.moov=function(_){for(var I=_.length,D=[];I--;)D[I]=A.trak(_[I]);return A.box.apply(null,[A.types.moov,A.mvhd(_[0].timescale,_[0].duration)].concat(D).concat(A.mvex(_)))},A.mvex=function(_){for(var I=_.length,D=[];I--;)D[I]=A.trex(_[I]);return A.box.apply(null,[A.types.mvex].concat(D))},A.mvhd=function(_,I){I*=_;var D=Math.floor(I/(R+1)),s=Math.floor(I%(R+1)),S=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,_>>24&255,_>>16&255,_>>8&255,255&_,D>>24,D>>16&255,D>>8&255,255&D,s>>24,s>>16&255,s>>8&255,255&s,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return A.box(A.types.mvhd,S)},A.sdtp=function(_){var I,D,s=_.samples||[],S=new Uint8Array(4+s.length);for(I=0;I<s.length;I++)D=s[I].flags,S[I+4]=D.dependsOn<<4|D.isDependedOn<<2|D.hasRedundancy;return A.box(A.types.sdtp,S)},A.stbl=function(_){return A.box(A.types.stbl,A.stsd(_),A.box(A.types.stts,A.STTS),A.box(A.types.stsc,A.STSC),A.box(A.types.stsz,A.STSZ),A.box(A.types.stco,A.STCO))},A.avc1=function(_){var I,D,s,S=[],m=[];for(I=0;I<_.sps.length;I++)s=(D=_.sps[I]).byteLength,S.push(s>>>8&255),S.push(255&s),S=S.concat(Array.prototype.slice.call(D));for(I=0;I<_.pps.length;I++)s=(D=_.pps[I]).byteLength,m.push(s>>>8&255),m.push(255&s),m=m.concat(Array.prototype.slice.call(D));var h=A.box(A.types.avcC,new Uint8Array([1,S[3],S[4],S[5],255,224|_.sps.length].concat(S).concat([_.pps.length]).concat(m))),T=_.width,y=_.height,d=_.pixelRatio[0],t=_.pixelRatio[1];return A.box(A.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,T>>8&255,255&T,y>>8&255,255&y,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),h,A.box(A.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),A.box(A.types.pasp,new Uint8Array([d>>24,d>>16&255,d>>8&255,255&d,t>>24,t>>16&255,t>>8&255,255&t])))},A.esds=function(_){var I=_.config.length;return new Uint8Array([0,0,0,0,3,23+I,0,1,0,4,15+I,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([I]).concat(_.config).concat([6,1,2]))},A.mp4a=function(_){var I=_.samplerate;return A.box(A.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,_.channelCount,0,16,0,0,0,0,I>>8&255,255&I,0,0]),A.box(A.types.esds,A.esds(_)))},A.mp3=function(_){var I=_.samplerate;return A.box(A.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,_.channelCount,0,16,0,0,0,0,I>>8&255,255&I,0,0]))},A.stsd=function(_){return _.type==="audio"?_.isAAC||_.codec!=="mp3"?A.box(A.types.stsd,A.STSD,A.mp4a(_)):A.box(A.types.stsd,A.STSD,A.mp3(_)):A.box(A.types.stsd,A.STSD,A.avc1(_))},A.tkhd=function(_){var I=_.id,D=_.duration*_.timescale,s=_.width,S=_.height,m=Math.floor(D/(R+1)),h=Math.floor(D%(R+1));return A.box(A.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,I>>24&255,I>>16&255,I>>8&255,255&I,0,0,0,0,m>>24,m>>16&255,m>>8&255,255&m,h>>24,h>>16&255,h>>8&255,255&h,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,s>>8&255,255&s,0,0,S>>8&255,255&S,0,0]))},A.traf=function(_,I){var D=A.sdtp(_),s=_.id,S=Math.floor(I/(R+1)),m=Math.floor(I%(R+1));return A.box(A.types.traf,A.box(A.types.tfhd,new Uint8Array([0,0,0,0,s>>24,s>>16&255,s>>8&255,255&s])),A.box(A.types.tfdt,new Uint8Array([1,0,0,0,S>>24,S>>16&255,S>>8&255,255&S,m>>24,m>>16&255,m>>8&255,255&m])),A.trun(_,D.length+16+20+8+16+8+8),D)},A.trak=function(_){return _.duration=_.duration||4294967295,A.box(A.types.trak,A.tkhd(_),A.mdia(_))},A.trex=function(_){var I=_.id;return A.box(A.types.trex,new Uint8Array([0,0,0,0,I>>24,I>>16&255,I>>8&255,255&I,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))},A.trun=function(_,I){var D,s,S,m,h,T,y=_.samples||[],d=y.length,t=12+16*d,a=new Uint8Array(t);for(I+=8+t,a.set([0,0,15,1,d>>>24&255,d>>>16&255,d>>>8&255,255&d,I>>>24&255,I>>>16&255,I>>>8&255,255&I],0),D=0;D<d;D++)S=(s=y[D]).duration,m=s.size,h=s.flags,T=s.cts,a.set([S>>>24&255,S>>>16&255,S>>>8&255,255&S,m>>>24&255,m>>>16&255,m>>>8&255,255&m,h.isLeading<<2|h.dependsOn,h.isDependedOn<<6|h.hasRedundancy<<4|h.paddingValue<<1|h.isNonSync,61440&h.degradPrio,15&h.degradPrio,T>>>24&255,T>>>16&255,T>>>8&255,255&T],12+16*D);return A.box(A.types.trun,a)},A.initSegment=function(_){A.types||A.init();var I=A.moov(_),D=new Uint8Array(A.FTYP.byteLength+I.byteLength);return D.set(A.FTYP),D.set(I,A.FTYP.byteLength),D},A}();E.types=void 0,E.HDLR_TYPES=void 0,E.STTS=void 0,E.STSC=void 0,E.STCO=void 0,E.STSZ=void 0,E.VMHD=void 0,E.SMHD=void 0,E.STSD=void 0,E.FTYP=void 0,E.DINF=void 0,C.default=E},"./src/remux/mp4-remuxer.ts":function(N,C,f){f.r(C),f.d(C,"default",function(){return d}),f.d(C,"normalizePts",function(){return t});var R=f("./src/polyfills/number.ts"),E=f("./src/remux/aac-helper.ts"),A=f("./src/remux/mp4-generator.ts"),_=f("./src/events.ts"),I=f("./src/errors.ts"),D=f("./src/utils/logger.ts"),s=f("./src/types/loader.ts"),S=f("./src/utils/timescale-conversion.ts");function m(){return(m=Object.assign||function(o){for(var u=1;u<arguments.length;u++){var n=arguments[u];for(var l in n)Object.prototype.hasOwnProperty.call(n,l)&&(o[l]=n[l])}return o}).apply(this,arguments)}var h=null,T=null,y=!1,d=function(){function o(n,l,p,g){if(this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=void 0,this._initDTS=void 0,this.nextAvcDts=null,this.nextAudioPts=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.observer=n,this.config=l,this.typeSupported=p,this.ISGenerated=!1,h===null){var v=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);h=v?parseInt(v[1]):0}if(T===null){var r=navigator.userAgent.match(/Safari\/(\d+)/i);T=r?parseInt(r[1]):0}y=!!h&&h<75||!!T&&T<600}var u=o.prototype;return u.destroy=function(){},u.resetTimeStamp=function(n){D.logger.log("[mp4-remuxer]: initPTS & initDTS reset"),this._initPTS=this._initDTS=n},u.resetNextTimestamp=function(){D.logger.log("[mp4-remuxer]: reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1},u.resetInitSegment=function(){D.logger.log("[mp4-remuxer]: ISGenerated flag reset"),this.ISGenerated=!1},u.getVideoStartPts=function(n){var l=!1,p=n.reduce(function(g,v){var r=v.pts-g;return r<-4294967296?(l=!0,t(g,v.pts)):r>0?g:v.pts},n[0].pts);return l&&D.logger.debug("PTS rollover detected"),p},u.remux=function(n,l,p,g,v,r,i,c){var b,L,k,O,w,x,P=v,F=v,M=n.pid>-1,B=l.pid>-1,U=l.samples.length,G=n.samples.length>0,V=U>1;if((!M||G)&&(!B||V)||this.ISGenerated||i){this.ISGenerated||(k=this.generateIS(n,l,v));var H=this.isVideoContiguous,Y=-1;if(V&&(Y=function(it){for(var Q=0;Q<it.length;Q++)if(it[Q].key)return Q;return-1}(l.samples),!H&&this.config.forceKeyFrameOnDiscontinuity))if(x=!0,Y>0){D.logger.warn("[mp4-remuxer]: Dropped "+Y+" out of "+U+" video samples due to a missing keyframe");var W=this.getVideoStartPts(l.samples);l.samples=l.samples.slice(Y),l.dropped+=Y,F+=(l.samples[0].pts-W)/(l.timescale||9e4)}else Y===-1&&(D.logger.warn("[mp4-remuxer]: No keyframe found out of "+U+" video samples"),x=!1);if(this.ISGenerated){if(G&&V){var q=this.getVideoStartPts(l.samples),J=(t(n.samples[0].pts,q)-q)/l.inputTimeScale;P+=Math.max(0,J),F+=Math.max(0,-J)}if(G){if(n.samplerate||(D.logger.warn("[mp4-remuxer]: regenerate InitSegment as audio detected"),k=this.generateIS(n,l,v)),L=this.remuxAudio(n,P,this.isAudioContiguous,r,B||V||c===s.PlaylistLevelType.AUDIO?F:void 0),V){var rt=L?L.endPTS-L.startPTS:0;l.inputTimeScale||(D.logger.warn("[mp4-remuxer]: regenerate InitSegment as video detected"),k=this.generateIS(n,l,v)),b=this.remuxVideo(l,F,H,rt)}}else V&&(b=this.remuxVideo(l,F,H,0));b&&(b.firstKeyFrame=Y,b.independent=Y!==-1)}}return this.ISGenerated&&(p.samples.length&&(w=this.remuxID3(p,v)),g.samples.length&&(O=this.remuxText(g,v))),{audio:L,video:b,initSegment:k,independent:x,text:O,id3:w}},u.generateIS=function(n,l,p){var g,v,r,i=n.samples,c=l.samples,b=this.typeSupported,L={},k=!Object(R.isFiniteNumber)(this._initPTS),O="audio/mp4";if(k&&(g=v=1/0),n.config&&i.length&&(n.timescale=n.samplerate,n.isAAC||(b.mpeg?(O="audio/mpeg",n.codec=""):b.mp3&&(n.codec="mp3")),L.audio={id:"audio",container:O,codec:n.codec,initSegment:!n.isAAC&&b.mpeg?new Uint8Array(0):A.default.initSegment([n]),metadata:{channelCount:n.channelCount}},k&&(r=n.inputTimeScale,g=v=i[0].pts-Math.round(r*p))),l.sps&&l.pps&&c.length&&(l.timescale=l.inputTimeScale,L.video={id:"main",container:"video/mp4",codec:l.codec,initSegment:A.default.initSegment([l]),metadata:{width:l.width,height:l.height}},k)){r=l.inputTimeScale;var w=this.getVideoStartPts(c),x=Math.round(r*p);v=Math.min(v,t(c[0].dts,w)-x),g=Math.min(g,w-x)}if(Object.keys(L).length)return this.ISGenerated=!0,k&&(this._initPTS=g,this._initDTS=v),{tracks:L,initPTS:g,timescale:r}},u.remuxVideo=function(n,l,p,g){var v,r,i,c=n.inputTimeScale,b=n.samples,L=[],k=b.length,O=this._initPTS,w=this.nextAvcDts,x=8,P=Number.POSITIVE_INFINITY,F=Number.NEGATIVE_INFINITY,M=0,B=!1;p&&w!==null||(w=l*c-(b[0].pts-t(b[0].dts,b[0].pts)));for(var U=0;U<k;U++){var G=b[U];G.pts=t(G.pts-O,w),G.dts=t(G.dts-O,w),G.dts>G.pts&&(M=Math.max(Math.min(M,G.pts-G.dts),-18e3)),G.dts<b[U>0?U-1:U].dts&&(B=!0)}B&&b.sort(function(Tt,Ot){var Se=Tt.dts-Ot.dts,be=Tt.pts-Ot.pts;return Se||be}),r=b[0].dts,i=b[b.length-1].dts;var V=Math.round((i-r)/(k-1));if(M<0){if(M<-2*V){D.logger.warn("PTS < DTS detected in video samples, offsetting DTS from PTS by "+Object(S.toMsFromMpegTsClock)(-V,!0)+" ms");for(var H=M,Y=0;Y<k;Y++)b[Y].dts=H=Math.max(H,b[Y].pts-V),b[Y].pts=Math.max(H,b[Y].pts)}else{D.logger.warn("PTS < DTS detected in video samples, shifting DTS by "+Object(S.toMsFromMpegTsClock)(M,!0)+" ms to overcome this issue");for(var W=0;W<k;W++)b[W].dts=b[W].dts+M}r=b[0].dts}if(p){var q=r-w,J=q>V;if(J||q<-1){J?D.logger.warn("AVC: "+Object(S.toMsFromMpegTsClock)(q,!0)+" ms ("+q+"dts) hole between fragments detected, filling it"):D.logger.warn("AVC: "+Object(S.toMsFromMpegTsClock)(-q,!0)+" ms ("+q+"dts) overlapping between fragments detected"),r=w;var rt=b[0].pts-q;b[0].dts=r,b[0].pts=rt,D.logger.log("Video: First PTS/DTS adjusted: "+Object(S.toMsFromMpegTsClock)(rt,!0)+"/"+Object(S.toMsFromMpegTsClock)(r,!0)+", delta: "+Object(S.toMsFromMpegTsClock)(q,!0)+" ms")}}y&&(r=Math.max(0,r));for(var it=0,Q=0,st=0;st<k;st++){for(var $=b[st],et=$.units,at=et.length,nt=0,ct=0;ct<at;ct++)nt+=et[ct].data.length;Q+=nt,it+=at,$.length=nt,$.dts=Math.max($.dts,r),$.pts=Math.max($.pts,$.dts,0),P=Math.min($.pts,P),F=Math.max($.pts,F)}i=b[k-1].dts;var vt,pt=Q+4*it+8;try{vt=new Uint8Array(pt)}catch{return void this.observer.emit(_.Events.ERROR,_.Events.ERROR,{type:I.ErrorTypes.MUX_ERROR,details:I.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:pt,reason:"fail allocating video mdat "+pt})}var yt=new DataView(vt.buffer);yt.setUint32(0,pt),vt.set(A.default.types.mdat,4);for(var ut=0;ut<k;ut++){for(var lt=b[ut],Nt=lt.units,Et=0,Lt=0,Bt=Nt.length;Lt<Bt;Lt++){var It=Nt[Lt],St=It.data,Yt=It.data.byteLength;yt.setUint32(x,Yt),x+=4,vt.set(St,x),x+=Yt,Et+=4+Yt}if(ut<k-1)v=b[ut+1].dts-lt.dts;else{var Ut=this.config,bt=lt.dts-b[ut>0?ut-1:ut].dts;if(Ut.stretchShortVideoTrack&&this.nextAudioPts!==null){var qt=Math.floor(Ut.maxBufferHole*c),Gt=(g?P+g*c:this.nextAudioPts)-lt.pts;Gt>qt?((v=Gt-bt)<0&&(v=bt),D.logger.log("[mp4-remuxer]: It is approximately "+Gt/90+" ms to the next segment; using duration "+v/90+" ms for the last video frame.")):v=bt}else v=bt}var Ct=Math.round(lt.pts-lt.dts);L.push(new a(lt.key,v,Et,Ct))}if(L.length&&h&&h<70){var At=L[0].flags;At.dependsOn=2,At.isNonSync=0}console.assert(v!==void 0,"mp4SampleDuration must be computed"),this.nextAvcDts=w=i+v,this.isVideoContiguous=!0;var wt={data1:A.default.moof(n.sequenceNumber++,r,m({},n,{samples:L})),data2:vt,startPTS:P/c,endPTS:(F+v)/c,startDTS:r/c,endDTS:w/c,type:"video",hasAudio:!1,hasVideo:!0,nb:L.length,dropped:n.dropped};return n.samples=[],n.dropped=0,console.assert(vt.length,"MDAT length must not be zero"),wt},u.remuxAudio=function(n,l,p,g,v){var r=n.inputTimeScale,i=r/(n.samplerate?n.samplerate:r),c=n.isAAC?1024:1152,b=c*i,L=this._initPTS,k=!n.isAAC&&this.typeSupported.mpeg,O=[],w=n.samples,x=k?0:8,P=this.nextAudioPts||-1,F=l*r;if(this.isAudioContiguous=p=p||w.length&&P>0&&(g&&Math.abs(F-P)<9e3||Math.abs(t(w[0].pts-L,F)-P)<20*b),w.forEach(function(St){St.pts=t(St.pts-L,F)}),!p||P<0){if(!(w=w.filter(function(St){return St.pts>=0})).length)return;P=v===0?0:g?Math.max(0,F):w[0].pts}if(n.isAAC)for(var M=v!==void 0,B=this.config.maxAudioFramesDrift,U=0,G=P;U<w.length;U++){var V=w[U],H=V.pts,Y=H-G,W=Math.abs(1e3*Y/r);if(Y<=-B*b&&M)U===0&&(D.logger.warn("Audio frame @ "+(H/r).toFixed(3)+"s overlaps nextAudioPts by "+Math.round(1e3*Y/r)+" ms."),this.nextAudioPts=P=G=H);else if(Y>=B*b&&W<1e4&&M){var q=Math.round(Y/b);(G=H-q*b)<0&&(q--,G+=b),U===0&&(this.nextAudioPts=P=G),D.logger.warn("[mp4-remuxer]: Injecting "+q+" audio frame @ "+(G/r).toFixed(3)+"s due to "+Math.round(1e3*Y/r)+" ms gap.");for(var J=0;J<q;J++){var rt=Math.max(G,0),it=E.default.getSilentFrame(n.manifestCodec||n.codec,n.channelCount);it||(D.logger.log("[mp4-remuxer]: Unable to get silent frame for given audio codec; duplicating last frame instead."),it=V.unit.subarray()),w.splice(U,0,{unit:it,pts:rt}),G+=b,U++}}V.pts=G,G+=b}for(var Q,st=null,$=null,et=0,at=w.length;at--;)et+=w[at].unit.byteLength;for(var nt=0,ct=w.length;nt<ct;nt++){var vt=w[nt],pt=vt.unit,yt=vt.pts;if($!==null)O[nt-1].duration=Math.round((yt-$)/i);else{if(p&&n.isAAC&&(yt=P),st=yt,!(et>0))return;et+=x;try{Q=new Uint8Array(et)}catch{return void this.observer.emit(_.Events.ERROR,_.Events.ERROR,{type:I.ErrorTypes.MUX_ERROR,details:I.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:et,reason:"fail allocating audio mdat "+et})}k||(new DataView(Q.buffer).setUint32(0,et),Q.set(A.default.types.mdat,4))}Q.set(pt,x);var ut=pt.byteLength;x+=ut,O.push(new a(!0,c,ut,0)),$=yt}var lt=O.length;if(lt){var Nt=O[O.length-1];this.nextAudioPts=P=$+i*Nt.duration;var Et=k?new Uint8Array(0):A.default.moof(n.sequenceNumber++,st/i,m({},n,{samples:O}));n.samples=[];var Lt=st/r,Bt=P/r,It={data1:Et,data2:Q,startPTS:Lt,endPTS:Bt,startDTS:Lt,endDTS:Bt,type:"audio",hasAudio:!0,hasVideo:!1,nb:lt};return this.isAudioContiguous=!0,console.assert(Q.length,"MDAT length must not be zero"),It}},u.remuxEmptyAudio=function(n,l,p,g){var v=n.inputTimeScale,r=v/(n.samplerate?n.samplerate:v),i=this.nextAudioPts,c=(i!==null?i:g.startDTS*v)+this._initDTS,b=g.endDTS*v+this._initDTS,L=1024*r,k=Math.ceil((b-c)/L),O=E.default.getSilentFrame(n.manifestCodec||n.codec,n.channelCount);if(D.logger.warn("[mp4-remuxer]: remux empty Audio"),O){for(var w=[],x=0;x<k;x++){var P=c+x*L;w.push({unit:O,pts:P,dts:P})}return n.samples=w,this.remuxAudio(n,l,p,!1)}D.logger.trace("[mp4-remuxer]: Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec")},u.remuxID3=function(n,l){var p=n.samples.length;if(p){for(var g=n.inputTimeScale,v=this._initPTS,r=this._initDTS,i=0;i<p;i++){var c=n.samples[i];c.pts=t(c.pts-v,l*g)/g,c.dts=t(c.dts-r,l*g)/g}var b=n.samples;return n.samples=[],{samples:b}}},u.remuxText=function(n,l){var p=n.samples.length;if(p){for(var g=n.inputTimeScale,v=this._initPTS,r=0;r<p;r++){var i=n.samples[r];i.pts=t(i.pts-v,l*g)/g}n.samples.sort(function(b,L){return b.pts-L.pts});var c=n.samples;return n.samples=[],{samples:c}}},o}();function t(o,u){var n;if(u===null)return o;for(n=u<o?-8589934592:8589934592;Math.abs(o-u)>4294967296;)o+=n;return o}var a=function(o,u,n,l){this.size=void 0,this.duration=void 0,this.cts=void 0,this.flags=void 0,this.duration=u,this.size=n,this.cts=l,this.flags=new e(o)},e=function(o){this.isLeading=0,this.isDependedOn=0,this.hasRedundancy=0,this.degradPrio=0,this.dependsOn=1,this.isNonSync=1,this.dependsOn=o?2:1,this.isNonSync=o?0:1}},"./src/remux/passthrough-remuxer.ts":function(N,C,f){f.r(C);var R=f("./src/polyfills/number.ts"),E=f("./src/utils/mp4-tools.ts"),A=f("./src/loader/fragment.ts"),_=f("./src/utils/logger.ts"),I=function(){function S(){this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=void 0,this.initTracks=void 0,this.lastEndDTS=null}var m=S.prototype;return m.destroy=function(){},m.resetTimeStamp=function(h){this.initPTS=h,this.lastEndDTS=null},m.resetNextTimestamp=function(){this.lastEndDTS=null},m.resetInitSegment=function(h,T,y){this.audioCodec=T,this.videoCodec=y,this.generateInitSegment(h),this.emitInitSegment=!0},m.generateInitSegment=function(h){var T=this.audioCodec,y=this.videoCodec;if(!h||!h.byteLength)return this.initTracks=void 0,void(this.initData=void 0);var d=this.initData=Object(E.parseInitSegment)(h);T||(T=s(d.audio,A.ElementaryStreamTypes.AUDIO)),y||(y=s(d.video,A.ElementaryStreamTypes.VIDEO));var t={};d.audio&&d.video?t.audiovideo={container:"video/mp4",codec:T+","+y,initSegment:h,id:"main"}:d.audio?t.audio={container:"audio/mp4",codec:T,initSegment:h,id:"audio"}:d.video?t.video={container:"video/mp4",codec:y,initSegment:h,id:"main"}:_.logger.warn("[passthrough-remuxer.ts]: initSegment does not contain moov or trak boxes."),this.initTracks=t},m.remux=function(h,T,y,d,t){var a=this.initPTS,e=this.lastEndDTS,o={audio:void 0,video:void 0,text:d,id3:y,initSegment:void 0};Object(R.isFiniteNumber)(e)||(e=this.lastEndDTS=t||0);var u=T.samples;if(!u||!u.length)return o;var n={initPTS:void 0,timescale:1},l=this.initData;if(l&&l.length||(this.generateInitSegment(u),l=this.initData),!l||!l.length)return _.logger.warn("[passthrough-remuxer.ts]: Failed to generate initSegment."),o;this.emitInitSegment&&(n.tracks=this.initTracks,this.emitInitSegment=!1),Object(R.isFiniteNumber)(a)||(this.initPTS=n.initPTS=a=D(l,u,e));var p=Object(E.getDuration)(u,l),g=e,v=p+g;Object(E.offsetStartDTS)(l,u,a),p>0?this.lastEndDTS=v:(_.logger.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());var r=!!l.audio,i=!!l.video,c="";r&&(c+="audio"),i&&(c+="video");var b={data1:u,startPTS:g,startDTS:g,endPTS:v,endDTS:v,type:c,hasAudio:r,hasVideo:i,nb:1,dropped:0};return o.audio=b.type==="audio"?b:void 0,o.video=b.type!=="audio"?b:void 0,o.text=d,o.id3=y,o.initSegment=n,o},S}(),D=function(S,m,h){return Object(E.getStartDTS)(S,m)-h};function s(S,m){var h=S==null?void 0:S.codec;return h&&h.length>4?h:h==="hvc1"?"hvc1.1.c.L120.90":h==="av01"?"av01.0.04M.08":h==="avc1"||m===A.ElementaryStreamTypes.VIDEO?"avc1.42e01e":"mp4a.40.5"}C.default=I},"./src/task-loop.ts":function(N,C,f){f.r(C),f.d(C,"default",function(){return R});var R=function(){function E(){this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}var A=E.prototype;return A.destroy=function(){this.onHandlerDestroying(),this.onHandlerDestroyed()},A.onHandlerDestroying=function(){this.clearNextTick(),this.clearInterval()},A.onHandlerDestroyed=function(){},A.hasInterval=function(){return!!this._tickInterval},A.hasNextTick=function(){return!!this._tickTimer},A.setInterval=function(_){return!this._tickInterval&&(this._tickInterval=self.setInterval(this._boundTick,_),!0)},A.clearInterval=function(){return!!this._tickInterval&&(self.clearInterval(this._tickInterval),this._tickInterval=null,!0)},A.clearNextTick=function(){return!!this._tickTimer&&(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0)},A.tick=function(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)},A.tickImmediate=function(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)},A.doTick=function(){},E}()},"./src/types/level.ts":function(N,C,f){function R(s,S){for(var m=0;m<S.length;m++){var h=S[m];h.enumerable=h.enumerable||!1,h.configurable=!0,"value"in h&&(h.writable=!0),Object.defineProperty(s,h.key,h)}}var E,A;function _(s,S){var m=s.canSkipUntil,h=s.canSkipDateRanges,T=s.endSN;return m&&(S!==void 0?S-T:0)<m?h?E.v2:E.Yes:E.No}f.r(C),f.d(C,"HlsSkip",function(){return E}),f.d(C,"getSkipValue",function(){return _}),f.d(C,"HlsUrlParameters",function(){return I}),f.d(C,"Level",function(){return D}),(A=E||(E={})).No="",A.Yes="YES",A.v2="v2";var I=function(){function s(S,m,h){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=S,this.part=m,this.skip=h}return s.prototype.addDirectives=function(S){var m=new self.URL(S);return this.msn!==void 0&&m.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&m.searchParams.set("_HLS_part",this.part.toString()),this.skip&&m.searchParams.set("_HLS_skip",this.skip),m.toString()},s}(),D=function(){function s(h){this.attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.videoCodec=void 0,this.width=void 0,this.unknownCodecs=void 0,this.audioGroupIds=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.textGroupIds=void 0,this.url=void 0,this._urlId=0,this.url=[h.url],this.attrs=h.attrs,this.bitrate=h.bitrate,h.details&&(this.details=h.details),this.id=h.id||0,this.name=h.name,this.width=h.width||0,this.height=h.height||0,this.audioCodec=h.audioCodec,this.videoCodec=h.videoCodec,this.unknownCodecs=h.unknownCodecs,this.codecSet=[h.videoCodec,h.audioCodec].filter(function(T){return T}).join(",").replace(/\.[^.,]+/g,"")}var S,m;return S=s,(m=[{key:"maxBitrate",get:function(){return Math.max(this.realBitrate,this.bitrate)}},{key:"uri",get:function(){return this.url[this._urlId]||""}},{key:"urlId",get:function(){return this._urlId},set:function(h){var T=h%this.url.length;this._urlId!==T&&(this.details=void 0,this._urlId=T)}}])&&R(S.prototype,m),s}()},"./src/types/loader.ts":function(N,C,f){var R,E,A,_;f.r(C),f.d(C,"PlaylistContextType",function(){return R}),f.d(C,"PlaylistLevelType",function(){return A}),(E=R||(R={})).MANIFEST="manifest",E.LEVEL="level",E.AUDIO_TRACK="audioTrack",E.SUBTITLE_TRACK="subtitleTrack",(_=A||(A={})).MAIN="main",_.AUDIO="audio",_.SUBTITLE="subtitle"},"./src/types/transmuxer.ts":function(N,C,f){f.r(C),f.d(C,"ChunkMetadata",function(){return R});var R=function(E,A,_,I,D,s){I===void 0&&(I=0),D===void 0&&(D=-1),s===void 0&&(s=!1),this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing={start:0,executeStart:0,executeEnd:0,end:0},this.buffering={audio:{start:0,executeStart:0,executeEnd:0,end:0},video:{start:0,executeStart:0,executeEnd:0,end:0},audiovideo:{start:0,executeStart:0,executeEnd:0,end:0}},this.level=E,this.sn=A,this.id=_,this.size=I,this.part=D,this.partial=s}},"./src/utils/attr-list.ts":function(N,C,f){f.r(C),f.d(C,"AttrList",function(){return A});var R=/^(\d+)x(\d+)$/,E=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g,A=function(){function _(D){for(var s in typeof D=="string"&&(D=_.parseAttrList(D)),D)D.hasOwnProperty(s)&&(this[s]=D[s])}var I=_.prototype;return I.decimalInteger=function(D){var s=parseInt(this[D],10);return s>Number.MAX_SAFE_INTEGER?1/0:s},I.hexadecimalInteger=function(D){if(this[D]){var s=(this[D]||"0x").slice(2);s=(1&s.length?"0":"")+s;for(var S=new Uint8Array(s.length/2),m=0;m<s.length/2;m++)S[m]=parseInt(s.slice(2*m,2*m+2),16);return S}return null},I.hexadecimalIntegerAsNumber=function(D){var s=parseInt(this[D],16);return s>Number.MAX_SAFE_INTEGER?1/0:s},I.decimalFloatingPoint=function(D){return parseFloat(this[D])},I.optionalFloat=function(D,s){var S=this[D];return S?parseFloat(S):s},I.enumeratedString=function(D){return this[D]},I.bool=function(D){return this[D]==="YES"},I.decimalResolution=function(D){var s=R.exec(this[D]);if(s!==null)return{width:parseInt(s[1],10),height:parseInt(s[2],10)}},_.parseAttrList=function(D){var s,S={};for(E.lastIndex=0;(s=E.exec(D))!==null;){var m=s[2];m.indexOf('"')===0&&m.lastIndexOf('"')===m.length-1&&(m=m.slice(1,-1)),S[s[1]]=m}return S},_}()},"./src/utils/binary-search.ts":function(N,C,f){f.r(C),C.default={search:function(R,E){for(var A=0,_=R.length-1,I=null,D=null;A<=_;){var s=E(D=R[I=(A+_)/2|0]);if(s>0)A=I+1;else{if(!(s<0))return D;_=I-1}}return null}}},"./src/utils/buffer-helper.ts":function(N,C,f){f.r(C),f.d(C,"BufferHelper",function(){return A});var R=f("./src/utils/logger.ts"),E={length:0,start:function(){return 0},end:function(){return 0}},A=function(){function _(){}return _.isBuffered=function(I,D){try{if(I){for(var s=_.getBuffered(I),S=0;S<s.length;S++)if(D>=s.start(S)&&D<=s.end(S))return!0}}catch{}return!1},_.bufferInfo=function(I,D,s){try{if(I){var S,m=_.getBuffered(I),h=[];for(S=0;S<m.length;S++)h.push({start:m.start(S),end:m.end(S)});return this.bufferedInfo(h,D,s)}}catch{}return{len:0,start:D,end:D,nextStart:void 0}},_.bufferedInfo=function(I,D,s){D=Math.max(0,D),I.sort(function(n,l){var p=n.start-l.start;return p||l.end-n.end});var S=[];if(s)for(var m=0;m<I.length;m++){var h=S.length;if(h){var T=S[h-1].end;I[m].start-T<s?I[m].end>T&&(S[h-1].end=I[m].end):S.push(I[m])}else S.push(I[m])}else S=I;for(var y,d=0,t=D,a=D,e=0;e<S.length;e++){var o=S[e].start,u=S[e].end;if(D+s>=o&&D<u)t=o,d=(a=u)-D;else if(D+s<o){y=o;break}}return{len:d,start:t||0,end:a||0,nextStart:y}},_.getBuffered=function(I){try{return I.buffered}catch(D){return R.logger.log("failed to get media.buffered",D),E}},_}()},"./src/utils/cea-608-parser.ts":function(N,C,f){f.r(C),f.d(C,"Row",function(){return o}),f.d(C,"CaptionScreen",function(){return u});var R,E,A=f("./src/utils/logger.ts"),_={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},I=function(v){var r=v;return _.hasOwnProperty(v)&&(r=_[v]),String.fromCharCode(r)},D=15,s=100,S={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},m={17:2,18:4,21:6,22:8,23:10,19:13,20:15},h={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},T={25:2,26:4,29:6,30:8,31:10,27:13,28:15},y=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];(E=R||(R={}))[E.ERROR=0]="ERROR",E[E.TEXT=1]="TEXT",E[E.WARNING=2]="WARNING",E[E.INFO=2]="INFO",E[E.DEBUG=3]="DEBUG",E[E.DATA=3]="DATA";var d=function(){function v(){this.time=null,this.verboseLevel=R.ERROR}return v.prototype.log=function(r,i){this.verboseLevel>=r&&A.logger.log(this.time+" ["+r+"] "+i)},v}(),t=function(v){for(var r=[],i=0;i<v.length;i++)r.push(v[i].toString(16));return r},a=function(){function v(i,c,b,L,k){this.foreground=void 0,this.underline=void 0,this.italics=void 0,this.background=void 0,this.flash=void 0,this.foreground=i||"white",this.underline=c||!1,this.italics=b||!1,this.background=L||"black",this.flash=k||!1}var r=v.prototype;return r.reset=function(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1},r.setStyles=function(i){for(var c=["foreground","underline","italics","background","flash"],b=0;b<c.length;b++){var L=c[b];i.hasOwnProperty(L)&&(this[L]=i[L])}},r.isDefault=function(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash},r.equals=function(i){return this.foreground===i.foreground&&this.underline===i.underline&&this.italics===i.italics&&this.background===i.background&&this.flash===i.flash},r.copy=function(i){this.foreground=i.foreground,this.underline=i.underline,this.italics=i.italics,this.background=i.background,this.flash=i.flash},r.toString=function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash},v}(),e=function(){function v(i,c,b,L,k,O){this.uchar=void 0,this.penState=void 0,this.uchar=i||" ",this.penState=new a(c,b,L,k,O)}var r=v.prototype;return r.reset=function(){this.uchar=" ",this.penState.reset()},r.setChar=function(i,c){this.uchar=i,this.penState.copy(c)},r.setPenState=function(i){this.penState.copy(i)},r.equals=function(i){return this.uchar===i.uchar&&this.penState.equals(i.penState)},r.copy=function(i){this.uchar=i.uchar,this.penState.copy(i.penState)},r.isEmpty=function(){return this.uchar===" "&&this.penState.isDefault()},v}(),o=function(){function v(i){this.chars=void 0,this.pos=void 0,this.currPenState=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chars=[];for(var c=0;c<s;c++)this.chars.push(new e);this.logger=i,this.pos=0,this.currPenState=new a}var r=v.prototype;return r.equals=function(i){for(var c=!0,b=0;b<s;b++)if(!this.chars[b].equals(i.chars[b])){c=!1;break}return c},r.copy=function(i){for(var c=0;c<s;c++)this.chars[c].copy(i.chars[c])},r.isEmpty=function(){for(var i=!0,c=0;c<s;c++)if(!this.chars[c].isEmpty()){i=!1;break}return i},r.setCursor=function(i){this.pos!==i&&(this.pos=i),this.pos<0?(this.logger.log(R.DEBUG,"Negative cursor position "+this.pos),this.pos=0):this.pos>s&&(this.logger.log(R.DEBUG,"Too large cursor position "+this.pos),this.pos=s)},r.moveCursor=function(i){var c=this.pos+i;if(i>1)for(var b=this.pos+1;b<c+1;b++)this.chars[b].setPenState(this.currPenState);this.setCursor(c)},r.backSpace=function(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)},r.insertChar=function(i){i>=144&&this.backSpace();var c=I(i);this.pos>=s?this.logger.log(R.ERROR,"Cannot insert "+i.toString(16)+" ("+c+") at position "+this.pos+". Skipping it!"):(this.chars[this.pos].setChar(c,this.currPenState),this.moveCursor(1))},r.clearFromPos=function(i){var c;for(c=i;c<s;c++)this.chars[c].reset()},r.clear=function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()},r.clearToEndOfRow=function(){this.clearFromPos(this.pos)},r.getTextString=function(){for(var i=[],c=!0,b=0;b<s;b++){var L=this.chars[b].uchar;L!==" "&&(c=!1),i.push(L)}return c?"":i.join("")},r.setPenStyles=function(i){this.currPenState.setStyles(i),this.chars[this.pos].setPenState(this.currPenState)},v}(),u=function(){function v(i){this.rows=void 0,this.currRow=void 0,this.nrRollUpRows=void 0,this.lastOutputScreen=void 0,this.logger=void 0,this.rows=[];for(var c=0;c<D;c++)this.rows.push(new o(i));this.logger=i,this.currRow=14,this.nrRollUpRows=null,this.lastOutputScreen=null,this.reset()}var r=v.prototype;return r.reset=function(){for(var i=0;i<D;i++)this.rows[i].clear();this.currRow=14},r.equals=function(i){for(var c=!0,b=0;b<D;b++)if(!this.rows[b].equals(i.rows[b])){c=!1;break}return c},r.copy=function(i){for(var c=0;c<D;c++)this.rows[c].copy(i.rows[c])},r.isEmpty=function(){for(var i=!0,c=0;c<D;c++)if(!this.rows[c].isEmpty()){i=!1;break}return i},r.backSpace=function(){this.rows[this.currRow].backSpace()},r.clearToEndOfRow=function(){this.rows[this.currRow].clearToEndOfRow()},r.insertChar=function(i){this.rows[this.currRow].insertChar(i)},r.setPen=function(i){this.rows[this.currRow].setPenStyles(i)},r.moveCursor=function(i){this.rows[this.currRow].moveCursor(i)},r.setCursor=function(i){this.logger.log(R.INFO,"setCursor: "+i),this.rows[this.currRow].setCursor(i)},r.setPAC=function(i){this.logger.log(R.INFO,"pacData = "+JSON.stringify(i));var c=i.row-1;if(this.nrRollUpRows&&c<this.nrRollUpRows-1&&(c=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==c){for(var b=0;b<D;b++)this.rows[b].clear();var L=this.currRow+1-this.nrRollUpRows,k=this.lastOutputScreen;if(k){var O=k.rows[L].cueStartTime,w=this.logger.time;if(O&&w!==null&&O<w)for(var x=0;x<this.nrRollUpRows;x++)this.rows[c-this.nrRollUpRows+x+1].copy(k.rows[L+x])}}this.currRow=c;var P=this.rows[this.currRow];if(i.indent!==null){var F=i.indent,M=Math.max(F-1,0);P.setCursor(i.indent),i.color=P.chars[M].penState.foreground}var B={foreground:i.color,underline:i.underline,italics:i.italics,background:"black",flash:!1};this.setPen(B)},r.setBkgData=function(i){this.logger.log(R.INFO,"bkgData = "+JSON.stringify(i)),this.backSpace(),this.setPen(i),this.insertChar(32)},r.setRollUpRows=function(i){this.nrRollUpRows=i},r.rollUp=function(){if(this.nrRollUpRows!==null){this.logger.log(R.TEXT,this.getDisplayText());var i=this.currRow+1-this.nrRollUpRows,c=this.rows.splice(i,1)[0];c.clear(),this.rows.splice(this.currRow,0,c),this.logger.log(R.INFO,"Rolling up")}else this.logger.log(R.DEBUG,"roll_up but nrRollUpRows not set yet")},r.getDisplayText=function(i){i=i||!1;for(var c=[],b="",L=-1,k=0;k<D;k++){var O=this.rows[k].getTextString();O&&(L=k+1,i?c.push("Row "+L+": '"+O+"'"):c.push(O.trim()))}return c.length>0&&(b=i?"["+c.join(" | ")+"]":c.join(`
`)),b},r.getTextAndFormat=function(){return this.rows},v}(),n=function(){function v(i,c,b){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=i,this.outputFilter=c,this.mode=null,this.verbose=0,this.displayedMemory=new u(b),this.nonDisplayedMemory=new u(b),this.lastOutputScreen=new u(b),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=b}var r=v.prototype;return r.reset=function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null},r.getHandler=function(){return this.outputFilter},r.setHandler=function(i){this.outputFilter=i},r.setPAC=function(i){this.writeScreen.setPAC(i)},r.setBkgData=function(i){this.writeScreen.setBkgData(i)},r.setMode=function(i){i!==this.mode&&(this.mode=i,this.logger.log(R.INFO,"MODE="+i),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=i)},r.insertChars=function(i){for(var c=0;c<i.length;c++)this.writeScreen.insertChar(i[c]);var b=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(R.INFO,b+": "+this.writeScreen.getDisplayText(!0)),this.mode!=="MODE_PAINT-ON"&&this.mode!=="MODE_ROLL-UP"||(this.logger.log(R.TEXT,"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())},r.ccRCL=function(){this.logger.log(R.INFO,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")},r.ccBS=function(){this.logger.log(R.INFO,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())},r.ccAOF=function(){},r.ccAON=function(){},r.ccDER=function(){this.logger.log(R.INFO,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()},r.ccRU=function(i){this.logger.log(R.INFO,"RU("+i+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(i)},r.ccFON=function(){this.logger.log(R.INFO,"FON - Flash On"),this.writeScreen.setPen({flash:!0})},r.ccRDC=function(){this.logger.log(R.INFO,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")},r.ccTR=function(){this.logger.log(R.INFO,"TR"),this.setMode("MODE_TEXT")},r.ccRTD=function(){this.logger.log(R.INFO,"RTD"),this.setMode("MODE_TEXT")},r.ccEDM=function(){this.logger.log(R.INFO,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)},r.ccCR=function(){this.logger.log(R.INFO,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)},r.ccENM=function(){this.logger.log(R.INFO,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()},r.ccEOC=function(){if(this.logger.log(R.INFO,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){var i=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=i,this.writeScreen=this.nonDisplayedMemory,this.logger.log(R.TEXT,"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)},r.ccTO=function(i){this.logger.log(R.INFO,"TO("+i+") - Tab Offset"),this.writeScreen.moveCursor(i)},r.ccMIDROW=function(i){var c={flash:!1};if(c.underline=i%2==1,c.italics=i>=46,c.italics)c.foreground="white";else{var b=Math.floor(i/2)-16;c.foreground=["white","green","blue","cyan","red","yellow","magenta"][b]}this.logger.log(R.INFO,"MIDROW: "+JSON.stringify(c)),this.writeScreen.setPen(c)},r.outputDataUpdate=function(i){i===void 0&&(i=!1);var c=this.logger.time;c!==null&&this.outputFilter&&(this.cueStartTime!==null||this.displayedMemory.isEmpty()?this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,c,this.lastOutputScreen),i&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:c):this.cueStartTime=c,this.lastOutputScreen.copy(this.displayedMemory))},r.cueSplitAtTime=function(i){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,i,this.displayedMemory),this.cueStartTime=i))},v}(),l=function(){function v(i,c,b){this.channels=void 0,this.currentChannel=0,this.cmdHistory=void 0,this.logger=void 0;var L=new d;this.channels=[null,new n(i,c,L),new n(i+1,b,L)],this.cmdHistory={a:null,b:null},this.logger=L}var r=v.prototype;return r.getHandler=function(i){return this.channels[i].getHandler()},r.setHandler=function(i,c){this.channels[i].setHandler(c)},r.addData=function(i,c){var b,L,k,O=!1;this.logger.time=i;for(var w=0;w<c.length;w+=2)if(L=127&c[w],k=127&c[w+1],L!==0||k!==0){if(this.logger.log(R.DATA,"["+t([c[w],c[w+1]])+"] -> ("+t([L,k])+")"),(b=this.parseCmd(L,k))||(b=this.parseMidrow(L,k)),b||(b=this.parsePAC(L,k)),b||(b=this.parseBackgroundAttributes(L,k)),!b&&(O=this.parseChars(L,k))){var x=this.currentChannel;x&&x>0?this.channels[x].insertChars(O):this.logger.log(R.WARNING,"No channel found yet. TEXT-MODE?")}b||O||this.logger.log(R.WARNING,"Couldn't parse cleaned data "+t([L,k])+" orig: "+t([c[w],c[w+1]]))}},r.parseCmd=function(i,c){var b=this.cmdHistory;if(!((i===20||i===28||i===21||i===29)&&c>=32&&c<=47||(i===23||i===31)&&c>=33&&c<=35))return!1;if(g(i,c,b))return p(null,null,b),this.logger.log(R.DEBUG,"Repeated command ("+t([i,c])+") is dropped"),!0;var L=i===20||i===21||i===23?1:2,k=this.channels[L];return i===20||i===21||i===28||i===29?c===32?k.ccRCL():c===33?k.ccBS():c===34?k.ccAOF():c===35?k.ccAON():c===36?k.ccDER():c===37?k.ccRU(2):c===38?k.ccRU(3):c===39?k.ccRU(4):c===40?k.ccFON():c===41?k.ccRDC():c===42?k.ccTR():c===43?k.ccRTD():c===44?k.ccEDM():c===45?k.ccCR():c===46?k.ccENM():c===47&&k.ccEOC():k.ccTO(c-32),p(i,c,b),this.currentChannel=L,!0},r.parseMidrow=function(i,c){var b=0;if((i===17||i===25)&&c>=32&&c<=47){if((b=i===17?1:2)!==this.currentChannel)return this.logger.log(R.ERROR,"Mismatch channel in midrow parsing"),!1;var L=this.channels[b];return!!L&&(L.ccMIDROW(c),this.logger.log(R.DEBUG,"MIDROW ("+t([i,c])+")"),!0)}return!1},r.parsePAC=function(i,c){var b,L=this.cmdHistory;if(!((i>=17&&i<=23||i>=25&&i<=31)&&c>=64&&c<=127||(i===16||i===24)&&c>=64&&c<=95))return!1;if(g(i,c,L))return p(null,null,L),!0;var k=i<=23?1:2;b=c>=64&&c<=95?k===1?S[i]:h[i]:k===1?m[i]:T[i];var O=this.channels[k];return!!O&&(O.setPAC(this.interpretPAC(b,c)),p(i,c,L),this.currentChannel=k,!0)},r.interpretPAC=function(i,c){var b,L={color:null,italics:!1,indent:null,underline:!1,row:i};return b=c>95?c-96:c-64,L.underline=(1&b)==1,b<=13?L.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(b/2)]:b<=15?(L.italics=!0,L.color="white"):L.indent=4*Math.floor((b-16)/2),L},r.parseChars=function(i,c){var b,L,k=null,O=null;if(i>=25?(b=2,O=i-8):(b=1,O=i),O>=17&&O<=19?(L=O===17?c+80:O===18?c+112:c+144,this.logger.log(R.INFO,"Special char '"+I(L)+"' in channel "+b),k=[L]):i>=32&&i<=127&&(k=c===0?[i]:[i,c]),k){var w=t(k);this.logger.log(R.DEBUG,"Char codes =  "+w.join(",")),p(i,c,this.cmdHistory)}return k},r.parseBackgroundAttributes=function(i,c){var b;if(!((i===16||i===24)&&c>=32&&c<=47||(i===23||i===31)&&c>=45&&c<=47))return!1;var L={};i===16||i===24?(b=Math.floor((c-32)/2),L.background=y[b],c%2==1&&(L.background=L.background+"_semi")):c===45?L.background="transparent":(L.foreground="black",c===47&&(L.underline=!0));var k=i<=23?1:2;return this.channels[k].setBkgData(L),p(i,c,this.cmdHistory),!0},r.reset=function(){for(var i=0;i<Object.keys(this.channels).length;i++){var c=this.channels[i];c&&c.reset()}this.cmdHistory={a:null,b:null}},r.cueSplitAtTime=function(i){for(var c=0;c<this.channels.length;c++){var b=this.channels[c];b&&b.cueSplitAtTime(i)}},v}();function p(v,r,i){i.a=v,i.b=r}function g(v,r,i){return i.a===v&&i.b===r}C.default=l},"./src/utils/codecs.ts":function(N,C,f){f.r(C),f.d(C,"isCodecType",function(){return E}),f.d(C,"isCodecSupportedInMp4",function(){return A});var R={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,av01:!0,drac:!0,dvav:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0},text:{stpp:!0,wvtt:!0}};function E(_,I){var D=R[I];return!!D&&D[_.slice(0,4)]===!0}function A(_,I){return MediaSource.isTypeSupported((I||"video")+'/mp4;codecs="'+_+'"')}},"./src/utils/cues.ts":function(N,C,f){f.r(C);var R=f("./src/utils/vttparser.ts"),E=f("./src/utils/webvtt-parser.ts"),A=f("./src/utils/texttrack-utils.ts"),_=/\s/,I={newCue:function(D,s,S,m){for(var h,T,y,d,t,a=[],e=self.VTTCue||self.TextTrackCue,o=0;o<m.rows.length;o++)if(y=!0,d=0,t="",!(h=m.rows[o]).isEmpty()){for(var u=0;u<h.chars.length;u++)_.test(h.chars[u].uchar)&&y?d++:(t+=h.chars[u].uchar,y=!1);h.cueStartTime=s,s===S&&(S+=1e-4),d>=16?d--:d++;var n=Object(R.fixLineBreaks)(t.trim()),l=Object(E.generateCueId)(s,S,n);D&&D.cues&&D.cues.getCueById(l)||((T=new e(s,S,n)).id=l,T.line=o+1,T.align="left",T.position=10+Math.min(80,10*Math.floor(8*d/32)),a.push(T))}return D&&a.length&&(a.sort(function(p,g){return p.line==="auto"||g.line==="auto"?0:p.line>8&&g.line>8?g.line-p.line:p.line-g.line}),a.forEach(function(p){return Object(A.addCueToTrack)(D,p)})),a}};C.default=I},"./src/utils/discontinuities.ts":function(N,C,f){f.r(C),f.d(C,"findFirstFragWithCC",function(){return _}),f.d(C,"shouldAlignOnDiscontinuities",function(){return I}),f.d(C,"findDiscontinuousReferenceFrag",function(){return D}),f.d(C,"adjustSlidingStart",function(){return S}),f.d(C,"alignStream",function(){return m}),f.d(C,"alignPDT",function(){return h});var R=f("./src/polyfills/number.ts"),E=f("./src/utils/logger.ts"),A=f("./src/controller/level-helper.ts");function _(T,y){for(var d=null,t=0,a=T.length;t<a;t++){var e=T[t];if(e&&e.cc===y){d=e;break}}return d}function I(T,y,d){return!(!y.details||!(d.endCC>d.startCC||T&&T.cc<d.startCC))}function D(T,y){var d=T.fragments,t=y.fragments;if(t.length&&d.length){var a=_(d,t[0].cc);if(a&&(!a||a.startPTS))return a;E.logger.log("No frag in previous level to align on")}else E.logger.log("No fragments to align")}function s(T,y){if(T){var d=T.start+y;T.start=T.startPTS=d,T.endPTS=d+T.duration}}function S(T,y){for(var d=y.fragments,t=0,a=d.length;t<a;t++)s(d[t],T);y.fragmentHint&&s(y.fragmentHint,T),y.alignedSliding=!0}function m(T,y,d){y&&(function(t,a,e){if(I(t,e,a)){var o=D(e.details,a);o&&Object(R.isFiniteNumber)(o.start)&&(E.logger.log("Adjusting PTS using last level due to CC increase within current level "+a.url),S(o.start,a))}}(T,d,y),!d.alignedSliding&&y.details&&h(d,y.details),d.alignedSliding||!y.details||d.skippedSegments||Object(A.adjustSliding)(y.details,d))}function h(T,y){if(y.fragments.length&&T.hasProgramDateTime&&y.hasProgramDateTime){var d=y.fragments[0].programDateTime,t=T.fragments[0].programDateTime,a=(t-d)/1e3+y.fragments[0].start;a&&Object(R.isFiniteNumber)(a)&&(E.logger.log("Adjusting PTS using programDateTime delta "+(t-d)+"ms, sliding:"+a.toFixed(3)+" "+T.url+" "),S(a,T))}}},"./src/utils/ewma-bandwidth-estimator.ts":function(N,C,f){f.r(C);var R=f("./src/utils/ewma.ts"),E=function(){function A(I,D,s){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultEstimate_=s,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new R.default(I),this.fast_=new R.default(D)}var _=A.prototype;return _.update=function(I,D){var s=this.slow_,S=this.fast_;this.slow_.halfLife!==I&&(this.slow_=new R.default(I,s.getEstimate(),s.getTotalWeight())),this.fast_.halfLife!==D&&(this.fast_=new R.default(D,S.getEstimate(),S.getTotalWeight()))},_.sample=function(I,D){var s=(I=Math.max(I,this.minDelayMs_))/1e3,S=8*D/s;this.fast_.sample(s,S),this.slow_.sample(s,S)},_.canEstimate=function(){var I=this.fast_;return I&&I.getTotalWeight()>=this.minWeight_},_.getEstimate=function(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_},_.destroy=function(){},A}();C.default=E},"./src/utils/ewma.ts":function(N,C,f){f.r(C);var R=function(){function E(_,I,D){I===void 0&&(I=0),D===void 0&&(D=0),this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=_,this.alpha_=_?Math.exp(Math.log(.5)/_):0,this.estimate_=I,this.totalWeight_=D}var A=E.prototype;return A.sample=function(_,I){var D=Math.pow(this.alpha_,_);this.estimate_=I*(1-D)+D*this.estimate_,this.totalWeight_+=_},A.getTotalWeight=function(){return this.totalWeight_},A.getEstimate=function(){if(this.alpha_){var _=1-Math.pow(this.alpha_,this.totalWeight_);if(_)return this.estimate_/_}return this.estimate_},E}();C.default=R},"./src/utils/fetch-loader.ts":function(N,C,f){f.r(C),f.d(C,"fetchSupported",function(){return m});var R=f("./src/polyfills/number.ts"),E=f("./src/loader/load-stats.ts"),A=f("./src/demux/chunk-cache.ts");function _(d){var t=typeof Map=="function"?new Map:void 0;return(_=function(a){if(a===null||(e=a,Function.toString.call(e).indexOf("[native code]")===-1))return a;var e;if(typeof a!="function")throw new TypeError("Super expression must either be null or a function");if(t!==void 0){if(t.has(a))return t.get(a);t.set(a,o)}function o(){return I(a,arguments,S(this).constructor)}return o.prototype=Object.create(a.prototype,{constructor:{value:o,enumerable:!1,writable:!0,configurable:!0}}),s(o,a)})(d)}function I(d,t,a){return(I=D()?Reflect.construct:function(e,o,u){var n=[null];n.push.apply(n,o);var l=new(Function.bind.apply(e,n));return u&&s(l,u.prototype),l}).apply(null,arguments)}function D(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function s(d,t){return(s=Object.setPrototypeOf||function(a,e){return a.__proto__=e,a})(d,t)}function S(d){return(S=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(d)}function m(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch{}return!1}var h=function(){function d(a){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=void 0,this.response=void 0,this.controller=void 0,this.context=void 0,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=a.fetchSetup||T,this.controller=new self.AbortController,this.stats=new E.LoadStats}var t=d.prototype;return t.destroy=function(){this.loader=this.callbacks=null,this.abortInternal()},t.abortInternal=function(){var a=this.response;a&&a.ok||(this.stats.aborted=!0,this.controller.abort())},t.abort=function(){var a;this.abortInternal(),(a=this.callbacks)!==null&&a!==void 0&&a.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)},t.load=function(a,e,o){var u=this,n=this.stats;if(n.loading.start)throw new Error("Loader can only be used once.");n.loading.start=self.performance.now();var l=function(r,i){var c={method:"GET",mode:"cors",credentials:"same-origin",signal:i};return r.rangeEnd&&(c.headers=new self.Headers({Range:"bytes="+r.rangeStart+"-"+String(r.rangeEnd-1)})),c}(a,this.controller.signal),p=o.onProgress,g=a.responseType==="arraybuffer",v=g?"byteLength":"length";this.context=a,this.config=e,this.callbacks=o,this.request=this.fetchSetup(a,l),self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(function(){u.abortInternal(),o.onTimeout(n,a,u.response)},e.timeout),self.fetch(this.request).then(function(r){if(u.response=u.loader=r,!r.ok){var i=r.status,c=r.statusText;throw new y(c||"fetch, bad network response",i,r)}return n.loading.first=Math.max(self.performance.now(),n.loading.start),n.total=parseInt(r.headers.get("Content-Length")||"0"),p&&Object(R.isFiniteNumber)(e.highWaterMark)?u.loadProgressively(r,n,a,e.highWaterMark,p):g?r.arrayBuffer():r.text()}).then(function(r){var i=u.response;self.clearTimeout(u.requestTimeout),n.loading.end=Math.max(self.performance.now(),n.loading.first),n.loaded=n.total=r[v];var c={url:i.url,data:r};p&&!Object(R.isFiniteNumber)(e.highWaterMark)&&p(n,a,r,i),o.onSuccess(c,n,a,i)}).catch(function(r){if(self.clearTimeout(u.requestTimeout),!n.aborted){var i=r.code||0;o.onError({code:i,text:r.message},a,r.details)}})},t.getCacheAge=function(){var a=null;if(this.response){var e=this.response.headers.get("age");a=e?parseFloat(e):null}return a},t.loadProgressively=function(a,e,o,u,n){u===void 0&&(u=0);var l=new A.default,p=a.body.getReader();return function g(){return p.read().then(function(v){if(v.done)return l.dataLength&&n(e,o,l.flush(),a),Promise.resolve(new ArrayBuffer(0));var r=v.value,i=r.length;return e.loaded+=i,i<u||l.dataLength?(l.push(r),l.dataLength>=u&&n(e,o,l.flush(),a)):n(e,o,r,a),g()}).catch(function(){return Promise.reject()})}()},d}();function T(d,t){return new self.Request(d.url,t)}var y=function(d){var t,a;function e(o,u,n){var l;return(l=d.call(this,o)||this).code=void 0,l.details=void 0,l.code=u,l.details=n,l}return a=d,(t=e).prototype=Object.create(a.prototype),t.prototype.constructor=t,s(t,a),e}(_(Error));C.default=h},"./src/utils/imsc1-ttml-parser.ts":function(N,C,f){f.r(C),f.d(C,"IMSC1_CODEC",function(){return S}),f.d(C,"parseIMSC1",function(){return y});var R=f("./src/utils/mp4-tools.ts"),E=f("./src/utils/vttparser.ts"),A=f("./src/utils/vttcue.ts"),_=f("./src/demux/id3.ts"),I=f("./src/utils/timescale-conversion.ts"),D=f("./src/utils/webvtt-parser.ts");function s(){return(s=Object.assign||function(n){for(var l=1;l<arguments.length;l++){var p=arguments[l];for(var g in p)Object.prototype.hasOwnProperty.call(p,g)&&(n[g]=p[g])}return n}).apply(this,arguments)}var S="stpp.ttml.im1t",m=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,h=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,T={left:"start",center:"center",right:"end",start:"start",end:"end"};function y(n,l,p,g,v){var r=Object(R.findBox)(new Uint8Array(n),["mdat"]);if(r.length!==0){var i=r[0],c=Object(_.utf8ArrayToStr)(new Uint8Array(n,i.start,i.end-i.start)),b=Object(I.toTimescaleFromScale)(l,1,p);try{g(function(L,k){var O=new DOMParser().parseFromString(L,"text/xml").getElementsByTagName("tt")[0];if(!O)throw new Error("Invalid ttml");var w={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},x=Object.keys(w).reduce(function(U,G){return U[G]=O.getAttribute("ttp:"+G)||w[G],U},{}),P=O.getAttribute("xml:space")!=="preserve",F=t(d(O,"styling","style")),M=t(d(O,"layout","region")),B=d(O,"body","[begin]");return[].map.call(B,function(U){var G=a(U,P);if(!G||!U.hasAttribute("begin"))return null;var V=u(U.getAttribute("begin"),x),H=u(U.getAttribute("dur"),x),Y=u(U.getAttribute("end"),x);if(V===null)throw o(U);if(Y===null){if(H===null)throw o(U);Y=V+H}var W=new A.default(V-k,Y-k,G);W.id=Object(D.generateCueId)(W.startTime,W.endTime,W.text);var q=M[U.getAttribute("region")],J=F[U.getAttribute("style")];W.position=10,W.size=80;var rt=function(st,$){var et="http://www.w3.org/ns/ttml#styling";return["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"].reduce(function(at,nt){var ct=e($,et,nt)||e(st,et,nt);return ct&&(at[nt]=ct),at},{})}(q,J),it=rt.textAlign;if(it){var Q=T[it];Q&&(W.lineAlign=Q),W.align=it}return s(W,rt),W}).filter(function(U){return U!==null})}(c,b))}catch(L){v(L)}}else v(new Error("Could not parse IMSC1 mdat"))}function d(n,l,p){var g=n.getElementsByTagName(l)[0];return g?[].slice.call(g.querySelectorAll(p)):[]}function t(n){return n.reduce(function(l,p){var g=p.getAttribute("xml:id");return g&&(l[g]=p),l},{})}function a(n,l){return[].slice.call(n.childNodes).reduce(function(p,g,v){var r;return g.nodeName==="br"&&v?p+`
`:(r=g.childNodes)!==null&&r!==void 0&&r.length?a(g,l):l?p+g.textContent.trim().replace(/\s+/g," "):p+g.textContent},"")}function e(n,l,p){return n.hasAttributeNS(l,p)?n.getAttributeNS(l,p):null}function o(n){return new Error("Could not parse ttml timestamp "+n)}function u(n,l){if(!n)return null;var p=Object(E.parseTimeStamp)(n);return p===null&&(m.test(n)?p=function(g,v){var r=m.exec(g),i=(0|r[4])+(0|r[5])/v.subFrameRate;return 3600*(0|r[1])+60*(0|r[2])+(0|r[3])+i/v.frameRate}(n,l):h.test(n)&&(p=function(g,v){var r=h.exec(g),i=Number(r[1]);switch(r[2]){case"h":return 3600*i;case"m":return 60*i;case"ms":return 1e3*i;case"f":return i/v.frameRate;case"t":return i/v.tickRate}return i}(n,l))),p}},"./src/utils/logger.ts":function(N,C,f){f.r(C),f.d(C,"enableLogs",function(){return I}),f.d(C,"logger",function(){return D});var R=function(){},E={trace:R,debug:R,log:R,warn:R,info:R,error:R},A=E;function _(s){var S=self.console[s];return S?S.bind(self.console,"["+s+"] >"):R}function I(s){if(self.console&&s===!0||typeof s=="object"){(function(S){for(var m=arguments.length,h=new Array(m>1?m-1:0),T=1;T<m;T++)h[T-1]=arguments[T];h.forEach(function(y){A[y]=S[y]?S[y].bind(S):_(y)})})(s,"debug","log","info","warn","error");try{A.log()}catch{A=E}}else A=E}var D=E},"./src/utils/mediakeys-helper.ts":function(N,C,f){var R,E;f.r(C),f.d(C,"KeySystems",function(){return R}),f.d(C,"requestMediaKeySystemAccess",function(){return A}),(E=R||(R={})).WIDEVINE="com.widevine.alpha",E.PLAYREADY="com.microsoft.playready";var A=typeof self!="undefined"&&self.navigator&&self.navigator.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null},"./src/utils/mediasource-helper.ts":function(N,C,f){function R(){return self.MediaSource||self.WebKitMediaSource}f.r(C),f.d(C,"getMediaSource",function(){return R})},"./src/utils/mp4-tools.ts":function(N,C,f){f.r(C),f.d(C,"bin2str",function(){return I}),f.d(C,"readUint16",function(){return D}),f.d(C,"readUint32",function(){return s}),f.d(C,"writeUint32",function(){return S}),f.d(C,"findBox",function(){return m}),f.d(C,"parseSegmentIndex",function(){return h}),f.d(C,"parseInitSegment",function(){return T}),f.d(C,"getStartDTS",function(){return y}),f.d(C,"getDuration",function(){return d}),f.d(C,"computeRawDurationFromSamples",function(){return t}),f.d(C,"offsetStartDTS",function(){return a}),f.d(C,"segmentValidRange",function(){return e}),f.d(C,"appendUint8Array",function(){return o});var R=f("./src/utils/typed-array.ts"),E=f("./src/loader/fragment.ts"),A=Math.pow(2,32)-1,_=[].push;function I(u){return String.fromCharCode.apply(null,u)}function D(u,n){"data"in u&&(n+=u.start,u=u.data);var l=u[n]<<8|u[n+1];return l<0?65536+l:l}function s(u,n){"data"in u&&(n+=u.start,u=u.data);var l=u[n]<<24|u[n+1]<<16|u[n+2]<<8|u[n+3];return l<0?4294967296+l:l}function S(u,n,l){"data"in u&&(n+=u.start,u=u.data),u[n]=l>>24,u[n+1]=l>>16&255,u[n+2]=l>>8&255,u[n+3]=255&l}function m(u,n){var l,p,g,v=[];if(!n.length)return v;"data"in u?(l=u.data,p=u.start,g=u.end):(p=0,g=(l=u).byteLength);for(var r=p;r<g;){var i=s(l,r),c=i>1?r+i:g;if(I(l.subarray(r+4,r+8))===n[0])if(n.length===1)v.push({data:l,start:r+8,end:c});else{var b=m({data:l,start:r+8,end:c},n.slice(1));b.length&&_.apply(v,b)}r=c}return v}function h(u){var n=m(u,["moov"])[0],l=n?n.end:null,p=m(u,["sidx"]);if(!p||!p[0])return null;var g=[],v=p[0],r=v.data[0],i=r===0?8:16,c=s(v,i);i+=4,i+=r===0?8:16,i+=2;var b=v.end+0,L=D(v,i);i+=2;for(var k=0;k<L;k++){var O=i,w=s(v,O);O+=4;var x=2147483647&w;if((2147483648&w)>>>31==1)return console.warn("SIDX has hierarchical references (not supported)"),null;var P=s(v,O);O+=4,g.push({referenceSize:x,subsegmentDuration:P,info:{duration:P/c,start:b,end:b+x-1}}),b+=x,i=O+=4}return{earliestPresentationTime:0,timescale:c,version:r,referencesCount:L,references:g,moovEndOffset:l}}function T(u){for(var n=[],l=m(u,["moov","trak"]),p=0;p<l.length;p++){var g=l[p],v=m(g,["tkhd"])[0];if(v){var r=v.data[v.start],i=r===0?12:20,c=s(v,i),b=m(g,["mdia","mdhd"])[0];if(b){var L=s(b,i=(r=b.data[b.start])===0?12:20),k=m(g,["mdia","hdlr"])[0];if(k){var O=I(k.data.subarray(k.start+8,k.start+12)),w={soun:E.ElementaryStreamTypes.AUDIO,vide:E.ElementaryStreamTypes.VIDEO}[O];if(w){var x=m(g,["mdia","minf","stbl","stsd"])[0],P=void 0;x&&(P=I(x.data.subarray(x.start+12,x.start+16))),n[c]={timescale:L,type:w},n[w]={timescale:L,id:c,codec:P}}}}}}return m(u,["moov","mvex","trex"]).forEach(function(F){var M=s(F,4),B=n[M];B&&(B.default={duration:s(F,12),flags:s(F,20)})}),n}function y(u,n){return m(n,["moof","traf"]).reduce(function(l,p){var g=m(p,["tfdt"])[0],v=g.data[g.start],r=m(p,["tfhd"]).reduce(function(i,c){var b=s(c,4),L=u[b];if(L){var k=s(g,4);v===1&&(k*=Math.pow(2,32),k+=s(g,8));var O=k/(L.timescale||9e4);if(isFinite(O)&&(i===null||O<i))return O}return i},null);return r!==null&&isFinite(r)&&(l===null||r<l)?r:l},null)||0}function d(u,n){for(var l=0,p=0,g=0,v=m(u,["moof","traf"]),r=0;r<v.length;r++){var i=v[r],c=m(i,["tfhd"])[0],b=n[s(c,4)];if(b){var L=b.default,k=s(c,0)|(L==null?void 0:L.flags),O=L==null?void 0:L.duration;8&k&&(O=s(c,2&k?12:8));for(var w=b.timescale||9e4,x=m(i,["trun"]),P=0;P<x.length;P++)l=O?O*s(x[P],4):t(x[P]),b.type===E.ElementaryStreamTypes.VIDEO?p+=l/w:b.type===E.ElementaryStreamTypes.AUDIO&&(g+=l/w)}}if(p===0&&g===0){var F=h(u);if(F!=null&&F.references)return F.references.reduce(function(M,B){return M+B.info.duration||0},0)}return p||g}function t(u){var n=s(u,0),l=8;1&n&&(l+=4),4&n&&(l+=4);for(var p=0,g=s(u,4),v=0;v<g;v++)256&n&&(p+=s(u,l),l+=4),512&n&&(l+=4),1024&n&&(l+=4),2048&n&&(l+=4);return p}function a(u,n,l){m(n,["moof","traf"]).forEach(function(p){m(p,["tfhd"]).forEach(function(g){var v=s(g,4),r=u[v];if(r){var i=r.timescale||9e4;m(p,["tfdt"]).forEach(function(c){var b=c.data[c.start],L=s(c,4);if(b===0)S(c,4,L-l*i);else{L*=Math.pow(2,32),L+=s(c,8),L-=l*i,L=Math.max(L,0);var k=Math.floor(L/(A+1)),O=Math.floor(L%(A+1));S(c,4,k),S(c,8,O)}})}})})}function e(u){var n={valid:null,remainder:null},l=m(u,["moof"]);if(!l)return n;if(l.length<2)return n.remainder=u,n;var p=l[l.length-1];return n.valid=Object(R.sliceUint8)(u,0,p.start-8),n.remainder=Object(R.sliceUint8)(u,p.start-8),n}function o(u,n){var l=new Uint8Array(u.length+n.length);return l.set(u),l.set(n,u.length),l}},"./src/utils/output-filter.ts":function(N,C,f){f.r(C),f.d(C,"default",function(){return R});var R=function(){function E(_,I){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=_,this.trackName=I}var A=E.prototype;return A.dispatchCue=function(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)},A.newCue=function(_,I,D){(this.startTime===null||this.startTime>_)&&(this.startTime=_),this.endTime=I,this.screen=D,this.timelineController.createCaptionsTrack(this.trackName)},A.reset=function(){this.cueRanges=[]},E}()},"./src/utils/texttrack-utils.ts":function(N,C,f){f.r(C),f.d(C,"sendAddTrackEvent",function(){return E}),f.d(C,"addCueToTrack",function(){return A}),f.d(C,"clearCurrentCues",function(){return _}),f.d(C,"removeCuesInRange",function(){return I}),f.d(C,"getCuesInRange",function(){return D});var R=f("./src/utils/logger.ts");function E(s,S){var m;try{m=new Event("addtrack")}catch{(m=document.createEvent("Event")).initEvent("addtrack",!1,!1)}m.track=s,S.dispatchEvent(m)}function A(s,S){var m=s.mode;if(m==="disabled"&&(s.mode="hidden"),s.cues&&!s.cues.getCueById(S.id))try{if(s.addCue(S),!s.cues.getCueById(S.id))throw new Error("addCue is failed for: "+S)}catch(T){R.logger.debug("[texttrack-utils]: "+T);var h=new self.TextTrackCue(S.startTime,S.endTime,S.text);h.id=S.id,s.addCue(h)}m==="disabled"&&(s.mode=m)}function _(s){var S=s.mode;if(S==="disabled"&&(s.mode="hidden"),s.cues)for(var m=s.cues.length;m--;)s.removeCue(s.cues[m]);S==="disabled"&&(s.mode=S)}function I(s,S,m){var h=s.mode;if(h==="disabled"&&(s.mode="hidden"),s.cues&&s.cues.length>0)for(var T=D(s.cues,S,m),y=0;y<T.length;y++)s.removeCue(T[y]);h==="disabled"&&(s.mode=h)}function D(s,S,m){var h=[],T=function(a,e){if(e<a[0].startTime)return 0;var o=a.length-1;if(e>a[o].endTime)return-1;for(var u=0,n=o;u<=n;){var l=Math.floor((n+u)/2);if(e<a[l].startTime)n=l-1;else{if(!(e>a[l].startTime&&u<o))return l;u=l+1}}return a[u].startTime-e<e-a[n].startTime?u:n}(s,S);if(T>-1)for(var y=T,d=s.length;y<d;y++){var t=s[y];if(t.startTime>=S&&t.endTime<=m)h.push(t);else if(t.startTime>m)return h}return h}},"./src/utils/time-ranges.ts":function(N,C,f){f.r(C),C.default={toString:function(R){for(var E="",A=R.length,_=0;_<A;_++)E+="["+R.start(_).toFixed(3)+","+R.end(_).toFixed(3)+"]";return E}}},"./src/utils/timescale-conversion.ts":function(N,C,f){function R(I,D,s,S){s===void 0&&(s=1),S===void 0&&(S=!1);var m=I*D*s;return S?Math.round(m):m}function E(I,D,s,S){return s===void 0&&(s=1),S===void 0&&(S=!1),R(I,D,1/s,S)}function A(I,D){return D===void 0&&(D=!1),R(I,1e3,1/9e4,D)}function _(I,D){return D===void 0&&(D=1),R(I,9e4,1/D)}f.r(C),f.d(C,"toTimescaleFromBase",function(){return R}),f.d(C,"toTimescaleFromScale",function(){return E}),f.d(C,"toMsFromMpegTsClock",function(){return A}),f.d(C,"toMpegTsClockFromTimescale",function(){return _})},"./src/utils/typed-array.ts":function(N,C,f){function R(E,A,_){return Uint8Array.prototype.slice?E.slice(A,_):new Uint8Array(Array.prototype.slice.call(E,A,_))}f.r(C),f.d(C,"sliceUint8",function(){return R})},"./src/utils/vttcue.ts":function(N,C,f){f.r(C),C.default=function(){if(typeof self!="undefined"&&self.VTTCue)return self.VTTCue;var R=["","lr","rl"],E=["start","middle","end","left","right"];function A(s,S){if(typeof S!="string"||!Array.isArray(s))return!1;var m=S.toLowerCase();return!!~s.indexOf(m)&&m}function _(s){return A(E,s)}function I(s){for(var S=arguments.length,m=new Array(S>1?S-1:0),h=1;h<S;h++)m[h-1]=arguments[h];for(var T=1;T<arguments.length;T++){var y=arguments[T];for(var d in y)s[d]=y[d]}return s}function D(s,S,m){var h=this,T={enumerable:!0};h.hasBeenReset=!1;var y="",d=!1,t=s,a=S,e=m,o=null,u="",n=!0,l="auto",p="start",g=50,v="middle",r=50,i="middle";Object.defineProperty(h,"id",I({},T,{get:function(){return y},set:function(c){y=""+c}})),Object.defineProperty(h,"pauseOnExit",I({},T,{get:function(){return d},set:function(c){d=!!c}})),Object.defineProperty(h,"startTime",I({},T,{get:function(){return t},set:function(c){if(typeof c!="number")throw new TypeError("Start time must be set to a number.");t=c,this.hasBeenReset=!0}})),Object.defineProperty(h,"endTime",I({},T,{get:function(){return a},set:function(c){if(typeof c!="number")throw new TypeError("End time must be set to a number.");a=c,this.hasBeenReset=!0}})),Object.defineProperty(h,"text",I({},T,{get:function(){return e},set:function(c){e=""+c,this.hasBeenReset=!0}})),Object.defineProperty(h,"region",I({},T,{get:function(){return o},set:function(c){o=c,this.hasBeenReset=!0}})),Object.defineProperty(h,"vertical",I({},T,{get:function(){return u},set:function(c){var b=function(L){return A(R,L)}(c);if(b===!1)throw new SyntaxError("An invalid or illegal string was specified.");u=b,this.hasBeenReset=!0}})),Object.defineProperty(h,"snapToLines",I({},T,{get:function(){return n},set:function(c){n=!!c,this.hasBeenReset=!0}})),Object.defineProperty(h,"line",I({},T,{get:function(){return l},set:function(c){if(typeof c!="number"&&c!=="auto")throw new SyntaxError("An invalid number or illegal string was specified.");l=c,this.hasBeenReset=!0}})),Object.defineProperty(h,"lineAlign",I({},T,{get:function(){return p},set:function(c){var b=_(c);if(!b)throw new SyntaxError("An invalid or illegal string was specified.");p=b,this.hasBeenReset=!0}})),Object.defineProperty(h,"position",I({},T,{get:function(){return g},set:function(c){if(c<0||c>100)throw new Error("Position must be between 0 and 100.");g=c,this.hasBeenReset=!0}})),Object.defineProperty(h,"positionAlign",I({},T,{get:function(){return v},set:function(c){var b=_(c);if(!b)throw new SyntaxError("An invalid or illegal string was specified.");v=b,this.hasBeenReset=!0}})),Object.defineProperty(h,"size",I({},T,{get:function(){return r},set:function(c){if(c<0||c>100)throw new Error("Size must be between 0 and 100.");r=c,this.hasBeenReset=!0}})),Object.defineProperty(h,"align",I({},T,{get:function(){return i},set:function(c){var b=_(c);if(!b)throw new SyntaxError("An invalid or illegal string was specified.");i=b,this.hasBeenReset=!0}})),h.displayState=void 0}return D.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},D}()},"./src/utils/vttparser.ts":function(N,C,f){f.r(C),f.d(C,"parseTimeStamp",function(){return A}),f.d(C,"fixLineBreaks",function(){return m}),f.d(C,"VTTParser",function(){return h});var R=f("./src/utils/vttcue.ts"),E=function(){function T(){}return T.prototype.decode=function(y,d){if(!y)return"";if(typeof y!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(y))},T}();function A(T){function y(t,a,e,o){return 3600*(0|t)+60*(0|a)+(0|e)+parseFloat(o||0)}var d=T.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return d?parseFloat(d[2])>59?y(d[2],d[3],0,d[4]):y(d[1],d[2],d[3],d[4]):null}var _=function(){function T(){this.values=Object.create(null)}var y=T.prototype;return y.set=function(d,t){this.get(d)||t===""||(this.values[d]=t)},y.get=function(d,t,a){return a?this.has(d)?this.values[d]:t[a]:this.has(d)?this.values[d]:t},y.has=function(d){return d in this.values},y.alt=function(d,t,a){for(var e=0;e<a.length;++e)if(t===a[e]){this.set(d,t);break}},y.integer=function(d,t){/^-?\d+$/.test(t)&&this.set(d,parseInt(t,10))},y.percent=function(d,t){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(t)){var a=parseFloat(t);if(a>=0&&a<=100)return this.set(d,a),!0}return!1},T}();function I(T,y,d,t){var a=t?T.split(t):[T];for(var e in a)if(typeof a[e]=="string"){var o=a[e].split(d);o.length===2&&y(o[0],o[1])}}var D=new R.default(0,0,""),s=D.align==="middle"?"middle":"center";function S(T,y,d){var t=T;function a(){var o=A(T);if(o===null)throw new Error("Malformed timestamp: "+t);return T=T.replace(/^[^\sa-zA-Z-]+/,""),o}function e(){T=T.replace(/^\s+/,"")}if(e(),y.startTime=a(),e(),T.substr(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+t);T=T.substr(3),e(),y.endTime=a(),e(),function(o,u){var n=new _;I(o,function(g,v){var r;switch(g){case"region":for(var i=d.length-1;i>=0;i--)if(d[i].id===v){n.set(g,d[i].region);break}break;case"vertical":n.alt(g,v,["rl","lr"]);break;case"line":r=v.split(","),n.integer(g,r[0]),n.percent(g,r[0])&&n.set("snapToLines",!1),n.alt(g,r[0],["auto"]),r.length===2&&n.alt("lineAlign",r[1],["start",s,"end"]);break;case"position":r=v.split(","),n.percent(g,r[0]),r.length===2&&n.alt("positionAlign",r[1],["start",s,"end","line-left","line-right","auto"]);break;case"size":n.percent(g,v);break;case"align":n.alt(g,v,["start",s,"end","left","right"])}},/:/,/\s/),u.region=n.get("region",null),u.vertical=n.get("vertical","");var l=n.get("line","auto");l==="auto"&&D.line===-1&&(l=-1),u.line=l,u.lineAlign=n.get("lineAlign","start"),u.snapToLines=n.get("snapToLines",!0),u.size=n.get("size",100),u.align=n.get("align",s);var p=n.get("position","auto");p==="auto"&&D.position===50&&(p=u.align==="start"||u.align==="left"?0:u.align==="end"||u.align==="right"?100:50),u.position=p}(T,y)}function m(T){return T.replace(/<br(?: \/)?>/gi,`
`)}var h=function(){function T(){this.state="INITIAL",this.buffer="",this.decoder=new E,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}var y=T.prototype;return y.parse=function(d){var t=this;function a(){var l=t.buffer,p=0;for(l=m(l);p<l.length&&l[p]!=="\r"&&l[p]!==`
`;)++p;var g=l.substr(0,p);return l[p]==="\r"&&++p,l[p]===`
`&&++p,t.buffer=l.substr(p),g}d&&(t.buffer+=t.decoder.decode(d,{stream:!0}));try{var e="";if(t.state==="INITIAL"){if(!/\r\n|\n/.test(t.buffer))return this;var o=(e=a()).match(/^()?WEBVTT([ \t].*)?$/);if(!o||!o[0])throw new Error("Malformed WebVTT signature.");t.state="HEADER"}for(var u=!1;t.buffer;){if(!/\r\n|\n/.test(t.buffer))return this;switch(u?u=!1:e=a(),t.state){case"HEADER":/:/.test(e)?I(e,function(l,p){},/:/):e||(t.state="ID");continue;case"NOTE":e||(t.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(e)){t.state="NOTE";break}if(!e)continue;if(t.cue=new R.default(0,0,""),t.state="CUE",e.indexOf("-->")===-1){t.cue.id=e;continue}case"CUE":if(!t.cue){t.state="BADCUE";continue}try{S(e,t.cue,t.regionList)}catch{t.cue=null,t.state="BADCUE";continue}t.state="CUETEXT";continue;case"CUETEXT":var n=e.indexOf("-->")!==-1;if(!e||n&&(u=!0)){t.oncue&&t.cue&&t.oncue(t.cue),t.cue=null,t.state="ID";continue}if(t.cue===null)continue;t.cue.text&&(t.cue.text+=`
`),t.cue.text+=e;continue;case"BADCUE":e||(t.state="ID")}}}catch{t.state==="CUETEXT"&&t.cue&&t.oncue&&t.oncue(t.cue),t.cue=null,t.state=t.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this},y.flush=function(){var d=this;try{if((d.cue||d.state==="HEADER")&&(d.buffer+=`

`,d.parse()),d.state==="INITIAL"||d.state==="BADWEBVTT")throw new Error("Malformed WebVTT signature.")}catch(t){d.onparsingerror&&d.onparsingerror(t)}return d.onflush&&d.onflush(),this},T}()},"./src/utils/webvtt-parser.ts":function(N,C,f){f.r(C),f.d(C,"generateCueId",function(){return m}),f.d(C,"parseWebVTT",function(){return h});var R=f("./src/polyfills/number.ts"),E=f("./src/utils/vttparser.ts"),A=f("./src/demux/id3.ts"),_=f("./src/utils/timescale-conversion.ts"),I=f("./src/remux/mp4-remuxer.ts"),D=/\r\n|\n\r|\n|\r/g,s=function(T,y,d){return d===void 0&&(d=0),T.substr(d,y.length)===y},S=function(T){for(var y=5381,d=T.length;d;)y=33*y^T.charCodeAt(--d);return(y>>>0).toString()};function m(T,y,d){return S(T.toString())+S(y.toString())+S(d)}function h(T,y,d,t,a,e,o,u){var n,l=new E.VTTParser,p=Object(A.utf8ArrayToStr)(new Uint8Array(T)).trim().replace(D,`
`).split(`
`),g=[],v=Object(_.toMpegTsClockFromTimescale)(y,d),r="00:00.000",i=0,c=0,b=!0,L=!1;l.oncue=function(k){var O=t[a],w=t.ccOffset,x=(i-v)/9e4;if(O!=null&&O.new&&(c!==void 0?w=t.ccOffset=O.start:function(B,U,G){var V=B[U],H=B[V.prevCC];if(!H||!H.new&&V.new)return B.ccOffset=B.presentationOffset=V.start,void(V.new=!1);for(;(Y=H)!==null&&Y!==void 0&&Y.new;){var Y;B.ccOffset+=V.start-H.start,V.new=!1,H=B[(V=H).prevCC]}B.presentationOffset=G}(t,a,x)),x&&(w=x-t.presentationOffset),L){var P=k.endTime-k.startTime,F=Object(I.normalizePts)(9e4*(k.startTime+w-c),9e4*e)/9e4;k.startTime=F,k.endTime=F+P}var M=k.text.trim();k.text=decodeURIComponent(encodeURIComponent(M)),k.id||(k.id=m(k.startTime,k.endTime,M)),k.endTime>0&&g.push(k)},l.onparsingerror=function(k){n=k},l.onflush=function(){n?u(n):o(g)},p.forEach(function(k){if(b){if(s(k,"X-TIMESTAMP-MAP=")){b=!1,L=!0,k.substr(16).split(",").forEach(function(O){s(O,"LOCAL:")?r=O.substr(6):s(O,"MPEGTS:")&&(i=parseInt(O.substr(7)))});try{c=function(O){var w=parseInt(O.substr(-3)),x=parseInt(O.substr(-6,2)),P=parseInt(O.substr(-9,2)),F=O.length>9?parseInt(O.substr(0,O.indexOf(":"))):0;if(!(Object(R.isFiniteNumber)(w)&&Object(R.isFiniteNumber)(x)&&Object(R.isFiniteNumber)(P)&&Object(R.isFiniteNumber)(F)))throw Error("Malformed X-TIMESTAMP-MAP: Local:"+O);return w+=1e3*x,(w+=6e4*P)+36e5*F}(r)/1e3}catch(O){L=!1,n=O}return}k===""&&(b=!1)}l.parse(k+`
`)}),l.flush()}},"./src/utils/xhr-loader.ts":function(N,C,f){f.r(C);var R=f("./src/utils/logger.ts"),E=f("./src/loader/load-stats.ts"),A=/^age:\s*[\d.]+\s*$/m,_=function(){function I(s){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=void 0,this.loader=null,this.stats=void 0,this.xhrSetup=s?s.xhrSetup:null,this.stats=new E.LoadStats,this.retryDelay=0}var D=I.prototype;return D.destroy=function(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null},D.abortInternal=function(){var s=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),s&&(s.onreadystatechange=null,s.onprogress=null,s.readyState!==4&&(this.stats.aborted=!0,s.abort()))},D.abort=function(){var s;this.abortInternal(),(s=this.callbacks)!==null&&s!==void 0&&s.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)},D.load=function(s,S,m){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=s,this.config=S,this.callbacks=m,this.retryDelay=S.retryDelay,this.loadInternal()},D.loadInternal=function(){var s=this.config,S=this.context;if(s){var m=this.loader=new self.XMLHttpRequest,h=this.stats;h.loading.first=0,h.loaded=0;var T=this.xhrSetup;try{if(T)try{T(m,S.url)}catch{m.open("GET",S.url,!0),T(m,S.url)}m.readyState||m.open("GET",S.url,!0)}catch(y){return void this.callbacks.onError({code:m.status,text:y.message},S,m)}S.rangeEnd&&m.setRequestHeader("Range","bytes="+S.rangeStart+"-"+(S.rangeEnd-1)),m.onreadystatechange=this.readystatechange.bind(this),m.onprogress=this.loadprogress.bind(this),m.responseType=S.responseType,self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),s.timeout),m.send()}},D.readystatechange=function(){var s=this.context,S=this.loader,m=this.stats;if(s&&S){var h=S.readyState,T=this.config;if(!m.aborted&&h>=2)if(self.clearTimeout(this.requestTimeout),m.loading.first===0&&(m.loading.first=Math.max(self.performance.now(),m.loading.start)),h===4){S.onreadystatechange=null,S.onprogress=null;var y=S.status;if(y>=200&&y<300){var d,t;if(m.loading.end=Math.max(self.performance.now(),m.loading.first),t=s.responseType==="arraybuffer"?(d=S.response).byteLength:(d=S.responseText).length,m.loaded=m.total=t,!this.callbacks)return;var a=this.callbacks.onProgress;if(a&&a(m,s,d,S),!this.callbacks)return;var e={url:S.responseURL,data:d};this.callbacks.onSuccess(e,m,s,S)}else m.retry>=T.maxRetry||y>=400&&y<499?(R.logger.error(y+" while loading "+s.url),this.callbacks.onError({code:y,text:S.statusText},s,S)):(R.logger.warn(y+" while loading "+s.url+", retrying in "+this.retryDelay+"..."),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,T.maxRetryDelay),m.retry++)}else self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),T.timeout)}},D.loadtimeout=function(){R.logger.warn("timeout while loading "+this.context.url);var s=this.callbacks;s&&(this.abortInternal(),s.onTimeout(this.stats,this.context,this.loader))},D.loadprogress=function(s){var S=this.stats;S.loaded=s.loaded,s.lengthComputable&&(S.total=s.total)},D.getCacheAge=function(){var s=null;if(this.loader&&A.test(this.loader.getAllResponseHeaders())){var S=this.loader.getResponseHeader("age");s=S?parseFloat(S):null}return s},I}();C.default=_}}).default);var te=Be(me.exports);const Ue={name:"d-icon"},mt=Object.assign(Ue,{props:{icon:String,size:[Number,String]},setup:function(N){const C=N,f=Mt(()=>({fontSize:/^\d+$/.test(C.size)?C.size+"px":C.size}));return(R,E)=>(X(),z("i",{class:xt(["d-icon iconfont",N.icon]),style:Pt(K(f))},null,6))}});mt.__scopeId="data-v-0c690e66";_t("data-v-4cb76d59");const Ge={class:"d-player-top"},je={class:"top-title"},Ke={class:"top-title"};Rt();const Ve={props:{title:{default:""}},setup(N){Date.prototype.format=function(R){let E={"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds()};for(var A in E)new RegExp("("+A+")").test(R)&&(R=R.replace(RegExp.$1,RegExp.$1.length==1?E[A]:("00"+E[A]).substr((""+E[A]).length)));return R};let C=kt("00:00:00");C.value=new Date().format("hh:mm:ss");let f=null;return f=setInterval(()=>{C.value=new Date().format("hh:mm:ss")},1e3),ge(()=>{clearInterval(f)}),(R,E)=>(X(),z("div",Ge,[j("p",je,tt(N.title||""),1),j("p",Ke,tt(K(C)),1)]))},__scopeId:"data-v-4cb76d59"};_t("data-v-ac2469ec");const He={class:"d-status"},We={class:"d-flex-center"},Ye={class:"d-flex-center"},qe=dt("5X\u901F\u64AD\u653E\u4E2D ");Rt();var ye=Ht({props:["state"],setup:N=>(C,f)=>ft((X(),z("div",He,[ft(j("li",We,[Z(mt,{size:"18",class:"d-status-icon",icon:"icon-volume-"+(N.state.volume==0?"mute":N.state.volume>.5?"up":"down")},null,8,["icon"]),dt(" "+tt(~~(100*N.state.volume))+"% ",1)],512),[[gt,N.state.handleType=="volume"]]),ft(j("li",Ye,[Z(mt,{size:"12",icon:"icon-play"}),Z(mt,{size:"12",icon:"icon-play",style:{"margin-right":"5px"}}),qe],512),[[gt,N.state.handleType=="playbackRate"||N.state.isMultiplesPlay]])],512)),[[gt,N.state.handleType||N.state.isMultiplesPlay]])});ye.__scopeId="data-v-ac2469ec",_t("data-v-385f7870");const Xe=["checked","true-value","false-value"],ze=j("span",{class:"d-switch_action"},null,-1);Rt();var Zt=Ht({props:{modelValue:{type:[Number,String,Boolean]},width:{type:String,default:"40px"},trueValue:{type:[Number,String,Boolean],default:!0},falseValue:{type:[Number,String,Boolean],default:!0},activeColor:{type:[String],default:"#409EFF"}},emits:["update:modelValue","change"],setup(N,{emit:C}){const f=N;se(_=>({"014e5dc0":N.width,e4e32852:N.activeColor}));const R=kt(null),E=Mt(()=>f.modelValue===f.trueValue),A=()=>{ve(()=>{const _=R.value.checked;C("update:modelValue",_),C("change",_)})};return(_,I)=>(X(),z("div",{class:xt(["d-switch",{"is-checked":K(E)}])},[j("input",{class:"d-switch__input",ref:R,type:"checkbox",checked:K(E),onChange:A,"true-value":N.trueValue,"false-value":N.falseValue},null,40,Xe),ze],2))}});Zt.__scopeId="data-v-385f7870",_t("data-v-b2384226");const $e={key:0},Qe=j("i",{class:"rotating iconfont icon-loading f50"},null,-1),Ze=[j("i",{class:"rotating iconfont icon-loading f50"},null,-1),j("p",null,"\u6B63\u5728\u7F13\u51B2...",-1)],Je=[j("i",{class:"iconfont icon-replay f24 mr5"},null,-1),dt("\u91CD\u65B0\u64AD\u653E ")],tr=[j("i",{class:"iconfont icon-replay f24 mr5"},null,-1),dt("\u8BF7\u6C42\u9519\u8BEF ")];Rt();var Ee=Ht({props:{loadType:String,text:{type:String,default:""}},setup(N){const C=N,{proxy:f}=pe(),R=["loadstart","waiting","ended","error","stalled"],E=()=>{f.$parent.play()},A=Mt(()=>{let _="background: rgba(0, 0, 0, .1);z-index:1";return C.loadType=="loadstart"&&(_="background: rgba(0, 0, 0, 1);;z-index:3"),_});return(_,I)=>ft((X(),z("div",{class:"d-loading",style:Pt(K(A))},[j("div",null,[N.loadType=="loadstart"?(X(),z("span",$e,[Qe,j("p",null,tt(N.text),1)])):ot("",!0),ft(j("span",null,Ze,512),[[gt,N.loadType=="waiting"]]),ft(j("span",null,[j("p",{onClick:E,class:"d-flex-x d-pointer"},Je)],512),[[gt,N.loadType=="ended"]]),ft(j("span",null,[j("p",{onClick:E,class:"d-flex-x d-pointer"},tr)],512),[[gt,N.loadType=="error"||N.loadType=="stalled"]])])],4)),[[gt,R.includes(N.loadType)]])}});Ee.__scopeId="data-v-b2384226";const Ft=function(N,C,f,R=!1){N&&C&&f&&N.addEventListener(C,f,R)},ht=function(N,C,f,R=!1){N&&C&&f&&N.removeEventListener(C,f,R)};_t("data-v-5a794390");const er=["onMousedown"];Rt();var jt=Ht(ae(ne({},{name:"DSlider"}),{props:{modelValue:{required:!0,type:Number,default:0},disabled:{type:Boolean,default:!1},vertical:{type:Boolean,default:!1},hover:{type:Boolean,default:!0},hoverText:{type:String,default:""},preload:{type:Number,default:0},size:{type:String,default:"10px"}},emits:["update:modelValue","change","onMousemove"],setup:function(N,{emit:C}){const f=N;se(t=>({"5242b67b":N.size}));const R=kt(null),E=kt(null),A=$t({dragging:!1,hoverPosition:0,hoverTipsLeft:"50%"}),_=Mt(()=>{let t=f.modelValue<0?0:f.modelValue>1?1:f.modelValue;return f.vertical?`height:${100*t}%`:`width:${100*t}%`}),I=Mt(()=>{let t=f.preload<0?0:f.preload>1?1:f.preload;return f.vertical?`height:${100*t}%`:`width:${100*t}%`}),D=Mt(()=>{let t=A.hoverPosition<0?0:A.hoverPosition>1?1:A.hoverPosition;return f.vertical?`bottom:${100*t}%`:`left:${100*t}%`}),s=t=>{t.preventDefault()},S=t=>{f.disabled||(t.preventDefault(),A.dragging=!0,h(t),Ft(window,"mousemove",y),Ft(window,"touchmove",y),Ft(window,"mouseup",d),Ft(window,"touchend",d))},m=t=>{if(!f.hover)return;let a=T(t);if(C("onMousemove",t,a),A.hoverPosition=a,f.vertical)return;let e=R.value,o=E.value.clientWidth/2,u=t.clientX-e.getBoundingClientRect().left;u<o?A.hoverTipsLeft=o-u+"px":e.clientWidth-u<o?A.hoverTipsLeft=e.clientWidth-u-o+"px":A.hoverTipsLeft="50%"},h=t=>{let a=T(t);C("update:modelValue",a),C("change",t,a)},T=t=>{let a=R.value,e=0;if(f.vertical){let o=a.clientHeight;e=(a.getBoundingClientRect().bottom-t.clientY)/o}else e=(t.clientX-a.getBoundingClientRect().left)/a.clientWidth;return e<0?0:e>1?1:e},y=t=>{h(t)},d=t=>{A.dragging&&(ht(window,"mousemove",y),ht(window,"touchmove",y),ht(window,"mouseup",d),ht(window,"touchend",d),ht(window,"contextmenu",d),setTimeout(()=>{A.dragging=!1},0))};return(t,a)=>(X(),z("div",{ref:R,class:xt(["d-slider",{"is-vertical":f.vertical}]),onMousedown:Le(S,["stop"]),onContextmenu:s},[j("div",{class:"d-slider__runway",onMousemove:m},[ft(j("div",{class:"d-slider__cursor",style:Pt(K(D))},[ft(j("div",{class:"d-slider__tips",ref:E,style:Pt({left:K(A).hoverTipsLeft})},tt(f.hoverText),5),[[gt,f.hoverText]])],4),[[gt,f.hover]]),j("div",{class:"d-slider__preload",style:Pt(K(I))},null,4),j("div",{class:"d-slider__bar",style:Pt(K(_))},null,4)],32)],42,er))}}));jt.__scopeId="data-v-5a794390";_t("data-v-570fa0d1");const rr={key:0,class:"d-player-dialog"},ir={class:"d-player-dialog-body"},nr={class:"d-player-dialog-title"},ar={class:"d-player-hotkey-panel"},sr={class:"d-player-filter-panel"},or={class:"d-player-filter-panel-item"},lr=j("span",null,"\u9971\u548C\u5EA6",-1),ur={class:"d-player-filter-panel-item"},dr=j("span",null,"\u4EAE\u5EA6",-1),cr={class:"d-player-filter-panel-item"},hr=j("span",null,"\u5BF9\u6BD4\u5EA6",-1),fr={key:0,class:"d-player-contextmenu"},gr=["dplayerKeyCode"],vr=j("input",{class:"d-player-copyText"},null,-1);Rt();var Te=Ht({setup(N){const C=$t({show:!1,dialogType:"",dialogTitle:"",version:"1.3.1-beta.6",mouseX:0,mouseY:0}),f=[{label:"\u89C6\u9891\u8272\u5F69\u8C03\u6574",key:"filter"},{label:"\u5FEB\u6377\u952E\u8BF4\u660E",key:"hotkey"},{label:"\u590D\u5236\u89C6\u9891\u7F51\u5740",key:"copy"},{label:"\u7248\u672C\uFF1A1.3.1-beta.6",key:"version"}],R=[{key:"Space",label:"\u64AD\u653E/\u6682\u505C"},{key:"\u2192",label:"\u5355\u6B21\u5FEB\u8FDB10s\uFF0C\u957F\u63095\u500D\u901F\u64AD\u653E"},{key:"\u2190",label:"\u5FEB\u90005s"},{key:"\u2191",label:"\u97F3\u91CF\u589E\u52A010%"},{key:"\u2193",label:"\u97F3\u91CF\u589E\u52A0\u964D\u4F4E10%"},{key:"Esc",label:"\u9000\u51FA\u5168\u5C4F/\u9000\u51FA\u7F51\u9875\u5168\u5C4F"},{key:"F",label:"\u5168\u5C4F/\u9000\u51FA\u5168\u5C4F"}],E=$t({saturate:.392,brightness:.392,contrast:.392}),A=Mt(()=>({left:C.mouseX+"px",top:C.mouseY+"px"}));fe(E,S=>{let m=document.querySelector("#dPlayerVideo"),h=(2.55*S.saturate).toFixed(2),T=(2.55*S.brightness).toFixed(2),y=(2.55*S.contrast).toFixed(2);m.style.filter=`saturate(${h}) brightness(${T}) contrast(${y})`});const _=()=>{E.saturate=.392,E.brightness=.392,E.contrast=.392},I=S=>{S.key=="Escape"&&s(0)},D=S=>{S.preventDefault(),Ft(window,"keydown",I),Ft(window,"click",s);let m=document.querySelector("#refPlayerWrap"),h=m.clientWidth;m.clientHeight,C.mouseX=S.clientX-m.getBoundingClientRect().left,h-C.mouseX<130&&(C.mouseX=C.mouseX+(h-C.mouseX-130)),C.mouseY=S.clientY-m.getBoundingClientRect().top,C.show=!0},s=S=>{let m=S.path[0].tagName=="LI",h=S.path[0].attributes.dplayerKeyCode&&S.path[0].attributes.dplayerKeyCode.value,T=f.map(y=>y.key);if(m&&T.includes(h))if(C.dialogTitle=S.path[0].innerText,C.dialogType=h,h=="copy"){let y=document.querySelector(".d-player-copyText");y.value=window.location.href,y.select(),document.execCommand("copy"),C.dialogType=""}else h=="version"&&(C.dialogType="");C.show=!1,ht(window,"keydown",I),ht(window,"click",s)};return oe(()=>{let S=document.querySelector("#refPlayerWrap");ht(window,"keydown",I),ht(window,"click",s),ht(S,"contextmenu",D),Ft(S,"contextmenu",D)}),ge(()=>{let S=document.querySelector("#refPlayerWrap");ht(window,"keydown",I),ht(window,"click",s),ht(S,"contextmenu",D)}),(S,m)=>(X(),z("div",null,[Z(re,{name:"d-fade-in"},{default:Dt(()=>[K(C).dialogType?(X(),z("div",rr,[j("div",ir,[j("h5",nr,[dt(tt(K(C).dialogTitle)+" ",1),j("i",{onClick:m[0]||(m[0]=h=>K(C).dialogType=!1),class:"icon icon-close"},"X")]),ft(j("ul",ar,[(X(),z(Kt,null,Vt(R,h=>j("li",{class:"d-player-hotkey-panel-item",key:h.key},[j("span",null,tt(h.key),1),j("span",null,tt(h.label),1)])),64))],512),[[gt,K(C).dialogType=="hotkey"]]),ft(j("ul",sr,[j("li",or,[lr,Z(jt,{class:"filter-panel-slider",size:"5px",modelValue:K(E).saturate,"onUpdate:modelValue":m[1]||(m[1]=h=>K(E).saturate=h)},null,8,["modelValue"]),j("span",null,tt(Math.round(255*K(E).saturate)),1)]),j("li",ur,[dr,Z(jt,{class:"filter-panel-slider",size:"5px",modelValue:K(E).brightness,"onUpdate:modelValue":m[2]||(m[2]=h=>K(E).brightness=h)},null,8,["modelValue"]),j("span",null,tt(Math.round(255*K(E).brightness)),1)]),j("li",cr,[hr,Z(jt,{class:"filter-panel-slider",size:"5px",modelValue:K(E).contrast,"onUpdate:modelValue":m[3]||(m[3]=h=>K(E).contrast=h)},null,8,["modelValue"]),j("span",null,tt(Math.round(255*K(E).contrast)),1)]),j("span",{onClick:_,title:"\u91CD\u7F6E","aria-label":"\u91CD\u7F6E",class:"d-player-filter-reset"},"\u91CD\u7F6E")],512),[[gt,K(C).dialogType=="filter"]])])])):ot("",!0)]),_:1}),K(C).show?(X(),z("div",fr,[j("ul",{class:"d-player-contextmenu-body",style:Pt(K(A))},[(X(),z(Kt,null,Vt(f,h=>j("li",{dplayerKeyCode:h.key,key:h.key},tt(h.label),9,gr)),64))],4),vr])):ot("",!0)]))}});Te.__scopeId="data-v-570fa0d1";const ee=N=>{let C=~~(N/3600),f=~~(N%3600/60),R=~~(N%60);return C=C<10?"0"+C:C,f=f<10?"0"+f:f,R=R<10?"0"+R:R,`${C}:${f}:${R}`},zt="ontouchstart"in window,he=["loadstart","play","pause","playing","seeking","seeked","waiting","durationchange","progress","canplay","timeupdate","ended","error","stalled"],pr={width:{type:String,default:"800px"},height:{type:String,default:"450px"},color:{type:String,default:"#409eff"},src:{required:!0,type:String,default:""},title:{type:String,default:""},type:{type:String,default:"video/mp4"},poster:{type:String,default:""},webFullScreen:{type:Boolean,default:!1},speed:{type:Boolean,default:!0},currentTime:{type:Number,default:0},playsinline:{type:Boolean,default:!1},muted:{type:Boolean,default:!1},speedRate:{type:Array,default:()=>["2.0","1.5","1.25","1.0","0.75","0.5"]},autoPlay:{type:Boolean,default:!1},loop:{type:Boolean,default:!1},mirror:{type:Boolean,default:!1},ligthOff:{type:Boolean,default:!1},volume:{type:[String,Number],default:.3},control:{type:Boolean,default:!0},controlBtns:{type:Array,default:["audioTrack","quality","speedRate","volume","setting","pip","pageFullScreen","fullScreen"]},preload:{type:String,default:"auto"}};_t("data-v-01791e9e");const mr={class:"d-player-video",id:"dPlayerVideo"},yr=["controls","webkit-playsinline","playsinline","volume","muted","loop","preload","src","poster"],Er={class:"d-player-lightoff"},Tr={key:1,class:"d-player-state"},Sr={class:"d-play-btn"},br=["onKeyup","onKeydown"],Lr={class:"d-control-progress"},Ar={class:"d-tool-bar"},Dr={key:0,class:"d-tool-item d-tool-time audioTrack-btn"},kr=j("span",{style:{margin:"0 3px"}},"/",-1),_r={class:"total-time"},Rr={class:"d-tool-bar"},Ir={key:0,class:"d-tool-item quality-btn"},Cr={class:"d-tool-item-main"},wr={class:"speed-main",style:{"text-align":"center"}},Or=["onClick"],xr={key:1,class:"d-tool-item speedRate-btn"},Pr={class:"d-tool-item-main"},Fr={class:"speed-main"},Mr=["onClick"],Nr={key:2,class:"d-tool-item volume-btn"},Br={class:"d-tool-item-main volume-box",style:{width:"52px"}},Ur={class:"volume-text-size"},Gr={key:3,class:"d-tool-item setting-btn"},jr={class:"d-tool-item-main"},Kr={class:"speed-main"},Vr=dt(" \u955C\u50CF\u753B\u9762 "),Hr=dt(" \u5FAA\u73AF\u64AD\u653E "),Wr=dt(" \u5173\u706F\u6A21\u5F0F "),Yr=j("div",{class:"d-tool-item-main"},"\u753B\u4E2D\u753B",-1),qr=j("div",{class:"d-tool-item-main"},"\u7F51\u9875\u5168\u5C4F",-1),Xr=j("div",{class:"d-tool-item-main"},"\u5168\u5C4F",-1);Rt();var Qt=Ht(ae(ne({},{name:"vue3VideoPlay",inheritAttrs:!1}),{props:pr,emits:[...he,"mirrorChange","loopChange","lightOffChange"],setup:function(N,{expose:C,emit:f}){const R=N;se(w=>({"51d4439c":K(T),"77e758a6":w.width,b8a1afc0:w.height}));const E=new te({fragLoadingTimeOut:2e3}),A=kt(null),_=kt(null),I=kt(null),D=kt(null),s=$t(ae(ne({dVideo:null},R),{muted:R.muted,playBtnState:R.autoPlay?"pause":"play",loadStateType:"loadstart",fullScreen:!1,handleType:"",currentTime:"00:00:00",preloadBar:0,totalTime:"00:00:00",isVideoHovering:!0,speedActive:"1.0",playProgress:0,isMultiplesPlay:!1,longPressTimeout:null,progressCursorTime:"00:00:00",qualityLevels:[],currentLevel:0})),S=(...w)=>x=>w.reverse().reduce((P,F)=>F(P),x),m=he.reduce((w,x)=>{var P;return w[`on${P=x,P.charAt(0).toUpperCase()+P.slice(1)}`]=F=>{s.loadStateType=x,f(x,F)},w},{});m.onCanplay=S(m.onCanplay,()=>{s.playBtnState!="play"&&s.dVideo.play(),s.autoPlay&&(s.dVideo.play(),s.playBtnState="pause")}),m.onEnded=S(m.onEnded,()=>{s.playBtnState="replay"}),m.onDurationchange=w=>{f("durationchange",w),R.currentTime!=0&&(s.dVideo.currentTime=R.currentTime),m.onTimeupdate(w)},m.onProgress=w=>{console.log("\u7F13\u51B2\u4E2D..."),f("progress",w);let x=w.target.duration,P=w.target.buffered,F=w.target.buffered.length&&w.target.buffered.end(P-1);s.preloadBar=F/x},m.onTimeupdate=w=>{f("timeupdate",w);let x=w.duration||w.target.duration||0,P=w.currentTime||w.target.currentTime;s.playProgress=P/x,s.currentTime=ee(P),s.totalTime=ee(x)},m.onError=S(m.onError,()=>{s.playBtnState="replay"});let h=Ae();for(let w in h)m[w]=h[w];const T=(y=s.color,`${parseInt("0x"+y.slice(1,3))},${parseInt("0x"+y.slice(3,5))},${parseInt("0x"+y.slice(5,7))}`);var y;const d=ce(500,()=>{s.handleType=""}),t=w=>{w.preventDefault(),w.code=="ArrowUp"?s.volume=s.volume+.1>1?1:s.volume+.1:s.volume=s.volume-.1<0?0:s.volume-.1,s.muted=!1,s.handleType="volume",d()},a=w=>{R.speed&&(s.dVideo.currentTime=s.dVideo.currentTime<10?.1:s.dVideo.currentTime-10,m.onTimeupdate(s.dVideo),u())},e=w=>{w.preventDefault();let x=w.type;if(w.key=="ArrowRight"){if(u(),x=="keyup"){if(clearTimeout(s.longPressTimeout),!R.speed&&!s.longPressTimeout)return;s.isMultiplesPlay?(s.dVideo.playbackRate=s.speedActive,s.isMultiplesPlay=!1):(s.dVideo.currentTime=s.dVideo.currentTime+10,m.onTimeupdate(s.dVideo))}else if(x=="keydown"){if(!R.speed)return;s.isMultiplesPlay&&clearTimeout(s.longPressTimeout),s.longPressTimeout=setTimeout(()=>{s.isMultiplesPlay=!0,s.dVideo.playbackRate=5,s.handleType="playbackRate",d()},500)}}},o=()=>{zt||D.value.focus()},u=()=>{s.loadStateType="play",s.dVideo.play().catch(()=>{setTimeout(()=>{s.playBtnState="replay",s.loadStateType="error"},500)}),s.playBtnState="pause"},n=()=>{s.dVideo.pause(),s.playBtnState="play"},l=w=>{w&&w.preventDefault(),s.playBtnState=="play"||s.playBtnState=="replay"?u():s.playBtnState=="pause"&&n()},p=()=>{s.muted=!s.muted,s.volume==0&&(s.volume=.05)},g=(w,x)=>{let P=s.dVideo.duration||s.dVideo.target.duration;s.dVideo.currentTime=P*x,s.playBtnState=="play"&&(s.dVideo.play(),s.playBtnState="pause")},v=(w,x)=>{s.progressCursorTime=ee(s.dVideo.duration*x)},r=ce(2500,()=>{s.isVideoHovering=!1}),i=w=>{s.isVideoHovering=!0,r()},c=w=>{f("mirrorChange",w,s.dVideo)},b=w=>{f("loopChange",w,s.dVideo)},L=w=>{f("lightOffChange",w,s.dVideo)},k=()=>{var w;w=s.dVideo,document.pictureInPictureElement?document.exitPictureInPicture().catch(x=>{console.log(x,"Video failed to leave Picture-in-Picture mode.")}):w.requestPictureInPicture().catch(x=>{console.log(x,"Video failed to enter Picture-in-Picture mode.")})},O=()=>{s.fullScreen=(w=>{let x=document,P=x.webkitIsFullScreen||x.fullscreen;return P?(document.exitFullscreen||x.webkitExitFullScreen).call(x):(w.requestFullscreen||w.webkitRequestFullScreen).call(w),!P})(A.value)};return fe(()=>R.src,()=>{ve(()=>{s.dVideo.canPlayType(R.type)||s.dVideo.canPlayType("application/vnd.apple.mpegurl")?s.muted=R.autoPlay:te.isSupported()&&(E.detachMedia(),E.attachMedia(s.dVideo),E.on(te.Events.MEDIA_ATTACHED,()=>{E.loadSource(R.src),E.on("hlsManifestParsed",(w,x)=>{console.log(x),s.currentLevel=x.level,s.qualityLevels=x.levels||[]})}),E.on("hlsLevelSwitching",(w,x)=>{console.log(x),console.log("LEVEL_SWITCHING")}),E.on("hlsLevelSwitched",(w,x)=>{s.currentLevel=x.level,console.log("LEVEL_SWITCHED")}))})},{immediate:!0}),oe(()=>{s.dVideo=_,o()}),C({play:u,pause:n,togglePlay:l}),(w,x)=>(X(),z("div",{ref:A,id:"refPlayerWrap",class:xt(["d-player-wrap",{"web-full-screen":K(s).webFullScreen,"is-lightoff":K(s).lightOff,"d-player-wrap-hover":K(s).playBtnState=="play"||K(s).isVideoHovering}]),onMousemove:i},[j("div",mr,[j("video",De({ref:_,class:["d-player-video-main",{"video-mirror":K(s).mirror}],id:"dPlayerVideoMain",controls:!(!K(zt)||!K(s).speed),"webkit-playsinline":R.playsinline,playsinline:R.playsinline},K(m),{volume:K(s).volume,muted:K(s).muted,loop:K(s).loop,preload:w.preload,width:"100%",height:"100%",src:R.src,poster:R.poster}),"\u60A8\u7684\u6D4F\u89C8\u5668\u4E0D\u652F\u6301Video\u6807\u7B7E\u3002",16,yr)]),Z(re,{name:"d-fade-in"},{default:Dt(()=>[ft(j("div",Er,null,512),[[gt,K(s).lightOff]])]),_:1}),K(s).fullScreen?(X(),ie(Ve,{key:0,title:R.title},null,8,["title"])):ot("",!0),K(zt)?ot("",!0):(X(),z("div",Tr,[Z(re,{name:"d-scale-out"},{default:Dt(()=>[ft(j("div",Sr,[Z(mt,{icon:"icon-play",size:40})],512),[[gt,K(s).playBtnState=="play"]])]),_:1}),Z(ye,{state:K(s)},null,8,["state"])])),K(zt)?ot("",!0):(X(),z("input",{key:2,type:"input",readonly:"readonly",ref:D,onDblclick:O,onKeyup:[Xt(O,["f"]),x[0]||(x[0]=Xt(P=>K(s).webFullScreen=!1,["esc"])),e],onClick:l,onKeydown:[Xt(l,["space"]),Xt(a,["arrow-left"]),Xt(t,["arrow-up","arrow-down"]),e],class:"d-player-input",maxlength:"0"},null,40,br)),Z(Ee,{loadType:K(s).loadStateType},null,8,["loadType"]),Z(Te),!K(zt)&&K(s).control?(X(),z("div",{key:3,class:"d-player-control",ref:I},[j("div",Lr,[Z(jt,{class:"d-progress-bar",onOnMousemove:v,onChange:g,disabled:!K(s).speed,hoverText:K(s).progressCursorTime,modelValue:K(s).playProgress,"onUpdate:modelValue":x[1]||(x[1]=P=>K(s).playProgress=P),preload:K(s).preloadBar},null,8,["disabled","hoverText","modelValue","preload"])]),j("div",{class:"d-control-tool",onClick:o},[j("div",Ar,[j("div",{class:"d-tool-item",onClick:l},[Z(mt,{size:"24",icon:`icon-${K(s).playBtnState}`},null,8,["icon"])]),R.controlBtns.includes("audioTrack")?(X(),z("div",Dr,[j("span",null,tt(K(s).currentTime),1),kr,j("span",_r,tt(K(s).totalTime),1)])):ot("",!0)]),j("div",Rr,[K(s).qualityLevels.length&&R.controlBtns.includes("quality")?(X(),z("div",Ir,[dt(tt(K(s).qualityLevels.length&&(K(s).qualityLevels[K(s).currentLevel]||{}).height)+"P ",1),j("div",Cr,[j("ul",wr,[(X(!0),z(Kt,null,Vt(K(s).qualityLevels,(P,F)=>(X(),z("li",{class:xt({"speed-active":K(s).currentLevel==F}),onClick:M=>((B,U)=>{E.currentLevel=U,s.currentLevel=U})(0,F),key:P},tt(P.height)+"P",11,Or))),128))])])])):ot("",!0),R.controlBtns.includes("speedRate")?(X(),z("div",xr,[dt(tt(K(s).speedActive=="1.0"?"\u500D\u901F":K(s).speedActive+"x")+" ",1),j("div",Pr,[j("ul",Fr,[(X(!0),z(Kt,null,Vt(K(s).speedRate,P=>(X(),z("li",{class:xt({"speed-active":K(s).speedActive==P}),onClick:F=>(M=>{s.speedActive=M,s.dVideo.playbackRate=M})(P),key:P},tt(P)+"x",11,Mr))),128))])])])):ot("",!0),R.controlBtns.includes("volume")?(X(),z("div",Nr,[j("div",Br,[j("div",{class:xt(["volume-main",{"is-muted":K(s).muted}])},[j("span",Ur,tt(K(s).muted?0:~~(100*K(s).volume))+"%",1),Z(jt,{onChange:x[2]||(x[2]=P=>K(s).muted=!1),hover:!1,size:"5px",vertical:!0,modelValue:K(s).volume,"onUpdate:modelValue":x[3]||(x[3]=P=>K(s).volume=P)},null,8,["modelValue"])],2)]),j("span",{onClick:p,style:{display:"flex"}},[Z(mt,{size:"20",icon:"icon-volume-"+(K(s).volume==0||K(s).muted?"mute":K(s).volume>.5?"up":"down")},null,8,["icon"])])])):ot("",!0),R.controlBtns.includes("setting")?(X(),z("div",Gr,[Z(mt,{size:"20",class:"rotateHover",icon:"icon-settings"}),j("div",jr,[j("ul",Kr,[j("li",null,[Vr,Z(Zt,{onChange:c,modelValue:K(s).mirror,"onUpdate:modelValue":x[4]||(x[4]=P=>K(s).mirror=P)},null,8,["modelValue"])]),j("li",null,[Hr,Z(Zt,{onChange:b,modelValue:K(s).loop,"onUpdate:modelValue":x[5]||(x[5]=P=>K(s).loop=P)},null,8,["modelValue"])]),j("li",null,[Wr,Z(Zt,{onChange:L,modelValue:K(s).lightOff,"onUpdate:modelValue":x[6]||(x[6]=P=>K(s).lightOff=P)},null,8,["modelValue"])])])])])):ot("",!0),R.controlBtns.includes("pip")?(X(),z("div",{key:4,class:"d-tool-item pip-btn",onClick:k},[Z(mt,{size:"20",icon:"icon-pip"}),Yr])):ot("",!0),R.controlBtns.includes("pageFullScreen")?(X(),z("div",{key:5,class:"d-tool-item pip-btn",onClick:x[7]||(x[7]=P=>K(s).webFullScreen=!K(s).webFullScreen)},[Z(mt,{size:"20",icon:"icon-web-screen"}),qr])):ot("",!0),R.controlBtns.includes("fullScreen")?(X(),z("div",{key:6,class:"d-tool-item fullScreen-btn",onClick:O},[Xr,Z(mt,{size:"20",icon:"icon-screen"})])):ot("",!0)])])],512)):ot("",!0)],34))}}));function zr(N){N.component(Qt.name,Qt)}Qt.__scopeId="data-v-01791e9e",Qt.install=zr;const $r={name:"mvDetail",components:{CommentList:Oe,videoPlay:Qt},setup(N){const{proxy:C}=pe(),f=_e(),R=Re(),E=$t({mId:"0",mvDetail:{},type:1,videoOptions:{src:"",poster:""},simiMv:[]}),A=async()=>{const{data:s}=await C.$http.mvDetail({id:E.mId});if(s.code!==200)return C.$msg.error("\u6570\u636E\u8BF7\u6C42\u5931\u8D25");E.mvDetail=s.data,E.videoOptions.poster=s.data.cover},_=async s=>{const{data:S}=await C.$http.mvUrl({id:E.mId,r:s});if(S.code!==200)return C.$msg.error("\u6570\u636E\u8BF7\u6C42\u5931\u8D25");E.videoOptions.src=S.data.url},I=async()=>{const{data:s}=await C.$http.simiMv({id:E.mId});if(s.code!==200)return C.$msg.error("\u6570\u636E\u8BF7\u6C42\u5931\u8D25");E.simiMv=s.mvs},D=()=>{A(),_(),I()};return Ie(s=>{E.mId=s.query.id,D()}),oe(()=>{E.mId=f.query.id,D(),R.commit("SET_PLAYSTATUS",!1)}),{...Ce(E)}}},Wt=N=>(_t("data-v-7ad4b8b4"),N=N(),Rt(),N),Qr={key:0,class:"mv-detail"},Zr={class:"mv-main"},Jr={class:"mv-info-hd"},ti={class:"info-name"},ei=Wt(()=>j("i",{class:"iconfont icon-mv"},null,-1)),ri={class:"video-main"},ii={class:"mv-comment"},ni={class:"aside-box"},ai={class:"mv-info"},si=Wt(()=>j("h3",{class:"aside-title"},"MV\u7B80\u4ECB",-1)),oi={class:"mv-info-count"},li={class:"info-time"},ui={class:"info-count"},di={class:"mv-desc"},ci={class:"simi-mv"},hi=Wt(()=>j("h3",{class:"aside-title"},"\u76F8\u4F3CMV",-1)),fi={class:"aside-main mv-main"},gi=Wt(()=>j("i",{class:"iconfont icon-play"},null,-1)),vi=Wt(()=>j("div",{slot:"placeholder",class:"image-slot"},[j("i",{class:"iconfont icon-placeholder"})],-1)),pi={class:"info"},mi={class:"mv-playCount"},yi=Wt(()=>j("i",{class:"iconfont icon-mvlist"},null,-1)),Ei={key:1,class:"mv-time"};function Ti(N,C,f,R,E,A){const _=Jt("router-link"),I=Jt("videoPlay"),D=Jt("comment-list"),s=we;return N.videoOptions.src?(X(),z("div",Qr,[j("div",Zr,[j("div",Jr,[j("div",ti,[ei,dt(tt(N.mvDetail.name),1)]),(X(!0),z(Kt,null,Vt(N.mvDetail.artists,(S,m)=>(X(),ie(_,{to:{path:"/singer",query:{id:S.id}},class:"song-author",key:S.name},{default:Dt(()=>[dt(tt(m!==0?" / "+S.name:S.name),1)]),_:2},1032,["to"]))),128))]),j("div",ri,[Z(I,{width:"100%",height:"100%",poster:N.videoOptions.poster,src:N.videoOptions.src},null,8,["poster","src"])]),j("div",ii,[Z(D,{type:N.type,sId:N.mId},null,8,["type","sId"])])]),j("div",ni,[j("div",ai,[si,j("div",oi,[j("div",li,"\u53D1\u5E03\u65F6\u95F4\uFF1A"+tt(N.mvDetail.publishTime),1),j("div",ui,"\u64AD\u653E\u91CF\uFF1A"+tt(N.$utils.formartNum(N.mvDetail.playCount)),1)]),j("div",di,tt(N.mvDetail.desc?N.mvDetail.desc:"\u6682\u65E0\u7B80\u4ECB"),1)]),j("div",ci,[hi,j("div",fi,[(X(!0),z(Kt,null,Vt(N.simiMv,(S,m)=>(X(),z("div",{class:"item",key:""+S.id+m},[Z(_,{to:{path:"/mvlist/mv",query:{id:S.id}},class:"faceImg"},{default:Dt(()=>[gi,Z(s,{src:S.cover||S.imgurl},{default:Dt(()=>[vi]),_:2},1032,["src"])]),_:2},1032,["to"]),j("div",pi,[Z(_,{to:{path:"/mvlist/mv",query:{id:S.id}},class:"mv-name"},{default:Dt(()=>[dt(tt(S.name),1)]),_:2},1032,["to"]),S.publishTime?ot("",!0):(X(),ie(_,{key:0,to:{path:"/singer",query:{id:S.artistId}},class:"mv-author"},{default:Dt(()=>[dt(tt(S.artistName),1)]),_:2},1032,["to"])),j("div",mi,[yi,dt(" "+tt(N.$utils.formartNum(S.playCount)),1)]),S.publishTime?(X(),z("div",Ei,"\u53D1\u5E03\u65F6\u95F4\uFF1A"+tt(S.publishTime),1)):ot("",!0)])]))),128))])])])])):ot("",!0)}var Li=ke($r,[["render",Ti],["__scopeId","data-v-7ad4b8b4"]]);export{Li as default};
